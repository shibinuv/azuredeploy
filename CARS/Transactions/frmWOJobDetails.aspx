    <%@ Page Language="vb" AutoEventWireup="false" CodeBehind="frmWOJobDetails.aspx.vb" Inherits="CARS.frmWOJobDetails" MasterPageFile="~/MasterPage.Master" ValidateRequest="false" %>

<%@ Register Assembly="DevExpress.Web.v21.2, Version=21.2.7.0, Culture=neutral, PublicKeyToken=b88d1754d700e49a" Namespace="DevExpress.Web" TagPrefix="dx" %>
<asp:Content ID="Content1" ContentPlaceHolderID="cntMainPanel" runat="Server">
    <style type="text/css">
        .ui-jqgrid-disablePointerEvents {
            pointer-events: none;
        }
        .ui-jqgrid tr.ui-row-ltr td {
            text-align: center;
        }
        .context-menu-list {
            z-index: 10;
        }
        .ui-state-hover, .ui-widget-content .ui-state-hover, .ui-widget-header .ui-state-hover, .ui-state-focus, .ui-widget-content .ui-state-focus, .ui-widget-header .ui-state-focus {
            border: 1px solid #999999;
            font-weight: normal;
            color: #212121;
            background-color: white;
        }

        /*added for dialog close button */
        .ui-dialog .ui-dialog-titlebar-close span {
            display: block;
           margin-bottom: 0px;
            padding: 0px;
            margin-left: -9px;
            margin-top: -9px;
        }
        

        .ui-dialog .ui-dialog-titlebar button.ui-button:focus,
        .ui-dialog .ui-dialog-titlebar button.ui-button.ui-state-focus,
        .ui-dialog .ui-dialog-titlebar button.ui-button.ui-state-active,
        .ui-dialog .ui-dialog-titlebar button.ui-button.ui-state-hover {
            outline: none;
        }
    

        .ui-dialog .ui-dialog-content{
            overflow:hidden;
        }
        .popupContent{
            width: 33%;
            height: 300px;
            text-align: center;
            padding-top:25%;
        }

        .ui-jqgrid .ui-pg-input{
            width: 25% !important;
            vertical-align: middle !important;
        }

        .statusBar a:first-child  
        {  
            display: none;  
        }
        .cls .dxeListBoxItem_Office2010Blue  { 
            height:25px;
            font-size:small;
        }
        .cls .dxeListBoxItem_Office2010Blue.dxeListBoxItemSelected_Office2010Blue.dxeListBoxItemHover_Office2010Blue  {  
            background: blue !important;  
            height:28px;
        }
        .customMlMemo{
            height:80px;
            width:200px;
        }
        .popupContentMiddle{
            width: 33%;
            height: 300px;
            text-align: center;
            padding-top:6%;
            border-right: 2px solid #aaa;
        }
    </style>

    <script type="text/javascript">
        var apiUserName = '';
        var apiPassword = '';
        var nbkLabPer = 0.0;
        var labourLinesCount=0;
        var textLinesCount = 0;
        var pageSizeSet;
        var supplierStockId = '';
        var dealerNoSpare = '';
        $(document).ready(function () {
            $('#btnCatalogue').hide();
            $('#btnHentPris').hide();
            $('#divSPGrid').hide();
            $('#divSelSPGrid').hide();
            $('#<%=txtMechanic.ClientID%>').hide();
             pageSizeSet = document.getElementById('<%=hdnPageSize.ClientID%>').value;

            var dateFormat = "";
            if ($('#<%=hdnDateFormat.ClientID%>').val() == "dd.MM.yyyy") {
                dateFormat = "dd.mm.yy"
            }
            else {
                dateFormat = "dd/mm/yy"
            }

            $(function () {
                $('.ui.dropdown').dropdown();
            });

            var getUrlParameter = function getUrlParameter(sParam) {
                var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                    sURLVariables = sPageURL.split('&'),
                    sParameterName,
                    i;

                for (i = 0; i < sURLVariables.length; i++) {
                    sParameterName = sURLVariables[i].split('=');

                    if (sParameterName[0] === sParam) {
                        return sParameterName[1] === undefined ? true : sParameterName[1];
                    }
                }
            };
            var userId = '<%= Session("UserID")%>';
            let arrayOfValues = [];
            var messageText = "";
            var woNumber = getUrlParameter('Wonumber');
            var woPrefix = getUrlParameter('WOPrefix');
            var searchmode = getUrlParameter('Mode');
            var woSearchflag = getUrlParameter('Flag');
            var blWOsearch = getUrlParameter('blWOsearch');

            woNumber = decodeURIComponent(woNumber);
            woPrefix = decodeURIComponent(woPrefix);
            searchmode = decodeURIComponent(searchmode);
            woSearchflag = decodeURIComponent(woSearchflag);
            blWOsearch = decodeURIComponent(blWOsearch);

            loadInit();
            function loadInit() {
                $('#<%=hdnWoNo.ClientID%>').val("");
                $('#<%=hdnWoPr.ClientID%>').val("");
                $('#<%=lblOrderNo.ClientID%>').text("");
                setTab('Head');
                 $('.GenDamage').hide();
                $('#exclamIcon').hide();
                $('#exclamOrderIcon').hide();
                $('#exclamCustomerIcon').hide();
       
            }
            ///Head Tab
            FillType();
            FillStatus();
            FillPayType();
            FillPayTerms();
            FillCustGroup();
            FillMake();
            FillPayType();
            fillOrderSpareStatus();
           // FillNewModel();
            //loadSrchMake();
            $('#<%=lnkDefect.ClientID%>').hide();
            $('#<%=lst_veh.ClientID%>').hide();

            //Load select dropdowns in pop-up 
            loadDefaultMake();
            loadDefaultSpSupplier();
            loadDefaultLocation();
            $('.coupled.modal')
                .modal({
                    allowMultiple: true
                })
                ;
            // open second modal on first modal buttons
            $('.two.modal')
                .modal('attach events', '.first.modal #engineOilAnnot')
                ;
            $('.three.modal')
                .modal('attach events', '.first.modal #cFLevelAnnot')
                ;
            $('.four.modal')
                .modal('attach events', '.first.modal #cfTempAnnot')
                ;
            $('.five.modal')
                .modal('attach events', '.first.modal #brakeFluidAnnot')
                ;
            $('.six.modal')
                .modal('attach events', '.first.modal #batteryAnnot')
                ;
            $('.seven.modal')
                .modal('attach events', '.first.modal #vipesFrontAnnot')
                ;
            $('.eight.modal')
                .modal('attach events', '.first.modal #vipesBackAnnot')
                ;
            $('.nine.modal')
                .modal('attach events', '.first.modal #lightsFrontAnnot')
                ;
            $('.ten.modal')
                .modal('attach events', '.first.modal #lightsBackAnnot')
                ;
            $('.eleven.modal')
                .modal('attach events', '.first.modal #bumperFrontAnnot')
                ;
            $('.twelve.modal')
                .modal('attach events', '.first.modal #bumperBackAnnot')
                ;
            $('.thirteen.modal')
                .modal('attach events', '.first.modal #tiresFrontAnnot')
                ;
            $('.fourteen.modal')
                .modal('attach events', '.first.modal #tiresBackAnnot')
                ;
            $('.fifteen.modal')
                .modal('attach events', '.first.modal #suspensionFrontAnnot')
                ;
            $('.sixteen.modal')
                .modal('attach events', '.first.modal #suspensionBackAnnot')
                ;
            $('.seventeen.modal')
                .modal('attach events', '.first.modal #brakesFrontAnnot')
                ;
            $('.eighteen.modal')
                .modal('attach events', '.first.modal #brakesBackAnnot')
                ;
            $('.nineteen.modal')
                .modal('attach events', '.first.modal #exhaustAnnot')
                ;
            $('.twenty.modal')
                .modal('attach events', '.first.modal #sealedEngineAnnot')
                ;
            $('.twentyone.modal')
                .modal('attach events', '.first.modal #sealedGearboxAnnot')
                ;
            // show first immediately
           
            //Populate the saved data      

            //var arrMake = ['VO', 'VP'];

            //$('.ui.fluid.dropdown').dropdown('set selected', arrMake);
            //$('.ui.fluid.dropdown').dropdown('set selected', ['697', '702']);
            //$('.ui.fluid.dropdown').dropdown('set selected', ['A', 'B']);
          
            if (blWOsearch == "true") {
                if (woNumber != "" && woPrefix != "") {
                    $(document.getElementById('<%=hdnWoNo.ClientID%>')).val(woNumber);
                    $(document.getElementById('<%=hdnWoPr.ClientID%>')).val(woPrefix);
                    $('#<%=lblOrderNo.ClientID%>').text(woPrefix + woNumber);
                    var Flag = getUrlParameter('Flag');
                    $('#<%=lst_veh.ClientID%>').hide();
                    $('#<%=txtSrchVeh.ClientID%>').show();
                    PopulateWODetails(woNumber, woPrefix, Flag);

                } else {
                    $(document.getElementById('<%=hdnWoNo.ClientID%>')).val("");
                    $(document.getElementById('<%=hdnWoPr.ClientID%>')).val("");
                }
            }

            $.datepicker.setDefaults($.datepicker.regional["no"]);
            $('#<%=txtDeliveryDate.ClientID%>').datepicker({
                //showWeek: true,
                //showOn: "button",
                //buttonImage: "../images/calendar_icon.gif",
                // buttonImageOnly: true,
                // buttonText: "Velg dato",
                showButtonPanel: true,
                changeMonth: true,
                changeYear: true,
                yearRange: "-50:+1",
                dateFormat: dateFormat
            });

            $('#<%=txtFinishDate.ClientID%>').datepicker({
                //showWeek: true,
                //showOn: "button",
                //buttonImage: "../images/calendar_icon.gif",
                //buttonImageOnly: true,
                // buttonText: "Velg dato",
                showButtonPanel: true,
                changeMonth: true,
                changeYear: true,
                yearRange: "-50:+1",
                dateFormat: dateFormat
            });

            $('#<%=txtDeliveryTime.ClientID%>').change(function (e) {
                fnValidateTime();
            });

            function fnValidateTime() {
                if ($('#<%=txtDeliveryTime.ClientID%>').val() != '') {
                    Validatetime($('#<%=txtDeliveryTime.ClientID%>'));
                }
            }

            $('#<%=txtDeliveryDate.ClientID%>').keyup(function () {
                if ($(this).val().length == 2 || $(this).val().length == 5) {
                    $(this).val($(this).val() + $('#<%=hdnDateFormatLang.ClientID%>').val());
                }
            });

            $('#custMoreInfo').click(function (e) {
                e.preventDefault();
                if ($('#<%=txtSrchCust.ClientID%>').val().length > 0) {
                    var custId = $('#<%=txtSrchCust.ClientID%>').val();
                    //window.open("../Master/frmCustomerDetail.aspx?cust=" + custId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                   // window.showModalDialog("../Master/frmCustomerDetail.aspx?cust=" + custId, window.self, "dialogHeight:700px;dialogWidth:1000px;resizable:no;center:yes;scroll:yes;");
                    moreInfo('../Master/frmCustomerDetail.aspx?cust=' + custId + '&pageName=OrderHead', 'Kundedetaljer');
                }
                else {
                    moreInfo('../Master/frmCustomerDetail.aspx?pageName=OrderHead', 'Kundedetaljer');
                }
            });

            
           

            $('#vehMoreInfo').click(function (e) {
                e.preventDefault();
                if ($('#<%=txtInternalNo.ClientID%>').val().length > 0) {
                    var intNo = $('#<%=txtInternalNo.ClientID%>').val();
                    //window.open("../Master/frmVehicleDetail.aspx?refno=" + vehId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                    //window.showModalDialog("../Master/frmVehicleDetail.aspx?refno=" + vehId, window.self, "dialogHeight:700px;dialogWidth:1000px;resizable:no;center:yes;scroll:yes;");
                    moreInfo('../Master/frmVehicleDetail.aspx?refno=' + intNo + '&pageName=OrderHead', 'KjÃ¸retÃ¸ydetaljer');
                } 
               else if ($('#<%=txtSrchVeh.ClientID%>').val().length > 0) {
                    var regno = $('#<%=txtSrchVeh.ClientID%>').val();
                     //window.open("../Master/frmVehicleDetail.aspx?refno=" + vehId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                     //window.showModalDialog("../Master/frmVehicleDetail.aspx?refno=" + vehId, window.self, "dialogHeight:700px;dialogWidth:1000px;resizable:no;center:yes;scroll:yes;");
                     moreInfo('../Master/frmVehicleDetail.aspx?regno=' + regno + '&veh=new&pageName=OrderHead', 'KjÃ¸retÃ¸ydetaljer');
                }
                else {
                    moreInfo('../Master/frmVehicleDetail.aspx?&pageName=OrderHead', 'KjÃ¸retÃ¸ydetaljer');
                }
                
            });

            //To open the customer/vehicle page as modal popup
            function moreInfo(page, title) {
                //var page = '../Master/frmCustomerDetail.aspx';

                var $dialog = $('<div id="testdialog"></div>')
                               .html('<iframe id="testifr" style="border: 0px;" src="' + page + '" width="1000px" height="800px"></iframe>')
                               .dialog({
                                   autoOpen: false,
                                   modal: true,
                                   height: 800,
                                   width: '80%',
                                   title: title
                               });
                $dialog.dialog('open');
            }

            $('#<%=ddlMake.ClientID%>').change(function (e) {
                var makeId = $('#<%=ddlMake.ClientID%>').val();
            });

            $('#<%=ddlCusGroup.ClientID%>').change(function (e) {
                var custGrpId = $('#<%=ddlCusGroup.ClientID%>').val();
                FillPayDet(custGrpId);
            });

            $('#<%=lst_veh.ClientID%>').change(function (e) {
                console.log("lst_veh change");
                $('#<%=lst_veh.ClientID%>').hide();
                $('#<%=txtSrchVeh.ClientID%>').show();
                var vehId = $('#<%=lst_veh.ClientID%>')[0].value;
                $('#<%=txtSrchVeh.ClientID%>').val(vehId);
                FillVehDet(vehId);
            });

            $('#<%=txtSrchVeh.ClientID%>').change(function (e) {
                var vehId = $('#<%=txtSrchVeh.ClientID%>').val();
                var retVal = validateVeh(vehId);
                if (retVal == "False") {
                    alert("Vehicle does not exist. Do you want to create a new vehicle?");
                   // window.open("../Master/frmVehicleDetail.aspx?vehid=" + vehId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                  //  window.showModalDialog("../Master/frmVehicleDetail.aspx?vehid=" + vehId, window.self, "dialogHeight:700px;dialogWidth:1000px;resizable:no;center:yes;scroll:yes;");
                    moreInfo("../Master/frmVehicleDetail.aspx?vehId=" + vehId + "&veh=new&pageName= OrderHead");
                }
                //loadXtraCheck();
            });

            $('#<%=txtSrchCust.ClientID%>').change(function (e) {
                var custId = $('#<%=txtSrchCust.ClientID%>').val();
                var retVal = validateCust(custId);
                if (retVal == "False") {
                    if ($('#<%=txtSrchCust.ClientID%>').val().length > 0) {
                        alert("Do you want to create that customer?");
                        //window.open("../Master/frmCustomerDetail.aspx?cust=" + custId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                        // window.showModalDialog("../Master/frmCustomerDetail.aspx?custId=" + custId, window.self, "dialogHeight:700px;dialogWidth:1000px;resizable:no;center:yes;scroll:yes;");
                        moreInfo("../Master/frmCustomerDetail.aspx?custId=" + custId + "&pageName= OrderHead");
                    }
                }
            });

            // PopulateWODetails(WoNo, WoPr);
            var cust = $('#<%=txtSrchCust.ClientID%>').val();
            $('#<%=txtSrchCust.ClientID%>').autocomplete({
                selectFirst: true,
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "frmWoSearch.aspx/Customer_Search",
                        data: "{'q':'" + $('#<%=txtSrchCust.ClientID%>').val() + "', 'isPrivate': '" + true + "', 'isCompany': '" + true + "'}",
                        dataType: "json",

                        success: function (data) {
                            response($.map(data.d, function (item) {
                                return {
                                    label: item.CUST_FIRST_NAME + " " + item.CUST_MIDDLE_NAME + " " + item.CUST_LAST_NAME + " - " + item.CUST_PERM_ADD1 + " - " + item.ID_CUST_PERM_ZIPCODE + " " + item.CUST_PERM_CITY,
                                    val: item.ID_CUSTOMER,
                                    value: item.ID_CUSTOMER
                                }
                            }))
                        },
                        error: function (xhr, status, error) {
                            alert("Error" + error);
                            <%--$('#systemMSG').hide();--%>
                            var err = eval("(" + xhr.responseText + ")");
                            alert('Error: ' + err.Message);
                        }
                    });
                },
                select: function (e, i) {
                    $("#<%=txtSrchCust.ClientID%>").val(i.item.val);
                    FillCustDet($("#<%=txtSrchCust.ClientID%>").val());
                    FillVehDrpDwn($("#<%=txtSrchCust.ClientID%>").val());
                    //LoadNonInvoiceOrderDet($('#<%=txtSrchCust.ClientID%>').val());
                },
            });





            //Insurance tab Customer field
            $('#<%=txtInsCustID.ClientID%>').autocomplete({
                selectFirst: true,
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "frmWoSearch.aspx/Customer_Search",
                        data: "{'q':'" + $('#<%=txtInsCustID.ClientID%>').val() + "', 'isPrivate': '" + true + "', 'isCompany': '" + true + "'}",
                        dataType: "json",

                        success: function (data) {
                            response($.map(data.d, function (item) {
                                return {
                                    label: item.CUST_FIRST_NAME + " " + item.CUST_MIDDLE_NAME + " " + item.CUST_LAST_NAME + " - " + item.CUST_PERM_ADD1 + " - " + item.ID_CUST_PERM_ZIPCODE + " " + item.CUST_PERM_CITY,
                                    val: item.ID_CUSTOMER,
                                    value: item.ID_CUSTOMER
                                }
                            }))
                        },
                        error: function (xhr, status, error) {
                            alert("Error" + error);
                            <%--$('#systemMSG').hide();--%>
                            var err = eval("(" + xhr.responseText + ")");
                            alert('Error: ' + err.Message);
                        }
                    });
                },
                select: function (e, i) {
                    $("#<%=txtInsCustID.ClientID%>").val(i.item.val);
                    $('#<%=hdnInsCustId.ClientID%>').val(i.item.val);
                    $('#<%=hdnDbtSeq.ClientID%>').val("");
                    if ($("#<%=txtInsCustID.ClientID%>").val() != "") {
                        FillInsCustDet($("#<%=txtInsCustID.ClientID%>").val(),"add");
                    }                    
                },
            });


            //Internal Customer
            $('#<%=txtIntCustID.ClientID%>').autocomplete({
                selectFirst: true,
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "frmWoSearch.aspx/Customer_Search",
                        data: "{'q':'" + $('#<%=txtIntCustID.ClientID%>').val() + "', 'isPrivate': '" + true + "', 'isCompany': '" + true + "'}",
                        dataType: "json",

                        success: function (data) {
                            response($.map(data.d, function (item) {
                                return {
                                    label: item.CUST_FIRST_NAME + " " + item.CUST_MIDDLE_NAME + " " + item.CUST_LAST_NAME + " - " + item.CUST_PERM_ADD1 + " - " + item.ID_CUST_PERM_ZIPCODE + " " + item.CUST_PERM_CITY,
                                    val: item.ID_CUSTOMER,
                                    value: item.ID_CUSTOMER
                                }
                            }))
                        },
                        error: function (xhr, status, error) {
                            alert("Error" + error);
                            <%--$('#systemMSG').hide();--%>
                            var err = eval("(" + xhr.responseText + ")");
                            alert('Error: ' + err.Message);
                        }
                    });
                },
                select: function (e, i) {
                    $("#<%=txtIntCustID.ClientID%>").val(i.item.val);
                    $('#<%=hdnIntCustId.ClientID%>').val(i.item.val);
                    $('#<%=hdnIntDbtSeq.ClientID%>').val("");
                    if ($("#<%=txtIntCustID.ClientID%>").val() != "") {
                        FillIntCustDet($("#<%=txtIntCustID.ClientID%>").val(),"add");
                    }
                },
            });

            //Claim Customer
            $('#<%=txtClaimCustID.ClientID%>').autocomplete({
                selectFirst: true,
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "frmWoSearch.aspx/Customer_Search",
                        data: "{'q':'" + $('#<%=txtClaimCustID.ClientID()%>').val() + "', 'isPrivate': '" + true + "', 'isCompany': '" + true + "'}",
                        dataType: "json",

                        success: function (data) {
                            response($.map(data.d, function (item) {
                                return {
                                    label: item.CUST_FIRST_NAME + " " + item.CUST_MIDDLE_NAME + " " + item.CUST_LAST_NAME + " - " + item.CUST_PERM_ADD1 + " - " + item.ID_CUST_PERM_ZIPCODE + " " + item.CUST_PERM_CITY,
                                    val: item.ID_CUSTOMER,
                                    value: item.ID_CUSTOMER
                                }
                            }))
                        },
                        error: function (xhr, status, error) {
                            alert("Error" + error);
                            <%--$('#systemMSG').hide();--%>
                            var err = eval("(" + xhr.responseText + ")");
                            alert('Error: ' + err.Message);
                        }
                    });
                },
                select: function (e, i) {
                    $("#<%=txtClaimCustID.ClientID%>").val(i.item.val);
                    $('#<%=hdnClaimCustId.ClientID%>').val(i.item.val);
                    $('#<%=hdnClaimDbtSeq.ClientID%>').val("");
                    if ($("#<%=txtClaimCustID.ClientID%>").val() != "") {
                        FillClaimCustDet($("#<%=txtClaimCustID.ClientID%>").val(),"add");
                    }
                },
            });

            //Misc Customer
            $('#<%=txtMiscCustID.ClientID%>').autocomplete({
                selectFirst: true,
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "frmWoSearch.aspx/Customer_Search",
                        data: "{'q':'" + $('#<%=txtMiscCustID.ClientID()%>').val() + "', 'isPrivate': '" + true + "', 'isCompany': '" + true + "'}",
                        dataType: "json",

                        success: function (data) {
                            response($.map(data.d, function (item) {
                                return {
                                    label: item.CUST_FIRST_NAME + " " + item.CUST_MIDDLE_NAME + " " + item.CUST_LAST_NAME + " - " + item.CUST_PERM_ADD1 + " - " + item.ID_CUST_PERM_ZIPCODE + " " + item.CUST_PERM_CITY,
                                    val: item.ID_CUSTOMER,
                                    value: item.ID_CUSTOMER
                                }
                            }))
                        },
                        error: function (xhr, status, error) {
                            alert("Error" + error);
                            <%--$('#systemMSG').hide();--%>
                            var err = eval("(" + xhr.responseText + ")");
                            alert('Error: ' + err.Message);
                        }
                    });
                },
                select: function (e, i) {
                   

                    $("#<%=txtMiscCustID.ClientID%>").val(i.item.val);
                    $('#<%=hdnMiscCustId.ClientID%>').val(i.item.val);
                    $('#<%=hdnMiscDbtSeq.ClientID%>').val("");
                    if ($("#<%=txtMiscCustID.ClientID%>").val() != "") {
                        FillMiscCustDet($("#<%=txtMiscCustID.ClientID%>").val(),"add");
                    }
                },
            });


            $('#<%=txtSrchVeh.ClientID%>').autocomplete({
                selectFirst: true,
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "frmWOHead.aspx/GetVehicle",
                        data: "{'vehicleRegNo':'" + $('#<%=txtSrchVeh.ClientID%>').val() + "'}",
                        dataType: "json",
                        success: function (data) {
                            response($.map(data.d, function (item) {
                                return {
                                    label: item.split('-')[0] + "-" + item.split('-')[1] + "-" + item.split('-')[2],
                                    val: item.split('-')[0],
                                    value: item.split('-')[0]
                                }
                            }))
                        },
                        error: function (xhr, status, error) {
                            alert("Error" + error);
                            <%--$('#systemMSG').hide();--%>
                            var err = eval("(" + xhr.responseText + ")");
                            alert('Error: ' + err.Message);
                        }
                    });
                },
                select: function (e, i) {
                    $("#<%=txtSrchVeh.ClientID%>").val(i.item.value);
                    FillVehDet($("#<%=txtSrchVeh.ClientID%>").val());

                }
            });

            $('#<%=txtZipCode.ClientID%>').autocomplete({
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "frmWOHead.aspx/GetZipCodes",
                        data: "{'zipCode':'" + $('#<%=txtZipCode.ClientID%>').val() + "'}",
                        dataType: "json",
                        success: function (data) {
                            $('#<%=hdnNewZip.ClientID%>').val("1");
                            response($.map(data.d, function (item) {
                                return {
                                    label: item.split('-')[0] + "-" + item.split('-')[3],
                                    val: item.split('-')[0],
                                    value: item.split('-')[0],
                                    country: item.split('-')[1],
                                    state: item.split('-')[2],
                                    city: item.split('-')[3],
                                }
                            }))
                        },
                        error: function (xhr, status, error) {
                            $('#<%=hdnNewZip.ClientID%>').val("0");
                            alert("Error" + error);
                            var err = eval("(" + xhr.responseText + ")");
                            alert('Error Response ' + err.Message);
                        }
                    });
                },
                select: function (e, i) {
                    $("#<%=txtZipCode.ClientID%>").val(i.item.val);
                 
                    $("#<%=txtState.ClientID%>").val(i.item.state);
                },
            });

           //Mechanic Autocomplete
            $('#<%=txtMechName.ClientID%>').autocomplete({

                selectFirst: true,
                autoFocus: true,
                source: function (request, response) {
                    $.ajax({
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "../master/frmMechanicSetting.aspx/Mechanic_Search",
                        data: "{q:'" + $('#<%=txtMechName.ClientID%>').val() + "'}",
                        dataType: "json",
                        success: function (data) {
                            console.log($('#<%=txtMechName.ClientID%>').val());
                            if (data.d.length === 0) {
                                response([{ label: 'Unable to find record ', value: '', val: 'new' }]);
                            } else
                                response($.map(data.d, function (item) {
                                    return {
                                        label: item.Id_Login + " - " + item.First_Name + " " + item.Last_Name,
                                        val: item.Id_Login ,
                                        value:item.First_Name + " " + item.Last_Name
                                    }
                                }))
                        },
                        error: function (xhr, status, error) {
                            alert("Error" + error);
                            var err = eval("(" + xhr.responseText + ")");
                            alert('Error: ' + err.Message);
                        }
                    });
                },
                select: function (e, i) {
                    //var fullMechanicDetail = i.item.value.split("-");
                    //mechanicFullName = fullMechanicDetail[1];
                    //mecIdLogin = i.item.val;
                    $('#<%=txtMechanic.ClientID%>').val(i.item.val);
                }

            });


            function saveXtraCheck()
            {
                // 0 = good,  1= ok, 2=action should be taken
                
                var motoroil;
                var cflevel;
                var cftemp;
                var brakefluid;
                var battery;
                var vipesfront;
                var vipesrear;
                var lightsfront;
                var lightsrear;
                var shockabsorberfront;
                var shockabsorberrear;
                var tiresfront;
                var tiresrear;
                var suspensionfront;
                var suspensionrear;
                var brakesfront;
                var brakesrear;
                var exhaust;
                var sealedengine;
                var sealedgearbox;

          

                


                if ($('#engineOilGoodBox').hasClass("checkmark")) { motoroil = 0; }
                else if ($('#engineOilOKBox').hasClass("checkmark")) { motoroil = 1; }
                else if ($('#engineOilBadBox').hasClass("checkmark")) { motoroil = 2; }
                else { motoroil = -1 }
                
                if ($('#cFLevelGoodBox').hasClass("checkmark"))         { cflevel = 0; }
                else if ($('#cFLevelOKBox').hasClass("checkmark"))           { cflevel = 1; }
                else if ($('#cFLevelBadBox').hasClass("checkmark")) { cflevel = 2; }
                else { cflevel = -1 }

                if ($('#cFTempGoodBox').hasClass("checkmark"))          { cftemp = 0; }
                else if ($('#cFTempOKBox').hasClass("checkmark"))            { cftemp = 1; }
                else if ($('#cFTempBadBox').hasClass("checkmark")) { cftemp = 2; }
                else { cftemp = -1 }
                      
                if ($('#brakeFluidGoodBox').hasClass("checkmark"))        { brakefluid = 0; }
                else if ($('#brakeFluidOKBox').hasClass("checkmark")) { brakefluid = 1; }
                else if ($('#brakeFluidBadBox').hasClass("checkmark")) { brakefluid = 2; }
                else { brakefluid = -1;  }

              
                if ($('#batteryGoodBox').hasClass("checkmark"))        { battery = 0; }
                else if ($('#batteryOKBox').hasClass("checkmark"))        { battery = 1; }
                else if ($('#batteryBadBox').hasClass("checkmark")) { battery = 2; }
                else { battery = -1 }
                
                if ($('#vipesFrontGoodBox').hasClass("checkmark"))       { vipesfront = 0; }
                else if ($('#vipesFrontOKBox').hasClass("checkmark"))         { vipesfront = 1; }
                else if ($('#vipesFrontBadBox').hasClass("checkmark")) { vipesfront = 2; }
                else { vipesfront = -1 }

                if ($('#vipesBackGoodBox').hasClass("checkmark")) { vipesrear = 0; }
                else if ($('#vipesBackOKBox').hasClass("checkmark"))         { vipesrear = 1; }
                else if ($('#vipesBackBadBox').hasClass("checkmark")) { vipesrear = 2; }
                else { vipesrear = -1 }

                if ($('#lightsFrontGoodBox').hasClass("checkmark")) { lightsfront = 0; }
                else if ($('#lightsFrontOKBox').hasClass("checkmark"))         { lightsfront = 1; }
                else if ($('#lightsFrontBadBox').hasClass("checkmark")) { lightsfront = 2; }
                else { lightsfront = -1 }

                if ($('#lightsBackGoodBox').hasClass("checkmark")) { lightsrear = 0; }
                else if ($('#lightsBackOKBox').hasClass("checkmark"))         { lightsrear = 1; }
                else if ($('#lightsBackBadBox').hasClass("checkmark")) { lightsrear = 2; }
                else { lightsrear = -1 }

                if ($('#bumperFrontGoodBox').hasClass("checkmark"))       { shockabsorberfront = 0; }
                else if ($('#bumperFrontOKBox').hasClass("checkmark"))         { shockabsorberfront = 1; }
                else if ($('#bumperFrontBadBox').hasClass("checkmark")) { shockabsorberfront = 2; }
                else { shockabsorberfront = -1 }

                if ($('#bumperBackGoodBox').hasClass("checkmark"))       { shockabsorberrear = 0; }
                else if ($('#bumperBackOKBox').hasClass("checkmark"))         { shockabsorberrear = 1; }
                else if ($('#bumperBackBadBox').hasClass("checkmark")) { shockabsorberrear = 2; }
                else { shockabsorberrear = -1 }

                if ($('#tiresFrontGoodBox').hasClass("checkmark"))       { tiresfront = 0; }
                else if ($('#tiresFrontOKBox').hasClass("checkmark"))         { tiresfront = 1; }
                else if ($('#tiresFrontBadBox').hasClass("checkmark")) { tiresfront = 2; }
                else { tiresfront = -1 }

                if ($('#tiresBackGoodBox').hasClass("checkmark"))       { tiresrear = 0; }
                else if ($('#tiresBackOKBox').hasClass("checkmark"))         { tiresrear = 1; }
                else if ($('#tiresBackBadBox').hasClass("checkmark")) { tiresrear = 2; }
                else { tiresrear = -1 }

                if ($('#suspensionFrontGoodBox').hasClass("checkmark"))       { suspensionfront = 0; }
                else if ($('#suspensionFrontOKBox').hasClass("checkmark"))         { suspensionfront = 1; }
                else if ($('#suspensionFrontBadBox').hasClass("checkmark")) { suspensionfront = 2; }
                else { suspensionfront = -1 }

                if ($('#suspensionBackGoodBox').hasClass("checkmark")) { suspensionrear = 0; }
                else if ($('#suspensionBackOKBox').hasClass("checkmark"))         { suspensionrear = 1; }
                else if ($('#suspensionBackBadBox').hasClass("checkmark")) { suspensionrear = 2; }
                else { suspensionrear = -1 }

                if ($('#brakesFrontGoodBox').hasClass("checkmark")) { brakesfront = 0; }
                else if ($('#brakesFrontOKBox').hasClass("checkmark"))         { brakesfront = 1; }
                else if ($('#brakesFrontBadBox').hasClass("checkmark")) { brakesfront = 2; }
                else { brakesfront = -1 }

                if ($('#brakesBackGoodBox').hasClass("checkmark"))       { brakesrear = 0; }
                else if ($('#brakesBackOKBox').hasClass("checkmark"))         { brakesrear = 1; }
                else if ($('#brakesBackBadBox').hasClass("checkmark")) { brakesrear = 2; }
                else { brakesrear = -1 }

                if ($('#exhaustGoodBox').hasClass("checkmark"))       { exhaust = 0; }
                else if ($('#exhaustOKBox').hasClass("checkmark"))         { exhaust = 1; }
                else if ($('#exhaustBadBox').hasClass("checkmark")) { exhaust = 2; }
                else { exhaust = -1 }

                if ($('#sealedEngineGoodBox').hasClass("checkmark"))       { sealedengine = 0; }
                else if ($('#sealedEngineOKBox').hasClass("checkmark")) { sealedengine = 1; }
                else if ($('#sealedEngineBadBox').hasClass("checkmark")) { sealedengine = 2; }
                else { sealedengine = -1 }

                if ($('#sealedGearboxGoodBox').hasClass("checkmark"))       { sealedgearbox = 0; }
                else if ($('#sealedGearboxOKBox').hasClass("checkmark"))         { sealedgearbox = 1; }
                else if ($('#sealedGearboxBadBox').hasClass("checkmark")) { sealedgearbox = 2; }
                else { sealedgearbox = -1 }

               $('.SMSXTRACHECK').each(function (i, obj) {
                   
                    
                   if ($(this).children(":first").hasClass("checkmark")) {
                       
                       $(this).val("1");
                   }
                   else {
                       $(this).val("0");
                   }
                   //alert($(this).attr("id"))
               
                });




                var regno = $('#<%=txtRegNo.ClientID%>').val();
                var refno = $('#<%=txtInternalNo.ClientID%>').val()
                //alert("bumper front verdien er: " + $('#txtFormbumperFrontAnnot').val());
                
                
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/SaveXtraCheck",
                    data: "{'regno':'" + regno
                        + "',refno:'" + refno
                        + "',motoroil:'" + motoroil
                        + "',motoroilAnnot:'" + $('#txtFormengineOilAnnot').val()
                        + "',motoroilSMS:'" + $('#engineOilSMS').val()
                        + "',cflevel:'" + cflevel
                        + "',cflevelAnnot:'" + $('#txtFormcFLevelAnnot').val()
                        + "',cflevelSMS:'" + $('#cFlevelSMS').val()
                        + "',cftemp:'" + cftemp
                        + "',cftempAnnot:'" + $('#txtFormcfTempAnnot').val()
                        + "',cftempSMS:'" + $('#cFtempSMS').val()
                        + "',brakefluid:'" + brakefluid
                        + "',brakefluidAnnot:'" + $('#txtFormbrakeFluidAnnot').val()
                        + "',brakefluidSMS:'" + $('#brakeFluidSMS').val()
                        + "',battery:'" + battery
                        + "',batteryAnnot:'" + $('#txtFormbatteryAnnot').val()
                        + "',batterySMS:'" + $('#batterySMS').val()
                        + "',vipesfront:'" + vipesfront
                        + "',vipesfrontAnnot:'" + $('#txtFormvipesFrontAnnot').val()
                        + "',vipesfrontSMS:'" + $('#vipesFrontSMS').val()
                        + "',vipesrear:'" + vipesrear
                        + "',vipesrearAnnot:'" + $('#txtFormvipesBackAnnot').val()
                        + "',vipesrearSMS:'" + $('#vipesBackSMS').val()
                        + "',lightsfront:'" + lightsfront
                        + "',lightsfrontAnnot:'" + $('#txtFormlightsFrontAnnot').val()
                        + "',lightsfrontSMS:'" + $('#lightsFrontSMS').val()
                        + "',lightsrear:'" + lightsrear
                        + "',lightsrearAnnot:'" + $('#txtFormlightsBackAnnot').val()
                        + "',lightsrearSMS:'" + $('#lightsBackSMS').val()
                        + "',shockabsorberfront:'" + shockabsorberfront
                        + "',shockabsorberfrontAnnot:'" + $('#txtFormbumperFrontAnnot').val()
                        + "',shockabsorberfrontSMS:'" + $('#bumperFrontSMS').val()
                        + "',shockabsorberrear:'" + shockabsorberrear
                        + "',shockabsorberrearAnnot:'" + $('#txtFormbumperBackAnnot').val()
                        + "',shockabsorberrearSMS:'" + $('#bumperBackSMS').val()
                        + "',tiresfront:'" + tiresfront
                        + "',tiresfrontAnnot:'" + $('#txtFormtiresFrontAnnot').val()
                        + "',tiresfrontSMS:'" + $('#tiresFrontSMS').val()
                        + "',tiresrear:'" + tiresrear
                        + "',tiresrearAnnot:'" + $('#txtFormtiresBackAnnot ').val()
                        + "',tiresrearSMS:'" + $('#tiresBackSMS').val()
                        + "',suspensionfront:'" + suspensionfront
                        + "',suspensionfrontAnnot:'" + $('#txtFormsuspensionFrontAnnot ').val()
                        + "',suspensionfrontSMS:'" + $('#suspensionFrontSMS').val()
                        + "',suspensionrear:'" + suspensionrear
                        + "',suspensionrearAnnot:'" + $('#txtFormsuspensionBackAnnot').val()
                        + "',suspensionrearSMS:'" + $('#suspensionBackSMS').val()
                        + "',brakesfront:'" + brakesfront
                        + "',brakesfrontAnnot:'" + $('#txtFormbrakesFrontAnnot').val()
                        + "',brakesfrontSMS:'" + $('#brakesFrontSMS').val()
                        + "',brakesrear:'" + brakesrear
                        + "',brakesrearAnnot:'" + $('#txtFormbrakesBackAnnot').val()
                        + "',brakesrearSMS:'" + $('#brakesBackSMS').val()
                        + "',exhaust:'" + exhaust
                        + "',exhaustAnnot:'" + $('#txtFormexhaustAnnot ').val()
                        + "',exhaustSMS:'" + $('#exhaustSMS').val()
                        + "',sealedengine:'" + sealedengine
                        + "',sealedengineAnnot:'" + $('#txtFormsealedEngineAnnot').val()
                        + "',sealedengineSMS:'" + $('#sealedEngineSMS').val()
                        + "',sealedgearbox:'" + sealedgearbox
                        + "',sealedgearboxAnnot:'" + $('#txtFormsealedGearboxAnnot').val()
                        + "',sealedgearboxSMS:'" + $('#sealedGearboxSMS').val()
                        + "',generalAnnot:'" + $('#generalAnnotation').val() + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                       
                    }
                });
                
            }

            function generatePDF()
            {
                var badValues = []
                var okValues = []
                var goodValues = []
                var annotValues = []

                $('.bad').each(function (i, obj) {

                    if ($(this).hasClass("checkmark")) {

                        badValues[i] = 'X';
                    }
                    else {

                        badValues[i] = '';
                    }
                });
                $('.okXtra').each(function (i, obj) {
                    
                    if ($(this).hasClass("checkmark")) {
                        
                        okValues[i] = 'X';
                    }
                    else {

                        okValues[i] = '';
                    }

                });
                $('.good').each(function (i, obj) {
                    if ($(this).hasClass("checkmark")) {

                        goodValues[i] = 'X';
                    }
                    else {

                        goodValues[i] = '';
                    }


                });

                $('.annot').each(function (i, obj) {
                    
                    if ($(this).hasClass("alarm")) {

                        annotValues[i] = '*';
                    }
                    else {

                        annotValues[i] = '';
                    }


                });


                var doc = new jsPDF()

                doc.text(7, 15, "BilXtra-Xtrasjekk");
                let text = $('#generalAnnotation').val()
                // Or use javascript directly:
                doc.autoTable({
                    theme: 'grid',
                    startY: 20,
                    headStyles: {
                         textColor: [17, 0, 0]
                        
                    },
                    bodyStyles: {
                        halign: 'center'
                    },
                    head: [
                        [{ content: 'Sjekkpunkt', styles: { fillColor: [245, 245, 245] } },
                        { content: '', styles: { fillColor: [245, 245, 245] } },
                            { content: 'Bør utbedres', styles: { fillColor: [255, 102, 102] } },
                            { content: 'Under oppsyn', styles: { fillColor: [255, 255, 85] } },
                            { content: 'OK', styles: { fillColor: [0, 204, 0] } },
                            { content: 'Anm.', styles: { fillColor: [245, 245, 245] }}
                           

                        ],                                              
                        ],
                    body: [
                        [{ content: 'Motorolje', styles: { halign: 'left'} }, { content: 'Nivå' }, { content: badValues[0]  }  ,{ content: okValues[0] }, { content: goodValues[0] } , { content: annotValues[0] }],
                        [{ content: 'Frostvæske', rowSpan: 2, styles: { halign: 'left'} }, { content: 'Nivå' }, { content: badValues[1]  }, { content: okValues[1] } , { content: goodValues[1] }, { content: annotValues[1] }],
                        [{ content: '' }, { content: 'Frysepunkt' }, { content: badValues[2] } , { content: okValues[2] } , { content: goodValues[2] } , { content: annotValues[2] }],
                        [{ content: 'Bremsevæske' , styles: { halign: 'left'}  }, { content: '' }, { content: badValues[3]}, { content: okValues[3] } ,{ content: goodValues[3] }, { content: annotValues[3] } ],
                        [{ content: 'Batteri' , styles: { halign: 'left'}  }, { content: 'Nivå' }, { content: badValues[4] }, { content: okValues[4] }, { content: goodValues[4] }, { content: annotValues[4] }],
                        [{ content: 'Vindusvisker' , styles: { halign: 'left'} , rowSpan: 2, styles: { halign: 'left' } }, { content: 'Foran' }, { content: badValues[5] }, { content: okValues[5] }, { content: goodValues[5] }, { content: annotValues[5] }],
                        [{ content: '' }, { content: 'Bak' }, { content: badValues[6] }, { content: okValues[6] }, { content: goodValues[6] }, { content: annotValues[6] }],
                        [{ content: 'Lyspærer', rowSpan: 2 , styles: { halign: 'left'} }, { content: 'Foran' }, { content: badValues[7] }, { content: okValues[7] }, { content: goodValues[7] }, { content: annotValues[7] }],
                        [{ content: ''}, { content: 'Bak' }, { content: badValues[8] }, { content: okValues[8] }, { content: goodValues[8] }, { content: annotValues[8] }],
                        [{ content: 'Støtdempere', rowSpan: 2, styles: { halign: 'left' } }, { content: 'Foran' }, { content: badValues[9] }, { content: okValues[9] }, { content: goodValues[9] }, { content: annotValues[9] }],
                        [{ content: '' }, { content: 'Bak' }, { content: badValues[10] }, { content: okValues[10] }, { content: goodValues[10] }, { content: annotValues[10] }],
                        [{ content: 'Dekk', rowSpan: 2, styles: { halign: 'left' } }, { content: 'Foran' }, { content: badValues[11] }, { content: okValues[11] }, { content: goodValues[11] }, { content: annotValues[11]}],
                        [{ content: '' }, { content: 'Bak' }, { content: badValues[12] }, { content: okValues[12] }, { content: goodValues[12] }, { content: annotValues[12] }],
                        [{ content: 'Forstilling' , styles: { halign: 'left'}  }, { content: '' }, { content: badValues[13] }, { content: okValues[13] }, { content: goodValues[13] }, { content: annotValues[13] }],
                        [{ content: 'Bakstilling' , styles: { halign: 'left'} }, { content: '' }, { content: badValues[14] }, { content: okValues[14] }, { content: goodValues[14] }, { content: annotValues[14] }],
                        [{ content: 'Bremseklosser' , rowSpan: 2, styles: { halign: 'left'} }, { content: 'Foran' }, { content: badValues[15] }, { content: okValues[15] }, { content: goodValues[15] }, { content: annotValues[15] }],
                        [{ content: ''  , styles: { halign: 'left'} }, { content: 'Bak' }, { content: badValues[16] }, { content: okValues[16] }, { content: goodValues[16] }, { content: annotValues[16] }],
                        [{ content: 'Eksosanlegg' , styles: { halign: 'left'}  }, { content: '' }, { content: badValues[17] }, { content: okValues[17] }, { content: goodValues[17] }, { content: annotValues[17]}],
                        [{ content: 'Tetthet' , styles: { halign: 'left'} , rowSpan: 2, styles: { halign: 'left', } }, { content: 'Motor' }, { content: badValues[18] }, { content: okValues[18] }, { content: goodValues[18] }, { content: annotValues[18] }],
                        [{ content: '' }, { content: 'Girkasse' }, { content: badValues[19] }, { content: okValues[19] }, { content: goodValues[19] }, { content:annotValues[19] }],
                        [{ content: 'Kommentarer' }, { content: text , colSpan: 5}]

                    ],
                })
               
                //var splitTitle = doc.splitTextToSize(text, 160);
                //let finalY = doc.lastAutoTable.finalY+20; // The y position on the page
                //doc.text(20, finalY, splitTitle)
                doc.addPage();
                doc.text(20, 20, '?');
                //doc.save('table.pdf')
                window.open(doc.output('bloburl'), '_blank');
            }

            function fetchOfferAmount(order) {

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/FetchOfferAmount",
                    data: "{'orderno':'" + order + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (Result.d.length > 0) {
                            var calc = Result.d[0].Final_Total.toFixed(2).replace('.', ',');
                            
                            $('#<%=txtOfferAmount.ClientID%>').val(calc);
                        }
                    }
                });
            }
            /*Fetches the data you need from sms config to be able to send sms. Username, password etc.*/
            function fetchSMSConfig(type) {


                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "../master/frmSendSMS.aspx/LoadSMSConfig",
                    data: "{'department':'" + "" + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (Result.d.length > 0) {
                            arrayOfValues[0] = Result.d[0].DEPARTMENT

                            arrayOfValues[1] = Result.d[0].SENDER_SMS
                            arrayOfValues[2] = Result.d[0].USER_ID
                            arrayOfValues[3] = Result.d[0].USER_PASSWORD
                            arrayOfValues[4] = Result.d[0].SMS_OPERATOR_LINK
                            arrayOfValues[5] = Result.d[0].SUB_NAME
                            arrayOfValues[6] = Result.d[0].SUB_PHONE

                            //return arrayOfValues;
                            //var messageType = "Manuell SMS";
                            //saveSMSGlobal(, Result.d[0]., phoneTo, messageType, messageText, time, Result.d[0].USER_ID, Result.d[0].USER_PASSWORD, Result.d[0].SMS_OPERATOR_LINK);
                            //sendXtraCheckWeb();
                            if (type == "XTRACHECK") {
                                //xtraCheckMobile()
                                XtraSchemeSMSNew()
                            }
                            else if (type == "BARGAIN") {
                                //bargainMobile()
                                BargainSMSNew()
                            }

                        }
                    }
                });
            }


            function bargainMobile() {
                let deptId = arrayOfValues[0]

                let senderSMS = arrayOfValues[1]
                let userId = arrayOfValues[2]
                let userPassword = arrayOfValues[3]
                let smsOperatorLink = arrayOfValues[4]

                let messageType = "Xtrasjekk"
                let messageText = "Hei. Vi har tatt en xtrasjekk på bilen din. Se detaljer på linken her: "
                let time = ""
                let s = [];
                let c = 0;
                let checkmarkString = "";
                let first = true;


                if ($('#<%=txtMName.ClientID%>').val() == "") alert()


                     let cust_mob = $('#<%=txtMobNo.ClientID%>').val()
                     let name = "";
                     if ($('#<%=txtMName.ClientID%>').val() == "") {
                         name = $('#<%=txtName.ClientID%>').val() + " " + $('#<%=txtLName.ClientID%>').val()
                 }
                 else if ($('#<%=txtMName.ClientID%>').val() == "" && $('#<%=txtName.ClientID%>').val() == "") {
                     name = $('#<%=txtLName.ClientID%>').val()
                 }
                 else {
                     name = $('#<%=txtName.ClientID%>').val() + " " + $('#<%=txtMName.ClientID%>').val() + " " + $('#<%=txtLName.ClientID%>').val()
                     }
                     name = JSON.stringify(name);
                     let cust_mob_json = JSON.stringify(cust_mob);
                     let orderId = $('#<%=lblOrderNo.ClientID%>').text();
                     let regNo = $('#<%=txtRegNo.ClientID%>').val();

                     $.ajax({

                         type: "POST",
                         contentType: "application/json; charset=utf-8",
                         url: "frmWOJobDetails.aspx/SendBargainMobile",

                         data: '{"deptId": "' + arrayOfValues[0] + '", "senderSMS": "' + arrayOfValues[1] + '", "userId": "'
                             + arrayOfValues[2] + '", "userPsw": "' + arrayOfValues[3] + '", "smsOperatorLink": "' + arrayOfValues[4]
                             + '", "custMob": "' + cust_mob + '", "custName": ' + name
                             + ', "regNo": "' + regNo + '", "orderId": "' + orderId + '", "result": "' + s + '", "text": "' + $('#<%=txtOfferText.ClientID%>').val() + '", "amount": "' + $('#<%=txtOfferAmount.ClientID%>').val() + '"}',


                         dataType: "json",
                         success: function (data) {
                             if (data.d.length > 0) {

                                 alert(data.d);
                             }

                         },
                         error: function (result) {
                             alert("Error");
                         }
                     });
                 }
            

            function sendSMSGlobal(dept, senderSMS, phoneTo, messageType, messageText, time, userId, userPassword, smsOperatorLink , linkId, orderId) {
                var msgType = messageType;
                var time = "";
                

                $.ajax({

                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "../master/frmSendSMS.aspx/SendSMSGlobal",
                    data: "{dept: '" + dept + "', senderSMS:'" + senderSMS + "', phoneTo:'" + phoneTo + "', messageType:'" + messageType + "', messageText:'" + messageText + "', time:'" + time + "', userId:'" + userId + "', userPassword:'" + userPassword + "', smsOperatorLink:'" + smsOperatorLink +  "', linkId:'" + linkId + "', orderId:'" + orderId + "'}",
                    dataType: "json",
                    success: function (data) {
                        if (data.d[0] != "") {                           
                            swal("SMS er sendt!")
                        }
                        else {
                            swal("SMS ble ikke lagret og derfor ikke sendt.");
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            };

            function xtraCheckMobile() {
                let deptId = arrayOfValues[0]

                let senderSMS = arrayOfValues[1]
                let userId = arrayOfValues[2]
                let userPassword = arrayOfValues[3]
                let smsOperatorLink = arrayOfValues[4]

                let messageType = "Xtrasjekk"
                let messageText = "Hei. Vi har tatt en xtrasjekk på bilen din. Se detaljer på linken her: "
                let time = ""
                let s = [];
                let c = 0;
                let checkmarkString = "";
                let first = true;
                $('.SMSXTRACHECK').each(function (i, obj) {
                    if ($(this).children(":first").hasClass("checkmark")) {
                        
                            //checkmarkString += checkmarkString + (i + 10) + ", ";
                       
                        
                        s[c] = i + 10; //+10 because it starts at 10 at the endpoint for some reason                        
                        c++
                    }
                });
                //checkmarkString = checkmarkString.substring(0, array.length - 2);
                // "11, 12, 13" string
                // ""11", "12", "13""
                if ($('#<%=txtMName.ClientID%>').val() == "") alert()


                let cust_mob = $('#<%=txtMobNo.ClientID%>').val()
                let name = "";
                if ($('#<%=txtMName.ClientID%>').val() == "") {
                    name = $('#<%=txtName.ClientID%>').val() + " " + $('#<%=txtLName.ClientID%>').val()
                }
                else if ($('#<%=txtMName.ClientID%>').val() == "" && $('#<%=txtName.ClientID%>').val() == "") {
                    name = $('#<%=txtLName.ClientID%>').val()
                }
                else {
                    name = $('#<%=txtName.ClientID%>').val() + " " + $('#<%=txtMName.ClientID%>').val() + " " + $('#<%=txtLName.ClientID%>').val()
                }
                name = JSON.stringify(name);
                let cust_mob_json = JSON.stringify(cust_mob);
                let orderId = $('#<%=lblOrderNo.ClientID%>').text();
                let regNo = $('#<%=txtRegNo.ClientID%>').val();
                //var array = ""
                //var commaseparatedstring = s.join(",");
                //var t = commaseparatedstring.split(",");
                //for (i = 0; t.length > i; i++) {
                //    if (i == 0) {
                //        array +=  t[i] + '"' + ", ";
                //    }
                //    else {
                //        array += '"' + t[i] + '"' + ", ";
                //    }
                //    console.log(array);
                        
                //}
                //var newarray = array.substring(0, array.length - 3);
                //console.log(newarray);
                $.ajax({

                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/SendXtraMobile",

                    data: '{"deptId": "' + arrayOfValues[0] + '", "senderSMS": "' + arrayOfValues[1] + '", "userId": "'
                        + arrayOfValues[2] + '", "userPsw": "' + arrayOfValues[3] + '", "smsOperatorLink": "' + arrayOfValues[4]
                        + '", "custMob": "' + cust_mob + '", "custName": ' + name
                        + ', "regNo": "' + regNo + '", "orderId": "' + orderId + '", "result": "' + s + '"}', 
                    
                                                                                     
                    dataType: "json",
                    success: function (data) {
                        if (data.d.length > 0) {

                            alert(data.d);
                        }

                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }

            function sendXtraCheckWeb() {

                //fetchSMSConfig();
               
                let deptId = arrayOfValues[0]

                let senderSMS = arrayOfValues[1]
                let userId = arrayOfValues[2]
                let userPassword = arrayOfValues[3]
                let smsOperatorLink = arrayOfValues[4]

                let messageType = "Xtrasjekk SMS"
                let messageText = "Hei. Vi har tatt en xtrasjekk på bilen din. Se detaljer her: "
                let time = ""
                let s = [];              
                let c = 0;
                $('.SMSXTRACHECK').each(function (i, obj) {
                    if ($(this).children(":first").hasClass("checkmark")) {                                                
                        
                        s[c] = i+10; //+10 because it starts at 10 at the endpoint for some reason                        
                        c++
                    }                  
                });
              
                if($('#<%=txtMName.ClientID%>').val() == "") alert()

                                       
                let cust_mob = $('#<%=txtMobNo.ClientID%>').val() 
                
                let name = $('#<%=txtName.ClientID%>').val() + $('#<%=txtMName.ClientID%>').val() + $('#<%=txtLName.ClientID%>').val()
                name = JSON.stringify(name);
                let cust_mob_json = JSON.stringify(cust_mob);
                let orderId = $('#<%=lblOrderNo.ClientID%>').text();
                let orderId_json = JSON.stringify(orderId);
                
                const myHeaders = new Headers({
                    'Content-Type': 'application/json',
                    'Authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1NTA0ODgzNjIsImV4cCI6MTg2NjA1NzYyMn0.gLQTGK1S7Ccka0oK-U05rKWuMAG3sAXKakb2ge6fCV0'
                });

                return fetch('https://cars-web-api-staging.herokuapp.com/api/v2/info/', {
                    method: 'POST',
                    headers: myHeaders,
                    body: '{"cumobile":' +cust_mob_json + ',"cuname":'+ name + ',"orderid":'+ orderId_json +',"regid":"BT69251","result":[' +s +'],"sename":"Cars Bil AS","sephone":"32242070"}'
                })

                    .then(response => {
                        if (response.status === 200) {
                            return response.json();
                        } else {
                            throw new Error('Something went wrong on api server!');
                        }
                    })
                    .then(response => {
                        console.log(response.id);
                        messageText += "https://carsapp-staging.nodelab.no/info/" + response.id 
                        sendSMSGlobal(deptId, senderSMS, cust_mob, messageType, messageText, time, userId, userPassword, smsOperatorLink, response.id, orderId)
                        //console.debug(response);

                    }).catch(error => {
                        console.error(error);
                    });
            }

            function BargainSMSNew() {
                let sename = arrayOfValues[5].toString();
                let sephone = arrayOfValues[6].toString();
                let userId = encodeURIComponent(arrayOfValues[2])
                let userPassword = encodeURIComponent(arrayOfValues[3])
                let smsOperatorLink = arrayOfValues[4].toString();
                let amount = $('#<%=txtOfferAmount.ClientID%>').val();
                let duration = "1250"
                let text = "Verksted tilbud for godkjenning."
                let cumobile = $('#<%=txtMobNo.ClientID%>').val()
                let cuname = "";
                if ($('#<%=txtMName.ClientID%>').val() == "") {
                    cuname = $('#<%=txtName.ClientID%>').val() + " " + $('#<%=txtLName.ClientID%>').val()
                }
                else if ($('#<%=txtMName.ClientID%>').val() == "" && $('#<%=txtName.ClientID%>').val() == "") {
                    cuname = $('#<%=txtLName.ClientID%>').val()
                }
                else {
                    cuname = $('#<%=txtName.ClientID%>').val() + " " + $('#<%=txtMName.ClientID%>').val() + " " + $('#<%=txtLName.ClientID%>').val()
                }
                sename = JSON.stringify(sename);
                let orderid = $('#<%=lblOrderNo.ClientID%>').text();
                let regid = $('#<%=txtRegNo.ClientID%>').val();
                let offerText = $('#<%=txtOfferText.ClientID%>').val();
                var jsonBargainData = '{"amount": "' + amount + '", "cumobile": "' + cumobile + '", "cuname": "'
                    + cuname + '", "duration": "' + duration + '", "orderid": "' + orderid
                    + '", "regid": "' + regid + '", "sename": ' + sename
                    + ', "sephone": "' + sephone + '", "text": "' + text + '"}';
                

                $.ajax({

                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/BargainSMSNew",
                    //data: "{jsonBargainData:'" + jsonBargainData + "'}" ,
                    data: "{'idWONO':'" + $('#<%=hdnWoNo.ClientID%>')[0].value + "',idWOPrefix:'" + $('#<%=hdnWoPr.ClientID%>')[0].value +"',jsonBargainData:'" + jsonBargainData + "'}" ,
                    dataType: "json",
                    success: function (data) {
                        if (data.d.length > 0) {
                            //Setting up the Hidden Variable for Id Bargain
                            $('#<%=hdnIdBargain.ClientID%>').val(data.d);
                            var bargainUrl ="https://carsapp.nodelab.no/quote/"
                            messageText = offerText+" " +bargainUrl + data.d;
                            var num = cumobile;
                            var time = ""//getFormatedDateTimeNow(); //To get the current datetime in YYYY-DD-MM hh:mm:ss format
                            var smsid = "";
                            $.ajax({
                                type: "POST",
                                url: "../Master/frmSendSMS.aspx/SendSMS",
                                data: "{num: '" + num + "', 'message': '" + messageText + "', 'time': '" + time + "', 'id': '" + smsid + "', 'user': '" + userId + "', 'password': '" + userPassword + "', 'dru': '" + smsOperatorLink + "'}",
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                async: false,
                                success: function (data) {
                                    if (data.d.length != 0) {
                                        if (data.d == "OK") {
                                            var msg = "TILBUD SMS" 
                                            saveSMS(msg);
                                            swal("Sms er sendt til " + cumobile + " og loggført.");                                            
                                        }
                                        else {
                                            swal("Sms fikk følgende retursvar: " + data.d);
                                        }

                                    }
                                    else {
                                        alert('SMS not sent. Please try again later!')
                                    }
                                },
                                failure: function () {
                                    alert("Failed!");
                                },
                                select: function (e, i) {
                                    //alert('hi');
                                },
                            });
                        }

                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }
            function getFormatedDateTimeNow() {
                //Since the API takes YYYY-DD-MM hh:mm:ss format to send the SMS
                var today = new Date();
                var mydate = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
                var mytime = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
                var dateTime = mydate + ' ' + mytime;
                return dateTime;
            }

            function saveSMS(messageType) {
                var msgType = messageType;
                var time = getFormatedDateTimeNow();

                $.ajax({

                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "../Master/frmSendSMS.aspx/SaveSMS",
                    data: "{dept: '" + arrayOfValues[0] + "', phoneFrom:'" + arrayOfValues[1] + "', phoneTo:'" + $('#<%=txtMobNo.ClientID%>').val() + "', messageType:'" + msgType + "', messageText:'" + messageText + "', time:'" + time + "'}",
                    dataType: "json",
                    success: function (data) {
                        if (data.d[0] != "") {
                            $('#<%=txtOfferText.ClientID%>').val('');
                        }
                        else {
                            swal("SMS ble ikke lagret og derfor ikke sendt.");
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            };
             $('#btnPhoneInsurance').on('click', function () {
                $("#modPhoneInsurance").modal('show');

            });

              $('#btnGen1').on('click', function () {
                $('.GenGeneral').show();
                $('#btnGen1').removeClass('carsButtonBlueInverted');
                $('#btnGen1').addClass('carsButtonBlueNotInverted');
                $('#btnGen2').removeClass('carsButtonBlueNotInverted');
                $('#btnGen2').addClass('carsButtonBlueInverted');

                $('.GenDamage').hide();

            });
            $('#btnGen2').on('click', function () {
                $('.GenDamage').show();
                $('.GenGeneral').hide();
                $('#btnGen1').addClass('carsButtonBlueInverted');
                $('#btnGen1').removeClass('carsButtonBlueNotInverted');
                $('#btnGen2').removeClass('carsButtonBlueInverted');
                $('#btnGen2').addClass('carsButtonBlueNotInverted');
             
            });

            function getLinkId() {
                var msgType = "Xtrasjekk SMS";
                let orderId = $('#<%=lblOrderNo.ClientID%>').text();
                

                $.ajax({

                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "../master/frmSendSMS.aspx/getLinkId",
                  
                    data: "{orderId: '" + orderId  + "', msgType:'"+ msgType + "'}",
                    dataType: "json",
                    success: function (data) {
                        if (data.d[0] != "") {                           
                           
                            getXtraCheckResult(data.d);
                        }
                        else {
                            swal("Fant ingen id");
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            };

            function getXtraCheckResult(linkId) {
              
                             
                const myHeaders = new Headers({
                    'Content-Type': 'application/json'
                    
                });

                return fetch('https://cars-web-api-staging.herokuapp.com/api/v2/info/'+ linkId, {
                    method: 'GET',
                    headers: myHeaders
                   
                })

                    .then(response => {
                        if (response.status === 200) {
                            return response.json();
                        } else {
                            throw new Error('Something went wrong on api server!');
                        }
                    })
                    .then(response => {
                        console.log(response.id);
                        saveXtraCheckResult(response.id, response.orderid, response.regid, response.created,response.expires, response.result,response.order,response.booked);
                        //console.debug(response);

                    }).catch(error => {
                        console.error(error);
                    });
            }

            function addXtraCheckResultToOrder(orderId) {
                
            }

            function saveXtraCheckResult(id, orderid, regId, created, expires, result, order, booked) {
               
                 $.ajax({

                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "../master/frmSendSMS.aspx/saveXtraCheckResult",
                  
                    data: "{linkId: '" + id  + "', orderId:'"+ orderid   + "', regId:'"+ regId +"', msgType:'"+ "Xtrasjekk SMS" + "', created:'"+ created + "', expires:'"+ expires + "', result:'"+ result + "', ordered:'"+ order + "', booked:'"+ booked + "'}",
                    dataType: "json",
                    success: function (data) {
                        if (data.d[0] != "") {                           
                          
                            $.each(order, function (key, value) {
                               
                                 if (value == "10") { alert("Kunden har akseptert motorolje-nivå"); }
                                 if (value == "11") { alert("Kunden har akseptert frostvæske-nivå"); }
                                 if (value == "12") { alert("Kunden har akseptert frostvæske-frysepunkt"); }
                                if (value == "13") { alert("Kunden har akseptert bremsevæske-ninå"); }
                                if (value == "14") { alert("Kunden har akseptert batterinivå"); }
                                if (value == "15") { alert("Kunden har akseptert vindusvisker foran"); }
                                if (value == "16") { alert("Kunden har akseptert vindusvisker bak"); }
                                if (value == "17") { alert("Kunden har akseptert lyspærer foran"); }
                                if (value == "18") { alert("Kunden har akseptert lyspærer bak"); }
                                if (value == "19") { alert("Kunden har akseptert støtdempere foran"); }
                                if (value == "20") { alert("Kunden har akseptert støtdempere bak"); }
                                if (value == "21") { alert("Kunden har akseptert dekk foran"); }
                                if (value == "22") { alert("Kunden har akseptert dekk bak"); }
                                if (value == "23") { alert("Kunden har akseptert forstilling"); }
                                if (value == "24") { alert("Kunden har akseptert bakstilling"); }
                                if (value == "25") { alert("Kunden har akseptert bremseklosser bak"); }
                                if (value == "26") { alert("Kunden har akseptert bremseklosser foran"); }
                                if (value == "27") { alert("Kunden har akseptert eksosanlegg"); }
                                if (value == "28") { alert("Kunden har akseptert motortetthet"); }
                                if (value == "29") { alert("Kunden har akseptert girkassetetthet"); }

                        });
                            
                        }
                        else {
                            swal("Fant ingen id");
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }

            $('#btnReferenceCustomer').on('click', function (e) {
                e.preventDefault();
                $('#modRefCustomer')
                    .modal('show')
                    ;
            });

            $('#btn_print_xtracheck').on('click', function () {
                generatePDF();
               
                
            });

            $('#btn_elin_xtracheck').on('click', function () {
                var sendingValue = "XTRACHECK";
                fetchSMSConfig(sendingValue);

            });


          $('#<%=btnBargain.ClientID%>').on('click', function () {
                var sendingValue = "BARGAIN";
                fetchSMSConfig(sendingValue);
              $('#modOffer')
                  .modal('hide')
                  ;
          });

            

            $('#btn_elin_xtracheck_get').on('click', function () {
                  
                getLinkId();
                
            });

            $('#btn_save_xtracheck').on('click', function () {
                saveXtraCheck();
               
                
            });


            $('#btnScheme').on('click', function (e) {
                e.preventDefault();
                loadXtraCheck();
               
                // show first immediately
                $('.first.modal')
                    .modal('show')
                    ;
            });

            $('.coupled.modal')
                .modal({
                    allowMultiple:   true
                })
                ;
            // open second modal on first modal buttons
            



             /*XTRASJEKK 
              * 
              HERE YOU CAN SWITCH FROM OK TO BAD ETC. And SIGNAL THAT F.EXAMPLE THE BRAKE FLUID LEVEL Is LOW
              And SHOULD BE CHANGED. THE RESULT OF THIS CAN BE SEEN WHEN YOU CHECK THIS VEHICLE(IN ORDER) 
              On THE VEHICLE PAGE(frmVehicleDetail.aspx)
              *
              XTRASJEKK*/
            

            $('#btnSaveEngineOilAnnot').on('click', function () {

                if ($('#txtFormengineOilAnnot').val() != "") {
                    $('#engineOilAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#engineOilAnnotIcon').removeClass('alarm icon');
                }
            });
            
            $('#btnSavecFLevelAnnot').on('click', function () {
                
                if ($('#txtFormcFLevelAnnot').val() != "") {
                    $('#cFLevelAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#cFLevelAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSavecfTempAnnot').on('click', function () {
              
                if ($('#txtFormcfTempAnnot').val() != "") {
                    $('#cfTempAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#cfTempAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveBrakeFluidAnnot').on('click', function () {
               
                if ($('#txtFormbrakeFluidAnnot').val() != "") {
                    $('#brakeFluidAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#brakeFluidAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveBatteryAnnot').on('click', function () {
                
                if ($('#txtFormbatteryAnnot').val() != "") {
                    $('#batteryAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#batteryAnnotIcon').removeClass('alarm icon');
                }
            });

           
            $('#btnSaveVipesFrontAnnot').on('click', function () {
               
                if ($('#txtFormvipesFrontAnnot').val() != "") {
                    $('#vipesFrontAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#vipesFrontAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveVipesBackAnnot').on('click', function () {
                
                if ($('#txtFormvipesBackAnnot').val() != "") {
                    $('#vipesBackAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#vipesBackAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveLightsFrontAnnot').on('click', function () {
              
                if ($('#txtFormlightsFrontAnnot').val() != "") {
                    $('#lightsFrontAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#lightsFrontAnnotIcon').removeClass('alarm icon');
                }
            });
            
            $('#btnSaveLightsBackAnnot').on('click', function () {
               
                if ($('#txtFormlightsBackAnnot').val() != "") {
                    $('#lightsBackAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#lightsBackAnnotIcon').removeClass('alarm icon');
                }
            });

           
            $('#btnSaveBumperFrontAnnot').on('click', function () {
               
                if ($('#txtFormbumperFrontAnnot').val() != "") {
                    $('#bumperFrontAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#bumperFrontAnnotIcon').removeClass('alarm icon');
                }
            });
          
            $('#btnSaveBumperBackAnnot').on('click', function () {
               
                if ($('#txtFormbumperBackAnnot').val() != "") {
                    $('#bumperBackAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#bumperBackAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveTiresFrontAnnot').on('click', function () {
                
                if ($('#txtFormtiresFrontAnnot').val() != "") {
                    $('#tiresFrontAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#tiresFrontAnnotIcon').removeClass('alarm icon');
                }
            });
           
            $('#btnSaveTiresBackAnnot').on('click', function () {
             
                if ($('#txtFormtiresBackAnnot').val() != "") {
                    $('#tiresBackAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#tiresBackAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveSuspensionFrontAnnot').on('click', function () {
               
                if ($('#txtFormsuspensionFrontAnnot').val() != "") {
                    $('#suspensionFrontAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#suspensionFrontAnnotIcon').removeClass('alarm icon');
                }
            });
            
            $('#btnSaveSuspensionBackAnnot').on('click', function () {
               
                if ($('#txtFormsuspensionBackAnnot').val() != "") {
                    $('#suspensionBackAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#suspensionBackAnnotIcon').removeClass('alarm icon');
                }
            });

           
            $('#btnSaveBrakesFrontAnnot').on('click', function () {
                if ($('#txtFormbrakesFrontAnnot').val() != "") {
                    $('#brakesFrontAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#brakesFrontAnnotIcon').removeClass('alarm icon');
                }
            });
            
            $('#btnSaveBrakesBackAnnot').on('click', function () {
               
                if ($('#txtFormbrakesBackAnnot').val() != "") {
                    $('#brakesBackAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#brakesBackAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveExhaustAnnot').on('click', function () {
               
                if ($('#txtFormexhaustAnnot').val() != "") {
                    $('#exhaustAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#exhaustAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveSealedEngineAnnot').on('click', function () {
              
                if ($('#txtFormsealedEngineAnnot').val() != "") {
                    $('#sealedEngineAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#sealedEngineAnnotIcon').removeClass('alarm icon');
                }
            });

            
            $('#btnSaveSealedGearboxAnnot').on('click', function () {
                if ($('#txtFormsealedGearboxAnnot').val() != "") {
                    $('#sealedGearboxAnnotIcon').addClass('alarm icon');
                }
                else {
                    $('#sealedGearboxAnnotIcon').removeClass('alarm icon');
                }
            });







            /*Code for the "BilXtra-sjekken" to add/remove the check mark*/
            /*Motorolje*/
            $('#engineOilBad').on('click', function () {
                $('#engineOilBadBox').toggleClass('large black checkmark icon');
                $('#engineOilOKBox, #engineOilGoodBox').removeClass('large black checkmark icon');
             
            });
            $('#engineOilOK').on('click', function () {
                $('#engineOilOKBox').toggleClass('large black checkmark icon');
                $('#engineOilBadBox, #engineOilGoodBox').removeClass('large black checkmark icon');
              
            });
            $('#engineOilGood').on('click', function () {
                $('#engineOilGoodBox').toggleClass('large black checkmark icon');
                $('#engineOilBadBox, #engineOilOKBox').removeClass('large black checkmark icon');
               
            });
            //works for all sms boxes
            $('.SMSXTRACHECK').on('click', function () {
                $(this).children(":first").toggleClass("large black checkmark icon");
                
            });
            /*Frostvæske nivå*/
            $('#cFLevelBad').on('click', function () {
                $('#cFLevelBadBox').toggleClass('large black checkmark icon');
                $('#cFLevelOKBox, #cFLevelGoodBox').removeClass('large black checkmark icon');
               
            });
            $('#cFLevelOK').on('click', function () {
                $('#cFLevelOKBox').toggleClass('large black checkmark icon');
                $('#cFLevelBadBox, #cFLevelGoodBox').removeClass('large black checkmark icon');
               
            });
            $('#cFLevelGood').on('click', function () {
                $('#cFLevelGoodBox').toggleClass('large black checkmark icon');
                $('#cFLevelBadBox, #cFLevelOKBox').removeClass('large black checkmark icon');
                
            });
            /*Frostvæske Temperatur frysepunkt*/
            $('#cFTempBad').on('click', function () {
                $('#cFTempBadBox').toggleClass('large black checkmark icon');
                $('#cFTempOKBox, #cFTempGoodBox').removeClass('large black checkmark icon');
            });
            $('#cFTempOK').on('click', function () {
                $('#cFTempOKBox').toggleClass('large black checkmark icon');
                $('#cFTempBadBox, #cFTempGoodBox').removeClass('large black checkmark icon');
            });
            $('#cFTempGood').on('click', function () {
                $('#cFTempGoodBox').toggleClass('large black checkmark icon');
                $('#cFTempBadBox, #cFTempOKBox').removeClass('large black checkmark icon');
            });
            /*Bremsevæske nivå*/
            $('#brakeFluidBad').on('click', function () {
                $('#brakeFluidBadBox').toggleClass('large black checkmark icon');
                $('#brakeFluidOKBox, #brakeFluidGoodBox').removeClass('large black checkmark icon');
            });
            $('#brakeFluidOK').on('click', function () {
                $('#brakeFluidOKBox').toggleClass('large black checkmark icon');
                $('#brakeFluidBadBox, #brakeFluidGoodBox').removeClass('large black checkmark icon');
            });
            $('#brakeFluidGood').on('click', function () {
                $('#brakeFluidGoodBox').toggleClass('large black checkmark icon');
                $('#brakeFluidBadBox, #brakeFluidOKBox').removeClass('large black checkmark icon');
            });
            /*Batteri nivå*/
            $('#batteryBad').on('click', function () {
                $('#batteryBadBox').toggleClass('large black checkmark icon');
                $('#batteryOKBox, #batteryGoodBox').removeClass('large black checkmark icon');
            });
            $('#batteryOK').on('click', function () {
                $('#batteryOKBox').toggleClass('large black checkmark icon');
                $('#batteryBadBox, #batteryGoodBox').removeClass('large black checkmark icon');
            });
            $('#batteryGood').on('click', function () {
                $('#batteryGoodBox').toggleClass('large black checkmark icon');
                $('#batteryBadBox, #batteryOKBox').removeClass('large black checkmark icon');
            });
            /*Vindusvisker foran*/
            $('#vipesFrontBad').on('click', function () {
                $('#vipesFrontBadBox').toggleClass('large black checkmark icon');
                $('#vipesFrontOKBox, .vipesFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#vipesFrontOK').on('click', function () {
                $('#vipesFrontOKBox').toggleClass('large black checkmark icon');
                $('#vipesFrontBadBox, #vipesFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#vipesFrontGood').on('click', function () {
                $('#vipesFrontGoodBox').toggleClass('large black checkmark icon');
                $('#vipesFrontBadBox, #vipesFrontOKBox').removeClass('large black checkmark icon');
            });
            /*Vindusvisker bak*/
            $('#vipesBackBad').on('click', function () {
                $('#vipesBackBadBox').toggleClass('large black checkmark icon');
                $('#vipesBackOKBox, #vipesBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#vipesBackOK').on('click', function () {
                $('#vipesBackOKBox').toggleClass('large black checkmark icon');
                $('#vipesBackBadBox, #vipesBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#vipesBackGood').on('click', function () {
                $('#vipesBackGoodBox').toggleClass('large black checkmark icon');
                $('#vipesBackBadBox, #vipesBackOKBox').removeClass('large black checkmark icon');
            });
            /*Lyspærer foran*/
            $('#lightsFrontBad').on('click', function () {
                $('#lightsFrontBadBox').toggleClass('large black checkmark icon');
                $('#lightsFrontOKBox, #lightsFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#lightsFrontOK').on('click', function () {
                $('#lightsFrontOKBox').toggleClass('large black checkmark icon');
                $('#lightsFrontBadBox, #lightsFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#lightsFrontGood').on('click', function () {
                $('#lightsFrontGoodBox').toggleClass('large black checkmark icon');
                $('#lightsFrontBadBox, #lightsFrontOKBox').removeClass('large black checkmark icon');
            });
            /*Lyspærer back*/
            $('#lightsBackBad').on('click', function () {
                $('#lightsBackBadBox').toggleClass('large black checkmark icon');
                $('#lightsBackOKBox, #lightsBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#lightsBackOK').on('click', function () {
                $('#lightsBackOKBox').toggleClass('large black checkmark icon');
                $('#lightsBackBadBox, #lightsBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#lightsBackGood').on('click', function () {
                $('#lightsBackGoodBox').toggleClass('large black checkmark icon');
                $('#lightsBackBadBox, #lightsBackOKBox').removeClass('large black checkmark icon');
            });
            /*Støtdemper foran*/
            $('#bumperFrontBad').on('click', function () {
                $('#bumperFrontBadBox').toggleClass('large black checkmark icon');
                $('#bumperFrontOKBox, #bumperFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#bumperFrontOK').on('click', function () {
                $('#bumperFrontOKBox').toggleClass('large black checkmark icon');
                $('#bumperFrontBadBox, #bumperFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#bumperFrontGood').on('click', function () {
                $('#bumperFrontGoodBox').toggleClass('large black checkmark icon');
                $('#bumperFrontBadBox, #bumperFrontOKBox').removeClass('large black checkmark icon');
            });
            /*Støtdemper bak*/
            $('#bumperBackBad').on('click', function () {
                $('#bumperBackBadBox').toggleClass('large black checkmark icon');
                $('#bumperBackOKBox, #bumperBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#bumperBackOK').on('click', function () {
                $('#bumperBackOKBox').toggleClass('large black checkmark icon');
                $('#bumperBackBadBox, #bumperBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#bumperBackGood').on('click', function () {
                $('#bumperBackGoodBox').toggleClass('large black checkmark icon');
                $('#bumperBackBadBox, #bumperBackOKBox').removeClass('large black checkmark icon');
            });
            /*Dekk foran*/
            $('#tiresFrontBad').on('click', function () {
                $('#tiresFrontBadBox').toggleClass('large black checkmark icon');
                $('#tiresFrontOKBox, #tiresFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#tiresFrontOK').on('click', function () {
                $('#tiresFrontOKBox').toggleClass('large black checkmark icon');
                $('#tiresFrontBadBox, #tiresFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#tiresFrontGood').on('click', function () {
                $('#tiresFrontGoodBox').toggleClass('large black checkmark icon');
                $('#tiresFrontBadBox, #tiresFrontOKBox').removeClass('large black checkmark icon');
            });
            /*Dekk bak*/
            $('#tiresBackBad').on('click', function () {
                $('#tiresBackBadBox').toggleClass('large black checkmark icon');
                $('#tiresBackOKBox, #tiresBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#tiresBackOK').on('click', function () {
                $('#tiresBackOKBox').toggleClass('large black checkmark icon');
                $('#tiresBackBadBox, #tiresBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#tiresBackGood').on('click', function () {
                $('#tiresBackGoodBox').toggleClass('large black checkmark icon');
                $('#tiresBackBadBox, #tiresBackOKBox').removeClass('large black checkmark icon');
            });
            /*Forstilling*/
            $('#suspensionFrontBad').on('click', function () {
                $('#suspensionFrontBadBox').toggleClass('large black checkmark icon');
                $('#suspensionFrontOKBox, #suspensionFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#suspensionFrontOK').on('click', function () {
                $('#suspensionFrontOKBox').toggleClass('large black checkmark icon');
                $('#suspensionFrontBadBox, #suspensionFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#suspensionFrontGood').on('click', function () {
                $('#suspensionFrontGoodBox').toggleClass('large black checkmark icon');
                $('#suspensionFrontBadBox, #suspensionFrontOKBox').removeClass('large black checkmark icon');
            });
            /*Bakstilling*/
            $('#suspensionBackBad').on('click', function () {
                $('#suspensionBackBadBox').toggleClass('large black checkmark icon');
                $('#suspensionBackOKBox, #suspensionBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#suspensionBackOK').on('click', function () {
                $('#suspensionBackOKBox').toggleClass('large black checkmark icon');
                $('#suspensionBackBadBox, #suspensionBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#suspensionBackGood').on('click', function () {
                $('#suspensionBackGoodBox').toggleClass('large black checkmark icon');
                $('#suspensionBackBadBox, #suspensionBackOKBox').removeClass('large black checkmark icon');
            });
            /*Bremser foran*/
            $('#brakesFrontBad').on('click', function () {
                $('#brakesFrontBadBox').toggleClass('large black checkmark icon');
                $('#brakesFrontOKBox, #brakesFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#brakesFrontOK').on('click', function () {
                $('#brakesFrontOKBox').toggleClass('large black checkmark icon');
                $('#brakesFrontBadBox, #brakesFrontGoodBox').removeClass('large black checkmark icon');
            });
            $('#brakesFrontGood').on('click', function () {
                $('#brakesFrontGoodBox').toggleClass('large black checkmark icon');
                $('#brakesFrontBadBox, #brakesFrontOKBox').removeClass('large black checkmark icon');
            });
            /*Bremser bak*/
            $('#brakesBackBad').on('click', function () {
                $('#brakesBackBadBox').toggleClass('large black checkmark icon');
                $('#brakesBackOKBox, #brakesBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#brakesBackOK').on('click', function () {
                $('#brakesBackOKBox').toggleClass('large black checkmark icon');
                $('#brakesBackBadBox, #brakesBackGoodBox').removeClass('large black checkmark icon');
            });
            $('#brakesBackGood').on('click', function () {
                $('#brakesBackGoodBox').toggleClass('large black checkmark icon');
                $('#brakesBackBadBox, #brakesBackOKBox').removeClass('large black checkmark icon');
            });
            /*Eksosanlegg*/
            $('#exhaustBad').on('click', function () {
                $('#exhaustBadBox').toggleClass('large black checkmark icon');
                $('#exhaustOKBox, #exhaustGoodBox').removeClass('large black checkmark icon');
            });
            $('#exhaustOK').on('click', function () {
                $('#exhaustOKBox').toggleClass('large black checkmark icon');
                $('#exhaustBadBox, #exhaustGoodBox').removeClass('large black checkmark icon');
            });
            $('#exhaustGood').on('click', function () {
                $('#exhaustGoodBox').toggleClass('large black checkmark icon');
                $('#exhaustBadBox, #exhaustOKBox').removeClass('large black checkmark icon');
            });
            /*Tetthet Motor*/
            $('#sealedEngineBad').on('click', function () {
                $('#sealedEngineBadBox').toggleClass('large black checkmark icon');
                $('#sealedEngineOKBox, #sealedEngineGoodBox').removeClass('large black checkmark icon');
            });
            $('#sealedEngineOK').on('click', function () {
                $('#sealedEngineOKBox').toggleClass('large black checkmark icon');
                $('#sealedEngineBadBox, #sealedEngineGoodBox').removeClass('large black checkmark icon');
            });
            $('#sealedEngineGood').on('click', function () {
                $('#sealedEngineGoodBox').toggleClass('large black checkmark icon');
                $('#sealedEngineBadBox, #sealedEngineOKBox').removeClass('large black checkmark icon');
            });
            /*Tetthet Girkasse*/
            $('#sealedGearboxBad').on('click', function () {
                $('#sealedGearboxBadBox').toggleClass('large black checkmark icon');
                $('#sealedGearboxOKBox, #sealedGearboxGoodBox').removeClass('large black checkmark icon');
            });
            $('#sealedGearboxOK').on('click', function () {
                $('#sealedGearboxOKBox').toggleClass('large black checkmark icon');
                $('#sealedGearboxBadBox, #sealedGearboxGoodBox').removeClass('large black checkmark icon');
            });
            $('#sealedGearboxGood').on('click', function () {
                $('#sealedGearboxGoodBox').toggleClass('large black checkmark icon');
                $('#sealedGearboxBadBox, #sealedGearboxOKBox').removeClass('large black checkmark icon');
            });



            /*STARTER UTSKRIFT AV VALGT RAPPORT*/
            $('#btnStartPrint').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modPrintVehicle').addClass('hidden');
                window.print();
            });


            $('#chkCompany').on('click', function (e) {
                if ($('#chkCompany').is(':checked')) {
                    $('#<%=lblPrivLastName.ClientID%>').addClass('hidden');
                    $('#<%=lblCompName.ClientID%>').removeClass('hidden');
                    $('#priv').hide();
                    $('#priv2').hide();
                    $('#comp').removeClass('hidden');
                    $('#comp2').removeClass('hidden');
                    $('#comp3').removeClass('hidden');
                }
                else {
                    $('#<%=lblPrivLastName.ClientID%>').removeClass('hidden');
                    $('#<%=lblCompName.ClientID%>').addClass('hidden');
                    $('#priv').show();
                    $('#priv2').show();
                    $('#comp').addClass('hidden');
                    $('#comp2').addClass('hidden');
                    $('#comp3').addClass('hidden');
                }
            });
            


            $('#btnSaveOrder').on('click', function () {
                var OrderNo = $('#<%=lblOrderNo.ClientID%>').text();
                if (OrderNo != "") {
                    UpdateOrder();
                    
                    PopulateWODetails($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value, 'update');
                    loadConfig($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value, userId, idMakeRP, idModelRP);
                    var Hprice = LoadHourlyPrice("New");
                    $('#<%=hdnHP.ClientID%>').val(Hprice);
                    loadRepairCode();
                    loadWorkCode();
                    loadWOJobGrid($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value);
                }
                else {
                    SaveOrder();
                    loadConfig($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value, userId, idMakeRP, idModelRP);
                    var Hprice = LoadHourlyPrice("New");
                    $('#<%=hdnHP.ClientID%>').val(Hprice);
                    loadRepairCode();
                    loadWorkCode();
                    loadWOJobGrid($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value);
                }
            });

            $('#btnCloseOrder').on('click', function () {
                var OrderNo = $('#<%=lblOrderNo.ClientID%>').text();
                if (OrderNo != "") {
                    UpdateOrder();
                }
                else {
                    SaveOrder();                    
                }

                 window.location.replace("../Transactions/frmOrderSearch.aspx");
            });

            ///OrderDetails
            var idMakeRP = "AM";
            var idModelRP = "";
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
            var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
            var userId = 'pv45';
            $('#<%=lblOrderNo.ClientID%>').text(idWOPrefix + idWONO);

            $('#<%=btnSearchSpares.ClientID%>').on('click', function () {
                //$('.overlayHide').addClass('ohActive');
                //$('#modNewCust').removeClass('hidden');
                $('#divSPGrid').show();
                var mkArr = new Array();
                var supArr = new Array();
                var locArr = new Array();
                var makelist = $('#<%=selMake.ClientID%>').dropdown('get value');
                if (makelist != null) {
                    if (makelist.length > 0) {
                        for (var i = 0; i < makelist.length; i++) {
                        mkArr[i] = makelist[i];
                        }
                    }
                }

                var suppList = $('#<%=selSupp.ClientID%>').dropdown('get value');
                if (suppList != null) {
                    if (suppList.length > 0) {
                        for (var k = 0; k < suppList.length; k++) {
                        supArr[k] = suppList[k];
                        }
                    }
                }

                var locList = $('#<%=selLoc.ClientID%>').dropdown('get value');
                if (locList != null) {
                    if (locList.length > 0) {
                        for (var k = 0; k < locList.length; k++) {
                        locArr[k] = locList[k];
                        }
                    }
                }

                loadSparesGrid($('#txtSPSearch')[0].value, $('#<%=lblCustName.ClientID%>').text(), $('#<%=hdnVehId.ClientID%>').val(), mkArr, supArr, locArr);
            });

            // Row 118 - cancel will take to wosearch page because data is saved after each line
            $('#<%=btnCancel.ClientID%>').on('click', function () {
                var res;
                var msg = GetMultiMessage('0242', '', '');
                res = confirm(msg);

                if (res == true) {
                    window.location.replace("../Transactions/frmWOSearch.aspx");
                }
                else {
                    saveJobDet(1);
                }
            });

            var grid = $("#jobgrid");
            var pageSize = "1000";
            var mydata;
            grid.jqGrid({
                datatype: "local",
                data: mydata,
                colNames: ['Job/Sparepart/Mech', 'Text', 'Nivå', 'Ford%', 'Bestilt', 'Levert', 'Pris', 'Rab', 'Belop', 'JobId', 'Flag', 'Diff', 'StockQty', 'Disc_Amt', 'Id_Make', 'WC', 'RC', 'ItemDesc', 'ForeignJob', 'IdMech', 'Id_Warehouse', 'IdWODetailseq', 'IdWOItemseq', 'Job_Status', 'LineNo', 'IdWOLabSeq', 'Id_Deb_Seq', 'Jobi_Bo_Qty', 'Sp_Cost_Price', 'MechanicName', 'DebitorType','SpareDiscount'],
                colModel: [
                    {
                        name: 'IdJob', index: 'IdJob', width: 290, editable: true, sortable: false,
                        editoptions: {
                            dataInit: function (el) {
                                $(el).autocomplete({
                                    selectFirst: true,
                                    autoFocus: true,
                                    source: function (request, response) {
                                        $.ajax({
                                            type: "POST",
                                            contentType: "application/json; charset=utf-8",
                                            url: "frmWOJobDetails.aspx/GetSpares",
                                            data: "{'spName':'" + $(el).val() + "',idCustomer:'" + $('#<%=lblCustName.ClientID%>').text() + "',vehId:'" + $('#<%=hdnVehId.ClientID%>').val() + "'}",
                                            dataType: "json",
                                            success: function (data) {
                                                if (data.d.length === 0) {
                                                    {
                                                        console.log("No Data");
                                                        response([{ label: 'Ingen reservedeler funnet. Vil du velge en reparasjonspakke?', value: ' ', val: 'RepPkg' }]);
                                                    }
                                                }
                                                else{
                                                response($.map(data.d, function (item) {
                                                    return {
                                                        label: item.Id_Item + " - " + item.Item_Sp_Desc,
                                                        val: item.Id_Item,
                                                        value: item.Id_Item,
                                                        spreplace: item.Id_Sp_Replace,
                                                        spdesc: item.Item_Sp_Desc,
                                                        spcatg: item.Id_Item_Catg,
                                                        spmake: item.Sp_Make,
                                                        idmake: item.Id_Make,
                                                        catgdesc: item.Category_Desc,
                                                        spmake: item.Sp_Make,
                                                        availqty: item.Item_Avail_Qty,
                                                        flgbkord: item.Flg_Allow_Bckord,
                                                        jobidisper: item.Jobi_Dis_Per,
                                                        jobivatper: item.Jobi_Vat_Per,
                                                        jobvatseq: item.Jobi_Vat_Seq,
                                                        spitemprice: item.Sp_Item_Price,
                                                        jobidelqty: item.Jobi_Deliver_Qty,
                                                        jobiboqty: item.Jobi_Bo_Qty,
                                                        costprice: item.Cost_Price,
                                                        disccodesell: item.Sp_Disc_Code_Sell,
                                                        disccodebuy: item.Sp_Disc_Code_Buy,
                                                        location: item.Sp_Location,
                                                        itemdesc: item.Sp_Item_Description,
                                                        spitem: item.Sp_I_Item,
                                                        idwhitem: item.Id_Wh_Item,
                                                        enviditem: item.Env_Id_Item,
                                                        envidmake: item.Env_Id_Make,
                                                        envidwh: item.Env_Id_Warehouse,
                                                        flgefd: item.Flg_Efd,
                                                        oldReplacementSpare: item.Id_Old_Sp_Replace,
                                                        sparediscount:item.SpareDiscount

                                                    }
                                                }))
                                                }
                                            },
                                            error: function (xhr, status, error) {
                                                alert("Error" + error);
                                                <%--$('#systemMSG').hide();--%>
                                                var err = eval("(" + xhr.responseText + ")");
                                                alert('Error: ' + err.Message);
                                            }
                                        });
                                    },
                                    select: function (e, i) {
                                        if (i.item.value == ' ' && i.item.val == 'RepPkg') {
                                            var id = jQuery("#jobgrid").jqGrid('getGridParam', 'selrow');
                                            $('#<%=lblSearchResult.ClientID%>').text("");
                                            $('#divRepPack').hide();
                                            $("#txtRPCodeSearch").val($(el).val());
                                            $('#modRepairPackage').modal({
                                                onDeny: function () {
                                                },
                                                onApprove: function () {
                                                    var selectedItem = lbRepPakHead.GetSelectedItems();
                                                    if (selectedItem.length > 0) {
                                                        var repPackSeq = selectedItem[0].texts[0];
                                                        var repPackageId = selectedItem[0].texts[2];
                                                        FetchRepairPackageDetails(repPackSeq, repPackageId, id);
                                                    }
                                                    else {
                                                        swal("Ingen reparasjonspakke valgt");
                                                    }
                                                }
                                            }).modal('show');
                                        }
                                        else {
                                        var key = e.charCode || e.keyCode; // to support all browsers
                                        //                   //something on key press by manipulating above value

                                        $("#<%=hdnAvail_Qty.ClientID%>").val(i.item.availqty);

                                        $(el).val(i.item.val);
                                        $("#<%=hdnIdItem.ClientID%>").val(i.item.val);
                                        $("#<%=hdnIdMake.ClientID%>").val(i.item.idmake);
                                        var id = jQuery("#jobgrid").jqGrid('getGridParam', 'selrow');


                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                                        var jobId = rowdata.JobId;
                                        var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                        var actualsparelength = rowspareData.length;
                                        jQuery("#jobgrid").setCell(id, "Nei", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(id, "Ford", "", 'not-editable-cell');

                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Nei', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Ford', "100");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Bestilt', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Levert', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Pris', i.item.spitemprice);
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Text', i.item.spdesc);
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Diff', "S");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Item_Avail_Qty', i.item.availqty);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'IdJob', i.item.val);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Make', i.item.idmake);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'ItemDesc', i.item.spdesc);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Warehouse', i.item.idwhitem);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'Sp_Cost_Price', i.item.costprice);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'SpareDiscount', i.item.sparediscount);

                                        if (i.item.spdesc != "") {
                                            jQuery("#jobgrid").setCell(id, "Text", "", 'not-editable-cell');
                                        }

                                        var cmn = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                                        cmn.editable = true;
                                        jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                                        $("#jobgrid").jqGrid("hideCol", "subGrid");
                                        setGridLinesColour();
                                        }
                                    },
                                });
                            }
                        }
                    },
                    {
                        name: 'Text', index: 'Text', width: 360, editable: true, sortable: false,
                        editoptions: {
                            dataInit: function (elem) { $(elem).focus(function () { this.select(); }) },
                            dataEvents: [
                                {
                                    type: 'keydown',
                                    fn: function (e) {
                                        var key = e.charCode || e.keyCode;
                                        if (key == 9 || key == 13)//tab
                                        {
                                            var grid = $('#jobgrid');
                                            var rowId = jQuery("#jobgrid").jqGrid('getGridParam', 'selrow');
                                            var fol = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                            var rowData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                            if (fol.Diff != "S" && fol.Diff != undefined) {
                                                jQuery('#jobgrid').jqGrid("setCell", rowId, 'Pris', $('#<%=hdnHP.ClientID%>').val());
                                            }
                                            jQuery('#jobgrid').setColProp('Nei', { editable: false });
                                            jQuery('#jobgrid').setColProp('Ford', { editable: false });
                                            // To be loaded from LoadHourlyPrice
                                            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                            for (var k = 0; k < rowdisdata.length; k++) {
                                                if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {

                                                    if (rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) {
                                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                                                    }

                                                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                                                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                                                }
                                                if ((rowdisdata[k].IdJob == "")) {
                                                    jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Nei', "0");
                                                    if (rowdisdata[k].Diff != "RAOR" || rowdisdata[k].Diff != "RBOR") {
                                                        if ($('#<%=hdnInsCustId.ClientID%>').val() == "") {
                                                            jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Ford', "100");
                                                        }
                                                    }

                                                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                                                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                                                    var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                                                    cm.editable = false;
                                                }
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    { name: 'Nei', index: 'Nei', width: 120, editable: false, sortable: false },
                    { name: 'Ford', index: 'Ford', width: 120, editable: false, sortable: false },
                    {
                        name: 'Bestilt', index: 'Bestilt', width: 80, editable: true, sortable: false,//, editrules: { custom: true, custom_func: calculateSp },
                        editoptions: {
                            dataInit: function (elem) { $(elem).focus(function () { this.select(); }) },
                        }
                    },
                    { name: 'Levert', index: 'Levert', width: 120, editable: true, sortable: false },
                    { name: 'Pris', index: 'Pris', width: 120, editable: true, sortable: false },
                    { name: 'Rab', index: 'Rab', width: 120, editable: true, sortable: false },
                    { name: 'Belop', index: 'Belop', width: 120, editable: false, sortable: false },
                    { name: 'JobId', index: 'JobId', width: 20, editable: true, hidden: true, sortable: false },
                    { name: 'Flag', index: 'Flag', width: 20, editable: true, hidden: true, sortable: false },
                    { name: 'Diff', index: 'Diff', width: 20, hidden: true, sortable: false },
                    { name: 'Item_Avail_Qty', index: 'Item_Avail_Qty', width: 20, hidden: true, sortable: false },
                    { name: 'Disc_Amt', index: 'Disc_Amt', hidden: true, sortable: false },
                    { name: 'Id_Make', index: 'Id_Make', hidden: true, sortable: false },
                    { name: 'WC', index: 'WC', hidden: true, sortable: false },
                    { name: 'RC', index: 'RC', hidden: true, sortable: false },
                    { name: 'ItemDesc', index: 'ItemDesc', hidden: true, sortable: false },
                    { name: 'ForeignJob', index: 'ForeignJob', hidden: true, sortable: false },
                    { name: 'IdMech', index: 'IdMech', hidden: true, sortable: false },
                    { name: 'Id_Warehouse', index: 'Id_Warehouse', hidden: true, sortable: false },
                    { name: 'IdWODetailseq', index: 'IdWODetailseq', hidden: true, sortable: false },
                    { name: 'IdWOItemseq', index: 'IdWOItemseq', hidden: true, sortable: false },
                    { name: 'Job_Status', index: 'Job_Status', hidden: true, sortable: false },
                    { name: 'LineNo', index: 'LineNo', hidden: true, sortable: false },
                    { name: 'IdWOLabSeq', index: 'IdWOLabSeq', hidden: true, sortable: false },
                    { name: 'Id_Deb_Seq', index: 'Id_Deb_Seq', hidden: true, sortable: false },
                    { name: 'Jobi_Bo_Qty', index: 'Jobi_Bo_Qty', hidden: true, sortable: false },
                    { name: 'Sp_Cost_Price', index: 'Sp_Cost_Price', hidden: true, sortable: false },
                    { name: 'MechanicName', index: 'MechanicName', hidden: true, sortable: false },
                    { name: 'DebtType', index: 'DebtType', hidden: true, sortable: false },
                    { name: 'SpareDiscount', index: 'SpareDiscount', hidden: true, sortable: false }
                ],
                multiselect: false,
                rowNum: pageSize,//can fetch from webconfig
                rowList: 5,
                sortorder: 'asc',
                viewrecords: true,
                height: "50%",
                autoWidth: true,
                shrinkToFit: true,
                caption: "Job Details",
                async: false, //Very important,
                subgrid: false,
                'cellEdit': true,
                'cellsubmit': "clientArray",
                editurl: "clientArray",
                afterEditCell: function (rowid, cellname, value, irow, icol) {
                    var cellDOM = this.rows[irow].cells[icol], originalKeydown;
                    var $editControl = $("#" + rowid).find("input, select, textarea,text"),
                        // events = $._data($editControl[0], "events"),
                             events = $editControl.data("events");
                    //originalKeydown;
                    if (events && events.keydown && events.keydown.length) {
                        //debugger;

                        // $editControl.unbind("keydown");
                        $editControl.bind("keydown", function (e) {
                              
                            // we can do something before jqGrid process "keydown" event
                            if (e.keyCode === 13) {
                                var id = rowid;//jQuery("#jobgrid").jqGrid('getGridParam', 'selrow');
                                var rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                                var jobId = rowdata.JobId;
                                var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');

                                if (cellname == "Ford") {
                                    for (var k = 0; k < rowspareData.length; k++) {
                                        if (rowspareData[k].DebtType == "OHC") {
                                            //rowspareData[k].Ford = rowdata.Ford;
                                            if (rowspareData[k].Diff == "RAOR") {
                                                if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop == "") {
                                                    var raorAmt = "0";
                                                    raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                    raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                    rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                }
                                            }

                                            if (rowspareData[k].Diff == "RBOR") {
                                                if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop == "") {
                                                    var raorAmt = "0";
                                                    rborAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                    rborAmt = (fnformatDecimalValue(rborAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                    rowspareData[k].Belop = fnformatDecimalValue(rborAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                }
                                            }
                                        }
                                        if (rowspareData[k].DebtType == "INSC" && (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR")) {
                                            rowspareData[k].Ford = 100 - fnformatDecimalValue(rowdata.Ford, seperator);
                                            //rowspareData[k].Diff = "ORARD"
                                        }
                                    }

                                    var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                    jQuery("#jobgrid").jqGrid('clearGridData');
                                    for (var i = 0; i < rowGrddata.length; i++) {
                                        jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                                    }
                                    //add a condition to check if ford% is > 0
                                    if (fnformatDecimalValue(rowdata.Ford, seperator) > 0 && (rowdata.Diff == "RBOR" || rowdata.Diff == "RAOR")) {
                                        saveJobDet(id);
                                    }
                                    else {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 6, true);
                                        document.getElementById((parseInt(rowid)) + '_Pris').select();
                                    }

                                }

                                if (cellname == "IdJob") {
                                    if (rowdata.IdJob != "" && rowdata.Text == "" && rowdata.Bestilt == "" && rowdata.Pris == "") {
                                        var isSpExists = checkSpareExists(e.target.value, id);
                                        if (isSpExists == "False") {
                                            alert("Select a valid spare");
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 0, true);
                                            document.getElementById((parseInt(rowid)) + '_IdJob').select();
                                            return false;
                                        }
                                    }
                                }

                                rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);

                                if (cellname == "IdJob") {
                                    if (rowdata.IdJob != "" && rowdata.Text != "") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                        document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                    }
                                    else if (rowdata.IdJob == "") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                        document.getElementById((parseInt(rowid)) + '_Text').select();
                                    } else if (rowdata.IdJob != "" && rowdata.Text == "" && rowdata.Diff == "S") {
                                        var isSpExists = checkSpareExists(e.target.value, id);
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                        document.getElementById((parseInt(rowid)) + '_Text').select();
                                    }
                                    else {
                                        if (rowdata.IdJob != "" && rowdata.Diff == "S" && rowdata.Levert != "" && rowdata.Bestilt != "") {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                            document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                        } else {
                                            alert("Select a valid spare");
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 0, true);
                                            document.getElementById((parseInt(rowid)) + '_IdJob').select();
                                            return false;
                                        }
                                    }
                                }

                                if (cellname == "Levert" || cellname == "Bestilt" || cellname == "Pris" || cellname == "Rab") {
                                    
                                    if (e.target.value != "") {
                                        var val = e.target.value;
                                        val = fnformatDecimalValue(val, seperator);
                                        var val_Length = val.length;

                                        if (isNaN(val) || (val < 0)) {
                                            msg = GetMultiMessage('0090', '', '');
                                            alert(msg);
                                            if (cellname == "Bestilt") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                                document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                            } else if (cellname == "Levert") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 5, true);
                                                document.getElementById((parseInt(rowid)) + '_Levert').select();
                                            } else if (cellname == "Pris") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 6, true);
                                                document.getElementById((parseInt(rowid)) + '_Pris').select();
                                            } else if (cellname == "Rab") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                document.getElementById((parseInt(rowid)) + '_Rab').select();
                                            }
                                            return false;
                                        }
                                        for (i = 0; i < val_Length; i++) {
                                            str = val.charCodeAt(i);
                                            if ((str == 46) || (str == 101) || (str == 32) || (str == 45) || (str == 43)) {
                                                msg = GetMultiMessage('MSGGERR1', '', '');
                                                alert(msg);

                                                if (cellname == "Bestilt") {
                                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                                    document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                                } else if (cellname == "Levert") {
                                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 5, true);
                                                    document.getElementById((parseInt(rowid)) + '_Levert').select();
                                                } else if (cellname == "Pris") {
                                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 6, true);
                                                    document.getElementById((parseInt(rowid)) + '_Pris').select();
                                                } else if (cellname == "Rab") {
                                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                    document.getElementById((parseInt(rowid)) + '_Rab').select();
                                                }
                                                return false;
                                            }
                                        }
                                        if (cellname == "Rab") {
                                            if (!(gfi_ValidNumber(e.target.value))) {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                document.getElementById((parseInt(rowid)) + '_Rab').select();
                                                return false;
                                            }
                                            if (e.target.value < 0) {
                                                var mess = GetMultiMessage('0116', GetMultiMessage('0338', '', ''), '');  //"Disc Percentage cannot be negative";
                                                alert(mess);
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                document.getElementById((parseInt(rowid)) + '_Rab').select();
                                                return false;
                                            }
                                            else if (e.target.value > 100) {
                                                var mess = GetMultiMessage('0116', GetMultiMessage('0338', '', ''), '');  //"Disc Percentage cannot be greater than 100";
                                                alert(mess);
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                document.getElementById((parseInt(rowid)) + '_Rab').select();
                                                return false;
                                            }
                                        }
                                    }
                                }
                             

                                var idItem = $('#<%=hdnIdItem.ClientID%>').val();
                                var idMake = $('#<%=hdnIdMake.ClientID%>').val();
                                var idCust = $('#<%=lblCustName.ClientID%>').text();
                                var vats = LoadGMHPVat(idItem, idMake,idCust);
                                var gmVat = 0.0;
                                var hpVat = 0.0;
                                var spVat = 0.0;

                                if (vats.length > 0) {
                                    gmVat = fnformatDecimalValue(vats[0], seperator);
                                    hpVat = fnformatDecimalValue(vats[1], seperator);
                                    spVat = fnformatDecimalValue(vats[2], seperator);
                                }

                                if (cellname == "IdJob") {
                                    //var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowid);
                                    var spareId = [];
                                    var ctr = 0;
                                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                    for (var k = 0; k < rowdisdata.length; k++) {
                                        //spareId[k] = rowdisdata[k].IdJob;
                                        if ((rowdisdata[k].JobId == rowdata.JobId) && (rowdisdata[k].Diff == "S")) {
                                            spareId.push(rowdisdata[k].IdJob);
                                            if (rowdisdata[k].IdJob == e.target.value) {
                                                ctr = ctr + 1;
                                            }
                                        }
                                    }

                                    if (ctr > 1) {
                                        alert("SparePart already exists.");
                                        return false;
                                    }

                                    var spmake = rowdata.Id_Make;
                                    $('#<%=hdnIdItem.ClientID%>').val(e.target.value);
                                    $('#<%=hdnIdMake.ClientID%>').val(spmake);
                                    //jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                    //document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                }

                                if (e.target.name == "Bestilt") {
                                    jQuery('#jobgrid').jqGrid("setCell", rowid, 'Bestilt', e.target.value);
                                } else if (e.target.name == "Levert") {
                                    jQuery('#jobgrid').jqGrid("setCell", rowid, 'Levert', e.target.value);
                                }

                                var id = rowid;//jQuery("#jobgrid").jqGrid('getGridParam', 'selrow');
                                var rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                                var jobId = rowdata.JobId;
                                var idwodetseq = "";
                                var iddebseq = "";
                                var idwoitemseq = "";
                                var idMechanic = rowdata.IdMech;
                                var makeid = rowdata.Id_Make;
                                idwodetseq = rowdata.IdWODetailseq;
                                idwoitemseq = rowdata.IdWOItemseq;
                                iddebseq = rowdata.Id_Deb_Seq;
                                var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                var isSpare, isLab_OrdText;
                                var isUpdate = "False";
                                var text = "";
                                var mcName = "";
                                var user = $('#<%=hdnDuser.ClientID%>').val();

                                var idItem = $('#<%=hdnIdItem.ClientID%>').val();
                                var idMake = $('#<%=hdnIdMake.ClientID%>').val();
                                var idCust = $('#<%=lblCustName.ClientID%>').text();
                                var vats = LoadGMHPVat(idItem, idMake,idCust);
                                var gmVat = 0.0;
                                var hpVat = 0.0;
                                var spVat = 0.0;
                                var foreignJob = "";

                                if (vats.length > 0) {
                                    gmVat = fnformatDecimalValue(vats[0], seperator);
                                    hpVat = fnformatDecimalValue(vats[1], seperator);
                                    spVat = fnformatDecimalValue(vats[2], seperator);
                                }

                                if (cellname == "Levert" || cellname == "Bestilt" || cellname == "Pris" || cellname == "Rab") {
                                    for (var k = 0; k < rowspareData.length; k++) {

                                        //if (rowspareData[k].Text != "") {
                                        if (e.target.value != "0" || e.target.value == "") {
                                            // if ((rowspareData[k].JobId == jobId) && (rowspareData[k].IdJob.indexOf(":") > -1)) {
                                            if ((rowspareData[k].IdMech != "") || (rowspareData[k].IdMech != undefined)) {
                                                if (rowspareData[k].IdJob != undefined) {
                                                    if (rowspareData[k].IdJob.indexOf(":") > -1) {
                                                        text = rowspareData[k].IdMech;
                                                        var mechName = new Array();
                                                        if (rowspareData[k].MechanicName != "" && rowspareData[k].MechanicName != null && rowspareData[k].MechanicName != undefined) {
                                                            mechName = rowspareData[k].MechanicName.split("-");
                                                            var userName = mechName[0] + "-" + mechName[1];
                                                            mcName = userName;
                                                        }
                                                        foreignJob = rowspareData[k].ForeignJob;
                                                        jQuery("#jobgrid").setCell(rowspareData[k].id, "IdJob", "", 'not-editable-cell');
                                                    }
                                                    else {
                                                        if (text == "" || text == undefined) {
                                                            rowspareData[k].IdMech = user;
                                                            text = rowspareData[k].IdMech;
                                                            var mechName = new Array();
                                                            if (rowspareData[k].MechanicName != "" && rowspareData[k].MechanicName != null && rowspareData[k].MechanicName != undefined) {
                                                                mechName = rowspareData[k].MechanicName.split("-");
                                                                var userName = mechName[0] + "-" + mechName[1];
                                                                mcName = userName;
                                                                if (mechName.length > 2) {
                                                                    rowspareData[k].IdMech = mechName[2];
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            else {
                                                if ((rowspareData[k].id == id)) {
                                                    if (text == "") {
                                                        text = rowspareData[k].IdJob;
                                                    }
                                                }
                                            }
                                        }
                                        //}

                                        if (rowspareData[k].id == id) {
                                            if (rowspareData[k].IdJob != "" && rowspareData[k].Diff == "S") {
                                                if (rowspareData[k].Item_Avail_Qty != "0") {
                                                    if (e.target.name == "Levert" || e.target.name == "Bestilt") {
                                                       
                                                        rowspareData[k].Levert = e.target.value;
                                                       
                                                        if (e.target.name == "Bestilt") {
                                                            //Need to calculate back order qty
                                                            //call getspareid - set itemavailqty , levert and back order column based on itemavailqty

                                                            checkSpareExists(rowspareData[k].IdJob, id);
                                                            var chkdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                                                            var backOrdQty = 0;
                                                            var spavailqty = 0;
                                                            var orderQty = 0;
                                                            var delvQty = 0;
                                                            var qtyDeliver = 0;
                                                            var Availa_Qty = 0.0;
                                                            var qtyDeliv = 0.0
                                                            var ordType = $('#<%=ddlType.ClientID%>').val();
                                                            spavailqty = fnformatDecimalValue(chkdata.Item_Avail_Qty, seperator);
                                                            orderQty = fnformatDecimalValue(e.target.value, seperator);
                                                            qtyDeliver = fnformatDecimalValue(chkdata.Levert, seperator) + fnformatDecimalValue(qtyDeliver, seperator);


                                                            if (spavailqty == 0) {
                                                                delvQty = 0;
                                                                backOrdQty = orderQty;
                                                            }
                                                            else if (spavailqty >= orderQty) {
                                                                delvQty = orderQty;
                                                                backOrdQty = orderQty - delvQty;
                                                            }
                                                            else if (spavailqty < orderQty) {
                                                                Availa_Qty = spavailqty + qtyDeliver;
                                                                if ((fnformatDecimalValue(orderQty, seperator) - fnformatDecimalValue(Availa_Qty, seperator)) > 0) {
                                                                    backOrdQty = orderQty - Availa_Qty;

                                                                    if (ordType.toString().trim() == "KRE") {
                                                                        backOrdQty = 0;
                                                                    }

                                                                    if (backOrdQty > 0) {
                                                                        backOrdQty = backOrdQty;
                                                                        qtyDeliv = orderQty - Availa_Qty;
                                                                        delvQty = qtyDeliv;
                                                                    }
                                                                    else {
                                                                        backOrdQty = 0;
                                                                        qtyDeliv = orderQty;
                                                                        delvQty = qtyDeliv;
                                                                    }
                                                                }

                                                                else {
                                                                    backOrdQty = 0;
                                                                    qtyDeliv = orderQty;
                                                                    delvQty = qtyDeliv;
                                                                }

                                                            }

                                                            if (chkdata.Rab == "" || chkdata.Rab == undefined || fnformatDecimalValue(chkdata.Rab, seperator)) {
                                                                if (fnformatDecimalValue($('#<%=hdnOHCSpareDisc.ClientID%>').val(), seperator) > 0) {
                                                                    rowspareData[k].Rab = $('#<%=hdnOHCSpareDisc.ClientID%>').val();
                                                                }
                                                                else if (fnformatDecimalValue($('#<%=hdnOHCGenDisc.ClientID%>').val(), seperator) > 0) {
                                                                    rowspareData[k].Rab = $('#<%=hdnOHCGenDisc.ClientID%>').val();
                                                                }
                                                                else if (fnformatDecimalValue(rowspareData[k].SpareDiscount, seperator) > 0) {
                                                                    rowspareData[k].Rab = rowspareData[k].SpareDiscount;
                                                                }
                                                                else {
                                                                    rowspareData[k].Rab = "";
                                                                }
                                                            }

                                                            jQuery('#jobgrid').jqGrid("setCell", id, 'Bestilt', orderQty);
                                                            jQuery('#jobgrid').jqGrid("setCell", id, 'Levert', delvQty);
                                                            jQuery('#jobgrid').jqGrid("setCell", id, 'Item_Avail_Qty', spavailqty);
                                                            jQuery('#jobgrid').jqGrid("setCell", id, 'Jobi_Bo_Qty', backOrdQty);

                                                        }
                                                    }


                                                    if (e.target.name == "Pris") {
                                                        rowspareData[k].Pris = fnreformatDecimal(e.target.value, seperator);
                                                        if (rowspareData[k].IdJob == "" && rowspareData[k].Text == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Levert == "") {
                                                            rowspareData[k].Diff = "OR";
                                                        }

                                                        if (rowspareData[k].Diff == "OR") {
                                                            if (fnformatDecimalValue(e.target.value, seperator) > fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val(), seperator)) {
                                                                alert("Own Risk Amount is greater than job total");
                                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(id), 6, true);
                                                                document.getElementById((parseInt(id)) + '_Pris').select();
                                                                return false;
                                                            }
                                                            saveJobDet(id);
                                                            rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                        }
                                                    }

                                                    if (e.target.name == "Pris") {
                                                        if (rowspareData[k].DebtType == "OHC") {
                                                            //rowspareData[k].Ford = rowdata.Ford;
                                                            if ((rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") && (rowspareData[k].JobId == "1")) {
                                                                if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop != "" && fnformatDecimalValue(rowspareData[k].Ford, seperator) > 0) {
                                                                    var raorAmt = e.target.value;
                                                                    raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                                    raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                                    rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                                } else if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris != "" && rowspareData[k].Belop == 0 && rowspareData[k].Ford == "") {
                                                                    var raorAmt = e.target.value;
                                                                    rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                                }
                                                                saveJobDet(id);
                                                                return false;
                                                            }

                                                        }
                                                    }

                                                    if (e.target.name == "Rab") {
                                                        var rebate = fnformatDecimalValue(e.target.value, seperator)
                                                        if (rebate == 0) {
                                                            rowspareData[k].Rab = "";
                                                        }
                                                        else {
                                                            rowspareData[k].Rab = fnreformatDecimal(e.target.value, seperator);
                                                        }
                                                        //if any reduction lines exists the belop amount shd be recalculated
                                                        recalculateRedLines();
                                                        saveJobDet(id);
                                                        //return false;
                                                        rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                    }

                                                    var amt = (fnformatDecimalValue(rowspareData[k].Levert, seperator) * fnformatDecimalValue(rowspareData[k].Pris, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) * 0.01)).toFixed(2);
                                                    var disc = 0.0;
                                                    //rowspareData[k].Belop = fnreformatDecimal(amt, seperator);
                                                    if (rowspareData[k].Rab != undefined && rowspareData[k].Rab != "0") {
                                                        disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowspareData[k].Rab, seperator) / 100)).toFixed(2)
                                                        amt = (amt - disc).toFixed(2);
                                                    }
                                                    rowspareData[k].Disc_Amt = fnreformatDecimal(disc, seperator);

                                                    if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                        rowspareData[k].Belop = fnreformatDecimal(amt, seperator);
                                                    }

                                                    if (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") {
                                                        if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Belop != "") {
                                                            var raorAmt = "0";
                                                            raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                            raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                            rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                        }
                                                    }


                                                    if (rowspareData[k].Diff == "S" && rowspareData[k].IdJob != "") {
                                                        rowspareData[k].Diff = "S";
                                                    }
                                                    else if (rowspareData[k].Diff == "L" && rowspareData[k].Text != "") {
                                                        rowspareData[k].Diff = "L";
                                                        if (rowspareData[k].IdMech == $('#<%=hdnDuser.ClientID%>').val()) {
                                                            rowspareData[k].IdJob = "";
                                                        }
                                                        else {
                                                            rowspareData[k].IdJob = mcName;
                                                        }
                                                        rowspareData[k].IdMech = text;
                                                        rowspareData[k].ForeignJob = foreignJob;
                                                    }
                                                    else if (rowspareData[k].Diff == "T" && rowspareData[k].Text != "") {
                                                        rowspareData[k].Diff = "T";
                                                    }
                                                    else {
                                                        if (text != "" && rowspareData[k].Levert != "") {
                                                            rowspareData[k].Diff = "L";
                                                            rowspareData[k].IdJob = mcName;
                                                            rowspareData[k].IdMech = text;
                                                            rowspareData[k].ForeignJob = foreignJob;
                                                        } else if (text != "" && rowspareData[k].Levert == "" && rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" || rowspareData[k].Diff != "RBOR") {
                                                            if (rowspareData[k].Text != "") {
                                                                rowspareData[k].Diff = "T";
                                                                $('#' + rowspareData[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                                            } else {
                                                                if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                                    rowspareData[k].Diff = "";
                                                                }
                                                            }
                                                            //rowspareData[k].IdJob = text;
                                                        } else {
                                                            if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                                rowspareData[k].Diff = "";
                                                            }
                                                        }
                                                    }
                                                }
                                                else {
                                                    //Added when spare had valid qty and edit spare when 0 qty - Need to check
                                                    //if (rowspareData[k].Levert == "0") {
                                                    //    rowspareData[k].Levert = "0";
                                                    //}
                                                    if (e.target.name == "Bestilt") {
                                                        
                                                        var chkdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                                                        var backOrdQty = 0;
                                                        var spavailqty = 0;
                                                        var orderQty = 0;
                                                        var delvQty = 0;
                                                        var qtyDeliver = 0;
                                                        var Availa_Qty = 0.0;
                                                        var qtyDeliv = 0.0
                                                        var ordType = $('#<%=ddlType.ClientID%>').val();
                                                        spavailqty = fnformatDecimalValue(chkdata.Item_Avail_Qty, seperator);
                                                        orderQty = fnformatDecimalValue(e.target.value, seperator);
                                                        qtyDeliver = fnformatDecimalValue(chkdata.Levert, seperator) + fnformatDecimalValue(qtyDeliver, seperator);
                                                        Availa_Qty = spavailqty + qtyDeliver;
                                                        if ((fnformatDecimalValue(orderQty, seperator) - fnformatDecimalValue(Availa_Qty, seperator)) > 0) {
                                                            backOrdQty = orderQty - Availa_Qty;

                                                            if (ordType.toString().trim() == "KRE") {
                                                                backOrdQty = 0;
                                                            }

                                                            if (backOrdQty > 0) {
                                                                backOrdQty = backOrdQty;
                                                                qtyDeliv = orderQty - backOrdQty;
                                                                delvQty = qtyDeliv;
                                                            }
                                                            else {
                                                                backOrdQty = 0;
                                                                qtyDeliv = orderQty;
                                                                delvQty = qtyDeliv;
                                                            }
                                                        }

                                                        else {
                                                            backOrdQty = 0;
                                                            qtyDeliv = orderQty;
                                                            delvQty = qtyDeliv;
                                                        }


                                                        rowspareData[k].Bestilt = orderQty;
                                                        rowspareData[k].Levert = delvQty;
                                                        rowspareData[k].Item_Avail_Qty = spavailqty;
                                                        rowspareData[k].Jobi_Bo_Qty = backOrdQty;

                                                        //rowspareData[k].Belop = "2000";

                                                        jQuery("#jobgrid").setCell(rowspareData[k].id, "Belop", "", 'ui-state-disabled');
                                                        if (backOrdQty > 0) {
                                                            jQuery("#jobgrid").jqGrid('setCell', rowspareData[k].id, "Bestilt", "", {
                                                                'color': 'rgba(255, 0, 0, 0.8)',
                                                                'background-image': 'none',
                                                                'text-align': 'right'
                                                            });
                                                        }
                                                    }
                                                    if (e.target.name == "Rab") {
                                                        var rebate = fnformatDecimalValue(e.target.value, seperator);
                                                        if (rebate == 0) {
                                                            rowspareData[k].Rab = "";
                                                        }
                                                        else {
                                                            rowspareData[k].Rab = fnreformatDecimal(e.target.value, seperator);
                                                        }
                                                        //if any reduction lines exists the belop amount shd be recalculated
                                                        recalculateRedLines();
                                                        saveJobDet(id);
                                                        //return false;
                                                        rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                    }
                                                }
                                            }
                                            else {
                                                if (e.target.name == "Levert" || e.target.name == "Bestilt") {
                                                    rowspareData[k].Levert = e.target.value;

                                                    if (e.target.value == "") {
                                                        rowspareData[k].Pris = "";
                                                        rowspareData[k].Diff = "T";
                                                        $('#' + rowspareData[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                                        var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Text');
                                                        cm.editable = true;
                                                    } else {
                                                        if (rowspareData[k].Text != "") {
                                                            rowspareData[k].Diff = "L";
                                                        } else {
                                                            rowspareData[k].Diff = "";
                                                            rowspareData[k].Levert = "";
                                                            rowspareData[k].Pris = "";
                                                        }
                                                    }
                                                }
                                                if (e.target.name == "Pris") {
                                                    rowspareData[k].Pris = fnreformatDecimal(e.target.value, seperator);
                                                    if (rowspareData[k].IdJob == "" && rowspareData[k].Text == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Levert == "") {
                                                        rowspareData[k].Diff = "OR";
                                                    }

                                                    if (rowspareData[k].Diff == "OR") {
                                                        if (fnformatDecimalValue(e.target.value, seperator) > fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val(), seperator)) {
                                                            alert("Own Risk Amount is greater than job total");
                                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(id), 6, true);
                                                            document.getElementById((parseInt(id)) + '_Pris').select();
                                                            return false;
                                                        }
                                                        saveJobDet(id);
                                                        rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');

                                                    }
                                                }

                                                if (e.target.name == "Pris") {
                                                    if (rowspareData[k].DebtType == "OHC") {
                                                        //rowspareData[k].Ford = rowdata.Ford;
                                                        if ((rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") && (rowspareData[k].JobId == "1")) {
                                                            if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop != "" && fnformatDecimalValue(rowspareData[k].Ford, seperator) > 0) {
                                                                var raorAmt = e.target.value;
                                                                raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                                raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                                rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                            } else if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris != "" && rowspareData[k].Belop == 0 && rowspareData[k].Ford == "") {
                                                                var raorAmt = e.target.value;
                                                                rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                            }
                                                            saveJobDet(id);
                                                            return false;
                                                        }

                                                    }
                                                }

                                                if (e.target.name == "Rab") {
                                                    var rebate = fnformatDecimalValue(e.target.value, seperator)
                                                    if (rebate == 0) {
                                                        rowspareData[k].Rab = "";
                                                    }
                                                    else {
                                                        rowspareData[k].Rab = fnreformatDecimal(e.target.value, seperator);
                                                    }
                                                    //if any reduction lines exists the belop amount shd be recalculated
                                                    recalculateRedLines();

                                                    saveJobDet(id);
                                                    //return false;
                                                    rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                }
                                                var amt = (fnformatDecimalValue(rowspareData[k].Levert, seperator) * fnformatDecimalValue(rowspareData[k].Pris, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) * 0.01)).toFixed(2);
                                                var disc = 0.0;
                                                //rowspareData[k].Belop = fnreformatDecimal(amt, seperator);
                                                if (rowspareData[k].Rab != undefined && rowspareData[k].Rab != "0") {
                                                    disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowspareData[k].Rab, seperator) / 100)).toFixed(2);
                                                    amt = (amt - disc).toFixed(2);
                                                }

                                                rowspareData[k].Disc_Amt = fnreformatDecimal(disc, seperator);
                                                if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                    rowspareData[k].Belop = fnreformatDecimal(amt, seperator);
                                                }
                                                if (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") {
                                                    if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Belop != "") {
                                                        var raorAmt = "0";
                                                        raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                        raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                        rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                    }
                                                }

                                                if (rowspareData[k].Diff == "S" && rowspareData[k].IdJob != "") {
                                                    rowspareData[k].Diff = "S";
                                                }
                                                else if (rowspareData[k].Diff == "L" && rowspareData[k].Text != "") {
                                                    rowspareData[k].Diff = "L";
                                                    if (rowspareData[k].IdMech == $('#<%=hdnDuser.ClientID%>').val()) {
                                                        rowspareData[k].IdJob = "";

                                                    }
                                                    else {
                                                        rowspareData[k].IdJob = mcName;

                                                    }
                                                    rowspareData[k].IdMech = text;
                                                    rowspareData[k].ForeignJob = foreignJob;
                                                }
                                                else if (rowspareData[k].Diff == "T" && rowspareData[k].Text != "") {
                                                    rowspareData[k].Diff = "T";
                                                }
                                                else {
                                                    if ((text != "" && text != undefined) && (rowspareData[k].Levert != "" && rowspareData[k].Levert != "0")) {
                                                        rowspareData[k].Diff = "L";
                                                        if (rowspareData[k].IdMech == $('#<%=hdnDuser.ClientID%>').val()) {
                                                            rowspareData[k].IdJob = "";
                                                        }
                                                        else {
                                                            rowspareData[k].IdJob = mcName;
                                                        }
                                                        rowspareData[k].IdMech = text;
                                                        rowspareData[k].ForeignJob = foreignJob;
                                                    } else if ((text != "" && text != undefined) && rowspareData[k].Levert == "" && rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                        if (rowspareData[k].Text != "") {
                                                            rowspareData[k].Diff = "T";
                                                        } else {
                                                            if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                                rowspareData[k].Diff = "";
                                                            }
                                                        }
                                                        //rowspareData[k].IdJob = text;
                                                    } else {
                                                        if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                            rowspareData[k].Diff = "";
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        if (rowspareData[k].JobId == jobId) {
                                            if (rowspareData[k].IdJob == "" && rowspareData[k].Text == "") {
                                                isUpdate = "True";
                                            } else {
                                                isUpdate = "False";
                                            }
                                        }
                                        else {
                                            if (rowspareData[k].id == id) {
                                                isUpdate = "True";
                                            }
                                        }
                                        if (rowspareData[k].Diff == "T") {
                                            if (e.target.name == "Levert") {
                                                if (e.target.value == "") {
                                                    rowspareData[k].Diff = "T";
                                                    if (rowspareData[k].id == id) {
                                                        saveJobDet(id);
                                                        return false;
                                                    }
                                                    //rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                }
                                            }
                                        }
                                    }

                                    if (isUpdate == "False") {
                                        //add new line
                                        var spares = {
                                            id: parseInt(id) + 1,
                                            IdJob: "",
                                            Text: "",
                                            Nei: "0",
                                            Ford: "100",
                                            Bestilt: "",
                                            Levert: "",
                                            Pris: "",
                                            Rab: "",
                                            Belop: "",
                                            JobId: jobId.toString(),
                                            Flag: "0",
                                            Diff: "",
                                            Item_Avail_Qty: "",
                                            Disc_Amt: "0",
                                            ForeignJob: "",
                                            ItemDesc: "",
                                            IdWODetailseq: idwodetseq,
                                            Id_Deb_Seq: iddebseq,
                                            IdMech: idMechanic,
                                            Id_Make: makeid,
                                            IdWOItemseq: idwoitemseq
                                        }

                                        var newspares = $.extend(true, {}, rowspareData);
                                        var actualsparelength = rowspareData.length;
                                        if (id == rowspareData.length) {
                                            rowspareData[parseInt(id)] = spares;
                                            actualsparelength = rowspareData.length;
                                        } else {
                                            for (var a = 0; a < id; a++) {
                                                newspares[a].IdJob = rowspareData[a].IdJob,
                                                newspares[a].Text = rowspareData[a].Text,
                                                newspares[a].Nei = rowspareData[a].Nei,
                                                newspares[a].Ford = rowspareData[a].Ford,
                                                newspares[a].Bestilt = rowspareData[a].Bestilt,
                                                newspares[a].Levert = rowspareData[a].Levert,
                                                newspares[a].Pris = rowspareData[a].Pris,
                                                newspares[a].Rab = rowspareData[a].Rab,
                                                newspares[a].Belop = rowspareData[a].Belop,
                                                newspares[a].JobId = rowspareData[a].JobId,
                                                newspares[a].Flag = rowspareData[a].Flag,
                                                newspares[a].Diff = rowspareData[a].Diff,
                                                newspares[a].Item_Avail_Qty = rowspareData[a].Item_Avail_Qty,
                                                newspares[a].Disc_Amt = rowspareData[a].Disc_Amt,
                                                newspares[a].ForeignJob = rowspareData[a].ForeignJob,
                                                newspares[a].ItemDesc = rowspareData[a].ItemDesc
                                                newspares[a].IdWODetailseq = rowspareData[a].IdWODetailseq
                                                newspares[a].Id_Deb_Seq = rowspareData[a].Id_Deb_Seq
                                                newspares[a].Id_Make = rowspareData[a].Id_Make
                                                newspares[a].IdMech = rowspareData[a].IdMech
                                                newspares[a].IdWOItemseq = rowspareData[a].IdWOItemseq
                                            }

                                            for (var b = parseInt(id) ; b < rowspareData.length + 1; b++) {
                                                var spares1 = {
                                                    id: b + 1,
                                                    IdJob: "",
                                                    Text: "",
                                                    Nei: "0",
                                                    Ford: "100",
                                                    Bestilt: "",
                                                    Levert: "",
                                                    Pris: "",
                                                    Rab: "",
                                                    Belop: "",
                                                    JobId: jobId.toString(),
                                                    Flag: "0",
                                                    Diff: "",
                                                    Item_Avail_Qty: "",
                                                    Disc_Amt: "0",
                                                    ForeignJob: "",
                                                    ItemDesc: "",
                                                    IdWODetailseq: idwodetseq,
                                                    Id_Deb_Seq: iddebseq,
                                                    IdMech: idMechanic,
                                                    Id_Make: makeid,
                                                    IdWOItemseq: idwoitemseq
                                                }
                                                newspares[parseInt(b)] = spares1;
                                            }

                                            for (var a = parseInt(id) ; a < rowspareData.length; a++) {
                                                newspares[parseInt(a) + 1].IdJob = rowspareData[parseInt(a)].IdJob,
                                                newspares[parseInt(a) + 1].Text = rowspareData[parseInt(a)].Text,
                                                newspares[parseInt(a) + 1].Nei = rowspareData[parseInt(a)].Nei,
                                                newspares[parseInt(a) + 1].Ford = rowspareData[parseInt(a)].Ford,
                                                newspares[parseInt(a) + 1].Bestilt = rowspareData[parseInt(a)].Bestilt,
                                                newspares[parseInt(a) + 1].Levert = rowspareData[parseInt(a)].Levert,
                                                newspares[parseInt(a) + 1].Pris = rowspareData[parseInt(a)].Pris,
                                                newspares[parseInt(a) + 1].Rab = rowspareData[parseInt(a)].Rab,
                                                newspares[parseInt(a) + 1].Belop = rowspareData[parseInt(a)].Belop,
                                                newspares[parseInt(a) + 1].JobId = rowspareData[parseInt(a)].JobId,
                                                newspares[parseInt(a) + 1].Flag = rowspareData[parseInt(a)].Flag,
                                                newspares[parseInt(a) + 1].Diff = rowspareData[parseInt(a)].Diff,
                                                newspares[parseInt(a) + 1].Item_Avail_Qty = rowspareData[parseInt(a)].Item_Avail_Qty,
                                                newspares[parseInt(a) + 1].Disc_Amt = rowspareData[parseInt(a)].Disc_Amt,
                                                newspares[parseInt(a) + 1].ForeignJob = rowspareData[parseInt(a)].ForeignJob
                                                newspares[parseInt(a) + 1].ItemDesc = rowspareData[parseInt(a)].ItemDesc
                                                newspares[parseInt(a) + 1].IdWODetailseq = rowspareData[parseInt(a)].IdWODetailseq
                                                newspares[parseInt(a) + 1].Id_Deb_Seq = rowspareData[parseInt(a)].Id_Deb_Seq
                                                newspares[parseInt(a) + 1].Id_Make = rowspareData[parseInt(a)].Id_Make
                                                newspares[parseInt(a) + 1].Id_Mech = rowspareData[parseInt(a)].Id_Mech
                                                newspares[parseInt(a) + 1].IdWOItemseq = rowspareData[parseInt(a)].IdWOItemseq
                                            }
                                            actualsparelength = actualsparelength + 1;
                                            rowspareData = newspares;
                                        }


                                        jQuery("#jobgrid").jqGrid('clearGridData');
                                        for (var j = 0; j < actualsparelength; j++) {
                                            sparedata = rowspareData;
                                            jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                                        }
                                        jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                                        $("#jobgrid").jqGrid("hideCol", "subGrid");

                                    } else {

                                        jQuery("#jobgrid").jqGrid('clearGridData');
                                        for (var j = 0; j < rowspareData.length; j++) {
                                            sparedata = rowspareData;
                                            jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                                        }
                                        jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                                        $("#jobgrid").jqGrid("hideCol", "subGrid");
                                    }
                                }
                                //end of if
                                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                var hpVatPer = hpVat;
                                var gmVatPer = gmVat;
                                var spVatPer = spVat;
                                var hpVat = 0.0;
                                var gmVat = 0.0;
                                var amtS = 0.0;
                                var vatAmount = 0.0;
                                var amtL = 0.0;
                                var discAmount = 0.0;
                                var TotalGM = 0.0;
                                var amtG = 0.0;
                                //var jobDisc = 0.0;

                                var labDisc = 0.0;
                                var gmDisc = 0.0;
                                var spareDisc = 0.0;
                                var labVatDisc = 0.0;
                                var gmVatDisc = 0.0;
                                var spareVatDisc = 0.0;
                                var totLabVatDisc = 0.0;
                                var totGmVatDisc = 0.0;
                                var totSpareVatDisc = 0.0;
                                var idCust = $('#<%=lblCustName.ClientID%>').text();
                                for (var k = 0; k < rowdisdata.length; k++) {
                                    vats = LoadGMHPVat(rowdisdata[k].IdJob, rowdisdata[k].Id_Make, idCust);
                                    //gmVat = 0.0;
                                    //hpVat = 0.0;
                                    spVat = 0.0;

                                    if (vats.length > 0) {
                                        // gmVat = fnformatDecimalValue(vats[0], seperator);
                                        // hpVat = fnformatDecimalValue(vats[1], seperator);
                                        spVat = fnformatDecimalValue(vats[2], seperator);
                                    }

                                    spVatPer = spVat;

                                    if (rowdisdata[k].Diff == "S") {
                                        if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                            var boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                            if (boQty != "0") {
                                                jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                                    'color': 'rgba(255, 0, 0, 0.8)',
                                                    'background-image': 'none'
                                                });
                                            }
                                        }
                                    }
                                    

                                    if (rowdisdata[k].Flag == "1" && (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined ||rowdisdata[k].DebtType == "")) {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    }                                     
                                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INSC") {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INSC") {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                    }
                                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INTC") {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INTC") {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                    }

                                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "CLA") {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "CLA") {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                    }
                                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "MISC") {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "MISC") {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                    }
                                    else {
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'text-align': 'left'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'text-align': 'left'
                                        });

                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Belop", "", 'ui-state-disabled');

                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                    }
                                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC") || (rowdisdata[k].DebtType == "INTC") || (rowdisdata[k].DebtType == "CLA") || (rowdisdata[k].DebtType == "MISC")) {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                    }
                                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RAOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RAOR")) {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                    }
                                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RBOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RBOR")) {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                    }
                                    if (rowdisdata[k].Diff == "T") {
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Pris", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Rab", "", 'not-editable-cell');
                                    }
                                    if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                                        if ((rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) && (rowdisdata[k].Diff == "S")) {
                                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                                        }

                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                                    }

                                    if (rowdisdata[k].Diff == "L") {
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');

                                        //var amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                                        var amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                        amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);
                                        var GM = $('#<%=txtGM.ClientID%>').val();

                                        if (rowdisdata[k].ForeignJob != "FJ") {
                                            amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                            TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                                            // TotalGM = fnreformatDecimal(TotalGM, seperator);
                                            $('#<%=txtTGM.ClientID%>').val(TotalGM);
                                        }

                                        //Lab and GM Discount
                                        if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                            labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                            gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);

                                            labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                                            totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                            gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                                            totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                                        }

                                        hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                                        gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                                        hpVat = fnreformatDecimal(hpVat, seperator);
                                        gmVat = fnreformatDecimal(gmVat, seperator);
                                        amtL = fnreformatDecimal(amtL, seperator);
                                        TotalGM = fnreformatDecimal(TotalGM, seperator);
                                        $('#<%=txtTGM.ClientID%>').val(TotalGM);
                                        $('#<%=txtHPVat.ClientID%>').val(hpVat);
                                        $('#<%=txtGMVat.ClientID%>').val(gmVat);
                                        $('#<%=txtTLab.ClientID%>').val(amtL);

                                        var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                                        rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);

                                        var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                                        rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                                    }

                                    if (rowdisdata[k].Diff == "S") {
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                                        var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                                        cm.editable = true;
                                        var amount;
                                        if (rowdisdata[k].Belop != undefined) {
                                            // amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                                            amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                        } else {
                                            amount = fnformatDecimalValue("", seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                        }
                                        amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                                        //vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);
                                        vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);

                                        amtS = fnreformatDecimal(amtS, seperator);
                                        vatAmount = fnreformatDecimal(vatAmount, seperator);
                                        $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                                        $('#<%=txtTSP.ClientID%>').val(amtS);

                                        if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                            var amt;
                                            var boQty;
                                            if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                                boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                            } else {
                                                boQty = 0;
                                            }

                                            if (boQty != "0") {
                                                //discAmount = 0;
                                                spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                                            } else {
                                                amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                                //discAmount = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2);
                                                spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                                            }
                                        }
                                        spareVatDisc = (amount * (spVatPer / 100)).toFixed(2);
                                        totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                        var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                                        rowdisdata[k].Disc_Amt = fnreformatDecimal(spchck, seperator);

                                        var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                                        rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);

                                    }

                                    if (rowdisdata[k].Disc_Amt != undefined) {
                                        discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                                    }

                                    discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);
                                }

                                if ($('#<%=txtTLab.ClientID%>').val() == "") {
                                    $('#<%=txtTLab.ClientID%>').val('0');
                                    $('#<%=txtTGM.ClientID%>').val('0');
                                    $('#<%=txtHPVat.ClientID%>').val('0');
                                    $('#<%=txtGMVat.ClientID%>').val('0');
                                }

                                if ($('#<%=txtSPVat.ClientID%>').val() == "") {
                                    $('#<%=txtSPVat.ClientID%>').val('0');
                                    $('#<%=txtTSP.ClientID%>').val('0');
                                }

                                var total = (fnformatDecimalValue($('#<%=txtTGM.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTLab.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val(), seperator)).toFixed(2);
                                var vatTotal = (fnformatDecimalValue($('#<%=txtHPVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtGMVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val(), seperator)).toFixed(2);
                                var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                                total = fnreformatDecimal(total, seperator);
                                vatTotal = fnreformatDecimal(vatTotal, seperator);
                                TIncVat = fnreformatDecimal(TIncVat, seperator);
                                discAmount = fnreformatDecimal(discAmount, seperator);

                                $('#<%=txtNet.ClientID%>').val(total);
                                $('#<%=txtVat.ClientID%>').val(vatTotal);
                                $('#<%=txtTotal.ClientID%>').val(TIncVat);
                                $('#<%=txtDisc.ClientID%>').val(discAmount);

                                if (cellname == "Levert" || cellname == "Bestilt") {
                                    if (rowdata.IdJob == "" && rowdata.Text != "" && rowdata.Levert == "") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 0, true);
                                        document.getElementById((parseInt(rowid) + 1) + '_IdJob').select();
                                    } else {
                                        if (rowdata.IdJob == "" && rowdata.Text == "" && rowdata.Diff == "") {
                                            //jQuery('#jobgrid').jqGrid("setCell", rowid, 'Levert', "0");
                                            //jQuery('#jobgrid').jqGrid("setCell", rowid, 'Pris', "0");
                                            //jQuery('#jobgrid').jqGrid("setCell", rowid, 'Belop', "0");
                                        }
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 6, true);
                                        document.getElementById((parseInt(rowid)) + '_Pris').select();
                                    }
                                }
                                if (cellname == "Pris") {

                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                    document.getElementById((parseInt(rowid)) + '_Rab').select();
                                }
                                if (cellname == "Rab") {

                                    var nextrowdata = jQuery("#jobgrid").jqGrid('getRowData', (parseInt(rowid) + 1));
                                    if (nextrowdata.IdJob != undefined && nextrowdata.Text != undefined && nextrowdata.Diff != undefined) {
                                        if (nextrowdata.IdJob != "" && nextrowdata.Text != "" && nextrowdata.Diff == "S") {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 4, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_Bestilt').select();
                                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Text');
                                            cm.editable = true;
                                        } else if (nextrowdata.IdJob == "" && nextrowdata.Text != "" && (nextrowdata.Diff == "L" || nextrowdata.Diff == "T")) {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 1, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_Text').select();
                                        } else if (nextrowdata.IdJob.indexOf(":") > -1) {
                                            var nextjobrowdata = jQuery("#jobgrid").jqGrid('getRowData', (parseInt(rowid) + 2));

                                            //if (nextjobrowdata.length > 1) {
                                            if (nextjobrowdata.Text != "" && nextjobrowdata.Diff == "L") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 2, 1, true);
                                                document.getElementById((parseInt(rowid) + 2) + '_Text').select();
                                            } else if (nextjobrowdata.IdJob != "" && nextjobrowdata.Text != "" && nextjobrowdata.Diff == "S") {

                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 2, 4, true);
                                                document.getElementById((parseInt(rowid) + 2) + '_Bestilt').select();
                                            } else if (nextjobrowdata.IdJob == "" && nextjobrowdata.Text == "" && nextjobrowdata.Diff == "") {

                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 2, 0, true);
                                                document.getElementById((parseInt(rowid) + 2) + '_IdJob').select();
                                            } else {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 0, true);
                                                document.getElementById((parseInt(rowid)) + '_IdJob').select();
                                            }                                                        //}

                                        }
                                        else {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 0, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_IdJob').select();
                                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Text');
                                            cm.editable = true;
                                        }
                                    }
                                }
                                if (cellname == "Text") {
                                    var nextrowdata = jQuery("#jobgrid").jqGrid('getRowData', (parseInt(rowid) + 1));
                                    if (rowdata.Diff == "S") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                        document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                    } else if (rowdata.Diff == "T") {
                                        if (nextrowdata.Diff == "S") {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 4, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_Bestilt').select();
                                        }
                                        else {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 1, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_Text').select();
                                        }
                                    }
                                    else {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 5, true);
                                        document.getElementById((parseInt(rowid)) + '_Levert').select();
                                    }
                                }

                                if (cellname == "IdJob") {
                                    if (rowdata.ItemDesc == "") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                        document.getElementById((parseInt(rowid)) + '_Text').select();
                                    }
                                    else if (rowdata.IdJob == "") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                        document.getElementById((parseInt(rowid)) + '_Text').select();

                                    }
                                    else {
                                        if (rowdata.IdJob != "" && rowdata.Diff == "S" && rowdata.Levert != "" && rowdata.Bestilt != "") {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                            document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                        } else {
                                            alert("Select a valid spare");
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 0, true);
                                            document.getElementById((parseInt(rowid)) + '_IdJob').select();
                                        }
                                    }
                                }
                                // }
                                return false;
                            }
                            else if (e.keyCode === 9) {
                               
                                var id = rowid;//jQuery("#jobgrid").jqGrid('getGridParam', 'selrow');
                                var rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                                var jobId = rowdata.JobId;
                                var idwodetseq = rowdata.IdWODetailseq;
                                var iddebseq = rowdata.Id_Deb_Seq;
                                var idMechanic = rowdata.IdMech;
                                var makeid = rowdata.Id_Make;
                                var idwoitemseq = rowdata.IdWOItemseq;
                                var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                var isSpare, isLab_OrdText;
                                var isUpdate = "False";
                                var text = "";
                                var foreignJob = "";
                                var mcName = "";
                                var user = $('#<%=hdnDuser.ClientID%>').val();
                                var debtType = rowdata.DebtType;

                                if (cellname == "Ford") {
                                    for (var k = 0; k < rowspareData.length; k++) {
                                        if (rowspareData[k].DebtType == "OHC") {
                                            //rowspareData[k].Ford = rowdata.Ford;
                                            if (rowspareData[k].Diff == "RAOR") {
                                                if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop == "") {
                                                    var raorAmt = "0";
                                                    raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                    raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                    rowspareData[k].Belop = fnformatDecimalValue(raorAmt,seperator); // To be recalculated based on RAOR/RBOR
                                                }
                                            }

                                            if (rowspareData[k].Diff == "RBOR") {
                                                if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop == "") {
                                                    var raorAmt = "0";
                                                    rborAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                    rborAmt = (fnformatDecimalValue(rborAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                    rowspareData[k].Belop = fnformatDecimalValue(rborAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                }
                                            }
                                        }
                                        if (rowspareData[k].DebtType == "INSC" && (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR")) {
                                            rowspareData[k].Ford = 100 - fnformatDecimalValue(rowdata.Ford, seperator);
                                            //rowspareData[k].Diff = "ORARD"
                                        }
                                        if (rowspareData[k].DebtType == "INTC" && (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR")) {
                                            rowspareData[k].Ford = 100 - fnformatDecimalValue(rowdata.Ford, seperator);
                                            //rowspareData[k].Diff = "ORARD"
                                        }
                                        if (rowspareData[k].DebtType == "CLA" && (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR")) {
                                            rowspareData[k].Ford = 100 - fnformatDecimalValue(rowdata.Ford, seperator);
                                            //rowspareData[k].Diff = "ORARD"
                                        }
                                        if (rowspareData[k].DebtType == "MISC" && (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR")) {
                                            rowspareData[k].Ford = 100 - fnformatDecimalValue(rowdata.Ford, seperator);
                                            //rowspareData[k].Diff = "ORARD"
                                        }
                                    }

                                    var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                    jQuery("#jobgrid").jqGrid('clearGridData');
                                    for (var i = 0; i < rowGrddata.length; i++) {
                                        jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                                    }
                                    //add a condition to check if ford% is > 0
                                    if (fnformatDecimalValue(rowdata.Ford, seperator) > 0 && (rowdata.Diff == "RBOR" || rowdata.Diff == "RAOR")) {
                                        saveJobDet(id);
                                    }
                                    else {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 6, true);
                                        document.getElementById((parseInt(rowid)) + '_Pris').select();
                                    }
                                }


                                if (cellname == "Levert" || cellname == "Bestilt" || cellname == "Pris" || cellname == "Rab") {
                                    
                                    if (e.target.value != "") {
                                        var val = e.target.value;
                                        val = fnformatDecimalValue(val, seperator);
                                        //val = fnreformatDecimal(val, seperator);
                                        //alert("Levert C " + val);
                                        var val_Length = val.length;

                                        if (isNaN(val) || (val < 0)) {
                                            msg = GetMultiMessage('0090', '', '');
                                            alert(msg);
                                            if (cellname == "Bestilt") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                                document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                            } else if (cellname == "Levert") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 5, true);
                                                document.getElementById((parseInt(rowid)) + '_Levert').select();
                                            } else if (cellname == "Pris") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 6, true);
                                                document.getElementById((parseInt(rowid)) + '_Pris').select();
                                            } else if (cellname == "Rab") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                document.getElementById((parseInt(rowid)) + '_Rab').select();
                                            }

                                            return false;
                                        }
                                        for (i = 0; i < val_Length; i++) {
                                            str = val.charCodeAt(i);
                                            if ((str == 46) || (str == 101) || (str == 32) || (str == 45) || (str == 43)) {
                                                msg = GetMultiMessage('MSGGERR1', '', '');
                                                alert(msg);

                                                if (cellname == "Bestilt") {
                                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                                    document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                                } else if (cellname == "Levert") {
                                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 5, true);
                                                    document.getElementById((parseInt(rowid)) + '_Levert').select();
                                                } else if (cellname == "Pris") {
                                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 6, true);
                                                    document.getElementById((parseInt(rowid)) + '_Pris').select();
                                                } else if (cellname == "Rab") {
                                                    jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                    document.getElementById((parseInt(rowid)) + '_Rab').select();
                                                }

                                                return false;
                                            }
                                        }
                                        if (cellname == "Rab") {
                                            if (!(gfi_ValidNumber(e.target.value))) {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                document.getElementById((parseInt(rowid)) + '_Rab').select();
                                                return false;
                                            }
                                            if (e.target.value < 0) {
                                                var mess = GetMultiMessage('0116', GetMultiMessage('0338', '', ''), '');  //"Disc Percentage cannot be negative";
                                                alert(mess);
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                document.getElementById((parseInt(rowid)) + '_Rab').select();
                                                return false;
                                            }
                                            else if (e.target.value > 100) {
                                                var mess = GetMultiMessage('0116', GetMultiMessage('0338', '', ''), '');  //"Disc Percentage cannot be greater than 100";
                                                alert(mess);
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                                document.getElementById((parseInt(rowid)) + '_Rab').select();
                                                return false;
                                            }
                                        }

                                    }
                                }

                                if (cellname == "IdJob") {
                                    if (rowdata.IdJob != "" && rowdata.Bestilt == "" && rowdata.Pris == "") {
                                        var isSpExists = checkSpareExists(e.target.value, id);
                                        if (isSpExists == "False") {
                                            alert("Select a valid spare");
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 0, true);
                                            document.getElementById((parseInt(rowid)) + '_IdJob').select();
                                            return false;
                                        }
                                    }
                                }
                                rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);

                                if (cellname == "IdJob") {
                                    if (rowdata.IdJob != "" && rowdata.ItemDesc == "") {
                                        var isSpExists = checkSpareExists(e.target.value, id);
                                        if (rowdata.Diff == "S") {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                            document.getElementById((parseInt(rowid)) + '_Text').select();
                                        } else {
                                            alert("Select a valid spare");
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 0, true);
                                            document.getElementById((parseInt(rowid)) + '_IdJob').select();
                                            return false;
                                        }
                                    }
                                    else if (rowdata.IdJob == "") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                        document.getElementById((parseInt(rowid)) + '_Text').select();

                                    } else if (rowdata.IdJob != "" && rowdata.Text == "" && rowdata.Diff == "S") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                        document.getElementById((parseInt(rowid)) + '_Text').select();
                                    }
                                    else {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                        document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                    }
                                }

                                if (cellname == "IdJob") {
                                    //var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowid);
                                    var spareId = [];
                                    var ctr = 0;
                                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                    for (var k = 0; k < rowdisdata.length; k++) {
                                        //spareId[k] = rowdisdata[k].IdJob;
                                        if ((rowdisdata[k].JobId === rowdata.JobId) && (rowdisdata[k].Diff == "S")) {
                                            spareId.push(rowdisdata[k].IdJob);
                                            if (rowdisdata[k].IdJob == e.target.value) {
                                                ctr = ctr + 1;
                                            }
                                        }
                                    }

                                    if (ctr > 1) {
                                        alert("SparePart already exists.");
                                        return false;
                                    }

                                    var spmake = rowdata.Id_Make;
                                    $('#<%=hdnIdItem.ClientID%>').val(e.target.value);
                                    $('#<%=hdnIdMake.ClientID%>').val(spmake);
                                    //jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                    //document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                }

                                if (e.target.name == "Bestilt") {
                                    jQuery('#jobgrid').jqGrid("setCell", rowid, 'Bestilt', e.target.value);
                                } else if (e.target.name == "Levert") {
                                    jQuery('#jobgrid').jqGrid("setCell", rowid, 'Levert', e.target.value);
                                }

                                var idItem = $('#<%=hdnIdItem.ClientID%>').val();
                                var idMake = $('#<%=hdnIdMake.ClientID%>').val();
                                var idCust = $('#<%=lblCustName.ClientID%>').text()
                                var vats = LoadGMHPVat(idItem, idMake,idCust);
                                var gmVat = 0.0;
                                var hpVat = 0.0;
                                var spVat = 0.0;
                                var lastsel;
                                var rowSeldata;

                                if (vats.length > 0) {
                                    gmVat = fnformatDecimalValue(vats[0], seperator);
                                    hpVat = fnformatDecimalValue(vats[1], seperator);
                                    spVat = fnformatDecimalValue(vats[2], seperator);
                                }

                                if (cellname == "Levert" || cellname == "Bestilt" || cellname == "Pris" || cellname == "Rab") {
                                    
                                    lastsel = jQuery('#jobgrid').jqGrid('getGridParam', 'selrow');
                                    rowSeldata = jQuery("#jobgrid").jqGrid('getRowData', lastsel);
                                    for (var k = 0; k < rowspareData.length; k++) {

                                        //if (rowspareData[k].Text != "") {
                                        if (e.target.value != "0" || e.target.value == "") {
                                            //if ((rowspareData[k].JobId == jobId) && (rowspareData[k].IdJob.indexOf(":") > -1)) {
                                            if ((rowspareData[k].IdMech != "") || (rowspareData[k].IdMech != undefined)) {
                                                if (rowspareData[k].IdJob != undefined) {
                                                    if (rowspareData[k].IdJob.indexOf(":") > -1) {
                                                        text = rowspareData[k].IdMech;
                                                        var mechName = new Array();
                                                        if (rowspareData[k].MechanicName != "" && rowspareData[k].MechanicName != null && rowspareData[k].MechanicName != undefined) {
                                                            mechName = rowspareData[k].MechanicName.split("-");
                                                            var userName = mechName[0] + "-" + mechName[1];
                                                            mcName = userName;
                                                        }
                                                        foreignJob = rowspareData[k].ForeignJob;
                                                        jQuery("#jobgrid").setCell(rowspareData[k].id, "IdJob", "", 'not-editable-cell');
                                                    }
                                                    else {
                                                        if (text == "" || text == undefined) {
                                                            rowspareData[k].IdMech = user;
                                                            text = rowspareData[k].IdMech;
                                                            var mechName = new Array();
                                                            if (rowspareData[k].MechanicName != "" && rowspareData[k].MechanicName != null && rowspareData[k].MechanicName != undefined) {
                                                                mechName = rowspareData[k].MechanicName.split("-");
                                                                var userName = mechName[0] + "-" + mechName[1];
                                                                mcName = userName;
                                                                if (mechName.length > 2) {
                                                                    rowspareData[k].IdMech = mechName[2];
                                                                }
                                                                
                                                            }
                                                        }
                                                    }
                                                }
                                                else {
                                                    rowspareData[k].IdMech = user;
                                                    text = rowspareData[k].IdMech;
                                                }
                                            }
                                            else {

                                                if ((rowspareData[k].id == id)) {
                                                    if (text == "") {
                                                        text = rowspareData[k].IdJob;
                                                    }
                                                }
                                            }
                                        }
                                        //}

                                        if (rowspareData[k].id == id) {
                                            if (text != "" && text != undefined) {
                                                rowspareData[k].IdMech = text;
                                                text = rowspareData[k].IdMech;
                                            } else {
                                                rowspareData[k].IdMech = user;
                                                text = rowspareData[k].IdMech;
                                            }
                                            if (rowspareData[k].IdJob != "" && rowspareData[k].Diff == "S") {
                                                if (rowspareData[k].Item_Avail_Qty != "0") {
                                                    if (e.target.name == "Levert" || e.target.name == "Bestilt") {
                                                        rowspareData[k].Levert = fnreformatDecimal(e.target.value, seperator);

                                                        if (e.target.name == "Bestilt") {
                                                            //Need to calculate back order qty
                                                            //call getspareid - set itemavailqty , levert and back order column based on itemavailqty

                                                            checkSpareExists(rowspareData[k].IdJob, id);
                                                            var chkdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                                                            var backOrdQty = 0;
                                                            var spavailqty = 0;
                                                            var orderQty = 0;
                                                            var delvQty = 0;
                                                            var qtyDeliver = 0;
                                                            var Availa_Qty = 0.0;
                                                            var qtyDeliv = 0.0;
                                                            var ordType = $('#<%=ddlType.ClientID%>').val();
                                                            spavailqty = fnformatDecimalValue(chkdata.Item_Avail_Qty, seperator);
                                                            orderQty = fnformatDecimalValue(e.target.value, seperator);
                                                            qtyDeliver = fnformatDecimalValue(chkdata.Levert, seperator) + fnformatDecimalValue(qtyDeliver, seperator);
                                                            //alert("Levert:"+fnformatDecimalValue(chkdata.Levert, seperator) + " :: spavailqty:" +spavailqty);

                                                            if (spavailqty == 0) {
                                                                delvQty = 0;
                                                                backOrdQty = orderQty;
                                                            }
                                                            else if (spavailqty >= orderQty) {
                                                                delvQty = orderQty;
                                                                backOrdQty = orderQty - delvQty;
                                                            }
                                                            else if (spavailqty < orderQty) {
                                                                Availa_Qty = spavailqty + qtyDeliver;
                                                                if ((fnformatDecimalValue(orderQty, seperator) - fnformatDecimalValue(Availa_Qty, seperator)) > 0) {
                                                                    backOrdQty = orderQty - Availa_Qty;

                                                                    if (ordType.toString().trim() == "KRE") {
                                                                        backOrdQty=0;
                                                                    }

                                                                    if (backOrdQty > 0) {
                                                                        backOrdQty = backOrdQty;
                                                                        qtyDeliv = orderQty - Availa_Qty;
                                                                        delvQty = qtyDeliv;
                                                                    }
                                                                    else {
                                                                        backOrdQty = 0;
                                                                        qtyDeliv = orderQty;
                                                                        delvQty = qtyDeliv;
                                                                    }
                                                                }

                                                                else {
                                                                    backOrdQty = 0;
                                                                    qtyDeliv = orderQty;
                                                                    delvQty = qtyDeliv;
                                                                }

                                                            }

                                                            if (chkdata.Rab == "" || chkdata.Rab == undefined || fnformatDecimalValue(chkdata.Rab, seperator)) {
                                                                if (fnformatDecimalValue($('#<%=hdnOHCSpareDisc.ClientID%>').val(), seperator) > 0) {
                                                                    rowspareData[k].Rab = $('#<%=hdnOHCSpareDisc.ClientID%>').val();
                                                                }
                                                                else if (fnformatDecimalValue($('#<%=hdnOHCGenDisc.ClientID%>').val(), seperator) > 0) {
                                                                    rowspareData[k].Rab = $('#<%=hdnOHCGenDisc.ClientID%>').val();
                                                                }
                                                                else if (fnformatDecimalValue(rowspareData[k].SpareDiscount, seperator) > 0) {
                                                                    rowspareData[k].Rab = rowspareData[k].SpareDiscount;
                                                                }
                                                                else {
                                                                    rowspareData[k].Rab = "";
                                                                }
                                                            }

                                                            jQuery('#jobgrid').jqGrid("setCell", id, 'Bestilt', orderQty);
                                                            jQuery('#jobgrid').jqGrid("setCell", id, 'Levert', delvQty);
                                                            jQuery('#jobgrid').jqGrid("setCell", id, 'Item_Avail_Qty', spavailqty);
                                                            jQuery('#jobgrid').jqGrid("setCell", id, 'Jobi_Bo_Qty', backOrdQty);
                                                            if (backOrdQty > 0) {
                                                                jQuery("#jobgrid").jqGrid('setCell', rowspareData[k].id, "Bestilt", "", {
                                                                    'color': 'rgba(255, 0, 0, 0.8)',
                                                                    'background-image': 'none',
                                                                    'text-align': 'right'
                                                                });
                                                            }

                                                        }
                                                    }
                                                    if (e.target.name == "Pris") {
                                                        rowspareData[k].Pris = fnreformatDecimal(e.target.value, seperator);
                                                        if (rowspareData[k].IdJob == "" && rowspareData[k].Text == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Levert == "") {
                                                            rowspareData[k].Diff = "OR";
                                                        }

                                                        if (rowspareData[k].Diff == "OR") {
                                                            if (fnformatDecimalValue(e.target.value, seperator) > fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val(), seperator)) {
                                                                alert("Own Risk Amount is greater than job total");
                                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(id), 6, true);
                                                                document.getElementById((parseInt(id)) + '_Pris').select();
                                                                return false;
                                                            }
                                                            saveJobDet(id);
                                                            rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                            //return false;
                                                        }
                                                    }

                                                    if (e.target.name == "Pris") {
                                                        if (rowspareData[k].DebtType == "OHC") {
                                                            //rowspareData[k].Ford = rowdata.Ford;
                                                            if ((rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") && (rowspareData[k].JobId == "1")) {
                                                                if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop != "" && fnformatDecimalValue(rowspareData[k].Ford, seperator) > 0) {
                                                                    var raorAmt = e.target.value;
                                                                    raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                                    raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                                    rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                                } else if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris != "" && rowspareData[k].Belop == 0 && rowspareData[k].Ford == "") {
                                                                    var raorAmt = e.target.value;
                                                                    rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                                }
                                                                saveJobDet(id);
                                                                return false;
                                                            }

                                                        }
                                                    }

                                                    if (e.target.name == "Rab") {
                                                        var rebate = fnformatDecimalValue(e.target.value, seperator);
                                                        if (rebate == 0) {
                                                            rowspareData[k].Rab = "";
                                                        }
                                                        else {
                                                            rowspareData[k].Rab = fnreformatDecimal(e.target.value, seperator);
                                                        }

                                                        //if any reduction lines exists the belop amount shd be recalculated
                                                        recalculateRedLines();
                                                        saveJobDet(id);
                                                        //return false;
                                                        rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                    }

                                                    var amt = (fnformatDecimalValue(rowspareData[k].Levert, seperator) * fnformatDecimalValue(rowspareData[k].Pris, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) * 0.01)).toFixed(2);
                                                    var disc = 0.0;
                                                    //rowspareData[k].Belop = fnreformatDecimal(amt, seperator);

                                                    if (rowspareData[k].Rab != undefined && rowspareData[k].Rab != "0") {
                                                        disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowspareData[k].Rab, seperator) / 100)).toFixed(2)
                                                        amt = (amt - disc).toFixed(2);
                                                    }
                                                    rowspareData[k].Disc_Amt = fnreformatDecimal(disc, seperator);

                                                    if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                        rowspareData[k].Belop = fnreformatDecimal(amt, seperator);
                                                    }

                                                    if (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") {
                                                        if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Belop != "") {
                                                            var raorAmt = "0";
                                                            raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                            raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                            rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                        }
                                                    }

                                                    if (rowspareData[k].Diff == "S" && rowspareData[k].IdJob != "") {
                                                        rowspareData[k].Diff = "S";
                                                    }
                                                    else if (rowspareData[k].Diff == "L" && rowspareData[k].Text != "") {
                                                        rowspareData[k].Diff = "L";
                                                        if (rowspareData[k].IdMech == $('#<%=hdnDuser.ClientID%>').val()) {
                                                            rowspareData[k].IdJob = "";
                                                        }
                                                        else {
                                                            rowspareData[k].IdJob = mcName;
                                                        }

                                                        rowspareData[k].IdMech = text;
                                                        rowspareData[k].ForeignJob = foreignJob;
                                                    }
                                                    else if (rowspareData[k].Diff == "T" && rowspareData[k].Text != "") {
                                                        rowspareData[k].Diff = "T";
                                                    }
                                                    else {
                                                        if (text != "" && rowspareData[k].Levert != "") {
                                                            rowspareData[k].Diff = "L";
                                                            if (rowspareData[k].Rab == "" || rowspareData[k].Rab == undefined || fnformatDecimalValue(rowspareData[k].Rab, seperator) == 0) {
                                                                if (fnformatDecimalValue($('#<%=hdnOHCLabDisc.ClientID%>').val(), seperator) > 0) {
                                                                    rowspareData[k].Rab = fnreformatDecimal($('#<%=hdnOHCLabDisc.ClientID%>').val(), seperator);
                                                                }
                                                                else if (fnformatDecimalValue($('#<%=hdnOHCGenDisc.ClientID%>').val(), seperator) > 0) {
                                                                    rowspareData[k].Rab = fnreformatDecimal($('#<%=hdnOHCGenDisc.ClientID%>').val(), seperator);
                                                                }
                                                                else {
                                                                    rowspareData[k].Rab = "";
                                                                }
                                                            }
                                                                
                                                            if (rowspareData[k].IdMech == $('#<%=hdnDuser.ClientID%>').val()) {
                                                                rowspareData[k].IdJob = "";
                                                            }
                                                            else {
                                                                rowspareData[k].IdJob = mcName;
                                                            }
                                                            rowspareData[k].IdMech = text;
                                                            rowspareData[k].ForeignJob = foreignJob;
                                                        } else if (text != "" && rowspareData[k].Levert == "" && rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                            if (rowspareData[k].Text != "") {
                                                                rowspareData[k].Diff = "T";
                                                                $('#' + rowspareData[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                                                var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Text');
                                                                cm.editable = true;
                                                            } else {
                                                                if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                                    rowspareData[k].Diff = "";
                                                                }
                                                            }
                                                            //rowspareData[k].IdJob = text;
                                                        } else {
                                                            if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                                rowspareData[k].Diff = "";
                                                            }
                                                        }
                                                    }
                                                }
                                                else {
                                                    //Added when spare had valid qty and edit spare when 0 qty - Need to check
                                                    //if (rowspareData[k].Levert == "0") {
                                                    //    rowspareData[k].Levert = "0";
                                                    //}

                                                    //rowspareData[k].Levert = "0";
                                                    //rowspareData[k].Belop = "0";
                                                    //rowspareData[k].Jobi_Bo_Qty = rowspareData[k].Bestilt;
                                                    //jQuery("#jobgrid").jqGrid('setCell', rowspareData[k].id, "Bestilt", "", {
                                                    //    'color': 'rgba(255, 0, 0, 0.8)',
                                                    //    'background-image': 'none'
                                                    //});

                                                    if (e.target.name == "Bestilt") {
                                                        
                                                        var chkdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                                                        var backOrdQty = 0;
                                                        var spavailqty = 0;
                                                        var orderQty = 0;
                                                        var delvQty = 0;
                                                        var qtyDeliver = 0;
                                                        var Availa_Qty = 0.0;
                                                        var qtyDeliv = 0.0
                                                        var ordType = $('#<%=ddlType.ClientID%>').val();
                                                        spavailqty = fnformatDecimalValue(chkdata.Item_Avail_Qty, seperator);
                                                        orderQty = fnformatDecimalValue(e.target.value, seperator);
                                                        qtyDeliver = fnformatDecimalValue(chkdata.Levert, seperator) + fnformatDecimalValue(qtyDeliver, seperator);
                                                        Availa_Qty = spavailqty + qtyDeliver;
                                                        if ((fnformatDecimalValue(orderQty, seperator) - fnformatDecimalValue(Availa_Qty, seperator)) > 0) {
                                                            backOrdQty = orderQty - Availa_Qty;

                                                            if (ordType.toString().trim() == "KRE") {
                                                                backOrdQty = 0;
                                                            }

                                                            if (backOrdQty > 0) {
                                                                backOrdQty = backOrdQty;
                                                                qtyDeliv = orderQty - backOrdQty;
                                                                delvQty = qtyDeliv;
                                                            }
                                                            else {
                                                                backOrdQty = 0;
                                                                qtyDeliv = orderQty;
                                                                delvQty = qtyDeliv;
                                                            }
                                                        }

                                                        else {
                                                            backOrdQty = 0;
                                                            qtyDeliv = orderQty;
                                                            delvQty = qtyDeliv;
                                                        }


                                                        rowspareData[k].Bestilt = orderQty;
                                                        rowspareData[k].Levert = delvQty;
                                                        rowspareData[k].Item_Avail_Qty = spavailqty;
                                                        rowspareData[k].Jobi_Bo_Qty = backOrdQty;

                                                        //rowspareData[k].Belop = "2000";

                                                        jQuery("#jobgrid").setCell(rowspareData[k].id, "Belop", "", 'ui-state-disabled');
                                                        jQuery('#jobgrid').jqGrid("setCell", rowspareData[k].id, 'Jobi_Bo_Qty', backOrdQty);
                                                        if (backOrdQty > 0) {
                                                            jQuery("#jobgrid").jqGrid('setCell', rowspareData[k].id, "Bestilt", "", {
                                                                'color': 'rgba(255, 0, 0, 0.8)',
                                                                'background-image': 'none',
                                                                'text-align': 'right'
                                                            });
                                                        }
                                                    }

                                                    if (e.target.name == "Rab") {
                                                        var rebate = fnformatDecimalValue(e.target.value, seperator);
                                                        if (rebate == 0) {
                                                            rowspareData[k].Rab = "";
                                                        }
                                                        else {
                                                            rowspareData[k].Rab = fnreformatDecimal(e.target.value, seperator);
                                                        }
                                                        //if any reduction lines exists the belop amount shd be recalculated
                                                        recalculateRedLines();
                                                        saveJobDet(id);
                                                        //return false;
                                                        rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                    }
                                                }
                                            }
                                            else {
                                                if (e.target.name == "Levert" || e.target.name == "Bestilt") {
                                                    
                                                    rowspareData[k].Levert = fnreformatDecimal(e.target.value, seperator);
                                                    if (e.target.value == "") {
                                                        rowspareData[k].Pris = "";
                                                        rowspareData[k].Diff = "T";
                                                        //saveJobDet(id);
                                                        //return false;
                                                        //rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                        $('#' + rowspareData[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                                        var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Text');
                                                        cm.editable = true;
                                                    } else {
                                                        if (rowspareData[k].Text != "") {
                                                            rowspareData[k].Diff = "L";
                                                            if (rowspareData[k].Rab == "" || rowspareData[k].Rab == undefined || fnformatDecimalValue(rowspareData[k].Rab, seperator) == 0) {
                                                                if (fnformatDecimalValue($('#<%=hdnOHCLabDisc.ClientID%>').val(), seperator) > 0) {
                                                                    rowspareData[k].Rab = $('#<%=hdnOHCLabDisc.ClientID%>').val();
                                                                }
                                                                else if (fnformatDecimalValue($('#<%=hdnOHCGenDisc.ClientID%>').val(), seperator) > 0) {
                                                                    rowspareData[k].Rab = $('#<%=hdnOHCGenDisc.ClientID%>').val();
                                                                }
                                                                else {
                                                                    rowspareData[k].Rab = "";
                                                                }
                                                            }
                                                        } else {
                                                            rowspareData[k].Diff = "";
                                                            rowspareData[k].Levert = "";
                                                            rowspareData[k].Pris = "";
                                                        }
                                                    }
                                                }
                                                if (e.target.name == "Pris") {
                                                    rowspareData[k].Pris = fnreformatDecimal(e.target.value, seperator);
                                                    if (rowspareData[k].IdJob == "" && rowspareData[k].Text == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Levert == "" && rowspareData[k].Pris != "") {
                                                        rowspareData[k].Diff = "OR";
                                                    }

                                                    if (rowspareData[k].Diff == "OR") {
                                                        if (fnformatDecimalValue(e.target.value, seperator) > fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val(), seperator)) {
                                                            alert("Own Risk Amount is greater than job total");
                                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(id), 6, true);
                                                            document.getElementById((parseInt(id)) + '_Pris').select();
                                                            return false;
                                                        }
                                                        saveJobDet(id);
                                                        rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                        //return false;
                                                    }
                                                }

                                                if (e.target.name == "Pris") {
                                                    if (rowspareData[k].DebtType == "OHC") {
                                                        //rowspareData[k].Ford = rowdata.Ford;
                                                        if ((rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") && (rowspareData[k].JobId == "1")) {
                                                            if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop != "" && fnformatDecimalValue(rowspareData[k].Ford, seperator) > 0) {
                                                                var raorAmt = e.target.value;
                                                                raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                                raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                                rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                            } else if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris != "" && rowspareData[k].Belop == 0 && rowspareData[k].Ford == "") {
                                                                var raorAmt = e.target.value;
                                                                rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                            }
                                                            saveJobDet(id);
                                                            return false;
                                                        }

                                                    }
                                                }

                                                if (e.target.name == "Rab") {
                                                    var rebate = fnformatDecimalValue(e.target.value, seperator)
                                                    if (rebate == 0) {
                                                        rowspareData[k].Rab = "";
                                                    }
                                                    else {
                                                        rowspareData[k].Rab = fnreformatDecimal(e.target.value, seperator);
                                                    }
                                                    //if any reduction lines exists the belop amount shd be recalculated
                                                    recalculateRedLines();
                                                    saveJobDet(id);
                                                    //return false;
                                                    rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                }
                                                var amt = (fnformatDecimalValue(rowspareData[k].Levert, seperator) * fnformatDecimalValue(rowspareData[k].Pris, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) * 0.01)).toFixed(2);
                                                var disc = 0.0;
                                                //rowspareData[k].Belop = fnreformatDecimal(amt, seperator);
                                                if (rowspareData[k].Rab != undefined && rowspareData[k].Rab != "0") {
                                                    disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowspareData[k].Rab, seperator) / 100)).toFixed(2);
                                                    amt = (amt - disc).toFixed(2);
                                                }

                                                rowspareData[k].Disc_Amt = fnreformatDecimal(disc, seperator);
                                                if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                    rowspareData[k].Belop = fnreformatDecimal(amt, seperator);
                                                }
                                                if (rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") {
                                                    if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Belop != "") {
                                                        var raorAmt = "0";
                                                        raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                                        raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                                        rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                                                    }
                                                }
                                                
                                                if (rowspareData[k].Diff == "S" && rowspareData[k].IdJob != "") {
                                                    rowspareData[k].Diff = "S";
                                                }
                                                else if (rowspareData[k].Diff == "L" && rowspareData[k].Text != "") {
                                                    rowspareData[k].Diff = "L";
                                                    if (rowspareData[k].IdMech == $('#<%=hdnDuser.ClientID%>').val()) {
                                                        rowspareData[k].IdJob = "";
                                                    }
                                                    else {
                                                        rowspareData[k].IdJob = mcName;
                                                    }
                                                    rowspareData[k].IdMech = text;
                                                    rowspareData[k].ForeignJob = foreignJob;
                                                }
                                                else if (rowspareData[k].Diff == "T" && rowspareData[k].Text != "") {
                                                    rowspareData[k].Diff = "T";
                                                }
                                                else {
                                                    if ((text != "" && text != undefined) && (rowspareData[k].Levert != "")) {
                                                        rowspareData[k].Diff = "L";
                                                        if (rowspareData[k].IdMech == $('#<%=hdnDuser.ClientID%>').val()) {
                                                            rowspareData[k].IdJob = "";
                                                        }
                                                        else {
                                                            rowspareData[k].IdJob = mcName;
                                                        }
                                                        rowspareData[k].IdMech = text;
                                                        rowspareData[k].ForeignJob = foreignJob;
                                                    } else if ((text != "" && text != undefined) && (rowspareData[k].Levert == "") && rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                        if (rowspareData[k].Text != "") {
                                                            rowspareData[k].Diff = "T";
                                                            $('#' + rowspareData[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Text');
                                                            cm.editable = true;
                                                        } else {
                                                            if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                                rowspareData[k].Diff = "";
                                                            }
                                                        }
                                                        //rowspareData[k].IdJob = text;
                                                    } else {
                                                        if (rowspareData[k].Diff != "OR" && rowspareData[k].Diff != "RAOR" && rowspareData[k].Diff != "RBOR") {
                                                            rowspareData[k].Diff = "";
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        if (rowspareData[k].JobId == jobId) {
                                            if (rowspareData[k].DebtType == "OHC") {
                                                if ((rowspareData[k].IdJob == "" || rowspareData[k].IdJob == undefined) && rowspareData[k].Text == "") {
                                                    isUpdate = "True";
                                                } else {
                                                    isUpdate = "False";
                                                }
                                            }
                                        }
                                        else {
                                            if (rowspareData[k].id == id) {
                                                isUpdate = "True";
                                            }
                                        }
                                        if (rowspareData[k].Diff == "T") {
                                            if (e.target.name == "Levert") {
                                                if (e.target.value == "") {
                                                    if (rowspareData[k].id == id) {
                                                        saveJobDet(id);
                                                        return false;
                                                    }
                                                }
                                            }
                                        }
                                    }

                                    if (isUpdate == "False") {
                                        
                                        //add new line
                                        var spares = {
                                            id: parseInt(id) + 1,
                                            IdJob: "",
                                            Text: "",
                                            Nei: "0",
                                            Ford: "100",
                                            Bestilt: "",
                                            Levert: "",
                                            Pris: "",
                                            Rab: "",
                                            Belop: "",
                                            JobId: jobId.toString(),
                                            Flag: "0",
                                            Diff: "",
                                            Item_Avail_Qty: "",
                                            Disc_Amt: "0",
                                            ForeignJob: "",
                                            ItemDesc: "",
                                            IdWOLabSeq: "",
                                            IdWODetailseq: idwodetseq,
                                            Id_Deb_Seq: iddebseq,
                                            Id_Make: makeid,
                                            IdMech: idMechanic,
                                            IdWOItemseq: idwoitemseq,
                                            DebtType: debtType,
                                            SpareDiscount: 0
                                        }

                                        

                                        var newspares = $.extend(true, {}, rowspareData);
                                        var actualsparelength = rowspareData.length;
                                        if (id == rowspareData.length) {
                                            
                                            rowspareData[parseInt(id)] = spares;
                                            actualsparelength = rowspareData.length;
                                        } else {
                                            
                                            for (var a = 0; a < id; a++) {
                                                newspares[a].IdJob = rowspareData[a].IdJob,
                                                newspares[a].Text = rowspareData[a].Text,
                                                newspares[a].Nei = rowspareData[a].Nei,
                                                newspares[a].Ford = rowspareData[a].Ford,
                                                newspares[a].Bestilt = rowspareData[a].Bestilt,
                                                newspares[a].Levert = rowspareData[a].Levert,
                                                newspares[a].Pris = rowspareData[a].Pris,
                                                newspares[a].Rab = rowspareData[a].Rab,
                                                newspares[a].Belop = rowspareData[a].Belop,
                                                newspares[a].JobId = rowspareData[a].JobId,
                                                newspares[a].Flag = rowspareData[a].Flag,
                                                newspares[a].Diff = rowspareData[a].Diff,
                                                newspares[a].Item_Avail_Qty = rowspareData[a].Item_Avail_Qty,
                                                newspares[a].Disc_Amt = rowspareData[a].Disc_Amt
                                                newspares[a].IdWOLabSeq = rowspareData[a].IdWOLabSeq
                                                newspares[a].IdWODetailseq = rowspareData[a].IdWODetailseq
                                                newspares[a].Id_Deb_Seq = rowspareData[a].Id_Deb_Seq
                                                newspares[a].Id_Make = rowspareData[a].Id_Make
                                                newspares[a].IdMech = rowspareData[a].IdMech
                                                newspares[a].IdWOItemseq = rowspareData[a].IdWOItemseq
                                                newspares[a].DebtType = rowspareData[a].DebtType
                                                newspares[a].SpareDiscount = rowspareData[a].SpareDiscount
                                            }

                                            for (var b = parseInt(id) ; b < rowspareData.length + 1; b++) {
                                                var spares1 = {
                                                    id: b + 1,
                                                    IdJob: "",
                                                    Text: "",
                                                    Nei: "0",
                                                    Ford: "100",
                                                    Bestilt: "",
                                                    Levert: "",
                                                    Pris: "",
                                                    Rab: "",
                                                    Belop: "",
                                                    JobId: jobId.toString(),
                                                    Flag: "0",
                                                    Diff: "",
                                                    Item_Avail_Qty: "",
                                                    Disc_Amt: "0",
                                                    ForeignJob: "",
                                                    ItemDesc: "",
                                                    IdWOLabSeq: "",
                                                    IdWODetailseq: idwodetseq,
                                                    Id_Deb_Seq: iddebseq,
                                                    Id_Make: makeid,
                                                    IdMech: idMechanic,
                                                    IdWOItemseq: idwoitemseq,
                                                    DebtType: debtType,
                                                    SpareDiscount:0
                                                }
                                                newspares[parseInt(b)] = spares1;
                                            }

                                            for (var a = parseInt(id) ; a < rowspareData.length; a++) {
                                                newspares[parseInt(a) + 1].IdJob = rowspareData[parseInt(a)].IdJob,
                                                newspares[parseInt(a) + 1].Text = rowspareData[parseInt(a)].Text,
                                                newspares[parseInt(a) + 1].Nei = rowspareData[parseInt(a)].Nei,
                                                newspares[parseInt(a) + 1].Ford = rowspareData[parseInt(a)].Ford,
                                                newspares[parseInt(a) + 1].Bestilt = rowspareData[parseInt(a)].Bestilt,
                                                newspares[parseInt(a) + 1].Levert = rowspareData[parseInt(a)].Levert,
                                                newspares[parseInt(a) + 1].Pris = rowspareData[parseInt(a)].Pris,
                                                newspares[parseInt(a) + 1].Rab = rowspareData[parseInt(a)].Rab,
                                                newspares[parseInt(a) + 1].Belop = rowspareData[parseInt(a)].Belop,
                                                newspares[parseInt(a) + 1].JobId = rowspareData[parseInt(a)].JobId,
                                                newspares[parseInt(a) + 1].Flag = rowspareData[parseInt(a)].Flag,
                                                newspares[parseInt(a) + 1].Diff = rowspareData[parseInt(a)].Diff,
                                                newspares[parseInt(a) + 1].Item_Avail_Qty = rowspareData[parseInt(a)].Item_Avail_Qty,
                                                newspares[parseInt(a) + 1].Disc_Amt = rowspareData[parseInt(a)].Disc_Amt,
                                                newspares[parseInt(a) + 1].IdWOLabSeq = rowspareData[parseInt(a)].IdWOLabSeq
                                                newspares[parseInt(a) + 1].IdWODetailseq = rowspareData[parseInt(a)].IdWODetailseq
                                                newspares[parseInt(a) + 1].Id_Deb_Seq = rowspareData[parseInt(a)].Id_Deb_Seq
                                                newspares[parseInt(a) + 1].Id_Make = rowspareData[parseInt(a)].Id_Make
                                                newspares[parseInt(a) + 1].IdMech = rowspareData[parseInt(a)].IdMech
                                                newspares[parseInt(a) + 1].IdWOItemseq = rowspareData[parseInt(a)].IdWOItemseq
                                                newspares[parseInt(a) + 1].DebtType = rowspareData[parseInt(a)].DebtType
                                            }
                                            actualsparelength = actualsparelength + 1;
                                            rowspareData = newspares;
                                        }
                                        
                                        jQuery("#jobgrid").jqGrid('clearGridData');
                                        for (var j = 0; j < actualsparelength; j++) {
                                            sparedata = rowspareData;
                                            jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                                        }
                                        jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                                        $("#jobgrid").jqGrid("hideCol", "subGrid");

                                    } else {

                                        jQuery("#jobgrid").jqGrid('clearGridData');
                                        for (var j = 0; j < rowspareData.length; j++) {
                                            sparedata = rowspareData;
                                            jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                                        }
                                        jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                                        $("#jobgrid").jqGrid("hideCol", "subGrid");
                                    }
                                }
                                //end of if
                                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                var hpVatPer = hpVat;
                                var gmVatPer = gmVat;
                                var spVatPer = spVat;
                                var hpVat = 0.0;
                                var gmVat = 0.0;
                                var amtS = 0.0;
                                var vatAmount = 0.0;
                                var amtL = 0.0;
                                var discAmount = 0.0;
                                var TotalGM = 0.0;
                                var amtG = 0.0;
                                //var jobDisc = 0.0;
                                var labDisc = 0.0;
                                var gmDisc = 0.0;
                                var spareDisc = 0.0;

                                var labVatDisc = 0.0;
                                var gmVatDisc = 0.0;
                                var spareVatDisc = 0.0;
                                var totLabVatDisc = 0.0;
                                var totGmVatDisc = 0.0;
                                var totSpareVatDisc = 0.0;
                                var idCust = $('#<%=lblCustName.ClientID%>').text();
                                for (var k = 0; k < rowdisdata.length; k++) {

                                    vats = LoadGMHPVat(rowdisdata[k].IdJob, rowdisdata[k].Id_Make, idCust);
                                    //gmVat = 0.0;
                                    //hpVat = 0.0;
                                    spVat = 0.0;

                                    if (vats.length > 0) {
                                        // gmVat = fnformatDecimalValue(vats[0], seperator);
                                        // hpVat = fnformatDecimalValue(vats[1], seperator);
                                        spVat = fnformatDecimalValue(vats[2], seperator);
                                    }

                                    spVatPer = spVat;

                                    if (rowdisdata[k].Diff == "S") {
                                        if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                            var boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                            if (boQty != "0"  ) {
                                                jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                                    'color': 'rgba(255, 0, 0, 0.8)',
                                                    'background-image': 'none'
                                                });
                                            }
                                        }
                                    }
                                  
                                    if (rowdisdata[k].Flag == "1" && (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined || rowdisdata[k].DebtType == "")) {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    }                                   
                                    else if (rowdisdata[k].Flag == "1" &&  rowdisdata[k].DebtType == "INSC") {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INSC") {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                    }
                                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INTC") {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INTC") {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(33, 186, 69, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                    }
                                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "CLA") {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "CLA") {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                    }
                                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "MISC") {
                                        //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'font-weight': 'normal',
                                            'background-image': 'none'
                                        });
                                    } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "MISC") {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(41, 128, 185, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                    }
                                    else {
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                            'text-align': 'right'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                            'text-align': 'left'
                                        });
                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                            'text-align': 'left'
                                        });
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Belop", "", 'ui-state-disabled');

                                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                            'background-color': 'rgba(255, 255, 153, 1)',
                                            'color': 'rgba(0, 0, 0, 1)',
                                            'background-image': 'none',
                                            'font-weight': 'normal',
                                            'text-align': 'right'
                                        });
                                    }
                                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC") || (rowdisdata[k].DebtType == "INTC") || (rowdisdata[k].DebtType == "CLA") || (rowdisdata[k].DebtType == "MISC")) {
                                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                     }
                                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RAOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RAOR")) {
                                         $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                     }
                                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RBOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RBOR")) {
                                         $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                                     }
                                    if (rowdisdata[k].Diff == "T") {
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Pris", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Rab", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                                    }
                                    if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {
                                        if ((rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) && (rowdisdata[k].Diff == "S")) {
                                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                                        }
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                                    }
                                    if (rowdisdata[k].Diff == "L") {
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');

                                        // var amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                                        var amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                        amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                                        var GM = $('#<%=txtGM.ClientID%>').val();

                                        if (rowdisdata[k].ForeignJob != "FJ") {
                                            amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                            TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                                            //$('#<%=txtTGM.ClientID%>').val(TotalGM);
                                        }

                                        //Lab and GM Discount
                                        if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                            labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                            gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                            labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                                            totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                            gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                                            totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                                        }

                                        hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                                        gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                                        hpVat = fnreformatDecimal(hpVat, seperator);
                                        gmVat = fnreformatDecimal(gmVat, seperator);
                                        amtL = fnreformatDecimal(amtL, seperator);
                                        TotalGM = fnreformatDecimal(TotalGM, seperator);

                                        $('#<%=txtTGM.ClientID%>').val(TotalGM);
                                        $('#<%=txtHPVat.ClientID%>').val(hpVat);
                                        $('#<%=txtGMVat.ClientID%>').val(gmVat);
                                        $('#<%=txtTLab.ClientID%>').val(amtL);

                                        var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                                        rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);

                                        var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                                        rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                                    }

                                    if (rowdisdata[k].Diff == "S") {
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                                        var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                                        cm.editable = true;
                                        var amount;
                                        if (rowdisdata[k].Belop != undefined) {
                                            //amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                                            amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                        } else {
                                            amount = fnformatDecimalValue("", seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                        }
                                        amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                                        //vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);
                                        vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);
                                        amtS = fnreformatDecimal(amtS, seperator);
                                        vatAmount = fnreformatDecimal(vatAmount, seperator);
                                        $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                                        $('#<%=txtTSP.ClientID%>').val(amtS);

                                        if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                            var amt;
                                            var boQty;
                                            if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                                boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                            } else {
                                                boQty = 0;
                                            }

                                            if (boQty != "0") {
                                                //discAmount = 0;
                                                spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                                            } else {
                                                amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                                //discAmount = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2);
                                                spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                                            }
                                        }
                                        spareVatDisc = (amount * (spVatPer / 100)).toFixed(2);
                                        totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                        var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                                        rowdisdata[k].Disc_Amt = fnreformatDecimal(spchck, seperator);

                                        var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                                        rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);

                                    }

                                    if (rowdisdata[k].Disc_Amt != undefined) {
                                        discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                                    }

                                    discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);
                                }
                                if ($('#<%=txtTLab.ClientID%>').val() == "") {
                                    $('#<%=txtTLab.ClientID%>').val('0');
                                    $('#<%=txtTGM.ClientID%>').val('0');
                                    $('#<%=txtHPVat.ClientID%>').val('0');
                                    $('#<%=txtGMVat.ClientID%>').val('0');
                                }

                                if ($('#<%=txtSPVat.ClientID%>').val() == "") {
                                    $('#<%=txtSPVat.ClientID%>').val('0');
                                    $('#<%=txtTSP.ClientID%>').val('0');
                                }

                                var total = (fnformatDecimalValue($('#<%=txtTGM.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTLab.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val(), seperator)).toFixed(2);
                                var vatTotal = (fnformatDecimalValue($('#<%=txtHPVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtGMVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val(), seperator)).toFixed(2);
                                var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                                total = fnreformatDecimal(total, seperator);
                                vatTotal = fnreformatDecimal(vatTotal, seperator);
                                TIncVat = fnreformatDecimal(TIncVat, seperator);
                                discAmount = fnreformatDecimal(discAmount, seperator);
                                $('#<%=txtNet.ClientID%>').val(total);
                                $('#<%=txtVat.ClientID%>').val(vatTotal);
                                $('#<%=txtTotal.ClientID%>').val(TIncVat);
                                $('#<%=txtDisc.ClientID%>').val(discAmount);

                                if (cellname == "Levert" || cellname == "Bestilt") {
                                    
                                    if (rowdata.IdJob == "" && rowdata.Text != "" && rowdata.Levert == "") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 0, true);
                                        document.getElementById((parseInt(rowid) + 1) + '_IdJob').select();
                                    } else {
                                        if (rowdata.IdJob == "" && rowdata.Text == "" && rowdata.Diff == "") {
                                            //jQuery('#jobgrid').jqGrid("setCell", rowid, 'Levert', "0");
                                            //jQuery('#jobgrid').jqGrid("setCell", rowid, 'Pris', "0");
                                            //jQuery('#jobgrid').jqGrid("setCell", rowid, 'Belop', "0");
                                        }
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 6, true);
                                        document.getElementById((parseInt(rowid)) + '_Pris').select();
                                    }
                                }

                                if (cellname == "Pris") {
                                    if (rowdata.Diff == "OR")
                                    {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 0, true);
                                        document.getElementById((parseInt(rowid) + 1) + '_IdJob').select();
                                    } else
                                    {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 7, true);
                                        document.getElementById((parseInt(rowid)) + '_Rab').select();
                                    }

                                }
                                if (cellname == "Rab") {
                                    var nextrowdata = jQuery("#jobgrid").jqGrid('getRowData', (parseInt(rowid) + 1));
                                    if (nextrowdata.IdJob != undefined && nextrowdata.Text != undefined && nextrowdata.Diff != undefined) {
                                        if (nextrowdata.IdJob != "" && nextrowdata.Text != "" && nextrowdata.Diff == "S") {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 4, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_Bestilt').select();
                                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Text');
                                            cm.editable = true;
                                        } else if (nextrowdata.IdJob == "" && nextrowdata.Text != "" && (nextrowdata.Diff == "L" || nextrowdata.Diff == "T")) {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 1, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_Text').select();
                                        } else if (nextrowdata.IdJob.indexOf(":") > -1) {
                                            var nextjobrowdata = jQuery("#jobgrid").jqGrid('getRowData', (parseInt(rowid) + 2));

                                            //if (nextjobrowdata.length > 1) {
                                            if (nextjobrowdata.Text != "" && nextjobrowdata.Diff == "L") {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 2, 1, true);
                                                document.getElementById((parseInt(rowid) + 2) + '_Text').select();
                                            } else if (nextjobrowdata.IdJob != "" && nextjobrowdata.Text != "" && nextjobrowdata.Diff == "S") {

                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 2, 4, true);
                                                document.getElementById((parseInt(rowid) + 2) + '_Bestilt').select();
                                            } else if (nextjobrowdata.IdJob == "" && nextjobrowdata.Text == "" && nextjobrowdata.Diff == "") {

                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 2, 0, true);
                                                document.getElementById((parseInt(rowid) + 2) + '_IdJob').select();
                                            } else {
                                                jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 0, true);
                                                document.getElementById((parseInt(rowid)) + '_IdJob').select();
                                            }
                                        }
                                        else {
                                            //Need to fix
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 0, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_IdJob').select();
                                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Text');
                                            cm.editable = true;
                                        }
                                    }
                                }
                                if (cellname == "Text") {
                                    var nextrowdata = jQuery("#jobgrid").jqGrid('getRowData', (parseInt(rowid) + 1));
                                    if (rowdata.Diff == "S") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                        document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                    } else if (rowdata.Diff == "T") {
                                        if (nextrowdata.Diff == "S") {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 4, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_Bestilt').select();
                                        }
                                        else {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid) + 1, 1, true);
                                            document.getElementById((parseInt(rowid) + 1) + '_Text').select();
                                        }
                                    }
                                    else {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 5, true);
                                        document.getElementById((parseInt(rowid)) + '_Levert').select();
                                    }
                                }

                                if (cellname == "IdJob") {
                                    if (rowdata.IdJob != "" && rowdata.ItemDesc == "") {
                                        if (rowdata.Diff == "S") {
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                            document.getElementById((parseInt(rowid)) + '_Text').select();
                                        } else {
                                            alert("Select a valid spare");
                                            jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 0, true);
                                            document.getElementById((parseInt(rowid)) + '_IdJob').select();
                                        }
                                    }
                                    else if (rowdata.IdJob == "") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 1, true);
                                        document.getElementById((parseInt(rowid)) + '_Text').select();

                                    } else if (rowdata.IdJob != "" && rowdata.Diff == "S") {
                                        jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowid), 4, true);
                                        document.getElementById((parseInt(rowid)) + '_Bestilt').select();
                                    }
                                }
                            }
                            // originalKeydown.call(this, e);
                            // we can do something after jqGrid process "keydown" event
                        });
                    }
                }
            });

            $grid = $("#jobgrid");
            var cm = $grid.jqGrid('getGridParam', 'colModel');
            $grid.mouseover(function (e) {
                var $td = $(e.target).closest('td'),
                    $tr = $td.closest('tr.jqgrow'),
                    rowId = $tr.attr('id'),
                    ci;
                var rowId = $(e.target).parents("tr:first").attr('id');
                var rowdata = jQuery('#jobgrid').getRowData(rowId);
                if (rowId) {
                    ci = $.jgrid.getCellIndex($td[0]); // works mostly as $td[0].cellIndex
                    $("#jobgrid").setCell(rowId, 'IdJob', '', '', { 'title': rowdata.MechanicName });
                    if (rowdata.Flag == 1) {
                        $("#jobgrid").setCell(rowId, 'Text', '', '', { 'title': rowdata.MechanicName });
                    }
                    if (console) {
                        console.log('You rolled over the row with id="' + rowId + '" in the column ' + cm[ci].name);
                    }
                }
            });

            //loadJobDetails();

            loadWOJobGrid(idWONO, idWOPrefix);
            //loadInvBasis(idWONO, idWOPrefix);

            function calcReductionAmt(redType) {
                var seperator = '<%= Session("Decimal_Seperator") %>';
                var hpVat = 0.0;
                var gmVat = 0.0;
                var amtS = 0.0;
                var vatAmount = 0.0;
                var amtL = 0.0;
                var discAmount = 0.0;
                var TotalGM = 0.0;
                var amtG = 0.0;
                var labDisc = 0.0;
                var gmDisc = 0.0;
                var spareDisc = 0.0;
                var ownRiskAmt = 0.0;
                var redAfterOR = 0.0;
                var redBeforeOR = 0.0;
                var redAmt = 0.0;

                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');

                for (var k = 0; k < rowdisdata.length; k++) {

                    if (rowdisdata[k].JobId == "1" && rowdisdata[k].DebtType == "OHC") {
                        var idItem = rowdisdata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                        var idMake = rowdisdata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                        var idCust = $('#<%=lblCustName.ClientID%>').text();
                        //var idItem = $('#<%=hdnIdItem.ClientID%>').val();
                        //var idMake = $('#<%=hdnIdMake.ClientID%>').val();
                        var vats = LoadGMHPVat(idItem, idMake, idCust);
                        gmVat = 0.0;
                        hpVat = 0.0;
                        spVat = 0.0;

                        if (vats.length > 0) {
                            gmVat = fnformatDecimalValue(vats[0], seperator);
                            hpVat = fnformatDecimalValue(vats[1], seperator);
                            spVat = fnformatDecimalValue(vats[2], seperator);
                        }

                        var hpVatPer = hpVat;
                        var gmVatPer = gmVat;
                        var spVatPer = spVat;

                        if (rowdisdata[k].Diff == "L") {
                            var amount = 0.0;
                            //amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                            //amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator));
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = fnformatDecimalValue($('#<%=txtGM.ClientID%>').val(), seperator);
                            if (rowdisdata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                                //$('#<%=txtTGM.ClientID%>').val(TotalGM);
                            }

                            //Lab and GM Discount
                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                            }

                            hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                            gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                            hpVat = fnreformatDecimal(hpVat, seperator);
                            gmVat = fnreformatDecimal(gmVat, seperator);
                            amtL = fnreformatDecimal(amtL, seperator);  //Total Labour Amt
                            TotalGM = fnreformatDecimal(TotalGM, seperator); // Total GM Amt

                            var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                        }

                        if (rowdisdata[k].Diff == "S") {
                            var amount = 0.0;
                            //amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator));
                            amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                            //vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVat))).toFixed(2);
                            vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVat))).toFixed(2);
                            amtS = fnreformatDecimal(amtS, seperator); // Total Spare Amt
                            vatAmount = fnreformatDecimal(vatAmount, seperator);

                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                var amt;
                                var boQty;
                                if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                    boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                } else {
                                    boQty = 0;
                                }

                                if (boQty != "0") {
                                    //discAmount = 0;
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                                } else {
                                    amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator);
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                                }
                            }

                            //Spare Discount
                            var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                        }

                        //if (rowdisdata[k].Disc_Amt != undefined) {
                        //    discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                        //}

                        //discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator)).toFixed(2);

                        if (rowdisdata[k].Diff == "OR" && rowdisdata[k].DebtType == "OHC") {
                            ownRiskAmt = fnformatDecimalValue(rowdisdata[k].Pris, seperator);
                        }

                    }

                    var total = (fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtL, seperator) + fnformatDecimalValue(amtS, seperator)).toFixed(2);
                    var vatTotal = (fnformatDecimalValue(hpVat, seperator) + fnformatDecimalValue(gmVat, seperator) + fnformatDecimalValue(vatAmount, seperator)).toFixed(2);
                    // var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                    var TExclVat = ((fnformatDecimalValue(total, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                    redAfterOR = fnformatDecimalValue(total, seperator) - fnformatDecimalValue(ownRiskAmt, seperator);
                    redBeforeOR = fnformatDecimalValue(total, seperator);

                    total = fnreformatDecimal(total, seperator);
                    vatTotal = fnreformatDecimal(vatTotal, seperator);
                    //TIncVat = fnreformatDecimal(TIncVat, seperator);
                    discAmount = fnreformatDecimal(discAmount, seperator);

                    if (redType == "RAOR") {
                        redAmt = fnformatDecimalValue(redAfterOR, seperator);
                    } else if (redType == "RBOR") {
                        redAmt = fnformatDecimalValue(redBeforeOR, seperator);
                    } else {
                        redAmt = fnformatDecimalValue(total, seperator);
                    }
                }

                return redAmt;
            }

            function recalculateRedLines() {

                var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                for (var k = 0; k < rowspareData.length; k++) {
                    if (rowspareData[k].DebtType == "OHC") {

                        if ((rowspareData[k].Diff == "RAOR" || rowspareData[k].Diff == "RBOR") && (rowspareData[k].JobId == "1")) {
                            if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris == "" && rowspareData[k].Belop != "" && fnformatDecimalValue(rowspareData[k].Ford, seperator) > 0) {
                                var raorAmt = "0";
                                raorAmt = calcReductionAmt(rowspareData[k].Diff.toString());
                                raorAmt = (fnformatDecimalValue(raorAmt, seperator) * (fnformatDecimalValue(rowspareData[k].Ford, seperator) / 100)).toFixed(2);
                                rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                            } else if (rowspareData[k].Levert == "" && rowspareData[k].Bestilt == "" && rowspareData[k].Pris != "" && rowspareData[k].Belop == 0 && rowspareData[k].Ford == "") {
                                var raorAmt = "0";
                                rowspareData[k].Belop = fnformatDecimalValue(raorAmt, seperator); // To be recalculated based on RAOR/RBOR
                            }
                        }
                    }
                }

                var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                jQuery("#jobgrid").jqGrid('clearGridData');
                for (var i = 0; i < rowGrddata.length; i++) {
                    jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                }
            }

            function loadConfig(idWONO, idWOPrefix, userId, idMakeRP, idModelRP) {
                var garageMatPer = "";
                var hpVatPer = "";
                var idJob = "1";
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/LoadConfig",
                    data: "{'idWONO':'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "',userId:'" + userId + "',idMakeRP:'" + idMakeRP + "',idModelRP:'" + idModelRP + "',idJob:'" + idJob + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (Result.d.length > 0) {
                            garageMatPer = Result.d[1][0].WO_Gm_Per;
                            garageMatPer = fnformatDecimalValue(garageMatPer, seperator);
                            $('#<%=txtGM.ClientID%>').val(garageMatPer);
                            $('#<%=hdnDuser.ClientID%>').val(Result.d[5][0].Id_Login);
                            loadMechanics(Result.d[4]);
                        }
                    }
                });
            }


            function checkSpareExists(idItem, id) {
                var idCustomer = $('#<%=lblCustName.ClientID%>').text();
                var vehId = $('#<%=hdnVehId.ClientID%>').val();
                var strResult = "False";
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/GetSpareById",
                    data: "{'spName':'" + idItem + "',idCustomer:'" + idCustomer + "',vehId:'" + vehId + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (Result.d.length > 0) {

                            var rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                            var jobId = rowdata.JobId;
                            for (var i = 0; i < Result.d.length; i++) {
                                if (rowdata.Diff == "S") {
                                    if (rowdata.Id_Make == Result.d[i].Id_Make) {
                                        $("#<%=hdnAvail_Qty.ClientID%>").val(Result.d[i].Item_Avail_Qty);

                                        $("#<%=hdnIdItem.ClientID%>").val(Result.d[i].Id_Item);
                                        $("#<%=hdnIdMake.ClientID%>").val(Result.d[i].Id_Make);

                                        jQuery("#jobgrid").setCell(id, "Nei", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(id, "Ford", "", 'not-editable-cell');

                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Nei', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Ford', "100");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Bestilt', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Levert', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Pris', Result.d[i].Sp_Item_Price);
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Text', Result.d[i].Item_Sp_Desc);
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Diff', "S");
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'Item_Avail_Qty', Result.d[i].Item_Avail_Qty);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'IdJob', Result.d[i].Id_Item);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Make', Result.d[i].Id_Make);
                                        jQuery('#jobgrid').jqGrid("setCell", id, 'ItemDesc', Result.d[i].Item_Sp_Desc);
                                        jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Warehouse', Result.d[i].Id_Wh_Item);

                                        if (Result.d[i].Item_Sp_Desc != "") {
                                            jQuery("#jobgrid").setCell(id, "Text", "", 'not-editable-cell');
                                        }
                                    }
                                } else {
                                    $("#<%=hdnAvail_Qty.ClientID%>").val(Result.d[i].Item_Avail_Qty);

                                    $("#<%=hdnIdItem.ClientID%>").val(Result.d[i].Id_Item);
                                    $("#<%=hdnIdMake.ClientID%>").val(Result.d[i].Id_Make);

                                    jQuery("#jobgrid").setCell(id, "Nei", "", 'not-editable-cell');
                                    jQuery("#jobgrid").setCell(id, "Ford", "", 'not-editable-cell');

                                    jQuery('#jobgrid').jqGrid("setCell", id, 'Nei', "0");
                                    jQuery('#jobgrid').jqGrid("setCell", id, 'Ford', "100");
                                    jQuery('#jobgrid').jqGrid("setCell", id, 'Bestilt', "0");
                                    jQuery('#jobgrid').jqGrid("setCell", id, 'Levert', "0");
                                    jQuery('#jobgrid').jqGrid("setCell", id, 'Pris', Result.d[i].Sp_Item_Price);
                                    jQuery('#jobgrid').jqGrid("setCell", id, 'Text', Result.d[i].Item_Sp_Desc);
                                    jQuery('#jobgrid').jqGrid("setCell", id, 'Diff', "S");
                                    jQuery('#jobgrid').jqGrid("setCell", id, 'Item_Avail_Qty', Result.d[i].Item_Avail_Qty);
                                    jQuery("#jobgrid").jqGrid('setCell', id, 'IdJob', Result.d[i].Id_Item);
                                    jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Make', Result.d[i].Id_Make);
                                    jQuery('#jobgrid').jqGrid("setCell", id, 'ItemDesc', Result.d[i].Item_Sp_Desc);
                                    jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Warehouse', Result.d[i].Id_Wh_Item);

                                    if (Result.d[i].Item_Sp_Desc != "") {
                                        jQuery("#jobgrid").setCell(id, "Text", "", 'not-editable-cell');
                                    }
                                }                                                                
                            }                            

                            var cmn = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                            cmn.editable = true;
                            jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                            $("#jobgrid").jqGrid("hideCol", "subGrid");
                            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                            strResult = "True";
                        } else {
                            strResult = "False";
                        }
                    }
                });
                return strResult;
            }

            function LoadHourlyPrice(hpMode) {
                var idMakeRP, idRPPCD_Hp, jobPCD_Hp, idCust, userid, vehGrp, Hprice;
                idRPPCD_Hp = "";
                jobPCD_Hp = "";
                idMakeRP = "AM";
                var jobId = ""; //jobId;
                var chkChrgStdTime = "false";
                idCust = $('#<%=lblCustName.ClientID%>').text();
                userid = '<%= Session("UserID")%>';
                vehGrp = $('#<%=hdnVehId.ClientID%>').val();
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/LoadHourlyPrice",
                    data: "{'idCust':'" + idCust + "',userid:'" + userid + "',idMakeRP:'" + idMakeRP + "',idRPPCD_Hp:'" + idRPPCD_Hp + "',jobPCD_Hp:'" + jobPCD_Hp + "',vehGrp:'" + vehGrp + "',jobId:'" + jobId + "',chkChrgStdTime:'" + chkChrgStdTime + "',hpmode:'" + hpMode + "'}",
                    //data: {},
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (Result.d.length > 0) {
                            if (hpMode == "New") {
                                Hprice = Result.d[0].HP_Price;
                            }
                        }
                    }
                });
                return Hprice;
            }

            function loadDefaultMake() {
                var loadAllMakes = "";
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWoJobDetails.aspx/Fetch_Sp_Make",
                    data: "{'q':'" + loadAllMakes + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (data) {
                        $('#<%=selMake.ClientID%>').empty();
                       // $('#<%=selMake.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                        data = data.d;
                        $.each(data, function (key, value) {
                            $('#<%=selMake.ClientID%>').append($("<option></option>").val(value.Sp_Make).html(value.Sp_Make));
                           // $('#<%=selMake.ClientID%>')[0].selectedIndex = 3;
                        });
                    },
                    error: function (xhr, status, error) {
                        alert("Error" + error);
                        var err = eval("(" + xhr.responseText + ")");
                        alert('Error: ' + err.Message);
                    }
                });
            } 

            $('#fetchEniro').on('click', function (e) {
                e.preventDefault();
                $('#<%=txtWashLocalLastName.ClientID()%>').val($('#<%=txtLName.ClientID()%>').val());
                $('#<%=txtWashLocalFirstName.ClientID()%>').val($('#<%=txtName.ClientID()%>').val());
                $('#<%=txtWashLocalMiddleName.ClientID()%>').val($('#<%=txtMName.ClientID()%>').val());
                $('#<%=txtWashLocalVisitAddress.ClientID()%>').val($('#<%=txtAddress1.ClientID()%>').val());
                $('#<%=txtWashLocalZipCode.ClientID()%>').val($('#<%=txtZipCode.ClientID()%>').val());
                $('#<%=txtWashLocalZipPlace.ClientID()%>').val($('#<%=txtState.ClientID()%>').val());
                $('#<%=txtWashLocalMobile.ClientID()%>').val($('#<%=txtMobNo.ClientID()%>').val());
                $('#<%=txtWashLocalPhone.ClientID()%>').val($('#<%=txtMobNo.ClientID()%>').val());
                if ($('#<%=hdnCustBorn.ClientID()%>').val().length > 10) {
                    var ret = $('#<%=hdnCustBorn.ClientID()%>').val().split(" ");
                    alert("length: " + ret[0].length);
                    $('#<%=txtWashLocalBorn.ClientID()%>').val(ret[0]);
                }
                else {
                    $('#<%=txtWashLocalBorn.ClientID()%>').val($('#<%=hdnCustBorn.ClientID()%>').val());
                }
                $('#<%=txtWashLocalSsnNo.ClientID()%>').val($('#<%=hdnCustSsn.ClientID()%>').val());
                WashEniroData();
                if ($('#<%=txtWashLocalLastName.ClientID()%>').val() != $('#<%=txtWashEniroLastName.ClientID()%>').val() && $('#<%=txtWashEniroLastName.ClientID()%>').val() !="") {
                    if ($('#<%=txtWashEniroLastName.ClientID()%>').val() != "") {
                        $('#<%=chkWashLastName.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashLastName.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalFirstName.ClientID()%>').val() != $('#<%=txtWashEniroFirstName.ClientID()%>').val() && $('#<%=txtWashEniroFirstName.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroFirstName.ClientID()%>').val() != "") {
                        $('#<%=chkWashFirstName.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashFirstName.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalMiddleName.ClientID()%>').val() != $('#<%=txtWashEniroMiddleName.ClientID()%>').val() && $('#<%=txtWashEniroMiddleName.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroMiddleName.ClientID()%>').val() != "") {
                        $('#<%=chkWashMiddleName.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashMiddleName.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalVisitAddress.ClientID()%>').val() != $('#<%=txtWashEniroVisitAddress.ClientID()%>').val() && $('#<%=txtWashEniroVisitAddress.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroVisitAddress.ClientID()%>').val() != " ") {
                        $('#<%=chkWashVisitAddress.ClientID()%>').prop('checked', true);
                    }
                    else {
                        $('#<%=chkWashVisitAddress.ClientID()%>').prop('checked', false);
                    }
                }
                else {
                    $('#<%=chkWashVisitAddress.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalBillAddress.ClientID()%>').val() != $('#<%=txtWashEniroBillAddress.ClientID()%>').val() && $('#<%=txtWashEniroBillAddress.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroBillAddress.ClientID()%>').val() != "") {
                        $('#<%=chkWashBillAddress.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashBillAddress.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalZipCode.ClientID()%>').val() != $('#<%=txtWashEniroZipCode.ClientID()%>').val() && $('#<%=txtWashEniroZipCode.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroZipCode.ClientID()%>').val() != "") {
                        $('#<%=chkWashZipCode.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashZipCode.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalZipPlace.ClientID()%>').val() != $('#<%=txtWashEniroZipPlace.ClientID()%>').val().toUpperCase() && $('#<%=txtWashEniroZipPlace.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroZipPlace.ClientID()%>').val() != "") {
                        $('#<%=chkWashZipPlace.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashZipPlace.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalPhone.ClientID()%>').val() != $('#<%=txtWashEniroPhone.ClientID()%>').val() && $('#<%=txtWashEniroPhone.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroPhone.ClientID()%>').val() != "") {
                        $('#<%=chkWashPhone.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashPhone.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalMobile.ClientID()%>').val() != $('#<%=txtWashEniroMobile.ClientID()%>').val() && $('#<%=txtWashEniroMobile.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroMobile.ClientID()%>').val() != "") {
                        $('#<%=chkWashMobile.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashMobile.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalBorn.ClientID()%>').val() != $('#<%=txtWashEniroBorn.ClientID()%>').val() && $('#<%=txtWashEniroBorn.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroBorn.ClientID()%>').val() != "") {
                        $('#<%=chkWashBorn.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashBorn.ClientID()%>').prop('checked', false);
                }
                if ($('#<%=txtWashLocalSsnNo.ClientID()%>').val() != $('#<%=txtWashEniroSsnNo.ClientID()%>').val() && $('#<%=txtWashEniroSsnNo.ClientID()%>').val() != "") {
                    if ($('#<%=txtWashEniroSsnNo.ClientID()%>').val() != "") {
                        $('#<%=chkWashSsnNo.ClientID()%>').prop('checked', true);
                    }
                }
                else {
                    $('#<%=chkWashSsnNo.ClientID()%>').prop('checked', false);
                }
                $('#modEniroCustomer').modal({
                    onDeny: function () {

                    },
                    onApprove: function () {
                        var lastName = "";
                        var firstName = "";
                        var middleName = "";
                        var visitAddress = "";
                        var billingAddress = "";
                        var zipCode = "";
                        var zipPlace = "";
                        var phone = "";
                        var mobile = "";
                        var born = "";
                        var ssn = ""
                        if ($('#<%=chkWashLastName.ClientID%>').is(':checked')) {
                            $('#<%=txtLName.ClientID%>').val($('#<%=txtWashEniroLastName.ClientID%>').val());
                            lastName = $('#<%=txtWashEniroLastName.ClientID%>').val();
                        }
                        if ($('#<%=chkWashFirstName.ClientID%>').is(':checked')) {
                            $('#<%=txtName.ClientID%>').val($('#<%=txtWashEniroFirstName.ClientID%>').val());
                            firstName = $('#<%=txtWashEniroFirstName.ClientID%>').val();
                        }
                        if ($('#<%=chkWashMiddleName.ClientID%>').is(':checked')) {
                            $('#<%=txtMName.ClientID%>').val($('#<%=txtWashEniroMiddleName.ClientID%>').val());
                            middleName = $('#<%=txtWashEniroMiddleName.ClientID%>').val();
                        }
                        if ($('#<%=chkWashVisitAddress.ClientID%>').is(':checked')) {
                            $('#<%=txtAddress1.ClientID%>').val($('#<%=txtWashEniroVisitAddress.ClientID%>').val());
                            visitAddress = $('#<%=txtWashEniroVisitAddress.ClientID%>').val();
                        }
                        if ($('#<%=chkWashBillAddress.ClientID%>').is(':checked')) {
                            //$('#<%=txtMobNo.ClientID%>').val($('#<%=txtWashEniroBillAddress.ClientID%>').val());
                            billingAddress = $('#<%=txtWashEniroBillAddress.ClientID%>').val();
                        }
                        if ($('#<%=chkWashZipCode.ClientID%>').is(':checked')) {
                            $('#<%=txtZipCode.ClientID%>').val($('#<%=txtWashEniroZipCode.ClientID%>').val());
                            zipCode = $('#<%=txtWashEniroZipCode.ClientID%>').val();
                        }
                        if ($('#<%=chkWashZipPlace.ClientID%>').is(':checked')) {
                            $('#<%=txtState.ClientID%>').val($('#<%=txtWashEniroZipPlace.ClientID%>').val());
                            zipPlace = $('#<%=txtWashEniroZipPlace.ClientID%>').val();
                        }
                        if ($('#<%=chkWashPhone.ClientID%>').is(':checked')) {
                            $('#<%=txtMobNo.ClientID%>').val($('#<%=txtWashEniroPhone.ClientID%>').val());
                            phone = $('#<%=txtWashEniroPhone.ClientID%>').val();
                        }
                        if ($('#<%=chkWashMobile.ClientID%>').is(':checked')) {
                            
                            $('#<%=txtMobNo.ClientID%>').val($('#<%=txtWashEniroMobile.ClientID%>').val());
                            mobile = $('#<%=txtWashEniroMobile.ClientID%>').val();
                        }
                        if ($('#<%=chkWashBorn.ClientID%>').is(':checked')) {
                            //$('#<%=txtMobNo.ClientID%>').val($('#<%=txtWashEniroBorn.ClientID%>').val());
                            born = $('#<%=txtWashEniroBorn.ClientID%>').val();
                        }
                        if ($('#<%=chkWashSsnNo.ClientID%>').is(':checked')) {
                            //$('#<%=txtMobNo.ClientID%>').val($('#<%=txtWashEniroSsnNo.ClientID%>').val());
                            ssn = $('#<%=txtWashEniroSsnNo.ClientID%>').val();
                        }
                        //$('#<%=txtMobNo.ClientID%>').val($.datepicker.formatDate("dd.mm.yy", new Date()));
                        updateEniroDetails($('#<%=txtSrchCust.ClientID%>').val(), lastName, firstName, middleName, visitAddress, billingAddress, zipCode, zipPlace, phone, mobile, born, ssn);
                    }
                }).modal('show');
            });

            function WashEniroData() {

                $.ajax({
                    type: "POST",
                    url: "../Master/frmCustomerDetail.aspx/FetchEniro",
                    data: "{search: '" + $('#<%=txtName.ClientID()%>').val() + " " + $('#<%=txtMName.ClientID()%>').val() + " " + $('#<%=txtLName.ClientID()%>').val() + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        if (data.d.length != 0) {
                            var res = data.d;
                            $.each(res, function (key, value) {
                                console.log(value.ENIRO_ID);
                                if (value.ENIRO_ID == $('#<%=txtEniroId.ClientID()%>').val()) {
                                    $('#<%=txtWashEniroLastName.ClientID()%>').val(value.CUST_LAST_NAME);
                                    $('#<%=txtWashEniroFirstName.ClientID()%>').val(value.CUST_FIRST_NAME);
                                    $('#<%=txtWashEniroMiddleName.ClientID()%>').val(value.CUST_MIDDLE_NAME);
                                    $('#<%=txtWashEniroVisitAddress.ClientID()%>').val(value.CUST_PERM_ADD1);
                                    $('#<%=txtWashEniroZipCode.ClientID()%>').val(value.ID_CUST_PERM_ZIPCODE);
                                    $('#<%=txtWashEniroZipPlace.ClientID()%>').val(value.CUST_PERM_ADD2.toUpperCase());
                                    if (value.PHONE_TYPE == 'M') {
                                        $('#<%=txtWashEniroMobile.ClientID()%>').val(value.CUST_PHONE_MOBILE);
                                    }
                                    if (value.PHONE_TYPE == 'T') {
                                        $('#<%=txtWashEniroPhone.ClientID()%>').val(value.CUST_PHONE_MOBILE);
                                    }
                                    $('#<%=txtWashEniroBorn.ClientID()%>').val(value.CUST_BORN);
                                    $('#<%=txtWashEniroSsnNo.ClientID()%>').val(value.CUST_SSN_NO);
                                }
                            });
                        }
                        else {
                            alert('No customer was found. Please search with something else as your data.')
                        }
                    },
                    failure: function () {
                        alert("Failed!");
                    },
                    select: function (e, i) {
                        alert('hi');

                    },
                });
            }


            function loadDefaultSpSupplier() {
                var loadAllSupp = "";
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWoJobDetails.aspx/Fetch_Sp_Supplier",
                    data: "{'q':'" + loadAllSupp + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {

                        $('#<%=selSupp.ClientID%>').empty();
                        //$('#<%=selSupp.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");

                        Result = Result.d;
                        $.each(Result, function (key, value) {
                            $('#<%=selSupp.ClientID%>').append($("<option></option>").val(value.SP_SupplierID).html(value.SP_SupplierName));
                            // $('#<%=selSupp.ClientID%>')[0].selectedIndex = 3;
                        });
                    },
                    error: function (xhr, status, error) {
                        alert("Error" + error);
                        var err = eval("(" + xhr.responseText + ")");
                        alert('Error: ' + err.Message);
                    }
                });
            }

            function loadDefaultLocation() {
                var loadAllLoc = "";
                var spMake = new Array();
                var spSupp = new Array();
                var spLoc = new Array();
               
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWoJobDetails.aspx/Fetch_Sp_Location",
                    data: "{'q':'" + loadAllLoc + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {

                        $('#<%=selLoc.ClientID%>').empty();
                        //$('#<%=selLoc.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");

                        Result = Result.d;
                        $.each(Result, function (key, value) {
                            $('#<%=selLoc.ClientID%>').append($("<option></option>").val(value.Sp_Location).html(value.Sp_Location));
                            // $('#<%=selLoc.ClientID%>')[0].selectedIndex = 3;
                        });

                        //Load default value
                        if (Result.length > 0) {
                            if (Result[0].Id_Make != null) {
                                spMake = Result[0].Id_Make.split(',');
                                if (spMake.length > 1) {
                                    for (var k = 0; k < spMake.length; k++) {
                                        //spMake[k] = "'" + spMake[k] + "'";
                                        $('.ui.fluid.dropdown').dropdown('set selected', spMake[k]);
                                    }
                                }
                            }
                            
                            if (Result[0].SP_SupplierID != null) {
                                spSupp = Result[0].SP_SupplierID.split(',');
                                if (spSupp.length > 1) {
                                    for (var k = 0; k < spSupp.length; k++) {
                                        $('.ui.fluid.dropdown').dropdown('set selected', spSupp[k]);
                                    }
                                }
                            }

                            if (Result[0].Item_Sp_Desc != null) {
                                spLoc = Result[0].Item_Sp_Desc.split(',');
                                if (spLoc.length > 1) {
                                    for (var k = 0; k < spLoc.length; k++) {
                                        $('.ui.fluid.dropdown').dropdown('set selected', spLoc[k]);
                                    }
                                }
                            }

                            if (Result[0].Sp_FlgStockItem == 1) {
                                $("#<%=chkSPStkQty.ClientID%>").prop('checked', true);
                            } else {
                                $("#<%=chkSPStkQty.ClientID%>").prop('checked', false);
                            }
                            if (Result[0].SP_FlgStockItemStatus == 1) {
                                $("#<%=chkFlgStockItem.ClientID%>").prop('checked', true);
                            } else {
                                $("#<%=chkFlgStockItem.ClientID%>").prop('checked', false);
                            }
                            if (Result[0].SP_FlgNonStockItemStatus == 1) {
                                $("#<%=chkFlgNonStockItem.ClientID%>").prop('checked', true);
                            } else {
                                $("#<%=chkFlgNonStockItem.ClientID%>").prop('checked', false);
                            }
                        }
                    },
                    error: function (xhr, status, error) {
                        alert("Error" + error);
                        var err = eval("(" + xhr.responseText + ")");
                        alert('Error: ' + err.Message);
                    }
                });
            }

            function overlay(state, mod) {
                $('body').focus();
                if (mod == "") {
                    $('.modal').addClass('hidden');
                }
                else {
                    $('#' + mod).removeClass('hidden');
                }
                if (state == "") {
                    $('.overlayHide').toggleClass('ohActive');
                } else if (state == "on") {
                    $('.overlayHide').addClass('ohActive');
                } else {
                    $('.overlayHide').removeClass('ohActive');
                }
            }



            $(".modClose").on('click', function (e) {
                overlay('off', '');
            });


            $(function () {
                $.contextMenu({
                    selector: '#dgdSelectedSPGrid tr',
                    callback: function (key, options) {
                        var m = "clicked: " + key;
                        window.console && console.log(m) || alert(m);
                    },
                    items: {
                        "DeleteLine": {
                            name: "DeleteLine",
                            callback: function (key, opt) {
                                var rowId = opt.$trigger[0].id;
                                var grdBasket = $("#dgdSelectedSPGrid");
                                grdBasket.delRowData(rowId);

                            }
                        }
                    }
                });
            });

            $(function () {
                $.contextMenu({
                    selector: '#jobgrid tr',
                    //$trigger = $('#jobgrid tr'),
                    //$trigger[$this[0].id].className ='context-menu-disabled',
                    build: function ($trigger, e) {
                        // this callback is executed every time the menu is to be shown
                        // its results are destroyed every time the menu is hidden
                        // e is the original contextmenu event, containing e.pageX and e.pageY (amongst other data)
                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', $trigger[0].id);

                        var currJobId = rowdata.JobId;
                        var rowjobData = $('#jobgrid').jqGrid('getGridParam', 'data');
                        var totalLength = rowjobData.length;
                        var selectedId = parseInt($trigger[0].id);
                        var cType = "DEL";//DEL - Delete Line/Job ;ADD=Add job;EDIT= Edit job; Default DEL
                        var lastOHCrow;
                        var spId = rowdata.IdJob;
                        var textDesc = rowdata.Text;
                        var ownRiskExists = false;

                        for (var k = 0; k < rowjobData.length; k++) {
                            if (rowjobData[k].Flag != "1" && rowjobData[k].DebtType == "OHC") {
                                if (rowjobData[k].IdJob == "" && rowjobData[k].Text == "" && (rowjobData[k].Diff == "" || rowjobData[k].Diff == undefined || rowjobData[k].Diff == null)) {
                                    lastOHCrow = rowjobData[k].id;
                                }
                            }

                            if (rowjobData[k].JobId == "1" && rowjobData[k].DebtType == "OHC" && rowjobData[k].Diff == "OR" && rowjobData[k].Bestilt == "" && rowjobData[k].Levert == "" && rowjobData[k].Pris != "") {
                                ownRiskExists = true;
                            }
                        }

                        if (spId != "") {
                            spId = spId.toString().indexOf("<input");
                            if (spId != -1) {
                                spId = "";
                            }
                        }
                        if (textDesc != "") {
                            textDesc = spId.toString().indexOf("<input");
                            if (textDesc != -1) {
                                textDesc = "";
                            }
                        }

                        if (selectedId == totalLength && rowdata.DebtType != "INSC" && rowdata.DebtType != "INTC" && rowdata.DebtType != "CLA" && rowdata.DebtType != "MISC") {
                            cType = "ADD"; //Add and spares search for jobs without insurance customer
                        } else if (rowdata.Flag == "1" && (rowdata.DebtType != "INSC" && rowdata.DebtType != "INTC" && rowdata.DebtType != "CLA" && rowdata.DebtType != "MISC")) {
                            cType = "EDIT";
                        } else if (rowdata.Diff == "" && spId == "" && textDesc == "" && (rowdata.DebtType != "INSC" && rowdata.DebtType != "INTC" && rowdata.DebtType != "CLA" && rowdata.DebtType != "MISC")) {
                            if (selectedId == lastOHCrow && rowdata.JobId == "1") {
                                if (ownRiskExists == false) {
                                    cType = "ADDJOBSPSRCHOR"; // When Insurance customer exists - Addjob,sp search,ownrisk if not exists for job1
                                } else {
                                    cType = "ADDJOB"; //Add job,spares search for jobs with insurance customer
                                }
                            } else if (rowdata.JobId != "1") {
                                if (selectedId == lastOHCrow) {
                                    cType = "ADDJOB"; //Add job,spares search for jobs with insurance customer
                                } else {
                                    cType = "SRCHSPARE"; //Add spares search only
                                }

                            } else {
                                if (ownRiskExists == false && $('#<%=hdnInsCustId.ClientID%>').val() != "") {
                                    cType = "SRCH"; //Add spares search,own risk for job1 if not exists for job1 with insurance customer
                                } else {
                                    cType = "SRCHSPARE"; //Add spares search only
                                }
                            }
                        } else if (rowdata.DebtType == "INSC" || rowdata.DebtType == "INTC" || rowdata.DebtType == "CLA" || rowdata.DebtType == "MISC") {
                            cType = "DEL";
                        }
                        return {
                            callback: function (key, options) {
                                var m = "clicked: " + key;
                                window.console && console.log(m) || alert(m);
                            },
                            items: {
                                "AddJob": {
                                    name: "AddJob",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (cType == "ADDJOB" || cType == "ADD" || cType == "ADDJOBSPSRCHOR") {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var idMech = parseInt(rowId) + 1;
                                        $('#<%=hdnRowId.ClientID%>').val(idMech);
                                        $('#<%=ddlMechanic.ClientID%>')[0].selectedIndex = 0;
                                        $("#<%=txtJobId.ClientID%>").removeAttr("disabled");
                                        var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
                                        var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
                                        var jobNo = fetchJobs();
                                        $('#<%=txtJobId.ClientID%>').val(jobNo);
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        var mydata2;
                                        var arrAddJob = new Array();


                                        $('#modWashCustomer').modal({
                                            onDeny: function () {
                                            },
                                            onApprove: function () {
                                                //debugger;
                                                var mechId = $('#<%=ddlMechanic.ClientID%>').val();
                                                if ($('#<%=txtJobId.ClientID%>').val() != "") {
                                                    var jobIds = [];
                                                    var distjobIds = [];
                                                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                    for (var k = 0; k < rowdisdata.length; k++) {
                                                        jobIds[k] = rowdisdata[k].JobId;
                                                    }

                                                    var distinct_axes2 = [];

                                                    for (var a = 0; a < jobIds.length; a++) {
                                                        var str = jobIds[a];
                                                        if (distinct_axes2.indexOf(str) == -1) {
                                                            distinct_axes2.push(str);
                                                        }
                                                    }
                                                    distjobIds = distinct_axes2;

                                                    var jobExist = isInArray($('#<%=txtJobId.ClientID%>').val(), distjobIds);
                                                    if (jobExist == true) {
                                                        alert("Job Number already exists.");
                                                        return false;
                                                    }
                                                }

                                                $.ajax({
                                                    type: "POST",
                                                    contentType: "application/json; charset=utf-8",
                                                    url: "frmWOJobDetails.aspx/AddSpareLine",
                                                    //data: "{}",
                                                    data: "{'idWONO':'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "'}",
                                                    dataType: "json",
                                                    async: false,//Very important
                                                    success: function (data) {
                                                        mydata2 = data;
                                                        mydata2.IdJob = "Job: " + jobNo + "";
                                                        mydata2.Nei = "0";
                                                        mydata2.Ford = "100";
                                                        mydata2.Text = "";
                                                        mydata2.JobId = jobNo.toString();
                                                        mydata2.Flag = "1";
                                                        mydata2.Belop = "";
                                                        mydata2.ForeignJob = "";
                                                        mydata2.ItemDesc = "";
                                                        mydata2.Levert = "";
                                                        mydata2.IdWODetailseq = "";
                                                        mydata2.IdWOItemseq = "";
                                                        mydata2.IdWOLabSeq = "";
                                                        mydata2.Id_Deb_Seq = ""
                                                        mydata2.Item_Avail_Qty = "0";
                                                        mydata2.Jobi_Bo_Qty = "";
                                                        mydata2.Sp_Cost_Price = "0";
                                                        mydata2.DebtType = "OHC";
                                                        mydata2.SpareDiscount = 0;
                                                        //jQuery("#jobgrid").jqGrid('addRowData', (parseInt(rowId) + 1), mydata2);
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "IdJob", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "Text", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "Nei", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "Ford", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "Bestilt", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "Levert", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "Pris", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "Rab", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });
                                                        jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId) + 1), "Belop", "", {
                                                            'background-color': 'rgba(255, 255, 153, 1)',
                                                            'color': 'rgba(0, 0, 0, 1)',
                                                            'background-image': 'none'
                                                        });

                                                        arrAddJob.push({
                                                            IdJob: mydata2.IdJob,
                                                            Text: mydata2.Text,
                                                            Nei: mydata2.Nei,
                                                            Ford: mydata2.Ford,
                                                            Bestilt: mydata2.Bestilt,
                                                            Levert: mydata2.Levert,
                                                            Pris: mydata2.Pris,
                                                            Rab: mydata2.Rab,
                                                            Belop: mydata2.Belop,
                                                            JobId: mydata2.JobId,
                                                            Flag: mydata2.Flag,
                                                            ForeignJob: mydata2.ForeignJob,
                                                            ItemDesc: mydata2.ItemDesc,
                                                            IdWODetailseq: mydata2.IdWODetailseq,
                                                            IdWOItemseq: mydata2.IdWOItemseq,
                                                            IdWOLabSeq: mydata2.IdWOLabSeq,
                                                            Id_Deb_Seq: mydata2.Id_Deb_Seq,
                                                            Jobi_Bo_Qty: mydata2.Jobi_Bo_Qty,
                                                            Id_Make: mydata2.Id_Make,
                                                            Sp_Cost_Price: mydata2.Sp_Cost_Price,
                                                            Diff: mydata2.Diff,
                                                            Item_Avail_Qty: mydata2.Item_Avail_Qty,
                                                            Id_Warehouse: mydata2.Id_Warehouse,
                                                            IdMech: mydata2.IdMech,
                                                            MechanicName: mydata2.MechanicName,
                                                            DebtType: mydata2.DebtType,
                                                            SpareDiscount:mydata2.SpareDiscount
                                                        });

                                                    }

                                                });

                                                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                for (var j = 0; j < arrAddJob.length; j++) {
                                                    arrayInsertAt(rowdisdata, parseInt(rowId), arrAddJob[j]);
                                                }

                                                var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                jQuery("#jobgrid").jqGrid('clearGridData');
                                                for (var i = 0; i < rowGrddata.length; i++) {
                                                    jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                                                }

                                                var rowData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                //$('#' + rowData[rowId].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                                                $('#' + rowData[rowId].id, $("#jobgrid")).addClass("ui-state-disabled");


                                                //New Line for Job2
                                                arrAddJob = new Array();
                                                var mydata3;
                                                $.ajax({
                                                    type: "POST",
                                                    contentType: "application/json; charset=utf-8",
                                                    url: "frmWOJobDetails.aspx/AddSpareLine",
                                                    data: "{'idWONO':'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "'}",
                                                    dataType: "json",
                                                    async: false,//Very important
                                                    success: function (data) {
                                                        mydata3 = data;
                                                        mydata3.JobId = jobNo.toString();
                                                        mydata3.Nei = "0";
                                                        mydata3.Ford = "100";
                                                        mydata3.ForeignJob = "";
                                                        mydata3.Flag = "0";
                                                        mydata3.Belop = "";
                                                        mydata3.ItemDesc = "";
                                                        mydata3.IdWODetailseq = "";
                                                        mydata3.IdWOItemseq = "";
                                                        mydata3.IdWOLabSeq = "";
                                                        mydata3.Item_Avail_Qty = "0";
                                                        mydata3.Jobi_Bo_Qty = "";
                                                        mydata3.Id_Deb_Seq = ""
                                                        mydata3.Sp_Cost_Price = "0";
                                                        mydata3.Levert = "";
                                                        mydata3.DebtType = "OHC";
                                                        mydata3.SpareDiscount = 0;
                                                        //jQuery("#jobgrid").jqGrid('addRowData', (parseInt(rowId) + 2), mydata3);
                                                        // jQuery("#jobgrid").jqGrid("nextCell", parseInt(rowId) + 2, 0, true);
                                                        // document.getElementById((parseInt(rowId) + 2) + '_IdJob').select();
                                                        arrAddJob.push({
                                                            IdJob: mydata3.IdJob,
                                                            Text: mydata3.Text,
                                                            Nei: mydata3.Nei,
                                                            Ford: mydata3.Ford,
                                                            Bestilt: mydata3.Bestilt,
                                                            Levert: mydata3.Levert,
                                                            Pris: mydata3.Pris,
                                                            Rab: mydata3.Rab,
                                                            Belop: mydata3.Belop,
                                                            JobId: mydata3.JobId,
                                                            Flag: mydata3.Flag,
                                                            ForeignJob: mydata3.ForeignJob,
                                                            ItemDesc: mydata3.ItemDesc,
                                                            IdWODetailseq: mydata3.IdWODetailseq,
                                                            IdWOItemseq: mydata3.IdWOItemseq,
                                                            IdWOLabSeq: mydata3.IdWOLabSeq,
                                                            Id_Deb_Seq: mydata3.Id_Deb_Seq,
                                                            Jobi_Bo_Qty: mydata3.Jobi_Bo_Qty,
                                                            Id_Make: mydata3.Id_Make,
                                                            Sp_Cost_Price: mydata3.Sp_Cost_Price,
                                                            Diff: mydata3.Diff,
                                                            Item_Avail_Qty: mydata3.Item_Avail_Qty,
                                                            Id_Warehouse: mydata3.Id_Warehouse,
                                                            IdMech: mydata3.IdMech,
                                                            MechanicName: mydata3.MechanicName,
                                                            DebtType: mydata3.DebtType,
                                                            SpareDiscount: mydata3.SpareDiscount

                                                        });
                                                    }
                                                });


                                                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                for (var j = 0; j < arrAddJob.length; j++) {
                                                    arrayInsertAt(rowdisdata, parseInt(rowId) + 1, arrAddJob[j]);
                                                }

                                                var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                jQuery("#jobgrid").jqGrid('clearGridData');
                                                for (var i = 0; i < rowGrddata.length; i++) {
                                                    jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                                                }

                                                setGridLinesColour();

                                                $('#<%=hdnJobId.ClientID%>').val($('#<%=txtJobId.ClientID%>').val());
                                                //$('#<%=txtJobId.ClientID%>').val('');
                                                $('#jobgrid').jqGrid("setCell", parseInt(rowId) + 1, 'IdJob', "Job:" + $('#<%=hdnJobId.ClientID%>').val());
                                                $('#jobgrid').jqGrid("setCell", parseInt(rowId) + 1, 'JobId', $('#<%=hdnJobId.ClientID%>').val());
                                                $('#jobgrid').jqGrid("setCell", parseInt(rowId) + 2, 'JobId', $('#<%=hdnJobId.ClientID%>').val());

                                                $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 1), 'WC', $('#<%=ddlWorkCode.ClientID%>').val());
                                                $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 1), 'RC', $('#<%=ddlRepairCode.ClientID%>').val());

                                                if (mechId != "0") {
                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 1), 'IdMech', $('#<%=ddlMechanic.ClientID%>').val());
                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 2), 'IdMech', $('#<%=ddlMechanic.ClientID%>').val());
                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 1), 'MechanicName', $("#<%=ddlMechanic.ClientID%> option:selected").text() + "-" + $('#<%=ddlMechanic.ClientID%>').val());
                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 2), 'MechanicName', $("#<%=ddlMechanic.ClientID%> option:selected").text() + "-" + $('#<%=ddlMechanic.ClientID%>').val());

                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 1), 'Text', $("#<%=ddlMechanic.ClientID%> option:selected").text());
                                                } else {
                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 1), 'IdMech', "");
                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId) + 2), 'IdMech', "");
                                                }

                                                var isJobNumber = parseInt($('#<%=txtJobId.ClientID%>').val());
                                                if (isJobNumber >= 90 && isJobNumber <= 99) {
                                                    $('#jobgrid').jqGrid("setCell", parseInt(rowId) + 1, 'ForeignJob', "FJ");
                                                } else {
                                                    $('#jobgrid').jqGrid("setCell", parseInt(rowId) + 1, 'ForeignJob', "");
                                                }

                                                //jQuery("#jobgrid").jqGrid("nextCell", (parseInt(rowId) + 2), 0).focus();
                                                //document.getElementById((parseInt(rowId) + 2) + '_IdJob').select();


                                                jQuery("#jobgrid").jqGrid("nextCell", (parseInt(rowId) + 2), 0, true);
                                                document.getElementById(((parseInt(rowId) + 2)) + '_IdJob').select();

                                            }
                                        }).modal('show');
                                    }
                                },
                                "SearchSpare": {
                                    name: "SearchSpare",
                                    visible: function (key, opt) {                                        
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (cType == "SRCH" || cType == "SRCHSPARE" || cType == "ADDJOBSPSRCHOR" || cType == "ADDJOB" || cType == "ADD") {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        //debugger;
                                        $('#txtSPSearch').val("");
                                        //$("#txtSrchSuppler").val(null);
                                        jQuery("#dgdSelectedSPGrid").jqGrid('clearGridData');
                                        jQuery("#dgdSpareGrid").jqGrid('clearGridData');
                                        <%--$("#<%=chkFlgStockItem.ClientID%>").prop('checked', false);
                                            $("#<%=chkFlgNonStockItem.ClientID%>").prop('checked', false);
                                            $("#<%=chkSPStkQty.ClientID%>").prop('checked', false);--%>
                                        var rowId = opt.$trigger[0].id;
                                        var idMech = parseInt(rowId) + 1;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        var idWodetSeq = rowdata.IdWODetailseq;
                                        var idDebSeq = rowdata.Id_Deb_Seq;
                                        var jobNo = rowdata.JobId;
                                        $('#<%=hdnGridId.ClientID%>').val(rowId);
                                        $('#txtSPSearch').focus();
                                        var arrayID = new Array();
                                                                              
                                        //Added for Resetting the Dropdowns and hiding the SP grid 
                                        $('#<%=selMake.ClientID%>').dropdown('clear');
                                        $('#<%=selSupp.ClientID%>').dropdown('clear');
                                        $('#<%=selLoc.ClientID%>').dropdown('clear');
                                        $('#divSPGrid').hide();
                                        $('#divSelSPGrid').hide();

                                        //Load Location and default spr settings data
                                        loadDefaultMake();
                                        loadDefaultSpSupplier();
                                        loadDefaultLocation();

                                         

                                        $('#modSpare').modal({
                                            onDeny: function () {
                                              
                                            },
                                            onApprove: function () {
                                                //debugger;
                                                var rows = jQuery("#dgdSelectedSPGrid").getDataIDs();
                                                for (a = 0; a < rows.length; a++) {
                                                    var name = $(this).attr('id');
                                                    row = jQuery("#dgdSelectedSPGrid").getRowData(rows[a]);
                                                    var id = $('#' + name).closest('tr.jqgrow').attr(rows[a]);
                                                    var idItem = row.Id_Item;
                                                    var desc = row.Item_Sp_Desc;
                                                    var Id_Make = row.Id_Make;
                                                    var deliver_qty = 1;
                                                    var Price = row.Sp_Item_Price;
                                                    var amt = fnformatDecimalValue(Price, seperator).toFixed(2);
                                                    var itemAvailQty = fnreformatDecimal(row.Sp_StockQty, seperator);
                                                    var jobi_bo_qty;
                                                    var jobi_ord_qty;
                                                    if (fnformatDecimalValue(itemAvailQty, seperator) > 0) {
                                                        jobi_bo_qty = 0;
                                                        deliver_qty = 1;
                                                    }
                                                    else {
                                                        jobi_bo_qty = 1;
                                                        deliver_qty = 0;
                                                    }
                                                    jobi_ord_qty = fnformatDecimalValue(row.Jobi_Order_Qty, seperator);
                                                    var IdWh = row.Id_Wh_Item;
                                                    //alert(firstName);
                                                    arrayID.push({
                                                        id: rows[a],
                                                        IdJob: idItem,
                                                        Text: desc,
                                                        Nei: "0",
                                                        Ford: "100",
                                                        Bestilt: fnreformatDecimal(jobi_ord_qty, seperator),
                                                        Levert: deliver_qty,
                                                        Pris: Price,
                                                        Rab: "0",
                                                        Belop: fnreformatDecimal(amt, seperator),
                                                        JobId: jobNo,
                                                        Flag: "0",
                                                        ForeignJob: "",
                                                        ItemDesc: "",
                                                        IdWODetailseq: idWodetSeq,
                                                        IdWOItemseq: "",
                                                        IdWOLabSeq: "",
                                                        Id_Deb_Seq: idDebSeq,
                                                        Jobi_Bo_Qty: jobi_bo_qty,
                                                        Id_Make: "",
                                                        Sp_Cost_Price: "0",
                                                        Diff: "S",
                                                        Id_Make: Id_Make,
                                                        Item_Avail_Qty: itemAvailQty,
                                                        Id_Warehouse: IdWh,
                                                        DebtType: "OHC",
                                                        SpareDiscount:0
                                                    });
                                                }
                                                loadjobGrid(rowId, jobNo, arrayID);
                                            }
                                        }).modal('show');
                                    }
                                },
                                "AddOwnRisk": {
                                    name: "AddOwnRisk",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {
                                            if (cType == "SRCH" || cType == "SRCHSPARE" || cType == "ADDJOBSPSRCHOR" || cType == "ADDJOB" || cType == "ADD") {
                                                return true;
                                            }
                                            else {
                                                return false;
                                            }
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);

                                        jQuery("#jobgrid").setCell(rowId, "Nei", "", 'not-editable-cell');
                                        jQuery("#jobgrid").setCell(rowId, "Ford", "", 'not-editable-cell');
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'IdJob', rowdata.IdJob);
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Text', "Own Risk");
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Nei', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Ford', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Bestilt', "");
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Levert', "");
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Pris', "0");
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Rab', "");
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Belop', "");
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'JobId', rowdata.JobId);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'Flag', "0");
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'ForeignJob', "");
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'ItemDesc', "");
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'IdWODetailseq', rowdata.IdWODetailseq);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'IdWOItemseq', rowdata.IdWOItemseq);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'IdWOLabSeq', rowdata.IdWOLabSeq);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'Id_Deb_Seq', rowdata.Id_Deb_Seq);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'Jobi_Bo_Qty', rowdata.Jobi_Bo_Qty);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'Id_Make', rowdata.Id_Make);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'Sp_Cost_Price', rowdata.Sp_Cost_Price);
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Diff', "OR");
                                        jQuery('#jobgrid').jqGrid("setCell", rowId, 'Item_Avail_Qty', rowdata.Item_Avail_Qty);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'Id_Warehouse', rowdata.Id_Warehouse);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'IdMech', rowdata.IdMech);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'MechanicName', rowdata.MechanicName);
                                        jQuery("#jobgrid").jqGrid('setCell', rowId, 'DebtType', "OHC");

                                        jQuery("#jobgrid").jqGrid("nextCell", (parseInt(rowId)), 6, true);
                                        document.getElementById(((parseInt(rowId))) + '_Pris').select();
                                    }
                                },
                                "EditJob": {
                                    name: "EditJob",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (cType == "EDIT") {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var idMech = parseInt(rowId) + 1;
                                        $('#<%=hdnRowId.ClientID%>').val(idMech);
                                        $('#<%=ddlMechanic.ClientID%>')[0].selectedIndex = 0;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        $("#<%=txtJobId.ClientID%>").val(rowdata.JobId);
                                        $("#<%=txtJobId.ClientID%>").attr("disabled", "disabled");
                                        var jobNo = rowdata.JobId;
                                        var focusrowNo = 0;
                                        var mydata2;
                                        var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
                                        var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;

                                        $('#modWashCustomer').modal({
                                            onDeny: function () {
                                            },
                                            onApprove: function () {
                                                var mechId = $('#<%=ddlMechanic.ClientID%>').val();

                                                $.ajax({
                                                    type: "POST",
                                                    contentType: "application/json; charset=utf-8",
                                                    url: "frmWOJobDetails.aspx/AddSpareLine",
                                                    //data: "{}",
                                                    data: "{'idWONO':'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "'}",
                                                    dataType: "json",
                                                    async: false,//Very important
                                                    success: function (data) {

                                                        var rowData1 = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                        if (rowData1[rowId].Flag == "1" && (rowData1[rowId].DebtType == "OHC" || rowData1[rowId].DebtType == null || rowData1[rowId].DebtType == undefined)) {
                                                            $('#' + rowData1[rowId].id, $("#jobgrid")).addClass("ui-state-disabled");


                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "IdJob", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "Text", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "Nei", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "Ford", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "Bestilt", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "Levert", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "Pris", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "Rab", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                            jQuery("#jobgrid").jqGrid('setCell', (parseInt(rowId)), "Belop", "", {
                                                                'background-color': 'rgba(255, 255, 153, 1)',
                                                                'color': 'rgba(0, 0, 0, 1)',
                                                                'background-image': 'none'
                                                            });
                                                        }
                                                    }

                                                });

                                                $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'WC', $('#<%=ddlWorkCode.ClientID%>').val());
                                                $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'RC', $('#<%=ddlRepairCode.ClientID%>').val());
                                                $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'IdMech', $('#<%=ddlMechanic.ClientID%>').val());
                                                $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'MechanicName', $("#<%=ddlMechanic.ClientID%> option:selected").text() + "-" + $('#<%=ddlMechanic.ClientID%>').val());
                                                // if (mechId != "0" && (rowdata.Text == "")) {
                                                if (mechId != "0") {
                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Text', $("#<%=ddlMechanic.ClientID%> option:selected").text());
                                                }

                                                //else {
                                                //    $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'IdJob', "");
                                                //}

                                                if (mechId == "0" && (rowdata.Text == "")) {
                                                    $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'IdJob', "");
                                                }


                                                var rowchkdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                for (var k = 0; k < rowchkdata.length; k++) {
                                                    if (rowchkdata[k].JobId == jobNo && rowchkdata[k].Flag != "1") {
                                                        if (rowchkdata[k].Diff == "" || rowchkdata[k].Diff == undefined) {
                                                            focusrowNo = k;
                                                        }
                                                    }
                                                }

                                                jQuery("#jobgrid").jqGrid("nextCell", (parseInt(focusrowNo) + 1), 1).focus();
                                                document.getElementById((parseInt(focusrowNo) + 1) + '_Text').select();
                                            }
                                        }).modal('show');
                                    }
                                },
                                "DeleteLine": {
                                    name: "DeleteLine",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (cType == "DEL" && (rowdata.DebtType == "OHC")) {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var isSpare = $(this)[0].cells['12'].title;
                                        var grid = $("#jobgrid");
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        var gridrecords = $('#jobgrid').jqGrid('getGridParam', 'data');
                                        var deleteCount = gridrecords.length;
                                        var noOfLines = 0;
                                        var jobNo = $(this)[0].cells['10'].title;
                                        var ownRiskAmt = 0;
                                        var jobtotal = 0;

                                        if (rowdata.Diff == "RAOR" || rowdata.Diff == "RBOR") {
                                            $('#<%=radInsNoReduction.ClientID%>').attr('checked', true);
                                            $('#<%=radInsReductioAfter.ClientID%>').attr('checked', false);
                                            $('#<%=radInsReductionBefore.ClientID%>').attr('checked', false);

                                        }

                                        //To find the number of jobs. If there are more than one job then we shd be able to delete job1 else no
                                        for (var a = 0; a < gridrecords.length; a++) {
                                            if (((gridrecords[a].IdJob == "" || gridrecords[a].IdJob == undefined) && (gridrecords[a].Text == "" || gridrecords[a].Text == undefined))) {
                                                noOfLines += 1;
                                            }

                                            if (gridrecords[a].Diff == "OR" && gridrecords[a].DebtType == "OHC") {
                                                ownRiskAmt = fnformatDecimalValue(gridrecords[a].Pris, seperator);
                                            }
                                        }

                                        if (fnformatDecimalValue(ownRiskAmt, seperator) > 0) {
                                            jobtotal = fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val(), seperator);
                                            jobtotal = (fnformatDecimalValue(jobtotal, seperator) - fnformatDecimalValue(ownRiskAmt, seperator));
                                        }

                                        if (deleteCount == 2 && noOfLines == 1) {
                                            alert("Cannot delete the line");
                                        } else if (((rowdata.IdJob == "" || rowdata.IdJob == undefined) && (rowdata.Text == "" || rowdata.Text == undefined))) {
                                            alert("Cannot delete the a blank line");
                                        } else if ((((rowdata.IdJob != "") && (rowdata.Pris == "") && (rowdata.Text == "")))) {
                                            alert("Cannot delete the a blank line");
                                        } else if (fnformatDecimalValue(jobtotal, seperator) < fnformatDecimalValue(ownRiskAmt, seperator)) {
                                            alert("Cannot delete the line as the own risk amt is greater than job total");
                                            //return false;
                                        }
                                        else {
                                            grid.delRowData(rowId);

                                            //if any reduction lines exists the belop amount shd be recalculated
                                            recalculateRedLines();

                                            var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                            jQuery("#jobgrid").jqGrid('clearGridData');
                                            for (var j = 0; j < rowspareData.length; j++) {
                                                sparedata = rowspareData;
                                                jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                                            }
                                            jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                                            $("#jobgrid").jqGrid("hideCol", "subGrid");
                                            setGridLinesColour();
                                            updateJobAfterDelete(jobNo);
                                            setGridLinesColour();
                                            recalculateTotals();
                                        }
                                    }
                                },
                                "DeleteJob": {
                                    name: "DeleteJob",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (cType == "DEL") {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        var jobId = $(this)[0].cells['10'].title;
                                        var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
                                        var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
                                        var grid = $("#jobgrid");
                                        var jobIdXml;
                                        var gridrecords = $('#jobgrid').jqGrid('getGridParam', 'data');
                                        var deleteCount = gridrecords.length;
                                        var jobNo = 0;
                                        var debtTypeJobNo = 0;
                                        var debtType = rowdata.DebtType;
                                        var iddebSeq = rowdata.Id_Deb_Seq;
                                        $('#<%=hdnJobNum.ClientID%>').val(jobId);
                                        if (debtType == "INSC") {
                                            $('#<%=hdnIdDebtor.ClientID%>').val($('#<%=hdnInsCustId.ClientID%>').val());

                                        }

                                        //var msg = "Do you want to delete the job ?";//GetMultiMessage('0016', '', '');
                                        //var r = confirm(msg);
                                        //if (r == true)
                                        //{

                                        $('#modCustomerLock').modal({
                                            onDeny: function () {

                                            },
                                            onApprove: function () {
                                                //To find the number of jobs. If there are more than one job then we shd be able to delete job1 else no
                                                for (var a = 0; a < gridrecords.length; a++) {
                                                    if (((gridrecords[a].IdJob == "" || gridrecords[a].IdJob == undefined) && (gridrecords[a].Text == "" || gridrecords[a].Text == undefined))) {
                                                        jobNo += 1;
                                                    }
                                                }

                                                for (var b = 0; b < gridrecords.length; b++) {
                                                    if (((gridrecords[b].IdJob == "" || gridrecords[b].IdJob == undefined) && (gridrecords[b].Text == "" || gridrecords[b].Text == undefined) && (gridrecords[b].DebtType == debtType))) {
                                                        debtTypeJobNo += 1;
                                                    }
                                                }

                                                if (debtTypeJobNo == 1) {
                                                    // alert("Cannot delete the job");
                                                    $('#modContact').modal({
                                                        onApprove: function () {
                                                        }
                                                    }).modal('show');
                                                }

                                                //1st Job and only 1blank line
                                                if (deleteCount == 2) {
                                                    //  alert("Cannot delete the job");

                                                    $('#modContact').modal({
                                                        onApprove: function () {

                                                        }
                                                    }).modal('show');
                                                } else {

                                                    if (jobNo > 1 && debtTypeJobNo != 1) {
                                                        jobIdXml = "<JOB><ID_JOBS>" + jobId + "</ID_JOBS><ID_PR>" + idWOPrefix + "</ID_PR> <ID_WO>" + idWONO + "</ID_WO><DEBT_TYPE>" + debtType + "</DEBT_TYPE><ID_DEB_SEQ>" + iddebSeq + "</ID_DEB_SEQ></JOB>";
                                                        jobIdXml = "<ROOT>" + jobIdXml + "</ROOT>";

                                                        deleteJob(jobIdXml);
                                                        var rowspareDataTese = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                        for (var k = rowspareDataTese.length - 1; k >= 0; k--) {
                                                            if (rowspareDataTese[k].JobId == jobId && rowspareDataTese[k].DebtType == debtType) {
                                                                grid.delRowData(rowspareDataTese[k].id);
                                                            }
                                                        }

                                                        var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                        jQuery("#jobgrid").jqGrid('clearGridData');
                                                        for (var j = 0; j < rowspareData.length; j++) {
                                                            sparedata = rowspareData;
                                                            jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                                                        }
                                                        jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                                                        $("#jobgrid").jqGrid("hideCol", "subGrid");
                                                        //loadWOJobGrid(idWONO, idWOPrefix);
                                                        saveJobDet(1);
                                                        setGridLinesColour();
                                                        recalculateTotals();
                                                    } else if (jobNo == 1) {
                                                        // alert("Cannot delete the job");
                                                        $('#modContact').modal({
                                                            onApprove: function () {
                                                            }
                                                        }).modal('show');
                                                    }

                                                }
                                            }
                                        }).modal('show');
                                    }
                                },
                                "OpenLine": {
                                    name: "OpenLine",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (cType == "DEL" && (rowdata.DebtType == "OHC")) {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var jobId = $(this)[0].cells['10'].title;
                                        var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
                                        var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        jQuery("#dgdLabLine").jqGrid('clearGridData');
                                        if (rowdata.Diff == "L") {
                                            // Always single record will be selected and displayed
                                            for (var i = 0; i < 1; i++) {
                                                jQuery("#dgdLabLine").jqGrid('addRowData', i + 1, rowdata);
                                            }
                                            $('#dgdLabLine').jqGrid("setCell", '1', 'Diff', 'Verksted arbied');
                                            $('#<%=txtLabDesc.ClientID%>').val(rowdata.Text);
                                            $('#<%=txtLabFord.ClientID%>').val(rowdata.Ford);
                                            $('#<%=txtStdTime.ClientID%>').val(rowdata.Levert);
                                            $('#<%=txtLabSalesPr.ClientID%>').val(rowdata.Pris);
                                            $('#<%=txtLabDiscPer.ClientID%>').val(rowdata.Rab);
                                            $('#<%=txtLabTotalAmt.ClientID%>').val(rowdata.Belop);
                                            if (rowdata.IdJob != "" || rowdata.IdJob != undefined) {
                                                if (rowdata.IdMech != $('#<%=hdnDuser.ClientID%>').val()) {
                                                    $('#<%=ddlmechList.ClientID%>').val(rowdata.IdMech);
                                                    $('#<%=txtMId.ClientID%>').val(rowdata.IdMech);
                                                    $('#<%=LblMName.ClientID%>').text(rowdata.IdJob);
                                                } else {
                                                    $('#<%=ddlmechList.ClientID%>')[0].selectedIndex = 0;
                                                    $('#<%=txtMId.ClientID%>').val("");
                                                    $('#<%=LblMName.ClientID%>').text("");
                                                }
                                            }
                                            $('#modLabPopup').modal({
                                                onDeny: function () {
                                                },
                                                onApprove: function () {
                                                    var arrLab = new Array();
                                                    var labText = $('#<%=txtLabDesc.ClientID%>').val();
                                                    var idMec = $('#<%=txtMId.ClientID%>').val();
                                                    var mecName = $('#<%=LblMName.ClientID%>').text();
                                                    var ford = $('#<%=txtLabFord.ClientID%>').val();
                                                    var lev = $('#<%=txtStdTime.ClientID%>').val();
                                                    var pris = $('#<%=txtLabSalesPr.ClientID%>').val();
                                                    var rab = $('#<%=txtLabDiscPer.ClientID%>').val();
                                                    var belop = $('#<%=txtLabTotalAmt.ClientID%>').val();
                                                    var mid = $('#<%=txtMId.ClientID%>').val();
                                                    var mname = $('#<%=LblMName.ClientID%>').text();
                                                    if (mid == "") {
                                                        mid = $('#<%=hdnDuser.ClientID%>').val();
                                                        mname = "";
                                                    }
                                                    if (rab == "") { rab = "0"; }
                                                    var discAmt = $('#<%=txtDiscAmt.ClientID%>').val();
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'Text', labText);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'Levert', lev);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'Pris', pris);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'Rab', rab);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'Belop', belop);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'IdMech', mid);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'IdJob', mname);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'MechanicName', $("#<%=ddlmechList.ClientID%> option:selected").text());
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'IdWODetailseq', rowdata.IdWODetailseq);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'IdWOItemseq', rowdata.IdWOItemseq);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'IdWOLabSeq', rowdata.IdWOLabSeq);
                                                    $('#jobgrid').jqGrid("setCell", rowId, 'Id_Deb_Seq', rowdata.Id_Deb_Seq);
                                                    recalculateTotals();
                                                    saveJobDet(1);
                                                }

                                            }).modal('show');
                                        }
                                        else if (rowdata.Diff == "T") {
                                            $('#<%=txtOrdTextLine.ClientID%>').val(rowdata.Text);
                                            $("#<%=chkTextToLab.ClientID%>").prop('checked', false);
                                            $('#modEditTextLine').modal({
                                                onDeny: function () {
                                                },
                                                onApprove: function () {
                                                    //only valid text line
                                                    if (rowdata.IdJob == "" && rowdata.Text == "") {
                                                        $('#modContact').modal({
                                                            onApprove: function () {
                                                            }
                                                        }).modal('show');
                                                    } else {
                                                        var textline = "";
                                                        textline = $('#<%=txtOrdTextLine.ClientID%>').val();
                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Text', textline);
                                                        saveJobDet(1);
                                                    }

                                                    jQuery("#dgdLabLine").jqGrid('clearGridData');
                                                    $('#<%=txtLabDesc.ClientID%>').val(rowdata.Text);
                                                    $('#<%=txtLabFord.ClientID%>').val(rowdata.Ford);
                                                    $('#<%=txtStdTime.ClientID%>').val('1,00');
                                                    $('#<%=txtLabSalesPr.ClientID%>').val($('#<%=hdnHP.ClientID%>').val());
                                                    $('#<%=txtLabDiscPer.ClientID%>').val(rowdata.Rab);
                                                    var stdTime = fnformatDecimalValue($('#<%=txtStdTime.ClientID%>').val(), seperator);
                                                    var price = fnformatDecimalValue($('#<%=txtLabSalesPr.ClientID%>').val(), seperator);
                                                    var disc = fnformatDecimalValue($('#<%=txtLabDiscPer.ClientID%>').val(), seperator);
                                                    var discAmt = (stdTime * price) * (disc * 0.01);
                                                    totLabAmt = (stdTime * price) - ((stdTime * price) * (disc * 0.01));
                                                    totLabAmt = fnreformatDecimal(totLabAmt);
                                                    $('#<%=txtLabTotalAmt.ClientID%>').val(totLabAmt);
                                                    if (rowdata.IdJob != "" || rowdata.IdJob != undefined) {
                                                        $('#<%=ddlmechList.ClientID%>').val(rowdata.IdMech);
                                                        $('#<%=txtMId.ClientID%>').val(rowdata.IdMech);
                                                        $('#<%=LblMName.ClientID%>').text(rowdata.IdJob);

                                                    }

                                                    if ($('#<%=chkTextToLab.ClientID%>').is(':checked')) {
                                                        for (var i = 0; i < 1; i++) {
                                                            jQuery("#dgdLabLine").jqGrid('addRowData', i + 1, rowdata);
                                                        }
                                                        $('#dgdLabLine').jqGrid("setCell", '1', 'Diff', 'Verksted arbied');
                                                        $('#modLabPopup').modal({
                                                            onApprove: function () {
                                                                var arrLab = new Array();
                                                                var labText = $('#<%=txtLabDesc.ClientID%>').val();
                                                                var ford = $('#<%=txtLabFord.ClientID%>').val();
                                                                var lev = $('#<%=txtStdTime.ClientID%>').val();
                                                                var pris = $('#<%=txtLabSalesPr.ClientID%>').val();
                                                                var rab = $('#<%=txtLabDiscPer.ClientID%>').val();
                                                                var belop = $('#<%=txtLabTotalAmt.ClientID%>').val();
                                                                var mid = $('#<%=txtMId.ClientID%>').val();
                                                                var mname = $('#<%=LblMName.ClientID%>').text();
                                                                if (mid == "") {
                                                                    //To check if mechanic exists for this job when there is no mechanic selected on pop-up
                                                                    var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                                    for (var k = 0; k < rowspareData.length; k++) {
                                                                        if (rowspareData[k].JobId == jobId) {
                                                                            if (rowspareData[k].IdJob.indexOf(":") > -1) {
                                                                                if (rowspareData[k].MechanicName != "" && rowspareData[k].MechanicName != null && rowspareData[k].MechanicName != undefined) {
                                                                                    mname = rowspareData[k].MechanicName.split("-");
                                                                                    mname = mname[0] + "-" + mname[1];
                                                                                    if (mname.length > 2) {
                                                                                        mid = mname[2];
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }

                                                                    if (mid == "") {
                                                                        mid = $('#<%=hdnDuser.ClientID%>').val();
                                                                        mname = "";
                                                                    }
                                                                }

                                                                var discAmt = $('#<%=txtDiscAmt.ClientID%>').val();
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'Levert', lev);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'Pris', pris);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'Rab', rab);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'Belop', belop);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'IdMech', mid);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'IdJob', mname);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'MechanicName', $("#<%=ddlmechList.ClientID%> option:selected").text());
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'IdWODetailseq', rowdata.IdWODetailseq);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'IdWOItemseq', rowdata.IdWOItemseq);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'IdWOLabSeq', rowdata.IdWOLabSeq);
                                                                $('#jobgrid').jqGrid("setCell", rowId, 'Id_Deb_Seq', rowdata.Id_Deb_Seq);

                                                                var WoNo = $('#<%=hdnWoNo.ClientID%>').val();
                                                                var WoPr = $('#<%=hdnWoPr.ClientID%>').val();
                                                                DeleteTextLine(rowdata.IdWOItemseq, WoNo, WoPr);
                                                                arrLab.push({
                                                                    id: 1,
                                                                    IdJob: rowdata.IdJob,
                                                                    Text: labText,
                                                                    Nei: fnreformatDecimal(rowdata.Nei, seperator),
                                                                    Ford: fnreformatDecimal(rowdata.Ford, seperator),
                                                                    Bestilt: fnreformatDecimal(rowdata.Bestilt, seperator),
                                                                    Levert: fnreformatDecimal(lev, seperator),
                                                                    Pris: fnreformatDecimal(pris, seperator),
                                                                    Rab: fnreformatDecimal(rab, seperator),
                                                                    Belop: fnreformatDecimal(belop, seperator),
                                                                    JobId: rowdata.JobId,
                                                                    Flag: "0",
                                                                    ForeignJob: "",
                                                                    ItemDesc: "",
                                                                    IdWODetailseq: rowdata.IdWODetailseq,
                                                                    IdWOItemseq: rowdata.IdWOItemseq,
                                                                    IdWOLabSeq: rowdata.IdWOLabSeq,
                                                                    Id_Deb_Seq: rowdata.Id_Deb_Seq,
                                                                    Jobi_Bo_Qty: rowdata.Jobi_Bo_Qty,
                                                                    Id_Make: rowdata.Id_Make,
                                                                    Sp_Cost_Price: "0",
                                                                    Diff: "L",
                                                                    Item_Avail_Qty: rowdata.Item_Avail_Qty,
                                                                    Id_Warehouse: rowdata.Id_Warehouse,
                                                                    IdMech: mid,
                                                                    MechanicName: mname

                                                                });
                                                                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                                                for (var j = 0; j < arrLab.length; j++) {
                                                                    arrayInsertAt(rowdisdata, parseInt(rowId) - 1, arrLab[j]);
                                                                }

                                                                var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                                                jQuery("#jobgrid").jqGrid('clearGridData');
                                                                for (var i = 0; i < rowGrddata.length; i++) {
                                                                    //rowGrddata[i].LineNo = rowGrddata[i].id;
                                                                    jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                                                                }

                                                                recalculateTotals();
                                                                saveJobDet(1);
                                                            }
                                                        }).modal('show');
                                                    }

                                                }
                                            }).modal('show');

                                        }//end of text line
                                        else if (rowdata.Diff == "S") {
                                            // Always single record will be selected and displayed
                                            jQuery("#dgdSpareLine").jqGrid('clearGridData');
                                            for (var i = 0; i < 1; i++) {
                                                rowdata.Diff = 'Varelinje';
                                                jQuery("#dgdSpareLine").jqGrid('addRowData', i + 1, rowdata);
                                            }
                                            var spareOrdQty = rowdata.Bestilt;//check ord qty or del qty
                                            var spareKostPris = rowdata.Sp_Cost_Price;
                                            var spareSellgPris = rowdata.Pris; //check
                                            var spareRab = rowdata.Rab;
                                            var spareBelop = rowdata.Belop;

                                            $('#<%=txtSpareId.ClientID%>').val(rowdata.IdJob);
                                            $('#<%=txtSpareDesc.ClientID%>').val(rowdata.Text);
                                            $('#<%=txtSpareFord.ClientID%>').val(rowdata.Ford);
                                            $('#<%=txtSpareOrdQty.ClientID%>').val(spareOrdQty);
                                            $('#<%=txtSpareCP.ClientID%>').val(spareKostPris);
                                            $('#<%=txtSpareSP.ClientID%>').val(spareSellgPris);
                                            $('#<%=txtSpareDisc.ClientID%>').val(spareRab);
                                            $('#<%=txtSpareAmount.ClientID%>').val(spareBelop);

                                            $('#modEditSpareLine').modal({
                                                onDeny: function () {
                                                },
                                                onApprove: function () {
                                                    //only valid text line
                                                    if (rowdata.IdJob == "" && rowdata.Text == "") {
                                                        $('#modContact').modal({
                                                            onApprove: function () {

                                                            }
                                                        }).modal('show');
                                                    } else {
                                                        // textline = $('#<%=txtOrdTextLine.ClientID%>').val();
                                                        // $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Text', textline);
                                                        // saveJobDet(1);

                                                        var rowspdata = jQuery("#dgdSpareLine").jqGrid('getRowData', 1);

                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Bestilt', rowspdata.Bestilt);
                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Levert', rowspdata.Levert);
                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Jobi_Bo_Qty', rowspdata.Jobi_Bo_Qty);
                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Sp_Cost_Price', rowspdata.Sp_Cost_Price);
                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Pris', rowspdata.Pris);
                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Rab', rowspdata.Rab);
                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Belop', rowspdata.Belop);
                                                        $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Disc_Amt', rowspdata.Disc_Amt);

                                                        recalculateTotals();
                                                        saveJobDet(1);
                                                    }
                                                }
                                            }).modal('show');
                                        }
                                    }
                                },
                                "OpenSpare": {
                                    name: "OpenSpare",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (cType == "DEL" && (rowdata.DebtType == "OHC" && rowdata.Diff == "S") ) {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var jobId = $(this)[0].cells['10'].title;
                                        var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
                                        var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (rowdata.Diff == "S") {
                                            //console.log(rowdata);
                                            var supp_currentno = rowdata.Id_Make;
                                            var id_item = rowdata.IdJob;
                                            moreInfo('../ss3/LocalSPDetail.aspx?id_make=' + supp_currentno + '&id_item=' + id_item + '&id_wh_item=' + 1 + '&pageName=frmWOJobDetails' + '&row_id=' + rowId, 'Varedetaljer');
                                            //moreInfo('../ss3/LocalSPDetail.aspx?id_make=50000&id_wh_item=1&id_item=12345&pageName=PurchaseOrder', 'Varedetaljer');
                                        }
                                    }
                                },
                                "AddRepPackage": {
                                    name: "Add Repair Package",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        if (cType == "SRCH" || cType == "SRCHSPARE" || cType == "ADDJOBSPSRCHOR" || cType == "ADDJOB" || cType == "ADD") {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        $('#<%=lblSearchResult.ClientID%>').text("");
                                        $('#divRepPack').hide();
                                        $("#txtRPCodeSearch").val("");
                                        $('#modRepairPackage').modal({
                                            onDeny: function () {
                                            },
                                            onApprove: function () {
                                                var selectedItem = lbRepPakHead.GetSelectedItems();
                                                if (selectedItem.length > 0) {
                                                    var repPackSeq = selectedItem[0].texts[0];
                                                    var repPackageId = selectedItem[0].texts[2];
                                                    FetchRepairPackageDetails(repPackSeq, repPackageId, rowId);
                                                }
                                                else {
                                                    swal("Ingen reparasjonspakke valgt");
                                                }
                                            }
                                        }).modal('show');

                                    }
                                },
                                "ReturnSpare": {
                                    name: "Return Spare",
                                    visible: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        
                                        if (cType == "DEL" && (rowdata.DebtType == "OHC" && rowdata.Diff == "S") ) {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    disabled: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        var spSuppCurrNo = rowdata.Id_Make;
                                        var currentSpareSupplier = $('#<%=hdnSupplierCurrentNo.ClientID%>').val();
                                        var orderedQuantity = parseInt(rowdata.Levert);
                                        //console.log(currentSpareSupplier + " " + spSuppCurrNo)
                                        if (spSuppCurrNo != currentSpareSupplier || orderedQuantity <= 0) {
                                            return true;
                                        }
                                        else {
                                            return false;
                                        }
                                    },
                                    callback: function (key, opt) {
                                        var rowId = opt.$trigger[0].id;
                                        var isSpare = $(this)[0].cells['12'].title;
                                        var grid = $("#jobgrid");
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        var gridrecords = $('#jobgrid').jqGrid('getGridParam', 'data');
                                        var deleteCount = gridrecords.length;
                                        var noOfLines = 0;
                                        var jobNo = $(this)[0].cells['10'].title;
                                        var ownRiskAmt = 0;
                                        var jobtotal = 0;
                                        var spSuppCurrNo = rowdata.Id_Make.trim();
                                        var currentSpareSupplier = $('#<%=hdnSupplierCurrentNo.ClientID%>').val().trim();
                                        console.log(rowdata);
                                        var orderedQuantity = parseInt(rowdata.Levert);  
                                            if (rowdata.Diff == "RAOR" || rowdata.Diff == "RBOR") {
                                                $('#<%=radInsNoReduction.ClientID%>').attr('checked', true);
                                                $('#<%=radInsReductioAfter.ClientID%>').attr('checked', false);
                                                $('#<%=radInsReductionBefore.ClientID%>').attr('checked', false);

                                            }
                                            console.log(spSuppCurrNo + "==><==" + currentSpareSupplier);
                                            if (spSuppCurrNo != currentSpareSupplier) {
                                                swal('Current Stock Supplier and supplier current no of the spare part does not match');
                                                return;
                                            }

                                            //To find the number of jobs. If there are more than one job then we shd be able to delete job1 else no
                                            for (var a = 0; a < gridrecords.length; a++) {
                                                if (((gridrecords[a].IdJob == "" || gridrecords[a].IdJob == undefined) && (gridrecords[a].Text == "" || gridrecords[a].Text == undefined))) {
                                                    noOfLines += 1;
                                                }

                                                if (gridrecords[a].Diff == "OR" && gridrecords[a].DebtType == "OHC") {
                                                    ownRiskAmt = fnformatDecimalValue(gridrecords[a].Pris, seperator);
                                                }
                                            }
                                            console.log(rowdata);
                                            if (fnformatDecimalValue(ownRiskAmt, seperator) > 0) {
                                                jobtotal = fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val(), seperator);
                                                jobtotal = (fnformatDecimalValue(jobtotal, seperator) - fnformatDecimalValue(ownRiskAmt, seperator));
                                            }

                                            if (deleteCount == 2 && noOfLines == 1) {
                                                alert("Cannot return this spare part");
                                            } else if (((rowdata.IdJob == "" || rowdata.IdJob == undefined) && (rowdata.Text == "" || rowdata.Text == undefined))) {
                                                alert("Cannot return the a blank line");
                                            } else if ((((rowdata.IdJob != "") && (rowdata.Pris == "") && (rowdata.Text == "")))) {
                                                alert("Cannot return the a blank line");
                                            } else if (fnformatDecimalValue(jobtotal, seperator) < fnformatDecimalValue(ownRiskAmt, seperator)) {
                                                alert("Cannot delete the line as the own risk amt is greater than job total");
                                            }
                                            else {
                                                grid.delRowData(rowId);

                                                //if any reduction lines exists the belop amount shd be recalculated
                                                recalculateRedLines();

                                                var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                jQuery("#jobgrid").jqGrid('clearGridData');
                                                for (var j = 0; j < rowspareData.length; j++) {
                                                    sparedata = rowspareData;
                                                    jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                                                }
                                                jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                                                $("#jobgrid").jqGrid("hideCol", "subGrid");
                                                setGridLinesColour();
                                                updateJobAfterDelete(jobNo);
                                                setGridLinesColour();
                                                recalculateTotals();
                                                var gridrecordAfterDel = $('#jobgrid').jqGrid('getGridParam', 'data');
                                                var countAfterDelete = gridrecordAfterDel.length;

                                                if (deleteCount - 1 == countAfterDelete) {
                                                    console.log("Removed Spare " + rowdata.IdJob);
                                                    SaveReturnSpares(rowdata)
                                                }

                                            }
                                        }
                                }
                            }
                        }//end of return
                    }//end of build
                });
            });


            function deleteJob(jobIdXml) {
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOHead.aspx/DeleteJob",
                    data: "{jobIdXmls: '" + jobIdXml + "'}",
                    dataType: "json",
                    success: function (data) {


                        if (data.d[0] == "DEL") {
                            if (data.d[2].toString() != "") {
                                alert(data.d[2].toString());
                                $('#<%=RTlblError.ClientID%>').text(data.d[1].toString());
                                $('#<%=RTlblError.ClientID%>').removeClass();
                                $('#<%=RTlblError.ClientID%>').addClass("lblMessage");

                            }
                            else {
                                $('#<%=RTlblError.ClientID%>').text(data.d[1].toString());
                                $('#<%=RTlblError.ClientID%>').removeClass();
                                $('#<%=RTlblError.ClientID%>').addClass("lblMessage");
                            }
                        }
                        else if (data.d[0] == "NDEL") {
                            $('#<%=RTlblError.ClientID%>').removeClass();
                            $('#<%=RTlblError.ClientID%>').addClass("lblErr");
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }
           

            function deleteJobDebitor(jobIdXml) {
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/DeleteJobDebitor",
                    data: "{jobIdXmls: '" + jobIdXml + "'}",
                    dataType: "json",
                    async: false,
                    success: function (data) {


                        if (data.d[0] == "DEL") {
                            if (data.d[2].toString() != "") {
                                alert(data.d[2].toString());
                                $('#<%=RTlblError.ClientID%>').text(data.d[1].toString());
                                $('#<%=RTlblError.ClientID%>').removeClass();
                                $('#<%=RTlblError.ClientID%>').addClass("lblMessage");

                            }
                            else {
                                $('#<%=RTlblError.ClientID%>').text(data.d[1].toString());
                                $('#<%=RTlblError.ClientID%>').removeClass();
                                $('#<%=RTlblError.ClientID%>').addClass("lblMessage");
                            }
                        }
                        else if (data.d[0] == "NDEL") {
                            $('#<%=RTlblError.ClientID%>').removeClass();
                            $('#<%=RTlblError.ClientID%>').addClass("lblErr");
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }

            function DeleteTextLine(idWoItemSeq, idWONO, idWOPrefix) {
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/DeleteTextline",
                    //data: "{'idWoItemSeq: '" + idWoItemSeq + "',idWONO: '" + idWONO + "',idWOPrefix: '" + idWOPrefix + "'}",
                    data: "{'idWoItemSeq':'" + idWoItemSeq + "',idWONO:'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "'}",
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        var d = data;
                        loadWOJobGrid(idWONO, idWOPrefix);
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }

            function isInArray(value, array) {
                return array.indexOf(value) > -1;
            }

            function fetchJobs() {
                var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
                var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
                var nextJobId;

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/AddSpareLine",
                    data: "{'idWONO':'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (data) {
                        nextJobId = data.d[0].JobId;
                    }
                });

                return nextJobId;
            }


            function Fetch_JobNo(idWONO, idWOPrefix) {
                var jobNo;
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/FetchJoBNo",
                    data: "{'idWONO':'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "',userId:'" + userId + "'}",
                    //data: {},
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        jobNo = Result.d;

                    }
                });
                return jobNo;
            }
            $('.menu .item')
               .tab()
            ; 
            function setTab(cTab) {
                var tabID = "";
                var WoNo = $('#<%=hdnWoNo.ClientID%>')[0].value;
                var WoPr = $('#<%=hdnWoPr.ClientID%>')[0].value;
                var OrderNo = $('#<%=lblOrderNo.ClientID%>').text();
                var status = $('#<%=ddlStatus.ClientID%>').val();
                tabID = $(cTab).data('tab') || cTab; // Checks if click or function call
                var tab;
                (tabID == "") ? tab = cTab : tab = tabID;
                if (tabID == "Head") {
                    if (WoNo != "") {
                        var Flag = getUrlParameter('Flag');
                        PopulateWODetails(WoNo, WoPr, Flag);
                    }

                   
                    $('#btnCatalogue').hide();
                    $('#btnHentPris').hide();
                    

                }
                if (tabID == "OrderDetails") {

                    

                    //var Hprice = LoadHourlyPrice("New");
                    //$('#<%=hdnHP.ClientID%>').val(Hprice);
                    if (OrderNo != "") {
                        UpdateOrder();
                        loadConfig($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value, userId, idMakeRP, idModelRP);
                        var Hprice = LoadHourlyPrice("New");
                        $('#<%=hdnHP.ClientID%>').val(Hprice);
                        //loadWOJobGrid($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value);
                        loadRepairCode();
                        loadWorkCode();
                        loadWOJobGrid($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value);
                        var rowChkdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                        if (rowChkdata[0].IdWODetailseq != "" || rowChkdata[0].IdWODetailseq != undefined) {
                            if ($('#<%=hdnDbtSeq.ClientID%>').val() == "" && $('#<%=hdnInsCustId.ClientID%>').val() != "") {
                                var totalGm;
                                var totalLab;
                                var totalAmt;
                                var totalVat;
                                var totGmDisc;
                                var totLabDisc;
                                var spVat;
                                var spAmt;
                                var arrInsId = new Array();
                                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                var diff="";

                                //rgba(255, 255, 153, 1)Line
                                for (i = 0; i < rowdisdata.length; i++) {
                                    $('#jobgrid').jqGrid("setCell", i, 'Nei', "0");
                                    $('#jobgrid').jqGrid("setCell", i, 'Ford', "0");

                                }

                                //To save the insurance customer first
                                saveJobDet(1);

                                if ($("#<%=radInsReductioAfter.ClientID%>").is(':checked')) {
                                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                    var rowId;
                                    var arrORisk = new Array();
                                    var redExists = false;

                                    for (var i = 0; i < rowdisdata.length; i++) {
                                        if (rowdisdata[i].DebtType == "OHC" && rowdisdata[i].JobId == "1") {
                                            rowId = rowdisdata[i].id;
                                        }

                                        if (rowdisdata[i].DebtType == "OHC" && rowdisdata[i].JobId == "1" && rowdisdata[i].Diff == "RAOR") {
                                            redExists = true;
                                        }
                                    }

                                    if (redExists == false) {
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        arrORisk.push({
                                            id: 1,
                                            IdJob: rowdata.IdJob,
                                            Text: "Reduction After Own Risk",
                                            Nei: "0",
                                            Ford: "",
                                            Bestilt: "",
                                            Levert: "",
                                            Pris: "",
                                            Rab: "",
                                            Belop: "",
                                            JobId: rowdata.JobId,
                                            Flag: "0",
                                            ForeignJob: "",
                                            ItemDesc: "",
                                            IdWODetailseq: rowdata.IdWODetailseq,
                                            IdWOItemseq: rowdata.IdWOItemseq,
                                            IdWOLabSeq: rowdata.IdWOLabSeq,
                                            Id_Deb_Seq: rowdata.Id_Deb_Seq,
                                            Jobi_Bo_Qty: rowdata.Jobi_Bo_Qty,
                                            Id_Make: rowdata.Id_Make,
                                            Sp_Cost_Price: "0",
                                            Diff: "RAOR",
                                            Item_Avail_Qty: rowdata.Item_Avail_Qty,
                                            Id_Warehouse: rowdata.Id_Warehouse,
                                            IdMech: rowdata.IdMech,
                                            MechanicName: rowdata.MechanicName,
                                            DebtType: "OHC",
                                            SpareDiscount:0
                                        });

                                        var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                        for (var j = 0; j < arrORisk.length; j++) {
                                            arrayInsertAt(rowdisdata, parseInt(rowId) - 1, arrORisk[j]);
                                        }

                                        var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                        jQuery("#jobgrid").jqGrid('clearGridData');
                                        for (var i = 0; i < rowGrddata.length; i++) {
                                            //rowGrddata[i].LineNo = rowGrddata[i].id;
                                            jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                                        }
                                    }
                                    //saveJobDet(1);
                                }


                                if ($("#<%=radInsReductionBefore.ClientID%>").is(':checked')) {
                                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                                    var rowId;
                                    var arrORisk = new Array();
                                    var redExists = false;

                                    for (var i = 0; i < rowdisdata.length; i++) {
                                        if (rowdisdata[i].DebtType == "OHC" && rowdisdata[i].JobId == "1") {
                                            rowId = rowdisdata[i].id;
                                        }

                                        if (rowdisdata[i].DebtType == "OHC" && rowdisdata[i].JobId == "1" && rowdisdata[i].Diff == "RBOR") {
                                            redExists = true;
                                        }
                                    }

                                    if (redExists == false) {
                                        var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                                        arrORisk.push({
                                            id: 1,
                                            IdJob: rowdata.IdJob,
                                            Text: "Reduction Before Own Risk",
                                            Nei: "0",
                                            Ford: "",
                                            Bestilt: "",
                                            Levert: "",
                                            Pris: "",
                                            Rab: "",
                                            Belop: "",
                                            JobId: rowdata.JobId,
                                            Flag: "0",
                                            ForeignJob: "",
                                            ItemDesc: "",
                                            IdWODetailseq: rowdata.IdWODetailseq,
                                            IdWOItemseq: rowdata.IdWOItemseq,
                                            IdWOLabSeq: rowdata.IdWOLabSeq,
                                            Id_Deb_Seq: rowdata.Id_Deb_Seq,
                                            Jobi_Bo_Qty: rowdata.Jobi_Bo_Qty,
                                            Id_Make: rowdata.Id_Make,
                                            Sp_Cost_Price: "0",
                                            Diff: "RBOR",
                                            Item_Avail_Qty: rowdata.Item_Avail_Qty,
                                            Id_Warehouse: rowdata.Id_Warehouse,
                                            IdMech: rowdata.IdMech,
                                            MechanicName: rowdata.MechanicName,
                                            DebtType: "OHC",
                                            SpareDiscount: 0
                                        });

                                        var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                        for (var j = 0; j < arrORisk.length; j++) {
                                            arrayInsertAt(rowdisdata, parseInt(rowId) - 1, arrORisk[j]);
                                        }

                                        var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                        jQuery("#jobgrid").jqGrid('clearGridData');
                                        for (var i = 0; i < rowGrddata.length; i++) {
                                            jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                                        }
                                    }
                                    //saveJobDet(1);
                                }
                                recalculateTotals();
                                setGridLinesColour();
                            }
                        }

                        //Internal Customer                        
                        if ($('#<%=hdnIntDbtSeq.ClientID%>').val() == "" && $('#<%=hdnIntCustId.ClientID%>').val() != "") {                          
                            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                            
                            //rgba(255, 255, 153, 1)Line
                            for (i = 0; i < rowdisdata.length; i++) {
                                $('#jobgrid').jqGrid("setCell", i, 'Nei', "0");
                                $('#jobgrid').jqGrid("setCell", i, 'Ford', "0");
                            }
                            saveJobDet(1);
                            recalculateTotals();
                            setGridLinesColour();
                        }                        

                        //Claim Customer
                        if ($('#<%=hdnClaimDbtSeq.ClientID%>').val() == "" && $('#<%=hdnClaimCustId.ClientID%>').val() != "") {                           
                            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');                           

                            //rgba(255, 255, 153, 1)Line
                            for (i = 0; i < rowdisdata.length; i++) {
                                $('#jobgrid').jqGrid("setCell", i, 'Nei', "0");
                                $('#jobgrid').jqGrid("setCell", i, 'Ford', "0");
                            }
                            saveJobDet(1);
                            recalculateTotals();
                            setGridLinesColour();
                        }
                        
                        //Misc
                        if ($('#<%=hdnMiscDbtSeq.ClientID%>').val() == "" && $('#<%=hdnMiscCustId.ClientID%>').val() != "") {                          
                            saveJobDet(1);
                            recalculateTotals();
                            setGridLinesColour();
                        }
                    }
                    else {
                        SaveOrder();
                        loadConfig($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value, userId, idMakeRP, idModelRP);
                        var Hprice = LoadHourlyPrice("New");
                        $('#<%=hdnHP.ClientID%>').val(Hprice);
                        //loadWOJobGrid($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value);
                        loadRepairCode();
                        loadWorkCode();
                        loadWOJobGrid($('#<%=hdnWoNo.ClientID%>')[0].value, $('#<%=hdnWoPr.ClientID%>')[0].value);
                    }
                    $('#btnCatalogue').show();
                    $('#btnHentPris').show();
                }
                else if (tabID == "Insurance") {
                    var redType = $('#<%=hdnReductionType.ClientID%>').val();
                    var ownPayVAT = $('#<%=hdnOwnPayVAT.ClientID%>').val();
                    <%--if ($('#<%=hdnIntCustId.ClientID%>').val() != "") {
                        if ($('#<%=hdnClaimCustId.ClientID%>').val() == "") {
                            $("#tabInsurance").removeClass("ui-menu-disabled");
                        }
                        else {
                            $("#tabInsurance").addClass("ui-menu-disabled");
                        }
                    }
                    else if ($('#<%=hdnClaimCustId.ClientID%>').val() != "") {
                        if ($('#<%=hdnIntCustId.ClientID%>').val() == "") {
                            $("#tabInsurance").removeClass("ui-menu-disabled");
                        }
                        else {
                            $("#tabInsurance").addClass("ui-menu-disabled");
                        }
                    }
                    else if ($('#<%=hdnIntCustId.ClientID%>').val() != "") {
                        if ($('#<%=hdnClaimCustId.ClientID%>').val() != "") {
                            $("#tabInsurance").addClass("ui-menu-disabled");
                        }
                    }
                    else if ($('#<%=hdnMiscCustId.ClientID%>').val() != "" ) {
                        $("#tabInsurance").removeClass("ui-menu-disabled");
                    }
                    else {
                        $("#tabInsurance").addClass("ui-menu-disabled");
                    }--%>

                    if ($('#<%=hdnIntCustId.ClientID%>').val() != "") {
                        $("#tabInsurance").addClass("ui-menu-disabled");
                    }
                    else if ($('#<%=hdnClaimCustId.ClientID%>').val() != "") {
                        $("#tabInsurance").addClass("ui-menu-disabled");
                    }
                    else {
                        $("#tabInsurance").removeClass("ui-menu-disabled");
                    }

                    if ($('#<%=txtInsCustID.ClientID%>').val() != "") {
                        if (redType == "RAOR") {
                            $('#<%=radInsReductioAfter.ClientID%>').attr('checked', true);
                            $('#<%=radInsReductioAfter.ClientID%>').prop("disabled", false);
                            $('#<%=radInsReductionBefore.ClientID%>').prop("disabled", true);
                        } else if (redType == "RBOR") {
                            $('#<%=radInsReductionBefore.ClientID%>').prop("disabled", false);
                            $('#<%=radInsReductionBefore.ClientID%>').attr('checked', true);
                            $('#<%=radInsReductioAfter.ClientID%>').prop("disabled", true);
                        } else {
                            $('#<%=radInsNoReduction.ClientID%>').attr('checked', true);
                            $('#<%=radInsReductioAfter.ClientID%>').prop("disabled", false);
                            $('#<%=radInsReductionBefore.ClientID%>').prop("disabled", false);
                        }
                        if (ownPayVAT.toString() == "true") {
                            $("#<%=chkInsMoveVat.ClientID%>").prop('checked', true);
                        } else {
                            $("#<%=chkInsMoveVat.ClientID%>").prop('checked', false);
                        }
                    }
                    $('#btnCatalogue').hide();
                    $('#btnHentPris').hide();
                }
                else if (tabID == "InternalDepartment") {
                    if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {
                        if ($('#<%=hdnClaimCustId.ClientID%>').val() == "") {
                            $("#tabInternalDepartment").addClass("ui-menu-disabled");
                            if ($('#<%=hdnClaimCustId.ClientID%>').val() == "") {
                                $('#<%=txtClaimSplit.ClientID%>').val('0');

                            }
                        }
                        else {
                            $("#tabInternalDepartment").removeClass("ui-menu-disabled");
                        }
                    }
                    else if ($('#<%=hdnClaimCustId.ClientID%>').val() != "") {
                        if ($('#<%=hdnInsCustId.ClientID%>').val() == "") {
                            $("#tabInternalDepartment").removeClass("ui-menu-disabled");

                            if ($('#<%=hdnIntCustId.ClientID%>').val() == "") {
                                $('#<%=txtIntSplit.ClientID%>').val('0');
                            }
                        }
                        else {
                            $("#tabInternalDepartment").removeClass("ui-menu-disabled");
                        }
                    }
                    else if ($('#<%=hdnMiscCustId.ClientID%>').val() != "") {
                        $("#tabInternalDepartment").addClass("ui-menu-disabled");
                    }
                    else {
                        $("#tabInternalDepartment").removeClass("ui-menu-disabled");
                    }
                    $('#btnCatalogue').hide();
                    $('#btnHentPris').hide();
                }
                else if (tabID == "Claim") {
                    if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {
                        if ($('#<%=hdnIntCustId.ClientID%>').val() == "") {
                            $("#tabClaim").addClass("ui-menu-disabled");
                        }
                        else {
                            $("#tabClaim").removeClass("ui-menu-disabled");
                        }
                    }
                    else if ($('#<%=hdnIntCustId.ClientID%>').val() != "") {
                        if ($('#<%=hdnInsCustId.ClientID%>').val() == "") {
                            $("#tabClaim").removeClass("ui-menu-disabled");
                            if ($('#<%=hdnClaimCustId.ClientID%>').val() == "") {
                                $('#<%=txtClaimSplit.ClientID%>').val('0');
                            }
                        }
                        else {
                            $("#tabClaim").removeClass("ui-menu-disabled");
                        }
                    }
                    else if ($('#<%=hdnMiscCustId.ClientID%>').val() != "") {
                        $("#tabClaim").addClass("ui-menu-disabled");
                    }
                    else {
                        $("#tabClaim").removeClass("ui-menu-disabled");
                    }
                    $('#btnCatalogue').hide();
                    $('#btnHentPris').hide();
                }
                else if (tabID == "Miscellaneous") {
                    if ($('#<%=hdnIntCustId.ClientID%>').val() != "") {
                        $("#tabMiscellaneous").addClass("ui-menu-disabled");
                    }
                    else if ($('#<%=hdnClaimCustId.ClientID%>').val() != "") {
                        $("#tabMiscellaneous").addClass("ui-menu-disabled");
                    }
                    else {
                        $("#tabMiscellaneous").removeClass("ui-menu-disabled");
                    }
                    $('#btnCatalogue').hide();
                    $('#btnHentPris').hide();
                }

                if (status == "INV") {
                    $("#tabMiscellaneous").addClass("ui-menu-disabled");
                    $("#tabClaim").addClass("ui-menu-disabled");
                    $("#tabInternalDepartment").addClass("ui-menu-disabled");
                    $("#tabInsurance").addClass("ui-menu-disabled");
                }

            }

            $('.cTab').on('click', function (e) {
                setTab($(this));
            });

            //Open Spare Line
            $("#dgdSpareLine").jqGrid({
                datatype: "local",
                height: 50,
                colNames: ['JobId', 'LineNo', 'LineType', 'Ford Nivå', 'Ford %', 'SpId','SpDesc','SpMake','SpOrdQty','SpDelQty','SpBOQty','SpItemAvailQty','SpCostPrice','SpSellngPrice','SpRab','SpTotAmt','IdWareHouse','Disc_Amt'],
                colModel: [
                    { name: 'JobId', index: 'JobId', width: 120 },
                    { name: 'LineNo', index: 'LineNo', width: 200 },
                    { name: 'Diff', index: 'Diff', width: 150 },
                    { name: 'Nei', index: 'Nei', width: 120 },
                    { name: 'Ford', index: 'Ford', width: 120 },
                    { name: 'IdJob', index: 'IdJob', width: 80,hidden:true },
                    { name: 'Text', index: 'Text', width: 80, hidden: true },
                    { name: 'Id_Make', index: 'Id_Make', width: 80, hidden: true },
                    { name: 'Bestilt', index: 'Bestilt', width: 80, hidden: false },
                    { name: 'Levert', index: 'Levert', width: 80, hidden: false },
                    { name: 'Jobi_Bo_Qty', index: 'Jobi_Bo_Qty', width: 80, hidden: false },
                    { name: 'Item_Avail_Qty', index: 'Item_Avail_Qty', width: 80, hidden: false },
                    { name: 'Sp_Cost_Price', index: 'Sp_Cost_Price', width: 80, hidden: false },
                    { name: 'Pris', index: 'Pris', width: 80, hidden: false },
                    { name: 'Rab', index: 'Rab', width: 80, hidden: false },
                    { name: 'Belop', index: 'Belop', width: 80, hidden: false },
                    { name: 'Id_Warehouse', index: 'Id_Warehouse', width: 80, hidden: true },
                    { name: 'Disc_Amt', index: 'Disc_Amt', width: 80, hidden: false },
                ],
                subGrid: false
            });

            $('#<%=txtSpareOrdQty.ClientID%>').change(function (e) {
                if ($('#<%=txtSpareOrdQty.ClientID%>').val() != "") {
                    var spOrdQty = fnreformatDecimal($('#<%=txtSpareOrdQty.ClientID%>').val(), seperator);
                    $('#<%=txtSpareOrdQty.ClientID%>').val(spOrdQty);
                    fnCalcSpareTotal();
                } else {
                    alert("Enter valid quantity");
                }

            });

            $('#<%=txtSpareSP.ClientID%>').change(function (e) {
                if ($('#<%=txtSpareSP.ClientID%>').val() != "") {
                    var sp = fnreformatDecimal($('#<%=txtSpareSP.ClientID%>').val(), seperator);
                    $('#<%=txtSpareSP.ClientID%>').val(sp);
                    fnCalcSpareTotal();
                } else {
                    alert("Enter valid selling price");
                }
            });

            $('#<%=txtSpareDisc.ClientID%>').change(function (e) {
                if ($('#<%=txtSpareDisc.ClientID%>').val() != "") {
                    var sp = fnreformatDecimal($('#<%=txtSpareDisc.ClientID%>').val(), seperator);
                    $('#<%=txtSpareDisc.ClientID%>').val(sp);
                    fnCalcSpareTotal();
                } else {
                    alert("Enter valid discount price");
                }
            });

            $('#<%=txtSpareCP.ClientID%>').change(function (e) {
                if ($('#<%=txtSpareCP.ClientID%>').val() != "") {
                    var cp = fnreformatDecimal($('#<%=txtSpareCP.ClientID%>').val(), seperator);
                    $('#<%=txtSpareCP.ClientID%>').val(cp);
                    fnCalcSpareTotal();
                } 
            });

            $("#dgdLabLine").jqGrid({
                datatype: "local",
                height: 50,
                colNames: ['JobId', 'LineNo', 'LineType', 'Ford NivÃ¥', 'Ford %'],
                colModel: [
                    { name: 'JobId', index: 'JobId', width: 60 },
                    { name: 'LineNo', index: 'LineNo', width: 90 },
                    { name: 'Diff', index: 'Diff', width: 150 },
                    { name: 'Nei', index: 'Nei', width: 80 },
                    { name: 'Ford', index: 'Ford', width: 80 }
                ],
                subGrid: false
            });

            $('#<%=txtStdTime.ClientID%>').change(function (e) {
                var stdTime = fnreformatDecimal($('#<%=txtStdTime.ClientID%>').val(), seperator);
                $('#<%=txtStdTime.ClientID%>').val(stdTime);
                fnCalcLabTotal();
            });

            $('#<%=txtLabSalesPr.ClientID%>').change(function (e) {
                var price = fnreformatDecimal($('#<%=txtLabSalesPr.ClientID%>').val(), seperator);
                $('#<%=txtLabSalesPr.ClientID%>').val(price);
                fnCalcLabTotal();
            });

            $('#<%=txtLabDiscPer.ClientID%>').change(function (e) {
                var discPer = fnreformatDecimal($('#<%=txtLabDiscPer.ClientID%>').val(), seperator);
                $('#<%=txtLabDiscPer.ClientID%>').val(discPer);
                fnCalcLabTotal();
            });

            $('#<%=ddlmechList.ClientID%>').change(function (e) {
                var mechName = new Array();
                var Mname;
                Mname = $("#<%=ddlmechList.ClientID%> option:selected").text();
                mechName = Mname.split("-");
                var userName = mechName[0] + "-" + mechName[1];
                var mechId = mechName[2];
                $('#<%=txtMId.ClientID%>').val(mechId);
                $('#<%=LblMName.ClientID%>').text(userName);
            });

            $(document).on('click', '#<%=chkInsMoveVat.ClientID%>', function () {
                $('#<%=chkInsMoveVat.ClientID%>').attr("checked", function () {
                    saveJobDet(1);
                    //setTab('OrderDetails');
                });
            });

            $('#<%=txtIntSplit.ClientID%>').change(function (e) {
                saveJobDet(1);
            });

            $('#<%=txtClaimSplit.ClientID%>').change(function (e) {
                saveJobDet(1);
            });

            $('#<%=txtMiscSplit.ClientID%>').change(function (e) {
                saveJobDet(1);
            });

            $(document).on('click', '#<%=chkMiscMoveOwnRisk.ClientID%>', function () {
                $('#<%=chkMiscMoveOwnRisk.ClientID%>').attr("checked", function () {
                    saveJobDet(1);
                });
            });

            $(document).on('click', '#<%=radInsReductioAfter.ClientID%>', function () {
                setTab('OrderDetails');
            });

            $(document).on('click', '#<%=radInsReductionBefore.ClientID%>', function () {
                setTab('OrderDetails');
            });

            $(document).on('click', '#<%=radInsNoReduction.ClientID%>', function () {
               // setTab('OrderDetails');
            });

            $('#<%=txtInsDiscount.ClientID%>').change(function (e) {
                saveJobDet(1);
            });

            $('#<%=txtIntDiscount.ClientID%>').change(function (e) {
                saveJobDet(1);
            });

            $('#<%=txtClaimDiscount.ClientID%>').change(function (e) {
                saveJobDet(1);
            });

            $('#<%=txtMiscDiscount.ClientID%>').change(function (e) {
                saveJobDet(1);
            });
           
            $('#<%=btnRINV.ClientID%>').on('click', function () {
                RINVRecs();
            });

            $('#btnJobCard').on('click', function () {
                jobCard();
            });
            $('#btnOffer').on('click', function (e) {
                e.preventDefault();
                if ($('#<%=txtInternalNo.ClientID%>').val() != "" && $('#<%=txtSrchCust.ClientID%>').val() != "" && $('#<%=lblOrderNo.ClientID%>').html() != "") {
                    fetchOfferAmount($('#<%=lblOrderNo.ClientID%>').html());
                    $('#modOffer')
                        .modal('show')
                        ;
                }
                else {
                    swal("Vennligst fyll inn kunde og kjøretøy og legg på linjer først.");
                }
            });

            $('#<%=ddlType.ClientID%>').change(function (e) {
                FillStatus();
            });

            $('#<%=btnPrint.ClientID%>').on('click', function () {
                //window.open("../Transactions/frmJobReports.aspx", "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                moreInfo('../Transactions/frmJobReports.aspx?pageName=JobDetails', 'Print');

            });
            $('#<%=btnNoteCustomer.ClientID%>').on('click', function () {
                overlay('on', 'modCustNotes');
            });
            $('#<%=btnCustNotesSave.ClientID%>').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modCustNotes').addClass('hidden');
                if ($('#<%=txtCustNotes.ClientID%>').val() != "") {
                    $('#<%=btnNoteCustomer.ClientID%>').addClass('warningAN');
                }
                else {
                    $('#<%=btnNoteCustomer.ClientID%>').removeClass('warningAN');
                }
            });
            $('#<%=btnCustNotesCancel.ClientID%>').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modCustNotes').addClass('hidden');
                $('#<%=txtCustNotes.ClientID%>').val('');
            });

           
            $('#<%=btnNoteVehicle.ClientID%>').on('click', function () {
                overlay('on', 'modVehNotes');
            });
            $('#<%=btnVehNotesSave.ClientID%>').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modVehNotes').addClass('hidden');
                if ($('#<%=txtVehNotes.ClientID%>').val() != "") {
                    $('#exclamIcon').show();
                }
                else {
                    $('#exclamIcon').hide();
                }
            });
            $('#<%=btnVehNotesCancel.ClientID%>').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modVehNotes').addClass('hidden');
                $('#<%=txtVehNotes.ClientID%>').val('');
            });

            $('#<%=btnNoteOrder.ClientID%>').on('click', function () {
                overlay('on', 'modOrderNotes');
            });
            $('#<%=btnOrderNotesSave.ClientID%>').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modOrderNotes').addClass('hidden');
                if ($('#<%=TxtAnnotation.ClientID%>').val() != "") {
                    $('#<%=btnNoteOrder.ClientID%>').addClass('warningAN');
                }
                else {
                    $('#<%=btnNoteOrder.ClientID%>').removeClass('warningAN');
                }
            });
            $('#<%=btnOrderNotesCancel.ClientID%>').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modOrderNotes').addClass('hidden');
                
            });

            $('#<%=btnMobilityWarranty.ClientID%>').on('click', function () {
                overlay('on', 'modMobWarranty');
            });
            $('#<%=btnMobWarrantySave.ClientID%>').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modMobWarranty').addClass('hidden');
                if ($('#<%=txtCustNotes.ClientID%>').val() != "") {
                    $('#<%=btnMobilityWarranty.ClientID%>').addClass('warningAN');
                }
                else {
                    $('#<%=btnMobilityWarranty.ClientID%>').removeClass('warningAN');
                }
            });
            $('#<%=btnMobWarrantyCancel.ClientID%>').on('click', function () {
                $('.overlayHide').removeClass('ohActive');
                $('#modMobWarranty').addClass('hidden');
                
            });
            $('#<%=btnMobWarrantyReset.ClientID%>').on('click', function () {
                $('#rbMobWarrantyViking').removeAttr('checked');
                $('#rbMobWarrantyBilXtra12').removeAttr('checked');
                $('#rbMobWarrantyBilXtra24').removeAttr('checked');
                swal('You have now reset the mobility warranty.');
            });

            $('#btnCatalogue').on('click', function () {
                $('#<%=txtOdrNoBilGlPort.ClientID%>').val("");
                popupCatalogue.Show();
            });

            $('#btnOpenCatalogue').on('click', function () {                
                var regNo = $('#<%=txtRegNo.ClientID%>').val();                           

                if (regNo != '') {
                    var apiUrl = 'http://nbk2.autodata.no/loginh.aspx?Sid=071012&USER=' + apiUserName + '&PW=' + apiPassword + '&REF=' + regNo;
                    window.open(apiUrl).focus();
                }
                else {
                    alert("Reg No is empty");
                }

            });
            $('#btnOpenAutoFrontal').on('click', function () {
                var regNo = $('#<%=txtRegNo.ClientID%>').val();

                if (regNo != '') {
                    var apiUrl = 'https://autofrontal.com/links?reg=NO:' + regNo;
                    window.open(apiUrl).focus();
                }
                else {
                    alert("Reg No is empty");
                }

            });

            $('#btnFetchFromCart').on('click', function () {
                var spareLinesCount = 0;
                var isInvalidResponse = false;
               // $(this).addClass('loading');
                LoadingPanel.Show();
                var idCustomer = $('#<%=lblCustName.ClientID%>').text();
                var vehId = $('#<%=hdnVehId.ClientID%>').val();

                $.ajax({
                    type: "POST",
                    url: "frmWOJobDetails.aspx/FetchSPFromNBKCart",                    
                    data: "{'apiUser':'" + apiUserName + "',idCustomer:'" + idCustomer + "',vehId:'" + vehId + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    //async: false, // Removed for Loading panel to work 
                    success: function (Result) {                          
                        Result = Result.d;
                        if (Result.length ==0 || Result == "") {                            
                            spareLinesCount = 0;
                        }
                        else if (Result.length > 0 && Result[0].IsValidResponse) {
                            AddNbkSpares(Result);                            
                            spareLinesCount = Result.length;
                        }
                        else {
                            isInvalidResponse = true;
                        }
                       
                        console.log("spareLinesCount "+spareLinesCount);
                    },
                    failure: function () {
                        alert("Failed!");
                    }
                });
                labourLinesCount = 0;
                textLinesCount = 0;
                $.ajax({
                    type: "POST",
                    url: "frmWOJobDetails.aspx/FetchLabourFromNBKCart",
                    data: "{'apiUser':'" + apiUserName + "',password:'" + apiPassword + "',nbkLabourPercent:'" + nbkLabPer + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    //async: false, // Removed for Loading panel to work 
                    success: function (Result) {
                        Result = Result.d;
                        if (Result.length ==0 || Result == "") {                           
                            labourLinesCount = 0;
                            textLinesCount = 0;
                        }
                        else if (Result.length > 0) {
                            AddNbkLabourLines(Result);
                        }
                        else {                            
                            isInvalidResponse = true;
                        }
                        
                        LoadingPanel.Hide();
                        popupCatalogue.Hide();
                        console.log("labourLinesCount " + labourLinesCount);
                        if (isInvalidResponse) {
                            swal("Ugyldig svar fra API");
                            return;
                        }

                        if (labourLinesCount == 0 && spareLinesCount == 0 && textLinesCount == 0) {
                            swal("Ingen reservedeler, arbeidskraft eller tekstlinjer var tilgjengelig i handlekurven");
                        }
                        else if (labourLinesCount > 0 && spareLinesCount == 0 && textLinesCount == 0) {
                            swal(labourLinesCount + " Arbeidslinjer ble lagt til");
                        }
                        else if (labourLinesCount == 0 && spareLinesCount > 0 && textLinesCount == 0) {
                            swal(spareLinesCount + " Reservedeler ble lagt til");
                        }
                        else if (labourLinesCount == 0 && spareLinesCount == 0 && textLinesCount > 0) {
                            swal(textLinesCount + " Tekstlinjer ble lagt til");
                        }
                        else if (labourLinesCount > 0 && spareLinesCount > 0 && textLinesCount == 0) {
                            swal(labourLinesCount + " Arbeidslinjene og " + spareLinesCount +" Reservedeler ble lagt til");
                        }
                        else if (labourLinesCount > 0 && spareLinesCount == 0 && textLinesCount > 0) {
                            swal(labourLinesCount + " Arbeidslinjene og " + textLinesCount + " Tekstlinjer ble lagt til");
                        }
                        else if (labourLinesCount == 0 && spareLinesCount > 0 && textLinesCount > 0) {
                            swal(spareLinesCount + " Reservedeler og " + textLinesCount + " Tekstlinjer ble lagt til");
                        }
                        else {
                            swal(spareLinesCount + " Reservedeler ," + labourLinesCount + " Arbeidslinjene og " + textLinesCount + " Tekstlinjer ble lagt til")
                        }
                    
                    },
                    failure: function () {
                        alert("Failed!");
                    }
                });                
                            
            });        

            $("#<%=btnFetchBargain.ClientID%>").on('click', function () {
                LoadingPanel.Show();
                var bargainId = $('#<%=hdnIdBargain.ClientID%>').val();
                if (bargainId == "" || bargainId == null) {
                    swal("Vennligst send tilbuds-SMS før du sjekker tilbudsstatusen"); 
                    LoadingPanel.Hide();
                    return;
                }
                //var bargainId = "4bbb0140-91e7-401c-9d32-5fcbea5b0d7f";
                
                $.ajax({
                    type: "POST",
                    url: "frmWOJobDetails.aspx/FetchBargainStatus",
                    data: "{'bargainId':'" + bargainId + "',idWONO:'" + $('#<%=hdnWoNo.ClientID%>')[0].value + "',idWOPrefix:'" + $('#<%=hdnWoPr.ClientID%>')[0].value + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    //async: false,     //Removed for Loading panel to work 
                    success: function (Result) {
                        LoadingPanel.Hide();
                        Result = Result.d;
                        console.log(Result);
                        if (Result != "") {
                            var response = JSON.parse(Result);
                            if (response.booked != null && response.status == 2) {
                                var bargTextLine = "Godkjent av kunde for beløp : " + response.amount;
                                $("#<%=btnFetchBargain.ClientID%>").attr('disabled', 'disabled');
                                popupCatalogue.Hide();
                                //We need to add Text Line
                                AddBargainTextLines(bargTextLine);
                                swal("Kuppforespørselen akseptert av kunden for beløp : " + response.amount);
                            }
                            else {
                                swal("Kuppforespørselen Avventer fra kunde.");
                            }
                        }
                        else {
                            swal("The bargain request status is unknown.");
                        }
                    },
                    failure: function () {
                        LoadingPanel.Hide();
                        alert("Failed!");
                    }
                });
            });

            function AddBargainTextLines(bargTextLine)
            {
                var barg_idwodetseq = "";
                var barg_iddebseq = "";
                var barg_idwoitemseq = "";
                var barg_Ford = "100";
                var barg_Levert = "";
                var barg_Pris = "";
                var barg_Belop, barg_Disc_Amt;
                var barg_Rab;
                var barg_makeid = "";

                var barg_rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                var barg_id_last = barg_rowdisdata.length;
                var barg_rowdata = jQuery("#jobgrid").jqGrid('getRowData', barg_id_last);
                var barg_debtType = barg_rowdata.DebtType;
                var barg_jobId = barg_rowdata.JobId;
                var barg_idMechanic = barg_rowdata.IdMech;
                var bargHPPrice = $('#<%=hdnHP.ClientID%>').val();
                var bargText = bargTextLine;
                var barglabDiff = "";
                var bargrowId = barg_id_last;

                barg_idwodetseq = barg_rowdata.IdWODetailseq;
                barg_idwoitemseq = barg_rowdata.IdWOItemseq;
                barg_iddebseq = barg_rowdata.Id_Deb_Seq;
                labDiff = "T";

                jQuery('#jobgrid').jqGrid("setCell", bargrowId, 'Pris', "");
                jQuery('#jobgrid').jqGrid("setCell", bargrowId, 'Text', bargText);
                jQuery('#jobgrid').jqGrid("setCell", bargrowId, 'Diff', labDiff);
                jQuery('#jobgrid').jqGrid("setCell", bargrowId, 'Levert', "");
                jQuery('#jobgrid').jqGrid("setCell", bargrowId, 'Rab', "");
                jQuery('#jobgrid').jqGrid("setCell", bargrowId, 'Belop', "0");
                jQuery('#jobgrid').jqGrid("setCell", bargrowId, 'IdMech', $('#<%=hdnDuser.ClientID%>').val());

                jQuery('#jobgrid').setColProp('Nei', { editable: false });
                jQuery('#jobgrid').setColProp('Ford', { editable: false });

                // To be loaded from LoadHourlyPrice
                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                for (var k = 0; k < rowdisdata.length; k++) {
                    if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {

                        if (rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                        }

                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                    }
                    if ((rowdisdata[k].IdJob == "")) {
                        jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Nei', "0");
                        if (rowdisdata[k].Diff != "RAOR" || rowdisdata[k].Diff != "RBOR") {
                            if ($('#<%=hdnInsCustId.ClientID%>').val() == "") {
                                jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Ford', "100");
                            }
                        }

                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                        cm.editable = false;
                    }
                }

                //adding new line
                var nl = {
                    id: parseInt(bargrowId) + 1,
                    IdJob: "",
                    Text: "",
                    Nei: "0",
                    Ford: "100",
                    Bestilt: "",
                    Levert: "",
                    Pris: "",
                    Rab: "",
                    Belop: "",
                    JobId: barg_jobId,
                    Flag: "0",
                    Diff: "",
                    Item_Avail_Qty: "",
                    Disc_Amt: "0",
                    ForeignJob: "",
                    ItemDesc: "",
                    IdWOLabSeq: "",
                    IdWODetailseq: barg_idwodetseq,
                    Id_Deb_Seq: barg_iddebseq,
                    Id_Make: barg_makeid,
                    IdMech: barg_idMechanic,
                    IdWOItemseq: barg_idwoitemseq,
                    DebtType: barg_debtType,
                    SpareDiscount: 0
                }

                var n_rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');

                var actualsparelength = n_rowspareData.length;
                if (bargrowId == n_rowspareData.length) {
                    n_rowspareData[parseInt(bargrowId)] = nl;
                    actualsparelength = n_rowspareData.length;
                }

                jQuery("#jobgrid").jqGrid('clearGridData');
                for (var j = 0; j < actualsparelength; j++) {
                    sparedata = n_rowspareData;
                    jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                }

                jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                $("#jobgrid").jqGrid("hideCol", "subGrid");

                //recoloring check?
                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                var hpVatPer = 0.0;
                var gmVatPer = 0.0;
                var spVatPer = 0.0;
                var hpVat = 0.0;
                var gmVat = 0.0;
                var amtS = 0.0;
                var vatAmount = 0.0;
                var amtL = 0.0;
                var discAmount = 0.0;
                var TotalGM = 0.0;
                var amtG = 0.0;
                //var jobDisc = 0.0;
                var labDisc = 0.0;
                var gmDisc = 0.0;
                var spareDisc = 0.0;

                var labVatDisc = 0.0;
                var gmVatDisc = 0.0;
                var spareVatDisc = 0.0;
                var totLabVatDisc = 0.0;
                var totGmVatDisc = 0.0;
                var totSpareVatDisc = 0.0;
                var spVat = 0.0;
                var idCust = $('#<%=lblCustName.ClientID%>').text();

                for (var k = 0; k < rowdisdata.length; k++) {

                    var vats = LoadGMHPVat(rowdisdata[k].IdJob, rowdisdata[k].Id_Make, idCust);
                    if (vats.length > 0) {
                        gmVat = fnformatDecimalValue(vats[0], seperator);
                        hpVat = fnformatDecimalValue(vats[1], seperator);
                        spVat = fnformatDecimalValue(vats[2], seperator);
                    }

                    gmVatPer = gmVat;
                    hpVatPer = hpVat;
                    spVatPer = spVat;

                    if (rowdisdata[k].Diff == "S") {
                        if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                            var boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                            if (boQty != "0") {
                                jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                    'color': 'rgba(255, 0, 0, 0.8)',
                                    'background-image': 'none'
                                });
                            }
                        }
                    }

                    if (rowdisdata[k].Flag == "1" && (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined || rowdisdata[k].DebtType == "")) {

                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                    }
                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INSC") {

                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                    }
                    else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INSC") {
                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'text-align': 'right'
                        });
                    }
                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INTC") {

                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                    }
                    else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INTC") {
                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'text-align': 'right'
                        });
                    }
                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "CLA") {

                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                    }
                    else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "CLA") {
                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'text-align': 'right'
                        });
                    }
                    else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "MISC") {

                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'font-weight': 'normal',
                            'background-image': 'none'
                        });
                    }
                    else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "MISC") {
                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'text-align': 'right'
                        });
                    }
                    else {
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                            'text-align': 'right'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                            'text-align': 'left'
                        });
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                            'text-align': 'left'
                        });
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Belop", "", 'ui-state-disabled');

                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                    }

                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC") || (rowdisdata[k].DebtType == "INTC") || (rowdisdata[k].DebtType == "CLA") || (rowdisdata[k].DebtType == "MISC")) {
                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    }
                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RAOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RAOR")) {
                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    }
                    if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RBOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RBOR")) {
                        $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    }

                    if (rowdisdata[k].Diff == "T") {
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Pris", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Rab", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                    }
                    if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {
                        if ((rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) && (rowdisdata[k].Diff == "S")) {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                        }
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                    }

                    if (rowdisdata[k].Diff == "L") {
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');

                        // var amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                        var amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                        amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                        var GM = $('#<%=txtGM.ClientID%>').val();

                        if (rowdisdata[k].ForeignJob != "FJ") {
                            amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                            TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                            //$('#<%=txtTGM.ClientID%>').val(TotalGM);
                        }

                        //Lab and GM Discount
                        if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                            labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                            gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                            labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                            totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                            gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                            totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                        }

                        hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                        gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                        hpVat = fnreformatDecimal(hpVat, seperator);
                        gmVat = fnreformatDecimal(gmVat, seperator);
                        amtL = fnreformatDecimal(amtL, seperator);
                        TotalGM = fnreformatDecimal(TotalGM, seperator);

                        $('#<%=txtTGM.ClientID%>').val(TotalGM);
                        $('#<%=txtHPVat.ClientID%>').val(hpVat);
                        $('#<%=txtGMVat.ClientID%>').val(gmVat);
                        $('#<%=txtTLab.ClientID%>').val(amtL);

                        var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                        rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);

                        var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                        rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                    }

                    if (rowdisdata[k].Diff == "S") {
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                        jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                        var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                        cm.editable = true;
                        var amount;
                        if (rowdisdata[k].Belop != undefined) {
                            amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                        } else {
                            amount = fnformatDecimalValue("", seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                        }
                        amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                        vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);
                        amtS = fnreformatDecimal(amtS, seperator);
                        vatAmount = fnreformatDecimal(vatAmount, seperator);
                        $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                        $('#<%=txtTSP.ClientID%>').val(amtS);

                        if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                            var amt;
                            var boQty;
                            if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                            } else {
                                boQty = 0;
                            }

                            if (boQty != "0") {
                                spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                            } else {
                                amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                            }
                        }
                        spareVatDisc = (amount * (spVatPer / 100)).toFixed(2);
                        totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                        var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                        rowdisdata[k].Disc_Amt = fnreformatDecimal(spchck, seperator);

                        var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                        rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);

                    }

                    if (rowdisdata[k].Disc_Amt != undefined) {
                        discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                    }

                    discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);

                }

                // need to recalculate
                recalculateTotals();

                //save TextLine to DB
                saveJobDet(1);
            }    

            function AddNbkSpares(spareList) {             
                var n_idwodetseq = "";
                var n_iddebseq = "";
                var n_idwoitemseq = "";
                var idwhitem = "";  
                var n_makeid = "";  

                var n_Ford = "100";
                var n_Bestilt = "";  
                var n_Levert = "";  
                var n_Pris = "";     
                var n_IdItem = ""; 
                var n_IdItemDesc = "";  
                var n_Sp_Cost_Price = "";  
                var n_SpareDiscount = "0";
                var n_Belop, n_Disc_Amt;
                var n_Rab = $('#<%=hdnOHCSpareDisc.ClientID%>').val();
                var n_ItemAvailQty = "";              

                for (var a = 0; a < spareList.length; a++) {
                    
                    var n_rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    var id = n_rowdisdata.length;
                    
                    var n_rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                    var n_debtType = n_rowdata.DebtType;
                    var n_jobId = n_rowdata.JobId;
                    var n_idMechanic = n_rowdata.IdMech;
                    n_idwodetseq = n_rowdata.IdWODetailseq;
                    n_idwoitemseq = n_rowdata.IdWOItemseq;
                    n_iddebseq = n_rowdata.Id_Deb_Seq;

                    idwhitem = spareList[a].Id_Wh_Item;
                    n_makeid = spareList[a].SuppCurrNo; 
                    n_Bestilt = spareList[a].Jobi_Order_Qty;
                    n_Levert = 0;  
                    n_Pris = spareList[a].Sp_Item_Price;
                    n_IdItem = spareList[a].Id_Item;
                    n_IdItemDesc = spareList[a].Item_Sp_Desc;
                    n_Sp_Cost_Price = spareList[a].Cost_Price;
                    n_ItemAvailQty = spareList[a].Item_Avail_Qty;


                    var backOrdQty = 0;
                    var spavailqty = 0;
                    var orderQty = 0;
                    var delvQty = 0;
                    var qtyDeliver = 0;
                    var Availa_Qty = 0.0;
                    var qtyDeliv = 0.0;
                    var ordType = $('#<%=ddlType.ClientID%>').val();
                    spavailqty = fnformatDecimalValue(n_ItemAvailQty, seperator);
                    orderQty = fnformatDecimalValue(n_Bestilt, seperator);
                    qtyDeliver = fnformatDecimalValue(n_Levert, seperator) + fnformatDecimalValue(qtyDeliver, seperator);

                    //alert("Levert:"+fnformatDecimalValue(n_Levert, seperator) + " :: spavailqty:" +spavailqty);

                    if (spavailqty == 0) {
                        delvQty = 0;
                        backOrdQty = orderQty;
                    }
                    else if (spavailqty >= orderQty) {
                        delvQty = orderQty;
                        backOrdQty = orderQty - delvQty;
                    }
                    else if (spavailqty < orderQty) {
                        Availa_Qty = spavailqty + qtyDeliver;
                        if ((fnformatDecimalValue(orderQty, seperator) - fnformatDecimalValue(Availa_Qty, seperator)) > 0) {
                            backOrdQty = orderQty - Availa_Qty;

                            if (ordType.toString().trim() == "KRE") {
                                backOrdQty = 0;
                            }

                            if (backOrdQty > 0) {
                                backOrdQty = backOrdQty;
                                qtyDeliv = Availa_Qty; //orderQty - Availa_Qty;
                                delvQty = qtyDeliv;
                            }
                            else {
                                backOrdQty = 0;
                                qtyDeliv = orderQty;
                                delvQty = qtyDeliv;
                            }
                        }

                        else {
                            backOrdQty = 0;
                            qtyDeliv = orderQty;
                            delvQty = qtyDeliv;
                        }

                    }

                    n_Bestilt = orderQty;
                    n_Levert = delvQty;
                    n_ItemAvailQty = spavailqty;                 
                   
                    var amt = (fnformatDecimalValue(n_Levert, seperator) * fnformatDecimalValue(n_Pris, seperator) * (fnformatDecimalValue(n_Ford, seperator) * 0.01)).toFixed(2);
                    var disc = 0.0;

                    if (n_Rab != undefined && n_Rab != "0") {
                        disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(n_Rab, seperator) / 100)).toFixed(2)
                        amt = (amt - disc).toFixed(2);
                    }

                    n_Disc_Amt = fnreformatDecimal(disc, seperator);
                    n_Belop = fnreformatDecimal(amt, seperator);

                    //adding new Spare Line
                    $("#<%=hdnIdItem.ClientID%>").val(n_IdItem);
                    $("#<%=hdnIdMake.ClientID%>").val(n_makeid);
                    jQuery("#jobgrid").setCell(id, "Nei", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(id, "Ford", "", 'not-editable-cell');
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Nei', "0");
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Ford', n_Ford);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Bestilt', n_Bestilt);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Levert', n_Levert);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Pris', n_Pris);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Text', n_IdItemDesc);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Diff', "S");
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Item_Avail_Qty', n_ItemAvailQty);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'IdJob', n_IdItem);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Make', n_makeid);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'ItemDesc', n_IdItemDesc);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Warehouse', idwhitem);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Sp_Cost_Price', n_Sp_Cost_Price);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'SpareDiscount', n_SpareDiscount);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'IdWODetailseq', n_idwodetseq);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'IdWOItemseq', n_idwoitemseq);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Deb_Seq', n_iddebseq);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'DebtType', n_debtType);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Flag', "0");
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Belop', n_Belop);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Rab', $('#<%=hdnOHCSpareDisc.ClientID%>').val().toString());
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Disc_Amt', n_Disc_Amt);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Jobi_Bo_Qty', backOrdQty);


                    //adding new line
                    var spares = {
                        id: parseInt(id) + 1,
                        IdJob: "",
                        Text: "",
                        Nei: "0",
                        Ford: "100",
                        Bestilt: "",
                        Levert: "",
                        Pris: "",
                        Rab: "",
                        Belop: "",
                        JobId: n_jobId,
                        Flag: "0",
                        Diff: "",
                        Item_Avail_Qty: "",
                        Disc_Amt: "0",
                        ForeignJob: "",
                        ItemDesc: "",
                        IdWOLabSeq: "",
                        IdWODetailseq: n_idwodetseq,
                        Id_Deb_Seq: n_iddebseq,
                        Id_Make: n_makeid,
                        IdMech: n_idMechanic,
                        IdWOItemseq: n_idwoitemseq,
                        DebtType: n_debtType,
                        SpareDiscount: 0
                    }

                    var n_rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');

                    var actualsparelength = n_rowspareData.length;
                    if (id == n_rowspareData.length) {
                        n_rowspareData[parseInt(id)] = spares;
                        actualsparelength = n_rowspareData.length;
                    }

                    jQuery("#jobgrid").jqGrid('clearGridData');
                    for (var j = 0; j < actualsparelength; j++) {
                        sparedata = n_rowspareData;
                        jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                    }
                    jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                    $("#jobgrid").jqGrid("hideCol", "subGrid");

                    // need to recalculate
                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    var hpVatPer = 0.0;
                    var gmVatPer = 0.0;
                    var spVatPer = 0.0;
                    var hpVat = 0.0;
                    var gmVat = 0.0;
                    var amtS = 0.0;
                    var vatAmount = 0.0;
                    var amtL = 0.0;
                    var discAmount = 0.0;
                    var TotalGM = 0.0;
                    var amtG = 0.0;
                    //var jobDisc = 0.0;
                    var labDisc = 0.0;
                    var gmDisc = 0.0;
                    var spareDisc = 0.0;

                    var labVatDisc = 0.0;
                    var gmVatDisc = 0.0;
                    var spareVatDisc = 0.0;
                    var totLabVatDisc = 0.0;
                    var totGmVatDisc = 0.0;
                    var totSpareVatDisc = 0.0;
                    var spVat = 0.0;
                    var idCust = $('#<%=lblCustName.ClientID%>').text();

                    for (var k = 0; k < rowdisdata.length; k++) {

                        var vats = LoadGMHPVat(rowdisdata[k].IdJob, rowdisdata[k].Id_Make, idCust);
                        if (vats.length > 0) {
                            gmVat = fnformatDecimalValue(vats[0], seperator);
                            hpVat = fnformatDecimalValue(vats[1], seperator);
                            spVat = fnformatDecimalValue(vats[2], seperator);
                        }

                        gmVatPer = gmVat;
                        hpVatPer = hpVat;
                        spVatPer = spVat;

                        if (rowdisdata[k].Diff == "S") {
                            if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                var boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                if (boQty != "0") {
                                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                        'color': 'rgba(255, 0, 0, 0.8)',
                                        'background-image': 'none'
                                    });
                                }
                            }
                        }

                        if (rowdisdata[k].Flag == "1" && (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined || rowdisdata[k].DebtType == "")) {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INSC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INSC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INTC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INTC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "CLA") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "CLA") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "MISC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "MISC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else {
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'text-align': 'left'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'text-align': 'left'
                            });
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Belop", "", 'ui-state-disabled');

                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                        }

                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC") || (rowdisdata[k].DebtType == "INTC") || (rowdisdata[k].DebtType == "CLA") || (rowdisdata[k].DebtType == "MISC")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }
                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RAOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RAOR")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }
                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RBOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RBOR")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }

                        if (rowdisdata[k].Diff == "T") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Pris", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Rab", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }
                        if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {
                            if ((rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) && (rowdisdata[k].Diff == "S")) {
                                jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                            }
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }

                        if (rowdisdata[k].Diff == "L") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');

                            // var amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                            var amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = $('#<%=txtGM.ClientID%>').val();

                            if (rowdisdata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                                //$('#<%=txtTGM.ClientID%>').val(TotalGM);
                            }

                            //Lab and GM Discount
                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                                totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                                totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                            }

                            hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                            gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                            hpVat = fnreformatDecimal(hpVat, seperator);
                            gmVat = fnreformatDecimal(gmVat, seperator);
                            amtL = fnreformatDecimal(amtL, seperator);
                            TotalGM = fnreformatDecimal(TotalGM, seperator);

                            $('#<%=txtTGM.ClientID%>').val(TotalGM);
                            $('#<%=txtHPVat.ClientID%>').val(hpVat);
                            $('#<%=txtGMVat.ClientID%>').val(gmVat);
                            $('#<%=txtTLab.ClientID%>').val(amtL);

                            var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);

                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                            rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                        }

                        if (rowdisdata[k].Diff == "S") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                            cm.editable = true;
                            var amount;
                            if (rowdisdata[k].Belop != undefined) {                                
                                amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            } else {
                                amount = fnformatDecimalValue("", seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            }
                            amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);                            
                            vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);
                            amtS = fnreformatDecimal(amtS, seperator);
                            vatAmount = fnreformatDecimal(vatAmount, seperator);
                            $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                            $('#<%=txtTSP.ClientID%>').val(amtS);

                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                var amt;
                                var boQty;
                                if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                    boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                } else {
                                    boQty = 0;
                                }

                                if (boQty != "0") {                                    
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                                } else {
                                    amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);                                    
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                                }
                            }
                            spareVatDisc = (amount * (spVatPer / 100)).toFixed(2);
                            totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                            var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            rowdisdata[k].Disc_Amt = fnreformatDecimal(spchck, seperator);

                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                            rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);

                        }

                        if (rowdisdata[k].Disc_Amt != undefined) {
                            discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                        }

                        discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);

                    }

                    if ($('#<%=txtTLab.ClientID%>').val() == "") {
                        $('#<%=txtTLab.ClientID%>').val('0');
                        $('#<%=txtTGM.ClientID%>').val('0');
                        $('#<%=txtHPVat.ClientID%>').val('0');
                        $('#<%=txtGMVat.ClientID%>').val('0');
                    }

                    if ($('#<%=txtSPVat.ClientID%>').val() == "") {
                        $('#<%=txtSPVat.ClientID%>').val('0');
                        $('#<%=txtTSP.ClientID%>').val('0');
                    }
                   
                    var total = (fnformatDecimalValue($('#<%=txtTGM.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTLab.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val(), seperator)).toFixed(2);
                    var vatTotal = (fnformatDecimalValue($('#<%=txtHPVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtGMVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val(), seperator)).toFixed(2);
                    var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                    total = fnreformatDecimal(total, seperator);
                    vatTotal = fnreformatDecimal(vatTotal, seperator);
                    TIncVat = fnreformatDecimal(TIncVat, seperator);
                    discAmount = fnreformatDecimal(discAmount, seperator);
                    $('#<%=txtNet.ClientID%>').val(total);
                    $('#<%=txtVat.ClientID%>').val(vatTotal);
                    $('#<%=txtTotal.ClientID%>').val(TIncVat);
                    $('#<%=txtDisc.ClientID%>').val(discAmount);

                    // save the line
                     saveJobDet(1);
                }
                //LoadingPanel.Hide();
            } //end of AddNbkSpares


            function AddNbkLabourLines(labourList) {//

                var nbkl_idwodetseq = "";
                var nbkl_iddebseq = "";
                var nbkl_idwoitemseq = "";
                var nbkl_Ford = "100";
                var nbkl_Levert = "";  
                var nbkl_Pris = "";
                var nbkl_Belop, nbkl_Disc_Amt;
                var nbkl_Rab;             
                var nbkl_makeid = "";

                for (var c = 0; c < labourList.length; c++) {

                    var lab_rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    var id_last = lab_rowdisdata.length;
                    var nbkl_rowdata = jQuery("#jobgrid").jqGrid('getRowData', id_last);
                    var nbkl_debtType = nbkl_rowdata.DebtType;
                    var nbkl_jobId = nbkl_rowdata.JobId;
                    var nbkl_idMechanic = nbkl_rowdata.IdMech;
                    var nHPPrice = $('#<%=hdnHP.ClientID%>').val();
                    var labText = "";
                    var labDiff = "";
                    var nbklrowId = id_last;

                    nbkl_idwodetseq = nbkl_rowdata.IdWODetailseq;
                    nbkl_idwoitemseq = nbkl_rowdata.IdWOItemseq;
                    nbkl_iddebseq = nbkl_rowdata.Id_Deb_Seq;

                    console.log(labourList[c].time + " ==> " + labourList[c].labourTime);
                    if (labourList[c].time == "0" && labourList[c].labourTime == 0) {
                        labDiff = "T";
                        textLinesCount = textLinesCount + 1;
                    } else {
                        labDiff = "L";
                        labourLinesCount = labourLinesCount + 1;
                    }


                    nbkl_Levert = labourList[c].labourTimeWithPerAdded;
                    labText = labourList[c].aw_betegnelse;                   
                    nbkl_Pris = fnformatDecimalValue(nHPPrice, seperator)


                    if (fnformatDecimalValue($('#<%=hdnOHCLabDisc.ClientID%>').val(), seperator) > 0) {
                        nbkl_Rab = $('#<%=hdnOHCLabDisc.ClientID%>').val();
                    }
                    else if (fnformatDecimalValue($('#<%=hdnOHCGenDisc.ClientID%>').val(), seperator) > 0) {
                        nbkl_Rab = $('#<%=hdnOHCGenDisc.ClientID%>').val();
                    }
                    else {
                        nbkl_Rab = "0";
                    }

                    var amt = (fnformatDecimalValue(nbkl_Levert, seperator) * fnformatDecimalValue(nbkl_Pris, seperator) * (fnformatDecimalValue(nbkl_Ford, seperator) * 0.01)).toFixed(2);
                    var disc = 0.0;

                    if (nbkl_Rab != undefined && nbkl_Rab != "0") {
                        disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(nbkl_Rab, seperator) / 100)).toFixed(2)
                        amt = (amt - disc).toFixed(2);
                    }

                    nbkl_Disc_Amt = fnreformatDecimal(disc, seperator);
                    nbkl_Belop = fnreformatDecimal(amt, seperator);


                    if (nbkl_rowdata.Diff != "S" && nbkl_rowdata.Diff != undefined) {
                        if (labDiff == "L") {
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Pris', nbkl_Pris);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Text', labText);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Diff', labDiff);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Levert', nbkl_Levert);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Rab', nbkl_Rab);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Belop', nbkl_Belop);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'IdMech', $('#<%=hdnDuser.ClientID%>').val());
                        } else if (labDiff == "T") {
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Pris', "");
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Text', labText);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Diff', labDiff);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Levert', "");
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Rab', "");
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Belop', "0");
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'IdMech', $('#<%=hdnDuser.ClientID%>').val());
                        }
                        
                    }

                    jQuery('#jobgrid').setColProp('Nei', { editable: false });
                    jQuery('#jobgrid').setColProp('Ford', { editable: false });


                    // To be loaded from LoadHourlyPrice
                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    for (var k = 0; k < rowdisdata.length; k++) {
                        if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {

                            if (rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) {
                                jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                            }

                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }
                        if ((rowdisdata[k].IdJob == "")) {
                            jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Nei', "0");
                            if (rowdisdata[k].Diff != "RAOR" || rowdisdata[k].Diff != "RBOR") {
                                if ($('#<%=hdnInsCustId.ClientID%>').val() == "") {
                                    jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Ford', "100");
                                }
                            }

                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                            cm.editable = false;
                        }
                    }



                    //adding new line
                    var spares = {
                        id: parseInt(id_last) + 1,
                        IdJob: "",
                        Text: "",
                        Nei: "0",
                        Ford: "100",
                        Bestilt: "",
                        Levert: "",
                        Pris: "",
                        Rab: "",
                        Belop: "",
                        JobId: nbkl_jobId,
                        Flag: "0",
                        Diff: "",
                        Item_Avail_Qty: "",
                        Disc_Amt: "0",
                        ForeignJob: "",
                        ItemDesc: "",
                        IdWOLabSeq: "",
                        IdWODetailseq: nbkl_idwodetseq,
                        Id_Deb_Seq: nbkl_iddebseq,
                        Id_Make: nbkl_makeid,
                        IdMech: nbkl_idMechanic,
                        IdWOItemseq: nbkl_idwoitemseq,
                        DebtType: nbkl_debtType,
                        SpareDiscount: 0
                    }

                    var n_rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');

                    var actualsparelength = n_rowspareData.length;
                    if (id_last == n_rowspareData.length) {
                        n_rowspareData[parseInt(id_last)] = spares;
                        actualsparelength = n_rowspareData.length;
                    }

                    jQuery("#jobgrid").jqGrid('clearGridData');
                    for (var j = 0; j < actualsparelength; j++) {
                        sparedata = n_rowspareData;
                        jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                    }
                    jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                    $("#jobgrid").jqGrid("hideCol", "subGrid");

                    // need to recalculate
                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    var hpVatPer = 0.0;
                    var gmVatPer = 0.0;
                    var spVatPer = 0.0;
                    var hpVat = 0.0;
                    var gmVat = 0.0;
                    var amtS = 0.0;
                    var vatAmount = 0.0;
                    var amtL = 0.0;
                    var discAmount = 0.0;
                    var TotalGM = 0.0;
                    var amtG = 0.0;
                    //var jobDisc = 0.0;
                    var labDisc = 0.0;
                    var gmDisc = 0.0;
                    var spareDisc = 0.0;

                    var labVatDisc = 0.0;
                    var gmVatDisc = 0.0;
                    var spareVatDisc = 0.0;
                    var totLabVatDisc = 0.0;
                    var totGmVatDisc = 0.0;
                    var totSpareVatDisc = 0.0;
                    var spVat = 0.0;
                    var idCust = $('#<%=lblCustName.ClientID%>').text();

                    for (var k = 0; k < rowdisdata.length; k++) {

                        var vats = LoadGMHPVat(rowdisdata[k].IdJob, rowdisdata[k].Id_Make, idCust);
                        if (vats.length > 0) {
                            gmVat = fnformatDecimalValue(vats[0], seperator);
                            hpVat = fnformatDecimalValue(vats[1], seperator);
                            spVat = fnformatDecimalValue(vats[2], seperator);
                        }

                        gmVatPer = gmVat;
                        hpVatPer = hpVat;
                        spVatPer = spVat;

                        if (rowdisdata[k].Diff == "S") {
                            if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                var boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                if (boQty != "0") {
                                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                        'color': 'rgba(255, 0, 0, 0.8)',
                                        'background-image': 'none'
                                    });
                                }
                            }
                        }

                        if (rowdisdata[k].Flag == "1" && (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined || rowdisdata[k].DebtType == "")) {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INSC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INSC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INTC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INTC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "CLA") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "CLA") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "MISC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "MISC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else {
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'text-align': 'left'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'text-align': 'left'
                            });
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Belop", "", 'ui-state-disabled');

                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                        }

                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC") || (rowdisdata[k].DebtType == "INTC") || (rowdisdata[k].DebtType == "CLA") || (rowdisdata[k].DebtType == "MISC")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }
                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RAOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RAOR")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }
                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RBOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RBOR")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }

                        if (rowdisdata[k].Diff == "T") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Pris", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Rab", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }
                        if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {
                            if ((rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) && (rowdisdata[k].Diff == "S")) {
                                jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                            }
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }

                        if (rowdisdata[k].Diff == "L") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');

                            // var amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                            var amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = $('#<%=txtGM.ClientID%>').val();

                            if (rowdisdata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                                //$('#<%=txtTGM.ClientID%>').val(TotalGM);
                            }

                            //Lab and GM Discount
                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                                totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                                totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                            }

                            hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                            gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                            hpVat = fnreformatDecimal(hpVat, seperator);
                            gmVat = fnreformatDecimal(gmVat, seperator);
                            amtL = fnreformatDecimal(amtL, seperator);
                            TotalGM = fnreformatDecimal(TotalGM, seperator);

                            $('#<%=txtTGM.ClientID%>').val(TotalGM);
                            $('#<%=txtHPVat.ClientID%>').val(hpVat);
                            $('#<%=txtGMVat.ClientID%>').val(gmVat);
                            $('#<%=txtTLab.ClientID%>').val(amtL);

                            var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);

                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                            rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                        }

                        if (rowdisdata[k].Diff == "S") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                            cm.editable = true;
                            var amount;
                            if (rowdisdata[k].Belop != undefined) {
                                amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            } else {
                                amount = fnformatDecimalValue("", seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            }
                            amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                            vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);
                            amtS = fnreformatDecimal(amtS, seperator);
                            vatAmount = fnreformatDecimal(vatAmount, seperator);
                            $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                            $('#<%=txtTSP.ClientID%>').val(amtS);

                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                var amt;
                                var boQty;
                                if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                    boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                } else {
                                    boQty = 0;
                                }

                                if (boQty != "0") {
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                                } else {
                                    amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                                }
                            }
                            spareVatDisc = (amount * (spVatPer / 100)).toFixed(2);
                            totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                            var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            rowdisdata[k].Disc_Amt = fnreformatDecimal(spchck, seperator);

                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                            rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);

                        }

                        if (rowdisdata[k].Disc_Amt != undefined) {
                            discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                        }

                        discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);

                    }

                    if ($('#<%=txtTLab.ClientID%>').val() == "") {
                        $('#<%=txtTLab.ClientID%>').val('0');
                        $('#<%=txtTGM.ClientID%>').val('0');
                        $('#<%=txtHPVat.ClientID%>').val('0');
                        $('#<%=txtGMVat.ClientID%>').val('0');
                    }

                    if ($('#<%=txtSPVat.ClientID%>').val() == "") {
                        $('#<%=txtSPVat.ClientID%>').val('0');
                        $('#<%=txtTSP.ClientID%>').val('0');
                    }

                    var total = (fnformatDecimalValue($('#<%=txtTGM.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTLab.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val(), seperator)).toFixed(2);
                    var vatTotal = (fnformatDecimalValue($('#<%=txtHPVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtGMVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val(), seperator)).toFixed(2);
                    var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                    total = fnreformatDecimal(total, seperator);
                    vatTotal = fnreformatDecimal(vatTotal, seperator);
                    TIncVat = fnreformatDecimal(TIncVat, seperator);
                    discAmount = fnreformatDecimal(discAmount, seperator);
                    $('#<%=txtNet.ClientID%>').val(total);
                    $('#<%=txtVat.ClientID%>').val(vatTotal);
                    $('#<%=txtTotal.ClientID%>').val(TIncVat);
                    $('#<%=txtDisc.ClientID%>').val(discAmount);

                    // save the line
                    saveJobDet(1);

                } //end of Labour For Loop

                                   
                LoadingPanel.Hide();
            } //end of AddNbkLabourLines

          
            function XtraSchemeSMSNew() {

                let deptId = arrayOfValues[0]

                let senderSMS = arrayOfValues[1]
                let userId = encodeURIComponent(arrayOfValues[2])
                let userPassword = encodeURIComponent(arrayOfValues[3])
              
                let smsOperatorLink = arrayOfValues[4]
                let sename = arrayOfValues[5].toString();
                let sephone = arrayOfValues[6].toString();
                let messageType = "Xtrasjekk SMS";
                let messageText = "Hei. Vi har tatt en xtrasjekk på bilen din. Se detaljer her: ";
                let s = [];
                let c = 0;
                $('.SMSXTRACHECK').each(function (i, obj) {
                    if ($(this).children(":first").hasClass("checkmark")) {

                        s[c] = i + 10; //+10 because it starts at 10 at the endpoint for some reason                        
                        c++
                    }
                });

                let cust_mob = $('#<%=txtMobNo.ClientID%>').val()

                let name = $('#<%=txtName.ClientID%>').val() +" "+ $('#<%=txtMName.ClientID%>').val() +" "+ $('#<%=txtLName.ClientID%>').val()
                name = JSON.stringify(name);
                let cust_mob_json = JSON.stringify(cust_mob);
                let orderId = $('#<%=hdnWoNo.ClientID%>').val();
                let orderId_json = JSON.stringify(orderId);
                let regid = $('#<%=txtRegNo.ClientID%>').val();
                sename = JSON.stringify(sename);
                sephone = JSON.stringify(sephone);
                regid = JSON.stringify(regid);

                console.log("Json Request for XtraScheme => "+'{"cumobile":' + cust_mob_json + ',"cuname":' + name + ',"orderid":' + orderId_json + ',"regid":' + regid + ',"result":[' + s + '],"sename":' + sename + ',"sephone":' + sephone + '}');
                const myHeaders = new Headers({
                    'Content-Type': 'application/json',
                    'Authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNzIjoiQ2Fyc1dlYiIsInVzZXJuYW1lIjoiY2FycyIsImV4cCI6MTkyMDU0OTk0NiwidHlwZSI6IkFQSSIsImlhdCI6MTYwNTAxNzE0Nn0.gUGGFxhFT4oVF_x362BRCMRhDe-q6WwhNTfvzzBqf7s'
                });

                return fetch('https://cars-web-api-production.herokuapp.com/api/v3/info/', {
                    method: 'POST',
                    headers: myHeaders,
                    body: '{"cumobile":' + cust_mob_json + ',"cuname":' + name + ',"orderid":' + orderId_json + ',"regid":' + regid + ',"result":[' + s + '],"sename":' + sename + ',"sephone":' + sephone+'}'
                })

                    .then(response => {
                        if (response.status === 200) {
                            return response.json();
                        } else {
                            throw new Error('Something went wrong on api server!');
                        }
                    })
                    .then(response => {
                        console.log(response.id);
                        //Setting up the Hidden Variable for IdXtraScheme
                        messageText += "https://carsapp.nodelab.no/info/" + response.id;
                        $('#<%=hdnIdXtraScheme.ClientID%>').val(response.id);

                        console.log("messageText => " + messageText);
                        $.ajax({
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            url: "frmWOJobDetails.aspx/SaveXtraSchemeId",
                            data: "{'idWONO':'" + $('#<%=hdnWoNo.ClientID%>').val()+ "',idWOPrefix:'" + $('#<%=hdnWoPr.ClientID%>').val() + "',idXtraScheme:'" + $('#<%=hdnIdXtraScheme.ClientID%>').val() + "'}",
                             dataType: "json",
                             success: function (data) {
                                 if (data.d.length > 0) {
                                     console.log("Sucessfully Saved XtraSchemeId");
                                 }
                             },
                             error: function (result) {
                                 alert("Error");
                             }
                         });

                        var num = cust_mob;
                        var time = "";
                        var smsid = "";
                        $.ajax({
                            type: "POST",
                            url: "../Master/frmSendSMS.aspx/SendSMS",
                            data: "{num: '" + num + "', 'message': '" + messageText + "', 'time': '" + time + "', 'id': '" + smsid + "', 'user': '" + userId + "', 'password': '" + userPassword + "', 'dru': '" + smsOperatorLink + "'}",
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            async: false,
                            success: function (data) {
                                if (data.d.length != 0) {
                                    if (data.d == "OK") {
                                        var msg = "XTRACHECK SMS"
                                        saveSMS(msg);
                                        swal("Sms er sendt til " + cust_mob + " og loggført.");
                                    }
                                    else {
                                        swal("Sms fikk følgende retursvar: " + data.d);
                                    }

                                }
                                else {
                                    alert('SMS not sent. Please try again later!')
                                }
                            },
                            failure: function () {
                                alert("Failed!");
                            },
                            select: function (e, i) {
                                //alert('hi');
                            },
                        });
                        //sendSMSGlobal(deptId, senderSMS, cust_mob, messageType, messageText, time, userId, userPassword, smsOperatorLink, response.id, orderId)
                        //console.debug(response);

                    }).catch(error => {
                        console.error(error);
                    });
            }
            $("#<%=btnFetchXtraScheme.ClientID%>").on('click', function () {
                var xtraSchemeKeyValue = {
                    "10": "Motorolje Nivå",
                    "11": "Frostvæske Nivå",
                    "12": "Frostvæske Frysepunkt",
                    "13": "Bremsevæske Nivå",
                    "14": "Batteri Nivå",
                    "15": "Vindusvisker Foran",
                    "16": "Vindusvisker Bak",
                    "17": "Lyspærer Foran",
                    "18": "Lyspærer Bak",
                    "19": "Støtdempere Foran",
                    "20": "Støtdempere Bak",
                    "21": "Dekk Foran",
                    "22": "Dekk Bak",
                    "23": "Forstilling",
                    "24": "Bakstilling",
                    "25": "Bremser Klosser foran",
                    "26": "Bremser Klosser bak",
                    "27": "Eksosanlegg",
                    "28": "Tetthet Motor",
                    "29": "Girkasse",
                    "30": "Frontrute"
                };

                LoadingPanel.Show();
                var xtraSchemeId = $('#<%=hdnIdXtraScheme.ClientID%>').val();
                if (xtraSchemeId == "" || xtraSchemeId == null) {
                    //swal("XtraScheme request is pending from Customer");
                    swal("Må sende XtraScheme SMS før du sjekker XtraScheme Status");
                    LoadingPanel.Hide();
                    return;
                }
                //var xtraschemeId = '7119b847-4ff3-4ae9-868d-054cb2f15f03';

                $.ajax({
                    type: "POST",
                    url: "frmWOJobDetails.aspx/FetchXtraSchemeStatus",
                    data: "{'xtraschemeId':'" + xtraSchemeId + "',idWONO:'" + $('#<%=hdnWoNo.ClientID%>')[0].value + "',idWOPrefix:'" + $('#<%=hdnWoPr.ClientID%>')[0].value + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    //async: false,     //Removed for Loading panel to work 
                    success: function (Result) {
                        LoadingPanel.Hide();
                        Result = Result.d;
                        console.log(Result);
                        if (Result != "") {
                            var response = JSON.parse(Result);
                            console.log(response);
                            if (response.booked != null && response.order != null) {
                                popupCatalogue.Hide();
                                var xtraschemeTextLine = "";
                                $("#<%=btnFetchXtraScheme.ClientID%>").attr('disabled', 'disabled');
                                for (var i = 0; i < response.order.length; i++) {
                                    if (response.order[i] != "" && response.order[i] != null){
                                        xtraschemeTextLine = "Akseptert : " + xtraSchemeKeyValue[response.order[i]];
                                    }
                                    AddBargainTextLines(xtraschemeTextLine);
                                }
                                swal("Lagt til tekstlinjer for XtraScheme");
                            }
                            else {
                                swal("XtraScheme-forespørsel er ennå ikke bekreftet av kunden");
                            }
                        }
                        else {
                            swal("Statusen til XtraScheme-forespørselen er ukjent.");
                        }
                    },
                    failure: function () {
                        LoadingPanel.Hide();
                        alert("Failed!");
                    }
                });
            });

                $('#btnStockQuantity').on('click', function () {
                //console.log("Checking Stock");
                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                var spareLineData = "";
                    var jsonData = [];
                    console.log(rowdisdata);
                for (var k = 0; k < rowdisdata.length; k++) {//Looping through all the spare lines in the order
                    if (rowdisdata[k].Diff == "S" && rowdisdata[k].DebtType == "OHC") {
                        //console.log(k+ " " +rowdisdata[k].IdJob);
                        spareLineData = spareLineData + rowdisdata[k].IdJob + ";";
                        var spares = {}
                        spares.id = rowdisdata[k].IdJob;
                        spares.desc = rowdisdata[k].Text;
                        spares.price = rowdisdata[k].Pris;
                        spares.bo_qty = rowdisdata[k].Jobi_Bo_Qty;
                        spares.id_wo_item_seq = rowdisdata[k].IdWOItemseq;
                        spares.bestilt = rowdisdata[k].Bestilt;
                        spares.supp_curr_no = rowdisdata[k].Id_Make;
                        spares.cost_price = rowdisdata[k].Sp_Cost_Price; // Need to check here
                        jsonData.push(spares); 
                    }
                }
                    console.log(jsonData);
                    $('#<%=hdnJobGridSparesJson.ClientID%>').val(JSON.stringify(jsonData));
                if (spareLineData != "" && spareLineData.includes(';')) {
                    <%--var suppStockId = $('#<%=hdnSupplierStockId.ClientID%>').val();
                    var dealerNoSpare = $('#<%=hdnDealerNoSpare.ClientID%>').val();--%>
                    if (supplierStockId != '' && dealerNoSpare != '') {
                        popupCatalogue.Hide();
                        popupStockQuantity.Show();
                        cbStockQuantity.PerformCallback(spareLineData);
                    }
                    else {
                        swal("Supplier Stock Id and Dealer No Spare ikke konfigurert for gjeldende Spare Supplier");
                    }
                    
                }
                else {
                    swal("Ingen reservedeler tilgjengelig i bestillingen");
                }
                
                });

            $('#btnHentPris').on('click', function () {
                LoadingPanel.Show();
                var suppStockId = $('#<%=hdnSupplierStockId.ClientID%>').val();
                var dealerNoSpare = $('#<%=hdnDealerNoSpare.ClientID%>').val();
                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                var isSaveSuccess = true;
                var spCount = 0;
                for (var k = 0; k < rowdisdata.length; k++) {
                    if (rowdisdata[k].Diff == "S" && rowdisdata[k].DebtType == "OHC") { //Looping through all the spare lines in the order
                        spCount = spCount + 1;
                        var spIdItem = rowdisdata[k].IdJob;
                        var suppCurrNo = rowdisdata[k].Id_Make;
                        var idWH = rowdisdata[k].Id_Warehouse;

                        $.ajax({
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            url: "frmWOJobDetails.aspx/GetSparePrice",
                            data: "{'spIdItem':'" + spIdItem + "',suppCurrNo:'" + suppCurrNo + "',suppStockId:'" + suppStockId + "',dealerNoSpare:'" + dealerNoSpare + "',idWH:'" + idWH + "'}",
                            dataType: "json",
                            async: false,       //Very important
                            success: function (Result) {
                                if (Result.d != null) {
                                    if (!Result.d.navnLev.includes("FEIL")) {                           
                                        isSaveSuccess = Result.d.isValid;                                        
                                        updateSPPrice(rowdisdata[k].id, Result.d.nettoLev, Result.d.bruttoLev);
                                    }
                                    else {
                                        console.log(Result.d.navnLev + " " + Result.d.spareID);
                                    }
                                }
                            },
                            error: function (result) {
                                isSaveSuccess = false;
                                LoadingPanel.Hide();
                                alert("Error");
                            }
                        });
                    }
                }
                if (spCount == 0) {
                    swal("No sparepart available in the WorkOrder");
                    LoadingPanel.Hide();
                    return;
                }

                if (isSaveSuccess) {
                    swal("Sparepart prices updated sucessfully.");
                }
                else {
                    swal("One or more spare part failed to update the prices");
                }

                LoadingPanel.Hide();
            });

            $('#btnFetchBilglassportalen').on('click', function () {
                LoadingPanel.Show();

                var bgpOrderNo = $('#<%=txtOdrNoBilGlPort.ClientID%>').val();
                var idCustomer = $('#<%=lblCustName.ClientID%>').text();
                var vehId = $('#<%=hdnVehId.ClientID%>').val();
                if (bgpOrderNo.trim() != "") {
                    $.ajax({
                        type: "POST",
                        url: "frmWOJobDetails.aspx/FetchBilglassportalen",
                        data: "{'bgpOrderNo':'" + bgpOrderNo + "',idCustomer:'" + idCustomer + "',vehicleID:'" + vehId + "'}",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        //async: false, // Removed for Loading panel to work 
                        success: function (Result) {
                            var spareLinesCount = 0;
                            Result = Result.d;
                            console.log(Result);
                            if (Result.length == 0 || Result == "") {
                                swal("Result not found");
                            }
                            else if (Result.length > 0 && Result[0].IsValidResponse) {
                                AddNbkSpares(Result);
                                spareLinesCount = Result.length;
                            }
                            LoadingPanel.Hide();
                            popupCatalogue.Hide();
                            swal(spareLinesCount.toString() + " spares were added for order " + bgpOrderNo);
                            
                        },
                        failure: function () {
                            alert("Failed!");
                        }
                    });
                }
                else {
                    swal("Please enter order no.(Bilglassportalen)");
                    LoadingPanel.Hide();
                }
            });

        });//end of ready

        function SendPurchase() {
             var isValidSpareSupplier = true;
            var currentSpareSupplier = $('#<%=hdnSupplierCurrentNo.ClientID%>').val();
            var woSpareLinesJson = JSON.parse($('#<%=hdnJobGridSparesJson.ClientID%>').val());
            //console.log("-> " + $('#<%=hdnSupplierCurrentNo.ClientID%>').val());
            var selectedSpares = gvStockQty.GetSelectedKeysOnPage();
            if (selectedSpares.length > 0) {
            for (var i = 0; i < woSpareLinesJson.length; i++) {
                if (woSpareLinesJson[i].supp_curr_no != currentSpareSupplier && selectedSpares.includes(woSpareLinesJson[i].id)) {
                    isValidSpareSupplier = false;
                }
            }
            if (gvStockQty.batchEditApi.HasChanges()) {
                gvStockQty.UpdateEdit();
            }

            if (isValidSpareSupplier) {
               cbSendPurchase.PerformCallback($('#<%=lblOrderNo.ClientID%>').html());
            }
            else {
                swal("Konfigurert lager leverandør og leverandøren av reservedelen som er valgt samsvarer ikke");
                }
            }
            else {
                swal("Velg eventuelle reservedeler på rutenettet for å sende kjøp");
            }
        }

        function dxInvoicebasis() {
            var idWoNo = $('#<%=hdnWoNo.ClientID%>')[0].value;
            var idWoPr = $('#<%=hdnWoPr.ClientID%>')[0].value;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/InvoiceBasis",
                data: "{'idWoNo':'" + idWoNo + "',idWoPr:'" + idWoPr + "'}",
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    if (Result.d.length > 0) {
                        cbPanel.PerformCallback();
                        //$('#<%=hdnInvoiceType.ClientID%>').val("InvoiceBasis");
                       // window.open("../Reports/frmShowReports.aspx?ReportHeader='Invoice Basis' &InvoiceType=INVOICEBASIS &Rpt=INVOICEPRINT &scrid='1'", "info6", "resizable=yes,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                    }
                }
            });

        }
        function dxInvoice() {
            var idWoNo = $('#<%=hdnWoNo.ClientID%>')[0].value;
            var idWoPr = $('#<%=hdnWoPr.ClientID%>')[0].value;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/Invoice",
                data: "{'idWoNo':'" + idWoNo + "',idWoPr:'" + idWoPr + "'}",
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    console.log(Result.d);
                    if (Result.d.length > 0) {
                        if (Result.d[0] == "SUCCESS") {
                            $('#<%=hdnInvoiceType.ClientID%>').val("Invoice");
                            PopulateWODetails(idWoNo, idWoPr, '');
                            //need to disable the save,upd,invoice buttons
                            $("#<%=btnInvoice.ClientID%>").attr('disabled', 'disabled');
                            $("#<%=btnRINV.ClientID%>").attr('disabled', 'disabled');

                            $("#<%=btnSave.ClientID%>").attr('disabled', 'disabled');

                            $("#<%=btnPickingList.ClientID%>").attr('disabled', 'disabled');
                            $("#<%=btnDeliveryNote.ClientID%>").attr('disabled', 'disabled');
                            $("#<%=btnOrderList.ClientID%>").attr('disabled', 'disabled');

                            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                            for (var k = 0; k < rowdisdata.length; k++) {
                                $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            }
                            cbPanel.PerformCallback();
                        }
                        
                    }
                }
            });

        }
        function saveSparePartDet(rowId, beholdning, Pris, Rab,spcostprice) {
            console.log(rowId + " beholdning:" + beholdning + " Pris:" + Pris + " Rab:" + Rab+ " spcostprice:" + spcostprice);
            var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);           
            $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Pris', Pris);
            $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Sp_Cost_Price', spcostprice);
           // $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Rab', Rab); 

            //$('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Jobi_Bo_Qty', Jobi_Bo_Qty);
            //$('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Sp_Cost_Price', Sp_Cost_Price);
            //$('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Disc_Amt', Disc_Amt);

            recalculateTotals();
            saveJobDet(1);
        }
        function IntCustMoreInfo() {
            if ($('#<%=txtIntCustID.ClientID%>').val().length > 0) {
                var custId = $('#<%=txtIntCustID.ClientID%>').val();
                window.open("../Master/frmCustomerDetail.aspx?cust=" + custId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
            }
            else {
                alert('No customer is selected. Please choose a customer first!');
            }
        }

        function InscCustMoreInfo() {
            if ($('#<%=txtInsCustID.ClientID%>').val().length > 0) {
                var custId = $('#<%=txtInsCustID.ClientID%>').val();
                window.open("../Master/frmCustomerDetail.aspx?cust=" + custId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
            }
            else {
                alert('No customer is selected. Please choose a customer first!');
            }
        }

        function ClaCustMoreInfo() {
            if ($('#<%=txtClaimCustID.ClientID%>').val().length > 0) {
                var custId = $('#<%=txtClaimCustID.ClientID%>').val();
                window.open("../Master/frmCustomerDetail.aspx?cust=" + custId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
            }
            else {
                alert('No customer is selected. Please choose a customer first!');
            }
        }

        function MiscCustMoreInfo() {
            if ($('#<%=txtMiscCustID.ClientID%>').val().length > 0) {
                var custId = $('#<%=txtMiscCustID.ClientID%>').val();
                window.open("../Master/frmCustomerDetail.aspx?cust=" + custId, "info6", "resizable=no,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
            }
            else {
                alert('No customer is selected. Please choose a customer first!');
            }
        }

        function fnCalcSpareTotal() {
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var totSpareAmt = 0.0;
            var chkdata = jQuery("#jobgrid").jqGrid('getRowData', id);
            var backOrdQty = 0;
            var spavailqty = 0;
            var orderQty = 0;
            var delvQty = 0;
            var qtyDeliver = 0;
            var Availa_Qty = 0.0;
            var qtyDeliv = 0.0;
            var ordType = $('#<%=ddlType.ClientID%>').val();
            spavailqty = fnformatDecimalValue(chkdata.Item_Avail_Qty, seperator);
            orderQty = fnformatDecimalValue(e.target.value, seperator);
            qtyDeliver = fnformatDecimalValue(chkdata.Levert, seperator) + fnformatDecimalValue(qtyDeliver, seperator);


            if (spavailqty == 0) {
                delvQty = 0;
                backOrdQty = orderQty;
            }
            else if (spavailqty >= orderQty) {
                delvQty = orderQty;
                backOrdQty = orderQty - delvQty;
            }
            else if (spavailqty < orderQty) {
                Availa_Qty = spavailqty + qtyDeliver;
                if ((fnformatDecimalValue(orderQty, seperator) - fnformatDecimalValue(Availa_Qty, seperator)) > 0) {
                    backOrdQty = orderQty - Availa_Qty;

                    if (ordType.toString().trim() == "KRE") {
                        backOrdQty = 0;
                    }

                    if (backOrdQty > 0) {
                        backOrdQty = backOrdQty;
                        qtyDeliv = orderQty - Availa_Qty;
                        delvQty = qtyDeliv;
                    }
                    else {
                        backOrdQty = 0;
                        qtyDeliv = orderQty;
                        delvQty = qtyDeliv;
                    }
                }
                else {
                    backOrdQty = 0;
                    qtyDeliv = orderQty;
                    delvQty = qtyDeliv;
                }
            }

            orderQty = fnreformatDecimal(orderQty, seperator);
            delvQty = fnreformatDecimal(delvQty, seperator);
            backOrdQty = fnreformatDecimal(backOrdQty, seperator);

            var amt = (fnformatDecimalValue(delvQty, seperator) * fnformatDecimalValue($('#<%=txtSpareSP.ClientID%>').val(), seperator)).toFixed(2);
            var disc = 0.0;
            //rowspareData[k].Belop = fnreformatDecimal(amt, seperator);

            if ($('#<%=txtSpareDisc.ClientID%>').val() != undefined && $('#<%=txtSpareDisc.ClientID%>').val() != "0") {
                disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue($('#<%=txtSpareDisc.ClientID%>').val(), seperator) / 100)).toFixed(2)
                amt = (amt - disc).toFixed(2);
            }
            disc = fnreformatDecimal(disc, seperator);
            amt = fnreformatDecimal(amt, seperator);

            $('#<%=txtSpareAmount.ClientID%>').val(amt);

            jQuery('#dgdSpareLine').jqGrid("setCell", 1, 'Bestilt', orderQty);
            jQuery('#dgdSpareLine').jqGrid("setCell", 1, 'Levert', delvQty);
            jQuery('#dgdSpareLine').jqGrid("setCell", 1, 'Jobi_Bo_Qty', backOrdQty);
            jQuery('#dgdSpareLine').jqGrid("setCell", 1, 'Rab', $('#<%=txtSpareDisc.ClientID%>').val());
            jQuery('#dgdSpareLine').jqGrid("setCell", 1, 'Disc_Amt', disc);
            jQuery('#dgdSpareLine').jqGrid("setCell", 1, 'Pris', $('#<%=txtSpareSP.ClientID%>').val());
            jQuery('#dgdSpareLine').jqGrid("setCell", 1, 'Belop', amt);
            if ($('#<%=txtSpareCP.ClientID%>').val() != "") {
                jQuery('#dgdSpareLine').jqGrid("setCell", 1, 'Sp_Cost_Price', $('#<%=txtSpareCP.ClientID%>').val());
            }
            
        }

        //Head
        function validateVeh(VehicleId) {
            var strRetVal;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOHead.aspx/ValidateVehicle",
                data: "{IdVehicle: '" + VehicleId + "'}",
                dataType: "json",
                async: false,
                success: function (data) {
                    strRetVal = data.d.toString()

                },
                error: function (result) {
                    alert("Error");
                }
            });
            return strRetVal;
        }


       
        function validateCust(CustomerId) {
            var strRetVal;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOHead.aspx/ValidateCustomer",
                data: "{IdCustomer: '" + CustomerId + "'}",
                dataType: "json",
                async: false,
                success: function (data) {
                    strRetVal = data.d.toString()

                },
                error: function (result) {
                    alert("Error");
                }
            });
            return strRetVal;
        }


      

        function FillPayDet(IdCustGrp) {

            var IdCustomer = $('#<%=txtSrchCust.ClientID%>').val();

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOHead.aspx/FillPaymentDet",
                data: "{IdCustGrp: '" + IdCustGrp + "'}",
                dataType: "json",
                success: function (data) {
                    if (data.d.length > 0) {
                        var cashPayType = data.d[0].Pay_Type.toString();
                        if (cashPayType == "Cash") {
                            var msg = GetMultiMessage('WOCASH_PAY', '', '');
                            alert(msg);
                            FillCustDet(IdCustomer);
                        }
                        if (data.d[0].ErrorMessage != "") {
                            alert(data.d[0].ErrorMessage);
                            FillCustDet(IdCustomer);
                        }
                        else {
                            if (data.d[0].Pay_Type == 0) {
                                $('#<%=ddlPayType.ClientID%>')[0].selectedIndex = 0;
                            }
                            else {
                                //$('#<%=ddlPayType.ClientID%>').val(data.d[0].Pay_Type);
                                $('#<%=ddlPayType.ClientID%> option:contains("' + data.d[0].Pay_Type + '")').attr('selected', 'selected');
                                $("#<%=ddlPayType.ClientID%>").attr('disabled', 'disabled');
                            }

                            if (data.d[0].Pay_Term == 0) {
                                $('#<%=ddlPayTerms.ClientID%>')[0].selectedIndex = 0;
                            }
                            else {
                                //$('#<%=ddlPayTerms.ClientID%>').val(data.d[0].Pay_Term);
                                $('#<%=ddlPayTerms.ClientID%> option:contains("' + data.d[0].Pay_Term + '")').attr('selected', 'selected');
                                $("#<%=ddlPayTerms.ClientID%>").attr('disabled', 'disabled');
                            }
                        }
                    }
                },
                error: function (result) {
                    alert("Error");
                }
            });
        }


        function FillVehDrpDwn(CustID) {
            <%-- $('#<%=ddlVeh.ClientID%>').show();--%>
            $('#<%=lst_veh.ClientID%>').show();
            $('#<%=txtSrchVeh.ClientID%>').hide();
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadVehDrpdwn",
                data: "{'IdCustomer':'" + CustID + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    Result = Result.d;
                    if (Result.length != 0) {
                        $('#<%=lst_veh.ClientID%>').empty();
                        if (Result[0].ErrorMessage != "" && $('#<%=txtRegNo.ClientID%>').val() != "") {
                            
                            $('#mceMSG').html('Do you want to change the owner of the car?')
                            $('#modVehicleChange').modal('setting', {
                                autofocus: false,
                                onShow: function () {
                                },
                                onDeny: function () {
                                    // $('.overlayHide').addClass('ohActive');
                                    $('#ctl00_cntMainPanel_lst_veh').hide();
                                    $('#ctl00_cntMainPanel_txtSrchVeh').show();
                                    LoadNonInvoiceOrderDet($('#<%=txtSrchCust.ClientID%>').val());
                                },
                                onApprove: function () {
                                    $('#ctl00_cntMainPanel_lst_veh').hide();
                                    $('#ctl00_cntMainPanel_txtSrchVeh').show();
                                    var VehicleId = $('#<%=txtSrchVeh.ClientID%>').val();
                                    var CustomerId = $('#<%=txtSrchCust.ClientID%>').val();
                                    updateVehicle(VehicleId, CustomerId);
                                    LoadNonInvoiceOrderDet(CustomerId);

                                }
                            }).modal('show');
                        }
                        else {
                            
                            $('#ctl00_cntMainPanel_lst_veh').show();
                            $.each(Result, function (key, value) {
                                $('#ctl00_cntMainPanel_lst_veh').append($("<option></option>").val(value.Id_Veh_Seq_WO).html(value.Veh_Det));
                            });
                            LoadNonInvoiceOrderDet($('#<%=txtSrchCust.ClientID%>').val());
                        }
                    }
                    else {
                        $('#<%=lst_veh.ClientID%>').hide();
                        $('#<%=txtSrchVeh.ClientID%>').show();
                    }
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FillType() {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadOrdTypes",
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    $('#<%=ddlType.ClientID%>').empty();
                    $('#<%=ddlType.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");

                    Result = Result.d;
                    $.each(Result, function (key, value) {
                        $('#<%=ddlType.ClientID%>').append($("<option></option>").val(value.Id_Settings).html(value.Description));
                        $('#<%=ddlType.ClientID%>')[0].selectedIndex = 4;
                    });
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FillStatus() {
            //debugger;
            var ordType = $('#<%=ddlType.ClientID%>').val();
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/FillOrdStatus",
                data: "{'ordType':'" + ordType + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    //debugger;
                    $('#<%=ddlStatus.ClientID%>').empty();
                    $('#<%=ddlStatus.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    Result = Result.d;
                    var ordType = $('#<%=ddlType.ClientID%>').val();
                    $.each(Result, function (key, value) {                        
                        if (ordType == "ORD") {
                            if ((value.Id_Settings == "CSA") || (value.Id_Settings == "JST") || (value.Id_Settings == "RES")) {
                                $('#<%=ddlStatus.ClientID%>').append($("<option></option>").val(value.Id_Settings).html(value.Description));
                            }
                        }
                        if (ordType == "CRSL") {
                            if ((value.Id_Settings == "STR")) {
                                $('#<%=ddlStatus.ClientID%>').append($("<option></option>").val(value.Id_Settings).html(value.Description));
                            }
                        }
                        if (ordType == "KRE") {
                            if ((value.Id_Settings == "CSA") || (value.Id_Settings == "JST") || (value.Id_Settings == "RES")) {
                                $('#<%=ddlStatus.ClientID%>').append($("<option></option>").val(value.Id_Settings).html(value.Description));
                            }
                        }
                    });

                    if (Result[0].Tmp_Id_Settings != "") {
                        $('#<%=ddlStatus.ClientID%>').val(Result[0].Tmp_Id_Settings);
                    }
                    if (Result[0].UserName != null && Result[0].UserName != '' && Result[0].Password != null && Result[0].Password != '') {
                        apiUserName = Result[0].UserName;
                        apiPassword = Result[0].Password;
                        //alert(apiUserName + " " + apiPassword);
                    }
                    if (Result[0].NBKLabourPercentage != null ) {
                        nbkLabPer = Result[0].NBKLabourPercentage;
                    }
                    if (Result[0].SUPPLIER_STOCK_ID != null) {
                        supplierStockId = Result[0].SUPPLIER_STOCK_ID;
                        $('#<%=hdnSupplierStockId.ClientID%>').val(supplierStockId);
                    }
                    if (Result[0].DEALER_NO_SPARE != null) {
                        dealerNoSpare = Result[0].DEALER_NO_SPARE;
                        $('#<%=hdnDealerNoSpare.ClientID%>').val(dealerNoSpare);
                    }
                    console.log(supplierStockId + " " + dealerNoSpare);
                    if (Result[0].ID_DEPT_WO != null) {
                        $('#<%=hdnIdDeptWo.ClientID%>').val(Result[0].ID_DEPT_WO);
                    }
                    if (Result[0].SUPPLIER_CURR_NO != null) {
                        $('#<%=hdnSupplierCurrentNo.ClientID%>').val(Result[0].SUPPLIER_CURR_NO);
                    }
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FillOrderStatus(ordType) {

            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadOrdStatus",
                data: "{'OrderType':'" + ordType + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    $('#<%=ddlStatus.ClientID%>').empty();
                    $('#<%=ddlStatus.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    Result = Result.d;
                    $.each(Result, function (key, value) {
                        $('#<%=ddlStatus.ClientID%>').append($("<option></option>").val(value.Id_Settings).html(value.Description));
                    });
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }
        function fillOrderSpareStatus() {
            $.ajax({
                type: "POST",
                url: "frmWOJobDetails.aspx/LoadOrderSpareStatus",
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    $('#<%=ddlSpareStatus.ClientID%>').empty();
                        $('#<%=ddlSpareStatus.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                        Result = Result.d;

                        $.each(Result, function (key, value) {
                            $('#<%=ddlSpareStatus.ClientID%>').append($("<option></option>").val(value.SpareStatusNo).html(value.SpareStatus));

                        });

                    },
                    failure: function () {
                        alert("Failed!");
                    }
                });
        }

        function FillPayType() {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadPayTypes",
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    $('#<%=ddlPayType.ClientID%>').empty();
                    $('#<%=ddlPayType.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    Result = Result.d;
                    $.each(Result, function (key, value) {
                        $('#<%=ddlPayType.ClientID%>').append($("<option></option>").val(value.Id_Settings).html(value.Description));
                        $("#<%=ddlPayType.ClientID%>").attr('disabled', 'disabled');
                    });

                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FillPayTerms() {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadPayTerms",
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    $('#<%=ddlPayTerms.ClientID%>').empty();
                    $('#<%=ddlPayTerms.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    Result = Result.d;
                    $.each(Result, function (key, value) {
                        $('#<%=ddlPayTerms.ClientID%>').append($("<option></option>").val(value.Id_Settings).html(value.Description));
                        $("#<%=ddlPayTerms.ClientID%>").attr('disabled', 'disabled');
                    });

                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FillCustGroup() {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadCustGroup",
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    Result = Result.d;
                    $('#<%=ddlCusGroup.ClientID%>').empty();
                    $('#<%=ddlCusGroup.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    $.each(Result, function (key, value) {
                        $('#<%=ddlCusGroup.ClientID%>').append($("<option></option>").val(value.Id_Cust_Group_Seq).html(value.Cust_Group));

                    });

                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FillMake() {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadVehMake",
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    Result = Result.d;
                    $('#<%=ddlMake.ClientID%>').empty();
                    $('#<%=ddlMake.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    $.each(Result, function (key, value) {
                        $('#<%=ddlMake.ClientID%>').append($("<option></option>").val(value.Id_Make).html(value.Veh_Make));
                    });
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

    <%--    function FillNewModel() {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadModel",
                data: '{}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    Result = Result.d;
                    $('#<%=ddlModel.ClientID%>').empty();
                    $('#<%=ddlModel.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    $.each(Result, function (key, value) {
                        $('#<%=ddlModel.ClientID%>').append($("<option></option>").val(value.Id_Model).html(value.Model_Desc));
                    });
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }--%>


      <%--  function FillModel(IdMake) {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadVehModel",
                data: "{'IdMake':'" + IdMake + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    $('#<%=ddlModel.ClientID%>').empty();
                    $('#<%=ddlModel.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    Result = Result.d;
                    $.each(Result, function (key, value) {
                        $('#<%=ddlModel.ClientID%>').append($("<option></option>").val(value.Model_Desc).html(value.Id_Model));
                    });
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }--%>

        function LoadNonInvoiceOrderDet(custId) {
            var userId = '<%= Session("UserID")%>';
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "NonInvoiceOrder.aspx/LoadNonInvoiceOrderDet",
                data: "{'idCust':'" + custId + "',idUser:'" + userId + "'}",
                //data: {},
                dataType: "json",
                async: false,//Very important
                success: function (data) {
                    if (data.d.length != 0) {
                        window.open("NonInvoiceOrder.aspx", 'info6', "resizable=no,scrollbars=1,status=yes,width=500px,height=300px,menubar=0,toolbar=0");
                    }
                }
            });
        }

        function PopulateWODetails(WoNo, WoPr, Flag) {
            //debugger;
            if (Flag != "update") {
                $('#<%=RTlblError.ClientID%>').text("");
            }
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/FetchWODetails",
                data: "{'WoNo':'" + WoNo + "','WoPr':'" + WoPr + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (data) {
                    FillOrderStatus(data.d[0].WO_Type);
                    if (data.d[0].WO_Type == 0) {
                        $('#<%=ddlType.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlType.ClientID%>').val(data.d[0].WO_Type);
                    }

                    if (data.d[0].WO_Status == 0) {
                        $('#<%=ddlStatus.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlStatus.ClientID%>').val(data.d[0].WO_Status);
                    }
                    $("#<%=ddlStatus.ClientID%>").attr('disabled', 'disabled');

                    if (data.d[0].IdSpareStatus == 0) {
                        $('#<%=ddlSpareStatus.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlSpareStatus.ClientID%>').val(data.d[0].IdSpareStatus);
                    }
                    if (data.d[0].Veh_Make == 0) {
                        $('#<%=ddlMake.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlMake.ClientID%> option:contains("' + data.d[0].Veh_Make + '")').attr('selected', 'selected');
                        <%--  $('#<%=ddlMake.ClientID%>').val(data.d[0].Veh_Make);--%>
                    }

                    //FillModel(data.d[0].Veh_Make);

                   <%-- if (data.d[0].Id_Model == "") {
                        $('#<%=ddlModel.ClientID%>')[0].selectedIndex = 0;
                    }--%>
                  <%--  else {
                        //$('#<%=ddlModel.ClientID%> option:contains("' + data.d[0].Id_Model + '")').attr('selected', 'selected');
                     $('#<%=ddlModel.ClientID%>').val(data.d[0].Id_Model);
                    }--%>
                    $('#<%=txtSrchCust.ClientID%>').val(data.d[0].Id_Cust_Wo);
                    $('#<%=lblCustName.ClientID%>').text(data.d[0].Id_Cust_Wo);

                    if ($('#<%=txtName.ClientID%>').val().trim() == "") {
                        $('#<%=txtName.ClientID%>').val(data.d[0].WO_Cust_Name);
                    }                    
                    
                    $('#<%=txtAddress1.ClientID%>').val(data.d[0].WO_Cust_Add1);
                    $('#<%=txtAddress2.ClientID%>').val(data.d[0].Cust_Perm_Add2);
                    $('#<%=txtZipCode.ClientID%>').val(data.d[0].Id_Zipcode_WO);
                    $('#<%=txtState.ClientID%>').val(data.d[0].City);
                    $('#<%=txtEniroId.ClientID%>').val(data.d[0].ENIROID);
                    $('#<%=txtMobNo.ClientID%>').val(data.d[0].WO_Cust_Phone_Mobile);
                    $('#<%=txtDeliveryTime.ClientID%>').val(data.d[0].WO_Tm_Deliv);
                    $('#<%=txtFinishDate.ClientID%>').val(data.d[0].Dt_Finish);
                    $('#<%=txtDeliveryDate.ClientID%>').val(data.d[0].Dt_Delivery);
                    <%--$('#<%=txtContact.ClientID%>').val(data.d[0].Cust_ContactPerson);
                    $('#<%=txtContactTitle.ClientID%>').val(data.d[0].Cust_ContactTitle);--%>

                    $('#<%=txtSrchVeh.ClientID%>').val(data.d[0].Id_Veh_Seq_WO);
                    $('#<%=hdnVehId.ClientID%>').val(data.d[0].Id_Veh_Seq_WO);
                    $('#<%=txtRegNo.ClientID%>').val(data.d[0].WO_Veh_Reg_NO);
                    $('#<%=lblRegistation.ClientID%>').html(data.d[0].WO_Veh_Reg_NO);
                    $('#<%=txtInternalNo.ClientID%>').val(data.d[0].Veh_Int_No);
                    $('#<%=txtVIN.ClientID%>').val(data.d[0].WO_Veh_Vin);
                    $('#<%=txtMileage.ClientID%>').val(data.d[0].WO_Veh_Mileage);
                    $('#<%=txtHours.ClientID%>').val(data.d[0].WO_Veh_Hrs);
                    $('#<%=txtbxModel.ClientID%>').val(data.d[0].Veh_Type);
                    $('#<%=txtColor.ClientID%>').val(data.d[0].VehColor);
                    $('#<%=txtCostPrice.ClientID%>').val(data.d[0].VA_Cost_Price);
                    $('#<%=txtSellPrice.ClientID%>').val(data.d[0].VA_Sell_Price);
                    $('#<%=txtVANum.ClientID%>').val(data.d[0].Van_Num)
                    $('#<%=txtDeptAccntNum.ClientID%>').val(data.d[0].La_Dept_Account_No);
                    $('#<%=txtRefWoNo.ClientID%>').val(data.d[0].Ref_Wo_No);
                    $('#<%=TxtAnnotation.ClientID%>').val(data.d[0].WO_Annot);
                    if ($('#<%=TxtAnnotation.ClientID%>').val() != "") {
                        $('#<%=btnNoteCustomer.ClientID%>').addClass('warningAN');
                    }
                    else {
                        $('#<%=btnNoteCustomer.ClientID%>').removeClass('warningAN');
                    }


                    if(data.d[0].Id_Pay_Type_WO == 0) {
                        $('#<%=ddlPayType.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlPayType.ClientID%>').val(data.d[0].Id_Pay_Type_WO);
                        $("#<%=ddlPayType.ClientID%>").attr('disabled', 'disabled');
                    }

                    if (data.d[0].Id_Pay_Terms_WO == 0) {
                        $('#<%=ddlPayTerms.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlPayTerms.ClientID%>').val(data.d[0].Id_Pay_Terms_WO);
                        $("#<%=ddlPayTerms.ClientID%>").attr('disabled', 'disabled');
                    }
                    if (data.d[0].Id_Cust_Group_Seq == 0) {
                        $('#<%=ddlCusGroup.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        //$('#<%=ddlCusGroup.ClientID%>')[0].val("5");
                        //$('#<%=ddlCusGroup.ClientID%> option:contains("' + data.d[0].Id_Cust_Group_Seq + '")').attr('selected', 'selected');
                        $('#<%=ddlCusGroup.ClientID%>').val(data.d[0].Id_Cust_Group_Seq);
                    }
                    <%--if ((data.d[0].WO_Status == "INV") || (data.d[0].WO_Status == "RINV")) {
                        $('#<%=btnUpdate.ClientID%>').attr("disabled", "disabled");
                        $('#<%=btnAddJob.ClientID%>').attr("disabled", "disabled");
                    }--%>

                    <%-- $('#<%=lbl_h_ordno.ClientID%>').text(WoNo);
                    $('#<%=lbl_h_prefix.ClientID%>').text(WoPr);--%>
                  
                    $('#<%=RTlblOrderDate.ClientID%>').text(data.d[0].Dt_Order);
                    FetchDefectNote(data.d[0].Id_Veh_Seq_WO);
                   // loadMechanicGrid(WoNo, WoPr);
                    if ($('#<%=ddlStatus.ClientID%>').val() == "INV") {
                        $("#<%=btnInvoice.ClientID%>").attr('disabled', 'disabled');
                        $("#<%=btnRINV.ClientID%>").attr('disabled', 'disabled');
                        
                        $("#<%=btnSave.ClientID%>").attr('disabled', 'disabled');
                        
                        $("#<%=btnPickingList.ClientID%>").attr('disabled', 'disabled');
                        $("#<%=btnDeliveryNote.ClientID%>").attr('disabled', 'disabled');
                        $("#<%=btnOrderList.ClientID%>").attr('disabled', 'disabled');                        
                    } else {
                        $('#<%=btnInvoice.ClientID%>').removeAttr("disabled");
                        $('#<%=btnRINV.ClientID%>').removeAttr("disabled");
                      
                      
                        $('#<%=btnPickingList.ClientID%>').removeAttr("disabled");
                        $('#<%=btnDeliveryNote.ClientID%>').removeAttr("disabled");
                        $('#<%=btnOrderList.ClientID%>').removeAttr("disabled");
                        $('#<%=btnSave.ClientID%>').removeAttr("disabled");
                    } 
                    loadXtraCheck();

                    $('#<%=txtMechanic.ClientID%>').val(data.d[0].MechanicId);
                    $('#<%=txtMechName.ClientID%>').val(data.d[0].MechName);
                    $('#<%=hdnIdBargain.ClientID%>').val(data.d[0].IdBargain);
                    //If Bargain is accepted by Customer disable the Bargain Status Button
                    if (data.d[0].IsBargainAccepted) {
                        $("#<%=btnFetchBargain.ClientID%>").attr('disabled', 'disabled');
                    }
                    else {
                        $("#<%=btnFetchBargain.ClientID%>").removeAttr("disabled");
                    }
                    $('#<%=hdnIdXtraScheme.ClientID%>').val(data.d[0].IdXtraScheme);
                    console.log(data.d[0].IsXtraSchemeAccepted);
                    //If XtraScheme request is accepted by Customer disable the XtraScheme Status Button
                    if (data.d[0].IsXtraSchemeAccepted) {
                        $("#<%=btnFetchXtraScheme.ClientID%>").attr('disabled', 'disabled');
                    }
                    else {
                        $("#<%=btnFetchXtraScheme.ClientID%>").removeAttr("disabled");
                    }
                    if (data.d[0].FLG_VEH_PKK == true) {
                        $('#chkpkk').prop('checked', true);
                    }
                    else {
                        $('#chkpkk').prop('checked', false);
                    }
                    if (data.d[0].FLG_VEH_PKK_AFTER == true) {
                        $('#chkpkkafter').prop('checked', true);
                    }
                    else {
                        $('#chkpkkafter').prop('checked', false);
                    }
                    if (data.d[0].FLG_VEH_PER_SERVICE == true) {
                        $('#chkservice').prop('checked', true);
                    }
                    else {
                        $('#chkservice').prop('checked', false);
                    }
                    if (data.d[0].FLG_VEH_RENTAL_CAR == true) {
                        $('#chkRentalCar').prop('checked', true);
                    }
                    else {
                        $('#chkRentalCar').prop('checked', false);
                    }
                    if (data.d[0].FLG_VEH_MOIST_CTRL == true) {
                        $('#chkMoistCtrl').prop('checked', true);
                    }
                    else {
                        $('#chkMoistCtrl').prop('checked', false);
                    }
                    if (data.d[0].FLG_VEH_TECTYL == true) {
                        $('#chkTectyl').prop('checked', true);
                    }
                    else {
                        $('#chkTectyl').prop('checked', false);
                    }
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FillCustDet(IdCustomer) {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadCustDet",
                data: "{IdCustomer: '" + IdCustomer + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (data) {
                    
                    $('#<%=txtSrchCust.ClientID%>').val(data.d[0].Cust_ID);
                    $('#<%=txtName.ClientID%>').val(data.d[0].FirstName);
                    $('#<%=txtMName.ClientID%>').val(data.d[0].MiddleName);
                    $('#<%=txtLName.ClientID%>').val(data.d[0].LastName);                    
                    
                    $('#<%=lblCustName2.ClientID%>').html(data.d[0].FirstName + " " + data.d[0].MiddleName + " " + data.d[0].LastName);
                    $('#<%=txtAddress1.ClientID%>').val(data.d[0].WO_Cust_Add1);
                    $('#<%=txtAddress2.ClientID%>').val(data.d[0].Cust_Perm_Add2);
                    $('#<%=txtState.ClientID%>').val(data.d[0].PState);
                    $('#<%=txtZipCode.ClientID%>').val(data.d[0].PZipcode);
                    $('#<%=txtEniroId.ClientID%>').val(data.d[0].ENIROID);
                    $('#<%=txtEmail.ClientID%>').val(data.d[0].Cust_Email);
                    $('#<%=txtMobNo.ClientID%>').val(data.d[0].WO_Cust_Phone_Mobile);
                    $('#<%=txtCustNotes.ClientID%>').val(data.d[0].CustNote);
                    console.log("Firmaet er privat eller ikke: " + data.d[0].Flg_Private_Comp)
                    if (data.d[0].Flg_Private_Comp == true) {
                        $('#chkCompany').prop('checked', true);
                        $('#<%=lblPrivLastName.ClientID%>').addClass('hidden');
                        $('#<%=lblCompName.ClientID%>').removeClass('hidden');
                        $('#priv').hide();
                        $('#priv2').hide();
                        $('#comp').removeClass('hidden');
                        $('#comp2').removeClass('hidden');
                        $('#comp3').removeClass('hidden');
                        $('#<%=txtName.ClientID%>').attr('data-required', 'FALSE');
                        $('#<%=txtMName.ClientID%>').attr('data-required', 'FALSE');
                        $('#<%=hdnCustSsn.ClientID%>').val(data.d[0].SSN)
                        $('#<%=txtContact.ClientID%>').val(data.d[0].Cust_Contactperson);
                        $('#<%=txtContactTitle.ClientID%>').val(data.d[0].Cust_ContactTitle);
                    }

                    else {
                        $('#chkCompany').prop('checked', false);
                        $('#<%=lblPrivLastName.ClientID%>').removeClass('hidden');
                        $('#<%=lblCompName.ClientID%>').addClass('hidden');
                        $('#priv').show();
                        $('#priv2').show();
                        $('#comp').addClass('hidden');
                        $('#comp2').addClass('hidden');
                        $('#comp3').addClass('hidden');
                        $('#<%=txtName.ClientID%>').attr('data-required', 'REQUIRED');
                        $('#<%=txtMName.ClientID%>').attr('data-required', 'REQUIRED');
                        $('#<%=hdnCustBorn.ClientID%>').val(data.d[0].BORN)
                    }
                    if ($('#<%=txtCustNotes.ClientID%>').val() != "") {
                        $('#<%=btnNoteCustomer.ClientID%>').addClass('warningAN');
                     }
                     else {
                         $('#<%=btnNoteCustomer.ClientID%>').removeClass('warningAN');
                     }
                    if (data.d[0].Id_Pay_Type_WO == 0) {
                        $('#<%=ddlPayType.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlPayType.ClientID%>').val(data.d[0].Id_Pay_Type_WO);
                    }

                    if (data.d[0].Id_Pay_Terms_WO == 0) {
                        $('#<%=ddlPayTerms.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlPayTerms.ClientID%>').val(data.d[0].Id_Pay_Terms_WO);
                    }
                    
                    if (data.d[0].Cust_Group == 0) {
                        $('#<%=ddlCusGroup.ClientID%>')[0].selectedIndex = 0;
                    }
                    else {
                        $('#<%=ddlCusGroup.ClientID%> option:contains("' + data.d[0].Cust_Group + '")').attr('selected', 'selected');
                    }
                    $('#<%=hdnOHCGenDisc.ClientID%>').val(data.d[0].Cust_Disc_General);
                    $('#<%=hdnOHCLabDisc.ClientID%>').val(data.d[0].Cust_Disc_Labour);
                    $('#<%=hdnOHCSpareDisc.ClientID%>').val(data.d[0].Cust_Disc_Spares);
                    
                      
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function clearInsCust() {
            $('#<%=txtInsCustID.ClientID%>').val("");
            $('#<%=txtInsPostalAddress.ClientID%>').val("");
            $('#<%=txtInsVisitAddress.ClientID%>').val("");
            $('#<%=txtInsZip.ClientID%>').val("");
            $('#<%=txtZipCity.ClientID%>').val("");
            $('#<%=txtInsPhonePrivate.ClientID%>').val("");
            $('#<%=txtInsPhoneSwitch.ClientID%>').val("");
            $('#<%=txtInsPhoneMobile.ClientID%>').val("");


            $('#<%=txtInsSalesGroup.ClientID%>').val("");//check 
            $('#<%=txtInsPhoneFax.ClientID%>').val("");
            $('#<%=txtInsPaymentTerms.ClientID%>').val("");
            $('#<%=txtInsGM.ClientID%>').val("");
            $('#<%=txtInsEnvFee.ClientID%>').val("");
            $('#<%=txtInsInvFee.ClientID%>').val("");
            $('#<%=hdnInsCustId.ClientID%>').val("");
            $('#<%=txtInsCompanyName.ClientID%>').val("");
            $('#<%=radInsNoReduction.ClientID%>').attr('checked', true);
            $('#<%=radInsReductioAfter.ClientID%>').prop("disabled", false);
            $('#<%=radInsReductionBefore.ClientID%>').prop("disabled", false);
            
        }

        function clearIntCust() {
            $('#<%=txtIntCustID.ClientID%>').val("");
            $('#<%=txtIntPostalAddress.ClientID%>').val("");
            $('#<%=txtIntVisitAddress.ClientID%>').val("");
            $('#<%=txtIntZip.ClientID%>').val("");
            $('#<%=txtIntZipCity.ClientID%>').val("");
            $('#<%=txtIntPhonePrivate.ClientID%>').val("");
            $('#<%=txtIntPhoneSwitch.ClientID%>').val("");
            $('#<%=txtIntPhoneMobile.ClientID%>').val("");

            $('#<%=txtIntSalesGroup.ClientID%>').val("");//check 
            $('#<%=txtIntPhoneFax.ClientID%>').val("");
            $('#<%=txtIntPaymentTerms.ClientID%>').val("");
            $('#<%=txtIntGM.ClientID%>').val("");
            $('#<%=txtIntEnvFee.ClientID%>').val("");
            $('#<%=txtIntInvFee.ClientID%>').val("");
            $('#<%=hdnIntCustId.ClientID%>').val("");
            $('#<%=hdnIntDbtSeq.ClientID%>').val("");
            $('#<%=txtIntCompanyName.ClientID%>').val("");
            $('#<%=txtIntSplit.ClientID%>').val("");
        }

        function clearClaCust() {
            $('#<%=txtClaimCustID.ClientID%>').val("");
            $('#<%=txtClaimPostalAddress.ClientID%>').val("");
            $('#<%=txtClaimVisitAddress.ClientID%>').val("");
            $('#<%=txtClaimZip.ClientID%>').val("");
            $('#<%=txtClaimZipCity.ClientID%>').val("");
            $('#<%=txtClaimPhonePrivate.ClientID%>').val("");
            $('#<%=txtClaimPhoneSwitch.ClientID%>').val("");
            $('#<%=txtClaimPhoneMobile.ClientID%>').val("");


            $('#<%=txtClaimSalesGroup.ClientID%>').val("");//check 
            $('#<%=txtClaimPhoneFax.ClientID%>').val("");
            $('#<%=txtClaimPaymentTerms.ClientID%>').val("");
            $('#<%=txtClaimGM.ClientID%>').val("");
            $('#<%=txtClaimEnvFee.ClientID%>').val("");
            $('#<%=txtClaimInvFee.ClientID%>').val("");
            $('#<%=hdnClaimCustId.ClientID%>').val("");
            $('#<%=hdnClaimDbtSeq.ClientID%>').val("");
            $('#<%=txtClaimCompanyName.ClientID%>').val("");
            $('#<%=txtClaimSplit.ClientID%>').val("");
        }

        function clearMiscCust() {
            $('#<%=txtMiscCustID.ClientID%>').val("");
            $('#<%=txtMiscPostalAddress.ClientID%>').val("");
            $('#<%=txtMiscVisitAddress.ClientID%>').val("");
            $('#<%=txtMiscZip.ClientID%>').val("");
            $('#<%=txtMiscZipCity.ClientID%>').val("");
            $('#<%=txtMiscPhonePrivate.ClientID%>').val("");
            $('#<%=txtMiscPhoneSwitch.ClientID%>').val("");
            $('#<%=txtMiscPhoneMobile.ClientID%>').val("");
            $('#<%=txtMiscSalesGroup.ClientID%>').val("");//check 
            $('#<%=txtMiscPhoneFax.ClientID%>').val("");
            $('#<%=txtMiscPaymentTerms.ClientID%>').val("");
            $('#<%=txtMiscGM.ClientID%>').val("");
            $('#<%=txtMiscEnvFee.ClientID%>').val("");
            $('#<%=txtMiscInvFee.ClientID%>').val("");
            $('#<%=hdnMiscCustId.ClientID%>').val("");
            $('#<%=hdnMiscDbtSeq.ClientID%>').val("");
            $('#<%=txtMiscCompanyName.ClientID%>').val("");
            $('#<%=txtMiscSplit.ClientID%>').val("");
        }

        function FillInsCustDet(IdCustomer,mode) {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadCustDet",
                data: "{IdCustomer: '" + IdCustomer + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (data) {
                    //either billing addr or perm address
                    var address = data.d[0].WO_Cust_Add1 + " " + data.d[0].Cust_Perm_Add2;

                    $('#<%=txtInsCustID.ClientID%>').val(data.d[0].Cust_ID);
                    $('#<%=txtInsPostalAddress.ClientID%>').val(address);
                    $('#<%=txtInsVisitAddress.ClientID%>').val(address);
                    $('#<%=txtInsZip.ClientID%>').val(data.d[0].PZipcode);
                    $('#<%=txtZipCity.ClientID%>').val(data.d[0].PState);
                    $('#<%=txtInsPhonePrivate.ClientID%>').val(data.d[0].WO_Cust_Phone_Home);
                    $('#<%=txtInsPhoneSwitch.ClientID%>').val(data.d[0].WO_Cust_Phone_Off);
                    $('#<%=txtInsPhoneMobile.ClientID%>').val(data.d[0].WO_Cust_Phone_Mobile);

                    //contact person need to load dd and then select 
                    if (data.d[0].Cust_Contactperson != "") {
                        $('#<%=ddlInsContactPerson.ClientID%>').val('0');// need to change
                    }
                    $('#<%=txtInsSalesGroup.ClientID%>').val(data.d[0].Cust_Group);//check 
                    $('#<%=txtInsPhoneFax.ClientID%>').val(data.d[0].Cust_Fax); 
                    $('#<%=txtInsPaymentTerms.ClientID%>').val(data.d[0].Pay_Term);
                    $('#<%=txtInsGM.ClientID%>').val($('#<%=txtTGM.ClientID%>').val());
                    $('#<%=txtInsEnvFee.ClientID%>').val("");//Todo
                    $('#<%=txtInsInvFee.ClientID%>').val("");//Todo
                    $('#<%=hdnInsCustId.ClientID%>').val(data.d[0].Cust_ID);

                    if (data.d[0].Flg_Private_Comp == true) {
                        $('#<%=txtInsCompanyName.ClientID%>').val(data.d[0].Cust_Last_Name);
                    } else {
                        $('#<%=txtInsCompanyName.ClientID%>').val("");
                    }

                    if (mode == "add") {
                        $('#<%=hdnInsGenDisc.ClientID%>').val(data.d[0].Cust_Disc_General);
                        $('#<%=hdnInsLabDisc.ClientID%>').val(data.d[0].Cust_Disc_Labour);
                        $('#<%=hdnInsSpareDisc.ClientID%>').val(data.d[0].Cust_Disc_Spares);
                    }                    
                    
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }


        function FillIntCustDet(IdCustomer,mode) {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadCustDet",
                data: "{IdCustomer: '" + IdCustomer + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (data) {
                    //either billing addr or perm address
                    var address = data.d[0].WO_Cust_Add1 + " " + data.d[0].Cust_Perm_Add2;

                    $('#<%=txtIntCustID.ClientID%>').val(data.d[0].Cust_ID);
                    $('#<%=txtIntPostalAddress.ClientID%>').val(address);
                    $('#<%=txtIntVisitAddress.ClientID%>').val(address);
                    $('#<%=txtIntZip.ClientID%>').val(data.d[0].PZipcode);
                    $('#<%=txtIntZipCity.ClientID%>').val(data.d[0].PState);
                    $('#<%=txtIntPhonePrivate.ClientID%>').val(data.d[0].WO_Cust_Phone_Home);
                    $('#<%=txtIntPhoneSwitch.ClientID%>').val(data.d[0].WO_Cust_Phone_Off);
                    $('#<%=txtIntPhoneMobile.ClientID%>').val(data.d[0].WO_Cust_Phone_Mobile);

                    //contact person need to load dd and then select 
                    if (data.d[0].Cust_Contactperson != "") {
                        $('#<%=ddlIntContactPerson.ClientID%>').val('0');// need to change
                    }
                    $('#<%=txtIntSalesGroup.ClientID%>').val(data.d[0].Cust_Group);//check 
                    $('#<%=txtIntPhoneFax.ClientID%>').val(data.d[0].Cust_Fax);
                    $('#<%=txtIntPaymentTerms.ClientID%>').val(data.d[0].Pay_Term);
                    $('#<%=txtIntGM.ClientID%>').val($('#<%=txtTGM.ClientID%>').val());
                    $('#<%=txtIntEnvFee.ClientID%>').val("");//Todo
                    $('#<%=txtIntInvFee.ClientID%>').val("");//Todo
                    $('#<%=hdnIntCustId.ClientID%>').val(data.d[0].Cust_ID);

                    if (data.d[0].Flg_Private_Comp == true) {
                        $('#<%=txtIntCompanyName.ClientID%>').val(data.d[0].Cust_Last_Name);
                    } else {
                        $('#<%=txtIntCompanyName.ClientID%>').val("");
                    }

                    if (mode == "add") {
                        $('#<%=hdnIntGenDisc.ClientID%>').val(data.d[0].Cust_Disc_General);
                        $('#<%=hdnIntLabDisc.ClientID%>').val(data.d[0].Cust_Disc_Labour);
                        $('#<%=hdnIntSpareDisc.ClientID%>').val(data.d[0].Cust_Disc_Spares);
                    }                   
                    
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }


        function FillClaimCustDet(IdCustomer,mode) {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadCustDet",
                data: "{IdCustomer: '" + IdCustomer + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (data) {
                    //either billing addr or perm address
                    //debugger;
                    var address = data.d[0].WO_Cust_Add1 + " " + data.d[0].Cust_Perm_Add2;

                    $('#<%=txtClaimCustID.ClientID%>').val(data.d[0].Cust_ID);
                    $('#<%=txtClaimPostalAddress.ClientID%>').val(address);
                    $('#<%=txtClaimVisitAddress.ClientID%>').val(address);
                    $('#<%=txtClaimZip.ClientID%>').val(data.d[0].PZipcode);
                    $('#<%=txtClaimZipCity.ClientID%>').val(data.d[0].PState);
                    $('#<%=txtClaimPhonePrivate.ClientID%>').val(data.d[0].WO_Cust_Phone_Home);
                    $('#<%=txtClaimPhoneSwitch.ClientID%>').val(data.d[0].WO_Cust_Phone_Off);
                    $('#<%=txtClaimPhoneMobile.ClientID%>').val(data.d[0].WO_Cust_Phone_Mobile);

                    //contact person need to load dd and then select 
                    if (data.d[0].Cust_Contactperson != "") {
                        $('#<%=ddlClaimContactPerson.ClientID%>').val('0');// need to change
                    }
                    $('#<%=txtClaimSalesGroup.ClientID%>').val(data.d[0].Cust_Group);//check 
                    $('#<%=txtClaimPhoneFax.ClientID%>').val(data.d[0].Cust_Fax);
                    $('#<%=txtClaimPaymentTerms.ClientID%>').val(data.d[0].Pay_Term);
                    $('#<%=txtClaimGM.ClientID%>').val($('#<%=txtTGM.ClientID%>').val());
                    $('#<%=txtClaimEnvFee.ClientID%>').val("");//Todo
                    $('#<%=txtClaimInvFee.ClientID%>').val("");//Todo
                    $('#<%=hdnClaimCustId.ClientID%>').val(data.d[0].Cust_ID);

                    if (data.d[0].Flg_Private_Comp == true) {
                        $('#<%=txtClaimCompanyName.ClientID%>').val(data.d[0].Cust_Last_Name);
                    } else {
                        $('#<%=txtClaimCompanyName.ClientID%>').val("");
                    }

                    if (mode == "add") {
                        $('#<%=hdnClaGenDisc.ClientID%>').val(data.d[0].Cust_Disc_General);
                        $('#<%=hdnClaLabDisc.ClientID%>').val(data.d[0].Cust_Disc_Labour);
                        $('#<%=hdnClaSpareDisc.ClientID%>').val(data.d[0].Cust_Disc_Spares);
                    }                   
                    
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FillMiscCustDet(IdCustomer,mode) {
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadCustDet",
                data: "{IdCustomer: '" + IdCustomer + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (data) {
                    //either billing addr or perm address
                    //debugger;
                    var address = data.d[0].WO_Cust_Add1 + " " + data.d[0].Cust_Perm_Add2;

                    $('#<%=txtMiscCustID.ClientID%>').val(data.d[0].Cust_ID);
                    $('#<%=txtMiscPostalAddress.ClientID%>').val(address);
                    $('#<%=txtMiscVisitAddress.ClientID%>').val(address);
                    $('#<%=txtMiscZip.ClientID%>').val(data.d[0].PZipcode);
                    $('#<%=txtMiscZipCity.ClientID%>').val(data.d[0].PState);
                    $('#<%=txtMiscPhonePrivate.ClientID%>').val(data.d[0].WO_Cust_Phone_Home);
                    $('#<%=txtMiscPhoneSwitch.ClientID%>').val(data.d[0].WO_Cust_Phone_Off);
                    $('#<%=txtMiscPhoneMobile.ClientID%>').val(data.d[0].WO_Cust_Phone_Mobile);

                    //contact person need to load dd and then select 
                    if (data.d[0].Cust_Contactperson != "") {
                        $('#<%=ddlMiscContactPerson.ClientID%>').val('0');// need to change
                    }
                    $('#<%=txtMiscSalesGroup.ClientID%>').val(data.d[0].Cust_Group);//check 
                    $('#<%=txtMiscPhoneFax.ClientID%>').val(data.d[0].Cust_Fax);
                    $('#<%=txtMiscPaymentTerms.ClientID%>').val(data.d[0].Pay_Term);
                    $('#<%=txtMiscGM.ClientID%>').val($('#<%=txtTGM.ClientID%>').val());
                    $('#<%=txtMiscEnvFee.ClientID%>').val("");//Todo
                    $('#<%=txtMiscInvFee.ClientID%>').val("");//Todo
                    $('#<%=hdnMiscCustId.ClientID%>').val(data.d[0].Cust_ID);

                    if (data.d[0].Flg_Private_Comp == true) {
                        $('#<%=txtMiscCompanyName.ClientID%>').val(data.d[0].Cust_Last_Name);
                    } else {
                        $('#<%=txtMiscCompanyName.ClientID%>').val("");
                    }
                    var rowjobData = $('#jobgrid').jqGrid('getGridParam', 'data');
                    var ownRiskExists = false;

                    for (var k = 0; k < rowjobData.length; k++) {
                        if (rowjobData[k].JobId == "1" && rowjobData[k].DebtType == "OHC" && rowjobData[k].Diff == "OR" && rowjobData[k].Bestilt == "" && rowjobData[k].Levert == "" && rowjobData[k].Pris != "") {
                            ownRiskExists = true;
                        }
                    }

                    if (ownRiskExists == true) {
                        $('#<%=chkMiscMoveOwnRisk.ClientID%>').prop("disabled", false);
                    }
                    else {
                        $('#<%=chkMiscMoveOwnRisk.ClientID%>').prop("disabled", true);
                    }

                    if (mode == "add") {
                        $('#<%=hdnMiscGenDisc.ClientID%>').val(data.d[0].Cust_Disc_General);
                        $('#<%=hdnMiscLabDisc.ClientID%>').val(data.d[0].Cust_Disc_Labour);
                        $('#<%=hdnMiscSpareDisc.ClientID%>').val(data.d[0].Cust_Disc_Spares);
                    }                    
                    
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        //just a tiny helper function for loadXtraCheck

        function doDirtyWork(num, boxName)
        {
            var boxState;

            if (boxName.includes("SMS"))
            {
              
                if (num == 1) {
                    $(boxName).children(":first").addClass("large black checkmark icon")
                }
               
                }
            
            if(boxName.includes("Annot") && num != "")
            {
                $(boxName).children(":first").addClass("alarm icon")
                $(boxName).val(num)
                var temp = boxName.replace("#", "")
                var temp2 = "#txtForm" + temp
                $(temp2).val(num)
                }
         
            if (num == "0")  { boxState = "GoodBox"; $(boxName + boxState).addClass("large black checkmark icon")}
            else if (num == "1")  { boxState = "OKBox";$(boxName + boxState).addClass("large black checkmark icon") }
            else if (num == "2")  { boxState = "BadBox";$(boxName + boxState).addClass("large black checkmark icon")}
            //else {  }
          
            //alert(boxName + boxState)
            
        }


                            
         //loads in the current XtraCheck scheme for this 
function loadXtraCheck()
{
     $('.XtraCheck').removeClass('large black checkmark icon');
                   
     $.ajax({
        type: "POST",
        contentType: "application/json; charset=utf-8",
        url: "frmWOJobDetails.aspx/loadXtraCheck",
        data: "{'refnr':'" + $('#<%=txtInternalNo.ClientID%>').val() + "',regnr:'" + $('#<%=txtRegNo.ClientID%>').val() + "'}",                    
        dataType: "json",
        async: true,//Very important
        success: function (Result) {
            if (Result.d.length > 0) {
                
                doDirtyWork(Result.d[0].MOTOROIL, "#engineOil");
                doDirtyWork(Result.d[0].MOTOROIL_ANNOT, "#engineOilAnnot");
                doDirtyWork(Result.d[0].MOTOROIL_SMS, "#engineOilSMS");
                doDirtyWork(Result.d[0].FREEZE_LEVEL, "#cFLevel");
                doDirtyWork(Result.d[0].FREEZE_LEVEL_ANNOT, "#cFLevelAnnot");
                doDirtyWork(Result.d[0].FREEZE_LEVEL_SMS, "#cFlevelSMS");
                doDirtyWork(Result.d[0].FREEZE_POINT, "#cFTemp");
                doDirtyWork(Result.d[0].FREEZE_POINT_ANNOT, "#cfTempAnnot")
                doDirtyWork(Result.d[0].FREEZE_POINT_SMS, "#cFtempSMS")
                doDirtyWork(Result.d[0].BRAKEFLUID, "#brakeFluid");
                doDirtyWork(Result.d[0].BRAKEFLUID_ANNOT, "#brakeFluidAnnot");
                doDirtyWork(Result.d[0].BRAKEFLUID_SMS, "#brakeFluidSMS");
                doDirtyWork(Result.d[0].BATTERY, "#battery");
                doDirtyWork(Result.d[0].BATTERY_ANNOT, "#batteryAnnot");
                doDirtyWork(Result.d[0].BATTERY_SMS, "#batterySMS");
                doDirtyWork(Result.d[0].WINDSCREEN_WIPER_FRONT, "#vipesFront");
                doDirtyWork(Result.d[0].WINDSCREEN_WIPER_FRONT_ANNOT, "#vipesFrontAnnot");
                doDirtyWork(Result.d[0].WINDSCREEN_WIPER_FRONT_SMS, "#vipesFrontSMS");
                doDirtyWork(Result.d[0].WINDSCREEN_WIPER_REAR, "#vipesBack");
                doDirtyWork(Result.d[0].WINDSCREEN_WIPER_REAR_ANNOT, "#vipesBackAnnot");
                doDirtyWork(Result.d[0].WINDSCREEN_WIPER_REAR_SMS, "#vipesBackSMS");
                doDirtyWork(Result.d[0].LIGHT_BULB_FRONT, "#lightsFront");
                doDirtyWork(Result.d[0].LIGHT_BULB_FRONT_ANNOT, "#lightsFrontAnnot");
                doDirtyWork(Result.d[0].LIGHT_BULB_FRONT_SMS, "#lightsFrontSMS");
                doDirtyWork(Result.d[0].LIGHT_BULB_REAR, "#lightsBack");
                doDirtyWork(Result.d[0].LIGHT_BULB_REAR_ANNOT, "#lightsBackAnnot");
                doDirtyWork(Result.d[0].LIGHT_BULB_REAR_SMS, "#lightsBackSMS");
                doDirtyWork(Result.d[0].SHOCK_ABSORBER_FRONT, "#bumperFront");
                doDirtyWork(Result.d[0].SHOCK_ABSORBER_FRONT_ANNOT, "#bumperFrontAnnot");
                doDirtyWork(Result.d[0].SHOCK_ABSORBER_FRONT_SMS, "#bumperFrontSMS");
                doDirtyWork(Result.d[0].SHOCK_ABSORBER_REAR, "#bumperBack");
                doDirtyWork(Result.d[0].SHOCK_ABSORBER_REAR_ANNOT, "#bumperBackAnnot");
                doDirtyWork(Result.d[0].SHOCK_ABSORBER_REAR_SMS, "#bumperBackSMS");
                doDirtyWork(Result.d[0].TIRE_FRONT, "#tiresFront");
                doDirtyWork(Result.d[0].TIRE_FRONT_ANNOT, "#tiresFrontAnnot");
                doDirtyWork(Result.d[0].TIRE_FRONT_SMS, "#tiresFrontSMS");
                doDirtyWork(Result.d[0].TIRE_REAR, "#tiresBack");
                doDirtyWork(Result.d[0].TIRE_REAR_ANNOT, "#tiresBackAnnot");
                doDirtyWork(Result.d[0].TIRE_REAR_SMS, "#tiresBackSMS");
                doDirtyWork(Result.d[0].SUSPENSION_FRONT, "#suspensionFront");
                doDirtyWork(Result.d[0].SUSPENSION_FRONT_ANNOT, "#suspensionFrontAnnot");
                doDirtyWork(Result.d[0].SUSPENSION_FRONT_SMS, "#suspensionFrontSMS");
                doDirtyWork(Result.d[0].SUSPENSION_REAR, "#suspensionBack");
                doDirtyWork(Result.d[0].SUSPENSION_REAR_ANNOT, "#suspensionBackAnnot");
                doDirtyWork(Result.d[0].SUSPENSION_REAR_SMS, "#suspensionBackSMS");
                doDirtyWork(Result.d[0].BRAKES_FRONT, "#brakesFront");
                doDirtyWork(Result.d[0].BRAKES_FRONT_ANNOT, "#brakesFrontAnnot");
                doDirtyWork(Result.d[0].BRAKES_FRONT_SMS, "#brakesFrontSMS");
                doDirtyWork(Result.d[0].BRAKES_REAR, "#brakesBack");
                doDirtyWork(Result.d[0].BRAKES_REAR_ANNOT, "#brakesBackAnnot");
                doDirtyWork(Result.d[0].BRAKES_REAR_SMS, "#brakesBackSMS");
                doDirtyWork(Result.d[0].EXHAUST, "#exhaust"); 
                doDirtyWork(Result.d[0].EXHAUST_ANNOT, "#exhaustAnnotIcon"); 
                doDirtyWork(Result.d[0].EXHAUST_SMS, "#exhaustSMS"); 
                doDirtyWork(Result.d[0].DENSITY_MOTOR, "#sealedEngine"); 
                doDirtyWork(Result.d[0].DENSITY_MOTOR_ANNOT, "#sealedEngineAnnot"); 
                doDirtyWork(Result.d[0].DENSITY_MOTOR_SMS, "#sealedEngineSMS"); 
                doDirtyWork(Result.d[0].DENSITY_GEARBOX, "#sealedGearbox");
                doDirtyWork(Result.d[0].DENSITY_GEARBOX_ANNOT, "#sealedGearboxAnnot");
                doDirtyWork(Result.d[0].DENSITY_GEARBOX_SMS, "#sealedGearboxSMS");
                $('#btnScheme').addClass('warningAN');
                $('.xtrasjekken').addClass('hidden');
                $('.xtrasjekkenActive').removeClass('hidden');
            }
        }
    });


}

        function FillVehDet(VehicleId) {           
            $.ajax({
                type: "POST",
                url: "frmWOHead.aspx/LoadVehDet",
                data: "{VehicleId: '" + VehicleId + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: true,
                success: function (data) {
                    //debugger;
                    
                    $('#<%=txtRegNo.ClientID%>').val(data.d[0].WO_Veh_Reg_NO);
                    $('#<%=lblRegistation.ClientID%>').html(data.d[0].WO_Veh_Reg_NO);
                    $('#<%=txtInternalNo.ClientID%>').val(data.d[0].Veh_Int_No);
                    
                    $('#<%=txtVIN.ClientID%>').val(data.d[0].WO_Veh_Vin);
                    $('#<%=txtMileage.ClientID%>').val(data.d[0].WO_Veh_Mileage);
                    $('#<%=txtHours.ClientID%>').val(data.d[0].WO_Veh_Hrs);
                    $('#<%=txtCostPrice.ClientID%>').val(data.d[0].VA_Cost_Price);
                    $('#<%=txtSellPrice.ClientID%>').val(data.d[0].VA_Sell_Price);
                    $('#<%=txtVANum.ClientID%>').val(data.d[0].Van_Num);
                    $('#<%=txtVehNotes.ClientID%>').val(data.d[0].Veh_Annot);
                    if ($('#<%=txtVehNotes.ClientID%>').val() != "")
                    {
                        $('#<%=btnNoteVehicle.ClientID%>').addClass('warningAN');
                    }
                    else
                    {
                        $('#<%=btnNoteVehicle.ClientID%>').removeClass('warningAN');
                    }
                    if (data.d[0].Id_Make == 0)
                    {
                        $('#<%=ddlMake.ClientID%>')[0].selectedIndex = 0;
                    }
                    else
                    {
                        $('#<%=ddlMake.ClientID%> option:contains("' + data.d[0].Id_Make + '")').attr('selected', 'selected');
                    }
                    
                    //FillModel(data.d[0].Id_Make);                    
                   
                    $('#<%=txtbxModel.ClientID%>').val(data.d[0].Veh_Type);
                    $('#<%=txtColor.ClientID%>').val(data.d[0].VehColor);
                    $(document.getElementById('<%=hdnVehGrpDesc.ClientID%>')).val(data.d[0].Veh_Grpdesc);

                    if ($('#<%=txtName.ClientID%>').val() == "") {

                        $('#<%=txtSrchCust.ClientID%>').val(data.d[0].Cust_ID);
                        $('#<%=txtName.ClientID%>').val(data.d[0].FirstName);
                        $('#<%=txtMName.ClientID%>').val(data.d[0].MiddleName);
                        $('#<%=txtLName.ClientID%>').val(data.d[0].LastName);


                        $('#<%=lblCustName2.ClientID%>').html(data.d[0].FirstName + " " + data.d[0].MiddleName + " " + data.d[0].LastName);
                        $('#<%=txtCustNotes.ClientID%>').val(data.d[0].CustNote);
                        if ($('#<%=txtCustNotes.ClientID%>').val() != "") {
                            $('#exclamCustomerIcon').show();
                         }
                         else {
                            $('#exclamCustomerIcon').hide();
                        }

                        $('#<%=txtAddress1.ClientID%>').val(data.d[0].WO_Cust_Add1);
                        $('#<%=txtAddress2.ClientID%>').val(data.d[0].Cust_Perm_Add2);
                        $('#<%=txtState.ClientID%>').val(data.d[0].PState);
                        $('#<%=txtZipCode.ClientID%>').val(data.d[0].PZipcode);
                       
                        
                        $('#<%=txtEmail.ClientID%>').val(data.d[0].Cust_Email);
                        $('#<%=txtMobNo.ClientID%>').val(data.d[0].WO_Cust_Phone_Mobile);
                        if (data.d[0].Id_Pay_Type_WO == 0) {
                            $('#<%=ddlPayType.ClientID%>')[0].selectedIndex = 0;
                        }
                        else {
                            $('#<%=ddlPayType.ClientID%>').val(data.d[0].Id_Pay_Type_WO);
                        }

                        if (data.d[0].Id_Pay_Terms_WO == 0) {
                            $('#<%=ddlPayTerms.ClientID%>')[0].selectedIndex = 0;
                        }
                        else {
                            $('#<%=ddlPayTerms.ClientID%>').val(data.d[0].Id_Pay_Terms_WO);
                        }
                                                
                        if (data.d[0].Id_Cust_Group_Seq == 0) {
                            $('#<%=ddlCusGroup.ClientID%>')[0].selectedIndex = 0;
                        }
                        else {
                            $('#<%=ddlCusGroup.ClientID%> option:contains("' + data.d[0].Id_Cust_Group_Seq + '")').attr('selected', 'selected');
                        }
                        $('#<%=lblRegistation.ClientID%>').html(data.d[0].WO_Veh_Reg_NO);
                    }
                    FetchDefectNote(VehicleId);
                    loadXtraCheck();
                    
                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }

        function FetchDefectNote(vehicleId) {
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOHead.aspx/Fetch_DefectNote",
                data: "{'idVeh':'" + vehicleId + "'}",
                //data: {},
                dataType: "json",
                async: false,//Very important
                success: function (data) {
                    strValue = data.d.toString();
                    if (strValue == "True") {
                        $('#<%=lnkDefect.ClientID%>').show();
                    }
                    else {
                        $('#<%=lnkDefect.ClientID%>').hide();
                    }
                }

            });
        }

        function openDefect() {
            var vid = $('#<%=txtSrchVeh.ClientID%>').val();
            var vRegNo = $('#<%=txtRegNo.ClientID%>').val();
            var vVIN = $('#<%=txtVIN.ClientID%>').val();
            var vInternNo = $('#<%=txtInternalNo.ClientID%>').val();
            var url = "frmWODefectNotes.aspx?FLG=1&VID=" + vid + "&RegNo=" + vRegNo + "&InternalNo=" + vInternNo + "&VIN=" + vVIN;
            var win = window.open(url, 'info3', 'resizable=no,scrollbars=1,status=yes,width=600px,height=400px,menubar=0,toolbar=0');
            win.focus();
        }

        function updateEniroDetails(custId, lastName, firstName, middleName, visitAdd, billAdd, zipCode, zipPlace, phone, mobile, born, ssn) {

            if (custId == "") {
                swal("Du må kundenummer før du lagrer!");

            }
            else {
                $.ajax({

                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/UpdateEniroDetails",
                    data: "{custId: '" + custId + "', lastName:'" + lastName + "', firstName:'" + firstName + "', middleName:'" + middleName + "', visitAdd:'" + visitAdd
                        + "', billAdd:'" + billAdd + "', zipCode:'" + zipCode + "', zipPlace:'" + zipPlace + "', phone:'" + phone + "', mobile:'" + mobile + "', born:'" + born + "', ssn:'" + ssn + "'}",
                    dataType: "json",
                    success: function (data) {
                        if (data.d[0] == "UPDFLG") {
                            var res = GetMultiMessage('MSG126', '', '');
                            //alert(res);
                            systemMSG('success', 'Kjøretøydetaljer ble lagret', 4000);


                        }

                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }
        }

        function SaveOrder() {
            var dtord = $('#<%=RTlblOrderDate.ClientID%>').val();
            var model = $("#<%=txtbxModel.ClientID%>").val();
            var make = $("#<%=ddlMake.ClientID%> option:selected").text();
            var result = fnClientValidate();
            var bool = chkCreditLimit_Customer();
            var fullName = "";
            if($('#<%=txtName.ClientID%>').val() != ""){
                fullName = $('#<%=txtName.ClientID%>').val() + " ";
            }
            if($('#<%=txtMName.ClientID%>').val() != ""){
                fullName += $('#<%=txtMName.ClientID%>').val() + " ";
            }
            fullName += $('#<%=txtLName.ClientID%>').val();

			//Spare status dd
            var IdSpareStatus = $('#<%=ddlSpareStatus.ClientID%>').val(); //need to include
            //alert("Save "+IdSpareStatus);
            var flgVehPkk = $('#chkpkk').is(':checked');
            var flgVehPkkAfter = $('#chkpkkafter').is(':checked');
            var flgVehPerService = $('#chkservice').is(':checked');
            var flgVehMoistCtrl = $('#chkMoistCtrl').is(':checked');
            var flgVehRentalCar = $('#chkRentalCar').is(':checked');
            var flgVehTectyl = $('#chkTectyl').is(':checked');
            if ((result == true) && (bool == true)) {
                $.ajax({
                    type: "POST",
                    url: "frmWOHead.aspx/SaveOrderDetails",
                    data: "{custID: '" + $('#<%=txtSrchCust.ClientID%>').val() + "',Id_Wo_No: '', ordDt:'" + $('#<%=RTlblOrderDate.ClientID%>')[0].innerHTML + "', woType:'" + $('#<%=ddlType.ClientID%>').val() + "', woStatus:'" + $('#<%=ddlStatus.ClientID%>').val() + "', Wo_Tm_Deliv:'" + $('#<%=txtDeliveryTime.ClientID%>').val() + "', delivDate:'" + $('#<%=txtDeliveryDate.ClientID%>').val() + "', finishDate:'" + $('#<%=txtFinishDate.ClientID%>').val() + "',payType:'" + $('#<%=ddlPayType.ClientID%>').val() + "',payTerms:'" + $('#<%=ddlPayTerms.ClientID%>').val() + "',custPermAddr1:'" + $('#<%=txtAddress1.ClientID%>').val() + "',custPermAddr2:'" + $('#<%=txtAddress2.ClientID%>').val() + "',zipCode:'" + $('#<%=txtZipCode.ClientID%>').val() + "',custOffPh:'" + "" + "',custHmPh:'" + "" + "',idVehSeq:'" + $('#<%=txtSrchVeh.ClientID%>').val() + "',vehRegNo:'" + $('#<%=txtRegNo.ClientID%>').val() + "',annotation:'" + $('#<%=TxtAnnotation.ClientID%>').val() + "',custName:'" + fullName + "',custMob:'" + $('#<%=txtMobNo.ClientID%>').val() + "',vehInterNo:'" + $('#<%=txtInternalNo.ClientID%>').val() + "',vehVin:'" + $('#<%=txtVIN.ClientID%>').val() + "',updVehFlag:'0" +
                        "',vehMileage: '" + $('#<%=txtMileage.ClientID%>').val() + "', vehHrs:'" + $('#<%=txtHours.ClientID%>').val() + "', country:'" + "" + "', state:'" + $('#<%=txtState.ClientID%>').val() + "', vehMake:'" + make + "', vehModel:'" + $('#<%=txtbxModel.ClientID%>').val() + "', custGrp:'" + $('#<%=ddlCusGroup.ClientID%>').val() + "', vehGrpDesc:'" + $(document.getElementById('<%=hdnVehGrpDesc.ClientID%>')).val() + "', deptAccntNum:'" + $('#<%=txtDeptAccntNum.ClientID%>').val() + "', VACostPrice:'" + $('#<%=txtCostPrice.ClientID%>').val() + "', VASellPrice:'" + $('#<%=txtSellPrice.ClientID%>').val() + "', VANum:'" + $('#<%=txtVANum.ClientID%>').val() + "', IntNote:'',DeptAccNum:'" + $('#<%=txtDeptAccntNum.ClientID%>').val() + "', MechId:'" + $('#<%=txtMechanic.ClientID%>').val() + "', MechName:'" + $('#<%=txtMechName.ClientID%>').val() + "', IdSpareStatus:'" + IdSpareStatus + "', flgVehPkk:'" + flgVehPkk + "', flgVehPkkAfter:'" + flgVehPkkAfter + "', flgVehPerService:'" + flgVehPerService + "', flgVehMoistCtrl:'" + flgVehMoistCtrl + "', flgVehRentalSer:'" + flgVehRentalCar + "', flgVehTectyl:'" + flgVehTectyl + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    async: false,
                    success: function (Result) {
                        Result = Result.d[0];
                        if (Result.SuccessMessage == "INSFLG") {
                            var OrdNo = Result.Id_WO_Prefix + Result.Id_WO_NO;
                            $('#<%=RTlblError.ClientID%>').text(GetMultiMessage('MSG126', '', ''));
                            $('#<%=RTlblError.ClientID%>').removeClass();
                            $('#<%=RTlblError.ClientID%>').addClass("lblMessage");
                          
                            $('#<%=lblOrderNo.ClientID%>').text(OrdNo);
                            $('#<%=lblCustName.ClientID%>').text(Result.Id_Cust_Wo);
                            $('#<%=hdnWoNo.ClientID%>').val(Result.Id_WO_NO);
                            $('#<%=hdnWoPr.ClientID%>').val(Result.Id_WO_Prefix);
                            $('#<%=hdnVehId.ClientID%>').val(Result.Id_Veh_Seq_WO);
                        }
                        else {
                            $('#<%=RTlblError.ClientID%>').text(Result.ErrorMessage);
                            $('#<%=RTlblError.ClientID%>').removeClass();
                            $('#<%=RTlblError.ClientID%>').addClass("lblErr");
                        }
                    },
                    failure: function () {
                        alert("Failed!");
                    }
                });
            }
        }

        function chkCreditLimit_Customer() {
            var custId = $('#<%=txtSrchCust.ClientID%>').val();
            var strValue;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOHead.aspx/CreditLimit_Customer",
                data: "{'idCust':'" + custId + "'}",
                //data: {},
                dataType: "json",
                async: false,//Very important
                success: function (data) {
                    strValue = data.d.toString();
                }

            });
            if (strValue != "True") {
                return confirm(strValue);
            }
            else {
                return true;
            }
        }

        function UpdateOrder() {
            var dtord = $('#<%=RTlblOrderDate.ClientID%>').val();
       <%--     var model = $("#<%=ddlModel.ClientID%> option:selected").text();--%>
            var make = $("#<%=ddlMake.ClientID%> option:selected").text();
            var bool = chkCreditLimit_Customer();
            var fullName = "";
            if ($('#<%=txtName.ClientID%>').val() != "") {
                fullName = $('#<%=txtName.ClientID%>').val() + " ";
            }
            if ($('#<%=txtMName.ClientID%>').val() != "") {
                fullName += $('#<%=txtMName.ClientID%>').val() + " ";
            }
            fullName += $('#<%=txtLName.ClientID%>').val();

             //Spare status dd
            var IdSpareStatus = $('#<%=ddlSpareStatus.ClientID%>').val(); //need to include            
            //alert(IdSpareStatus);
            var flgVehPkk = $('#chkpkk').is(':checked');
            var flgVehPkkAfter = $('#chkpkkafter').is(':checked');
            var flgVehPerService = $('#chkservice').is(':checked');
            var flgVehMoistCtrl = $('#chkMoistCtrl').is(':checked');
            var flgVehRentalCar = $('#chkRentalCar').is(':checked');
            var flgVehTectyl = $('#chkTectyl').is(':checked');
            if ((bool == true)) {
                $.ajax({
                    type: "POST",
                    url: "frmWOHead.aspx/UpdateOrderDetails",
                    data: "{custID: '" + $('#<%=txtSrchCust.ClientID%>').val() + "',Id_Wo_No: '', ordDt:'" + $('#<%=RTlblOrderDate.ClientID%>')[0].innerHTML + "', woType:'" + $('#<%=ddlType.ClientID%>').val() + "', woStatus:'" + $('#<%=ddlStatus.ClientID%>').val() + "', Wo_Tm_Deliv:'" + $('#<%=txtDeliveryTime.ClientID%>').val() + "', delivDate:'" + $('#<%=txtDeliveryDate.ClientID%>').val() + "', finishDate:'" + $('#<%=txtFinishDate.ClientID%>').val() + "',payType:'" + $('#<%=ddlPayType.ClientID%>').val() + "',payTerms:'" + $('#<%=ddlPayTerms.ClientID%>').val() + "',custPermAddr1:'" + $('#<%=txtAddress1.ClientID%>').val() + "',custPermAddr2:'" + $('#<%=txtAddress2.ClientID%>').val() + "',zipCode:'" + $('#<%=txtZipCode.ClientID%>').val() + "',custOffPh:'" + "" + "',custHmPh:'" + "" + "',idVehSeq:'" + $('#<%=txtSrchVeh.ClientID%>').val() + "',vehRegNo:'" + $('#<%=txtRegNo.ClientID%>').val() + "',annotation:'" + $('#<%=TxtAnnotation.ClientID%>').val() + "',custName:'" + fullName + "',custMob:'" + $('#<%=txtMobNo.ClientID%>').val() + "',vehInterNo:'" + $('#<%=txtInternalNo.ClientID%>').val() + "',vehVin:'" + $('#<%=txtVIN.ClientID%>').val() + "',updVehFlag:'0" +
                        "',vehMileage: '" + $('#<%=txtMileage.ClientID%>').val() + "', vehHrs:'" + $('#<%=txtHours.ClientID%>').val() + "', country:'" + "" + "', state:'" + $('#<%=txtState.ClientID%>').val() + "', vehMake:'" + make + "', vehModel:'" + $('#<%=txtbxModel.ClientID%>').val() + "', custGrp:'" + $('#<%=ddlCusGroup.ClientID%>').val() + "', vehGrpDesc:'" + $(document.getElementById('<%=hdnVehGrpDesc.ClientID%>')).val() + "', deptAccntNum:'" + $('#<%=txtDeptAccntNum.ClientID%>').val() + "', VACostPrice:'" + $('#<%=txtCostPrice.ClientID%>').val() + "', VASellPrice:'" + $('#<%=txtSellPrice.ClientID%>').val() + "', VANum:'" + $('#<%=txtVANum.ClientID%>').val() + "', IntNote:'',DeptAccNum:'" + $('#<%=txtDeptAccntNum.ClientID%>').val() + "', MechId:'" + $('#<%=txtMechanic.ClientID%>').val() + "', MechName:'" + $('#<%=txtMechName.ClientID%>').val() + "', IdSpareStatus:'" + IdSpareStatus + "', flgVehPkk:'" + flgVehPkk + "', flgVehPkkAfter:'" + flgVehPkkAfter + "', flgVehPerService:'" + flgVehPerService + "', flgVehMoistCtrl:'" + flgVehMoistCtrl + "', flgVehRentalSer:'" + flgVehRentalCar + "', flgVehTectyl:'" + flgVehTectyl + "'}",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    async: false,
                    success: function (Result) {
                        Result = Result.d[0];
                        if (Result.SuccessMessage != "") {
                            var OrdNo = ($('#<%=hdnWoPr.ClientID%>')[0].value) + ($('#<%=hdnWoNo.ClientID%>')[0].value);
                            $('#<%=RTlblError.ClientID%>').text(Result.SuccessMessage);
                            $('#<%=RTlblError.ClientID%>').removeClass();
                            $('#<%=RTlblError.ClientID%>').addClass("lblMessage");
                         
                        }
                        else {
                            $('#<%=RTlblError.ClientID%>').text(Result.ErrorMessage);
                            $('#<%=RTlblError.ClientID%>').removeClass();
                            $('#<%=RTlblError.ClientID%>').addClass("lblErr");
                        }
                    },
                    failure: function () {
                        alert("Failed!");
                    }
                });
            }
        }

        function fnClientValidate() {
            if ($('#<%=ddlType.ClientID%>')[0].selectedIndex == "0") {
                alert(GetMultiMessage('0007', GetMultiMessage('0324', '', ''), ''));
                $('#<%=ddlType.ClientID%>')[0].focus();
                return false;
            }
            if ($('#<%=ddlStatus.ClientID%>')[0].selectedIndex == "0") {
                alert(GetMultiMessage('0007', GetMultiMessage('0325', '', ''), ''));
                $('#<%=ddlStatus.ClientID%>')[0].focus();
                return false;
            }

            if (($('#<%=txtFinishDate.ClientID%>')[0].value != "") && ($('#<%=txtDeliveryDate.ClientID%>')[0].value != "")) {
                var DeliveryDate = fnValidateDate($('#<%=txtDeliveryDate.ClientID%>').val(), $('#<%=hdnDateFormat.ClientID%>').val());
                var finishDate = fnValidateDate($('#<%=txtFinishDate.ClientID%>').val(), $('#<%=hdnDateFormat.ClientID%>').val());

                if (finishDate < DeliveryDate) {
                    alert(GetMultiMessage('0328', '', ''))
                    return false;
                }
            }


            if ($('#<%=txtSrchVeh.ClientID%>').val() == "") {
                if (($('#<%=txtRegNo.ClientID%>').val() != "") || ($('#<%=txtInternalNo.ClientID%>').val() != "") || ($('#<%=txtVIN.ClientID%>').val() != "")) {
                    if ($('#<%=ddlMake.ClientID%>')[0].selectedIndex == "0") {
                        alert(GetMultiMessage('0606', '', ''));
                        $('#<%=ddlMake.ClientID%>')[0].focus();
                        return false;
                    }
                    if ($('#<%=txtbxModel.ClientID%>')[0].selectedIndex == "0") {
                        alert(GetMultiMessage('0607', '', ''));
                        $('#<%=txtbxModel.ClientID%>')[0].focus();
                        return false;
                    }
                }
            }
            else {
                if (($('#<%=txtRegNo.ClientID%>').val() != "") || ($('#<%=txtInternalNo.ClientID%>').val() != "") || ($('#<%=txtVIN.ClientID%>').val() != "")) {
                    if ($('#<%=ddlMake.ClientID%>')[0].selectedIndex == "0") {
                        alert(GetMultiMessage('0606', '', ''));
                        $('#<%=ddlMake.ClientID%>')[0].focus();
                        return false;
                    }
                    if ($('#<%=ddlMake.ClientID%>')[0].selectedIndex == "0") {
                        alert(GetMultiMessage('0607', '', ''));
                        $('#<%=txtbxModel.ClientID%>')[0].focus();
                        return false;
                    }
                }
            }

            if (!(gfi_ValidateNumDot($('#<%=txtMileage.ClientID%>')))) {

                return false;
            }
            if (!(gfi_ValidateNumDot($('#<%=txtHours.ClientID%>')))) {

                $('#<%=txtHours.ClientID%>').val('');
                $('#<%=txtHours.ClientID%>').focus();
                return false;
            }
            if (!(gfi_ValidateNumber($('#<%=txtMileage.ClientID%>'), '0262')))
                return false;
            if (!(gfi_ValidateNumber($('#<%=txtHours.ClientID%>'), 'VEHHRS')))
                return false;

            <%--if (!(gfi_CheckEmpty($('#<%=txtName.ClientID%>'), '0265'))) {
                return false;
            }--%>
            <%--if (!(gfi_CheckEmptySpace($('#<%=txtName.ClientID%>'), '0265'))) {
                return false;
            }--%>

            if ($('#<%=ddlCusGroup.ClientID%>')[0].selectedIndex == "0") {
                alert(GetMultiMessage('0205', '', ''));
                $('#<%=ddlCusGroup.ClientID%>')[0].focus();
                return false;
            }


            var UzipCode = $('#<%=txtZipCode.ClientID%>').val();
            if (UzipCode != "") {

               
                if (!(gfb_ValidateAlphabets($('#<%=txtState.ClientID%>'), '0193'))) {
                    return false;
                }
            }

            window.scrollTo(0, 0);
            return true;
        }

        function fnClientUpdValidate() {
            if ($('#<%=ddlType.ClientID%>')[0].selectedIndex == "0") {
                alert(GetMultiMessage('0007', GetMultiMessage('0324', '', ''), ''));
                $('#<%=ddlType.ClientID%>')[0].focus();
                return false;
            }
            if ($('#<%=ddlStatus.ClientID%>')[0].selectedIndex == "0") {
                alert(GetMultiMessage('0007', GetMultiMessage('0325', '', ''), ''));
                document.forms[0].CmbStatus.focus();
                return false;
            }

            if ($('#<%=txtDeliveryTime.ClientID%>').val() != "") {

                Validatetime($('#<%=txtDeliveryTime.ClientID%>'));

            }

            if (($('#<%=txtFinishDate.ClientID%>')[0].value != "") && ($('#<%=txtDeliveryDate.ClientID%>')[0].value != "")) {
                var DeliveryDate = fnValidateDate($('#<%=txtDeliveryDate.ClientID%>').val(), $('#<%=hdnDateFormat.ClientID%>').val());
                var finishDate = fnValidateDate($('#<%=txtFinishDate.ClientID%>').val(), $('#<%=hdnDateFormat.ClientID%>').val());

                if (finishDate < DeliveryDate) {
                    alert(GetMultiMessage('0328', '', ''))
                    return false;
                }
            }

            if ($('#<%=txtSrchVeh.ClientID%>').val() == "") {
                if (($('#<%=txtRegNo.ClientID%>').val() != "") || ($('#<%=txtInternalNo.ClientID%>').val() != "") || ($('#<%=txtVIN.ClientID%>').val() != "")) {
                    if ($('#<%=ddlMake.ClientID%>')[0].selectedIndex == "0") {
                        alert(GetMultiMessage('0606', '', ''));
                        $('#<%=ddlMake.ClientID%>')[0].focus();
                        return false;
                    }
                    if ($('#<%=txtbxModel.ClientID%>')[0].selectedIndex == "0") {
                        alert(GetMultiMessage('0607', '', ''));
                        $('#<%=txtbxModel.ClientID%>')[0].focus();
                        return false;
                    }
                }
            }
            else {
                if (($('#<%=txtRegNo.ClientID%>').val() != "") || ($('#<%=txtInternalNo.ClientID%>').val() != "") || ($('#<%=txtVIN.ClientID%>').val() != "")) {
                    if ($('#<%=ddlMake.ClientID%>')[0].selectedIndex == "0") {
                        alert(GetMultiMessage('0606', '', ''));
                        $('#<%=ddlMake.ClientID%>')[0].focus();
                        return false;
                    }
                    if ($('#<%=ddlMake.ClientID%>')[0].selectedIndex == "0") {
                        alert(GetMultiMessage('0607', '', ''));
                        $('#<%=txtbxModel.ClientID%>')[0].focus();
                        return false;
                    }
                }
            }

            if (!(gfi_CheckEmpty($('#<%=txtName.ClientID%>'), '0265'))) {
                return false;
            }

            if ($('#<%=ddlCusGroup.ClientID%>')[0].selectedIndex == "0") {
                alert(GetMultiMessage('0205', '', ''));
                $('#<%=ddlCusGroup.ClientID%>')[0].focus();
                return false;
            }

            if (!(gfi_ValidateNumDot($('#<%=txtMileage.ClientID%>')))) {

                return false;
            }

            if (!(gfi_ValidateNumDot($('#<%=txtHours.ClientID%>')))) {

                $('#<%=txtHours.ClientID%>').val('');
                $('#<%=txtHours.ClientID%>').focus();
                return false;
            }

            if (!(gfi_ValidateNumber($('#<%=txtMileage.ClientID%>'), '0262')))
                return false;
            if (!(gfi_ValidateNumber($('#<%=txtHours.ClientID%>'), 'VEHHRS')))
                return false;

            var UzipCode = $('#<%=txtZipCode.ClientID%>').val();
            if (UzipCode != "") {

                
                if (!(gfb_ValidateAlphabets($('#<%=txtState.ClientID%>'), '0193'))) {
                    return false;
                }
            }

            if (UzipCode != "") {
                if (document.forms[0].hdnNewZip.value == 0) {
                    if (document.forms[0].txtState.value.length == 0) {
                        if (confirm(GetMultiMessage('ZIPCONFIRM', '', '')) == 1) {
                            $('#<%=hdnConfigZipSave.ClientID%>').val("1");
                        }
                        else {
                            $('#<%=hdnConfigZipSave.ClientID%>').val("0");
                        }
                    }
                }
            }

            window.scrollTo(0, 0);
        }

        //OrderDetails
        function LoadGMHPVat(idItem, idMake,idCustomer) {
            var idCust, idVehSeq;
            idCust = idCustomer;//$('#<%=lblCustName.ClientID%>').text();
            idVehSeq = $('#<%=hdnVehId.ClientID%>').val();
            var GMVat = "";
            var HPVat = "";
            var SPVat = "";

            var GMHPVat = [];

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/LoadGMHPVat",
                data: "{'idCust':'" + idCust + "',idVehSeq:'" + idVehSeq + "',idItem:'" + idItem + "',idMake:'" + idMake + "'}",
                //data: {},
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    if (Result.d.length > 0) {
                        GMVat = Result.d[0].GM_Vat;
                        HPVat = Result.d[0].HP_Vat;
                        SPVat = Result.d[0].SP_Vat;
                        GMHPVat[0] = GMVat;
                        GMHPVat[1] = HPVat;
                        GMHPVat[2] = SPVat;
                    }
                }
            });
            //return [GMVat, HPVat];
            return GMHPVat;
        }

        function fetchDelJobDet(idWoNo, idWoPr)
        {
            var idCust = "";
            var custType = "";
            var idJobId = "";
            var delJob = [];

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/FetchDelJobDet",
                data: "{'idWoNo':'" + idWoNo + "',idWoPr:'" + idWoPr + "'}",
                //data: {},
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    var arrcheck = new Array();
                    if (Result.d.length > 0)
                    {
                        for (var k = 0; k < Result.d.length; k++) {
                            idCust = Result.d[k].Id_Customer;
                            custType = Result.d[k].DebtType;
                            idJobId = Result.d[k].Id_Job;

                            arrcheck.push({ id: k, idJobId: idJobId, Debitor: idCust })
                        }
                        delJob = arrcheck;

                    }
                }
            });
            return delJob;
        }

        function FetchCustomerDisc(idCust) {
            var GenDisc = "";
            var LabDisc = "";
            var SPDisc = "";

            var Disc = [];

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/FetchCustomerDisc",
                data: "{'idCust':'" + idCust + "'}",
                //data: {},
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    if (Result.d.length > 0) {
                        GenDisc = Result.d[0].CUST_DISC_GENERAL;
                        LabDisc = Result.d[0].CUST_DISC_LABOUR;
                        SPDisc = Result.d[0].CUST_DISC_SPARES;
                        Disc[0] = GenDisc;
                        Disc[1] = LabDisc;
                        Disc[2] = SPDisc;
                    }
                }
            });
            //return [GMVat, HPVat];
            return Disc;
        }

        function GetVatDis(idItem, idJobDeb, idVeh, idMake, idWh) {
            var JOBI_DIS_SEQ;
            var JOBI_VAT_PER;
            var JOBI_VAT_SEQ;
            var result;
            var Vat = [];
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/Get_vat_Dis",
                data: "{'idItem':'" + idItem + "',idJobDeb:'" + idJobDeb + "',idVeh:'" + idVeh + "',idMake:'" + idMake + "',idWh:'" + idWh + "'}",
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    if (Result.d.length > 0) {
                        result = Result.d.split(';');
                        JOBI_DIS_SEQ = result[1];
                        JOBI_VAT_PER = result[2];
                        JOBI_VAT_SEQ = result[3];
                        Vat[0] = JOBI_DIS_SEQ;
                        Vat[1] = JOBI_VAT_PER;
                        Vat[2] = JOBI_VAT_SEQ;
                    }

                }
            });
            return Vat;
        }

        function recalculateTotals() {
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var hpVat = 0.0;
            var gmVat = 0.0;
            var amtS = 0.0;
            var vatAmount = 0.0;
            var amtL = 0.0;
            var discAmount = 0.0;
            var TotalGM = 0.0;
            var amtG = 0.0;
            var labDisc = 0.0;
            var gmDisc = 0.0;
            var spareDisc = 0.0;
            var labVatDisc = 0.0;
            var gmVatDisc = 0.0;
            var spareVatDisc = 0.0;
            var totLabVatDisc = 0.0;
            var totGmVatDisc = 0.0;
            var totSpareVatDisc = 0.0;

            $('#<%=txtTLab.ClientID%>').val(fnformatDecimalValue('0.0', seperator));
            $('#<%=txtTGM.ClientID%>').val(fnformatDecimalValue('0.0', seperator));
            $('#<%=txtHPVat.ClientID%>').val(fnformatDecimalValue('0.0', seperator));
            $('#<%=txtGMVat.ClientID%>').val(fnformatDecimalValue('0.0', seperator));
            $('#<%=txtSPVat.ClientID%>').val(fnformatDecimalValue('0.0', seperator));
            $('#<%=txtTSP.ClientID%>').val(fnformatDecimalValue('0.0', seperator));

            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');

            for (var k = 0; k < rowdisdata.length; k++) {
                var idItem = rowdisdata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                var idMake = rowdisdata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                var idCust = $('#<%=lblCustName.ClientID%>').text();
                //var idItem = $('#<%=hdnIdItem.ClientID%>').val();
                //var idMake = $('#<%=hdnIdMake.ClientID%>').val();
                var vats = LoadGMHPVat(idItem, idMake, idCust);
                gmVat = 0.0;
                hpVat = 0.0;
                spVat = 0.0;

                if (vats.length > 0) {
                    gmVat = fnformatDecimalValue(vats[0], seperator);
                    hpVat = fnformatDecimalValue(vats[1], seperator);
                    spVat = fnformatDecimalValue(vats[2], seperator);
                }

                var hpVatPer = hpVat;
                var gmVatPer = gmVat;
                var spVatPer = spVat;

                if (rowdisdata[k].Diff == "L") {
                    var amount = 0.0;
                    //amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                    amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                    amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                    var GM = fnformatDecimalValue($('#<%=txtGM.ClientID%>').val(), seperator);
                    if (rowdisdata[k].ForeignJob != "FJ") {
                        amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                        TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                        //$('#<%=txtTGM.ClientID%>').val(TotalGM);
                    }

                    //Lab and GM Discount
                    if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                        labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                        gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                        labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                        totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                        gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                        totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                    }

                    hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                    gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                    hpVat = fnreformatDecimal(hpVat, seperator);
                    gmVat = fnreformatDecimal(gmVat, seperator);
                    amtL = fnreformatDecimal(amtL, seperator);
                    TotalGM = fnreformatDecimal(TotalGM, seperator);
                    $('#<%=txtTGM.ClientID%>').val(TotalGM);
                    $('#<%=txtHPVat.ClientID%>').val(hpVat);
                    $('#<%=txtGMVat.ClientID%>').val(gmVat);
                    $('#<%=txtTLab.ClientID%>').val(amtL);

                    var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                    rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);
                    var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                    rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                }

                if (rowdisdata[k].Diff == "S") {
                    var amount = 0.0;
                    //amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator)
                    amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                    amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                    vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVat))).toFixed(2);
                    amtS = fnreformatDecimal(amtS, seperator);
                    vatAmount = fnreformatDecimal(vatAmount, seperator);
                    $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                    $('#<%=txtTSP.ClientID%>').val(amtS);


                    if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                        var amt;
                        var boQty;
                        if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                            boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                        } else {
                            boQty = 0;
                        }

                        if (boQty != "0") {
                            //discAmount = 0;
                            spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                        } else {
                            amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            //discAmount = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2);
                            spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                        }
                    }
                    spareVatDisc = (amount * (spVatPer / 100)).toFixed(2);
                    totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                    //Spare Discount

                    var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                    rowdisdata[k].Disc_Amt = fnreformatDecimal(spchck, seperator);

                    var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                    rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);

                }

                if (rowdisdata[k].Disc_Amt != undefined) {
                    discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                }        

                discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);

            }

            var total = (fnformatDecimalValue($('#<%=txtTGM.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTLab.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val(), seperator)).toFixed(2);
            var vatTotal = (fnformatDecimalValue($('#<%=txtHPVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtGMVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val(), seperator)).toFixed(2);
            var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
            total = fnreformatDecimal(total, seperator);
            vatTotal = fnreformatDecimal(vatTotal, seperator);
            TIncVat = fnreformatDecimal(TIncVat, seperator);

            discAmount = fnreformatDecimal(discAmount, seperator);

            $('#<%=txtNet.ClientID%>').val(total);
            $('#<%=txtVat.ClientID%>').val(vatTotal);
            $('#<%=txtTotal.ClientID%>').val(TIncVat);
            $('#<%=txtDisc.ClientID%>').val(discAmount);
        }

       

        function loadWOJobGrid(idWONO, idWOPrefix) {
            var spdata;
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var insuranceCust = "";
            var internalCust = "";
            var claimCust = "";
            var miscCust = "";
            var ohcCust = "";
            $("#<%=chkMiscMoveOwnRisk.ClientID%>").prop('checked', false);
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/Load_WorkOrderDetails",
                data: "{'idWONO':'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "'}",
                dataType: "json",
                async: false,//Very important
                success: function (data) {
                    jQuery("#jobgrid").jqGrid('clearGridData');
                    for (i = 0; i < data.d.length; i++) {
                        spdata = data;
                        jQuery("#jobgrid").jqGrid('addRowData', i + 1, spdata.d[i]);

                        if (spdata.d[i].DebtType == "INSC") {
                            insuranceCust = spdata.d[i].Id_Job_Deb;
                            $('#<%=hdnInsCustId.ClientID%>').val(insuranceCust);
                            $('#<%=hdnDbtSeq.ClientID%>').val(spdata.d[i].Id_Deb_Seq);

                            if (spdata.d[i].Diff == "L" || spdata.d[i].Diff == "S") {
                                var insDisc = (fnformatDecimalValue(spdata.d[i].DebitorDiscount, seperator)).toFixed(0);
                                insDisc = fnreformatDecimal(insDisc, seperator);
                                $('#<%=txtInsDiscount.ClientID%>').val(insDisc);

                                $('#<%=hdnInsGenDisc.ClientID%>').val(data.d[i].CustGenDiscount);
                                $('#<%=hdnInsLabDisc.ClientID%>').val(data.d[i].CustLabDiscount);
                                $('#<%=hdnInsSpareDisc.ClientID%>').val(data.d[i].CustSpareDiscount);
                            }
                        }

                        if (spdata.d[i].DebtType == "INTC") {
                            var intSplit = (fnformatDecimalValue(spdata.d[i].SplitPercent, seperator)).toFixed(0);
                            intSplit = fnreformatDecimal(intSplit, seperator);
                            internalCust = spdata.d[i].Id_Job_Deb;
                            $('#<%=hdnIntCustId.ClientID%>').val(internalCust);
                            $('#<%=hdnIntDbtSeq.ClientID%>').val(spdata.d[i].Id_Deb_Seq);
                            $('#<%=txtIntSplit.ClientID%>').val(intSplit);

                            if (spdata.d[i].Diff == "L" || spdata.d[i].Diff == "S") {
                                var intDisc = (fnformatDecimalValue(spdata.d[i].DebitorDiscount, seperator)).toFixed(0);
                                intDisc = fnreformatDecimal(intDisc, seperator);
                                $('#<%=txtIntDiscount.ClientID%>').val(intDisc);
                                $('#<%=hdnIntGenDisc.ClientID%>').val(data.d[i].CustGenDiscount);
                                $('#<%=hdnIntLabDisc.ClientID%>').val(data.d[i].CustLabDiscount);
                                $('#<%=hdnIntSpareDisc.ClientID%>').val(data.d[i].CustSpareDiscount);
                            }
                        }

                        if (spdata.d[i].DebtType == "CLA") {
                            claimCust = spdata.d[i].Id_Job_Deb;
                            var claSplit = (fnformatDecimalValue(spdata.d[i].SplitPercent, seperator)).toFixed(0);
                            claSplit = fnreformatDecimal(claSplit, seperator);
                            $('#<%=hdnClaimCustId.ClientID%>').val(claimCust);
                            $('#<%=hdnClaimDbtSeq.ClientID%>').val(spdata.d[i].Id_Deb_Seq);
                            $('#<%=txtClaimSplit.ClientID%>').val(claSplit);

                            if (spdata.d[i].Diff == "L" || spdata.d[i].Diff == "S") {
                                var claDisc = (fnformatDecimalValue(spdata.d[i].DebitorDiscount, seperator)).toFixed(0);
                                claDisc = fnreformatDecimal(claDisc, seperator);
                                $('#<%=txtClaimDiscount.ClientID%>').val(claDisc);
                                $('#<%=hdnClaGenDisc.ClientID%>').val(data.d[i].CustGenDiscount);
                                $('#<%=hdnClaLabDisc.ClientID%>').val(data.d[i].CustLabDiscount);
                                $('#<%=hdnClaSpareDisc.ClientID%>').val(data.d[i].CustSpareDiscount);
                            }
                        }

                        if (spdata.d[i].DebtType == "MISC") {
                            miscCust = spdata.d[i].Id_Job_Deb;

                            var miscCustSplit = (fnformatDecimalValue(spdata.d[i].SplitPercent, seperator)).toFixed(0);
                            miscCustSplit = fnreformatDecimal(miscCustSplit, seperator);
                            $('#<%=hdnMiscCustId.ClientID%>').val(miscCust);
                            $('#<%=hdnMiscDbtSeq.ClientID%>').val(spdata.d[i].Id_Deb_Seq);
                            $('#<%=txtMiscSplit.ClientID%>').val(miscCustSplit);

                            if (spdata.d[i].Diff == "OR" && fnformatDecimalValue(spdata.d[i].Belop, seperator) > 0) {
                                $("#<%=chkMiscMoveOwnRisk.ClientID%>").prop('checked', true);
                            }

                            if (spdata.d[i].Diff == "L" || spdata.d[i].Diff == "S") {
                                var miscDisc = (fnformatDecimalValue(spdata.d[i].DebitorDiscount, seperator)).toFixed(0);
                                miscDisc = fnreformatDecimal(miscDisc, seperator);
                                $('#<%=txtMiscDiscount.ClientID%>').val(miscDisc);
                                $('#<%=hdnMiscGenDisc.ClientID%>').val(data.d[i].CustGenDiscount);
                                $('#<%=hdnMiscLabDisc.ClientID%>').val(data.d[i].CustLabDiscount);
                                $('#<%=hdnMiscSpareDisc.ClientID%>').val(data.d[i].CustSpareDiscount);
                            }
                        }

                        if (spdata.d[i].DebtType == "OHC") {
                            ohcCust = $('#<%=lblCustName.ClientID%>').text();
                        }

                        if (spdata.d[i].DebtType == "OHC" && spdata.d[i].Diff == "RAOR" && spdata.d[i].JobId == "1") {
                            $('#<%=hdnReductionType.ClientID%>').val("RAOR");
                        } else if (spdata.d[i].DebtType == "OHC" && spdata.d[i].Diff == "RBOR" && spdata.d[i].JobId == "1") {
                            $('#<%=hdnReductionType.ClientID%>').val("RBOR");
                        }
                        else if (spdata.d[i].DebtType == "OHC" && spdata.d[i].Diff == "" && spdata.d[i].JobId == "1") {
                            $('#<%=hdnReductionType.ClientID%>').val("");
                        }
                        $('#<%=hdnOwnPayVAT.ClientID%>').val(spdata.d[i].WO_Own_Pay_Vat);

                        if (spdata.d[i].DebtType == "OHC" && spdata.d[i].Flag == "1" && spdata.d[i].JobId == "1") {
                            $('#<%=hdnOrdHeadDebtVatPerc.ClientID%>').val(spdata.d[i].DebtVatPercentage);
                        }
                    }

                    jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                    $("#jobgrid").jqGrid("hideCol", "subgrid");

                    if (ohcCust != "") {                        
                        FillCustDet(ohcCust);
                    }

                    if (insuranceCust != "") {
                        FillInsCustDet(insuranceCust, "update");
                    }

                    if (internalCust != "" && claimCust != "") {
                        FillIntCustDet(internalCust, "update");
                        FillClaimCustDet(claimCust, "update");
                    }

                    if (claimCust != "" && internalCust == "") {
                        FillClaimCustDet(claimCust, "update");
                    }

                    if (claimCust == "" && internalCust != "") {
                        FillIntCustDet(internalCust, "update");
                    }

                    if (miscCust != "") {
                        FillMiscCustDet(miscCust, "update");
                    }

                    if ($("#<%=radInsReductioAfter.ClientID%>").is(':checked')) {
                        var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                        var rowId;
                        var arrORisk = new Array();
                        var redExists = false;

                        for (var i = 0; i < rowdisdata.length; i++) {
                            if (rowdisdata[i].DebtType == "OHC" && rowdisdata[i].JobId == "1") {
                                rowId = rowdisdata[i].id;
                            }

                            if (rowdisdata[i].DebtType == "OHC" && rowdisdata[i].JobId == "1" && rowdisdata[i].Diff == "RAOR") {
                                redExists = true;
                            }
                        }

                        if (redExists == false && $('#<%=hdnInsCustId.ClientID%>').val() != "") {
                            var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                            arrORisk.push({
                                id: 1,
                                IdJob: rowdata.IdJob,
                                Text: "Reduction After Own Risk",
                                Nei: "0",
                                Ford: "",
                                Bestilt: "",
                                Levert: "",
                                Pris: "",
                                Rab: "",
                                Belop: "",
                                JobId: rowdata.JobId,
                                Flag: "0",
                                ForeignJob: "",
                                ItemDesc: "",
                                IdWODetailseq: rowdata.IdWODetailseq,
                                IdWOItemseq: rowdata.IdWOItemseq,
                                IdWOLabSeq: rowdata.IdWOLabSeq,
                                Id_Deb_Seq: rowdata.Id_Deb_Seq,
                                Jobi_Bo_Qty: rowdata.Jobi_Bo_Qty,
                                Id_Make: rowdata.Id_Make,
                                Sp_Cost_Price: "0",
                                Diff: "RAOR",
                                Item_Avail_Qty: rowdata.Item_Avail_Qty,
                                Id_Warehouse: rowdata.Id_Warehouse,
                                IdMech: rowdata.IdMech,
                                MechanicName: rowdata.MechanicName,
                                DebtType: "OHC",
                                SpareDiscount: 0
                            });

                            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');

                            for (var j = 0; j < arrORisk.length; j++) {
                                arrayInsertAt(rowdisdata, parseInt(rowId) - 1, arrORisk[j]);
                            }

                            var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                            jQuery("#jobgrid").jqGrid('clearGridData');
                            for (var i = 0; i < rowGrddata.length; i++) {
                                //rowGrddata[i].LineNo = rowGrddata[i].id;
                                jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                            }
                        }
                        //saveJobDet(1);
                    }

                    if ($("#<%=radInsReductionBefore.ClientID%>").is(':checked')) {
                        var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                        var rowId;
                        var arrORisk = new Array();
                        var redExists = false;

                        for (var i = 0; i < rowdisdata.length; i++) {
                            if (rowdisdata[i].DebtType == "OHC" && rowdisdata[i].JobId == "1") {
                                rowId = rowdisdata[i].id;
                            }

                            if (rowdisdata[i].DebtType == "OHC" && rowdisdata[i].JobId == "1" && rowdisdata[i].Diff == "RBOR") {
                                redExists = true;
                            }
                        }

                        if (redExists == false) {
                            var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
                            arrORisk.push({
                                id: 1,
                                IdJob: rowdata.IdJob,
                                Text: "Reduction Before Own Risk",
                                Nei: "0",
                                Ford: "",
                                Bestilt: "",
                                Levert: "",
                                Pris: "",
                                Rab: "",
                                Belop: "",
                                JobId: rowdata.JobId,
                                Flag: "0",
                                ForeignJob: "",
                                ItemDesc: "",
                                IdWODetailseq: rowdata.IdWODetailseq,
                                IdWOItemseq: rowdata.IdWOItemseq,
                                IdWOLabSeq: rowdata.IdWOLabSeq,
                                Id_Deb_Seq: rowdata.Id_Deb_Seq,
                                Jobi_Bo_Qty: rowdata.Jobi_Bo_Qty,
                                Id_Make: rowdata.Id_Make,
                                Sp_Cost_Price: "0",
                                Diff: "RBOR",
                                Item_Avail_Qty: rowdata.Item_Avail_Qty,
                                Id_Warehouse: rowdata.Id_Warehouse,
                                IdMech: rowdata.IdMech,
                                MechanicName: rowdata.MechanicName,
                                DebtType: "OHC",
                                SpareDiscount: 0
                            });

                            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');

                            for (var j = 0; j < arrORisk.length; j++) {
                                arrayInsertAt(rowdisdata, parseInt(rowId) - 1, arrORisk[j]);
                            }

                            var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                            jQuery("#jobgrid").jqGrid('clearGridData');
                            for (var i = 0; i < rowGrddata.length; i++) {
                                jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                            }
                        }
                        //saveJobDet(1);
                    }

                    if ($("#<%=radInsNoReduction.ClientID%>").is(':checked')) {
                        var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                        var rowId;
                        for (var i = 0; i < rowdisdata.length; i++) {
                            if (rowdisdata[i].DebtType === "OHC" && (rowdisdata[i].Diff == "RAOR" || rowdisdata[i].Diff == "RBOR") && rowdisdata[i].Belop != "") {
                                rowId = rowdisdata[i].id;
                                $('#jobgrid').delRowData(rowId);
                                var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

                                jQuery("#jobgrid").jqGrid('clearGridData');
                                for (var i = 0; i < rowGrddata.length; i++) {
                                    if (rowGrddata[i].DebtType === "OHC") {
                                        rowGrddata[i].Ford = "0";
                                    }
                                    if (rowGrddata[i].DebtType === "INSC") {
                                        rowGrddata[i].Ford = "100";
                                        //  rowGrddata[i].Diff = "ORARD";
                                    }
                                    jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
                                }
                                $('#<%=hdnReductionType.ClientID%>').val("");
                                saveJobDet(1);
                            }
                        }
                    }
                    recalculateTotals();
                }

            });

            setGridLinesColour();
            if ($('#<%=ddlStatus.ClientID%>').val() == "INV") {
                var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                for (var k = 0; k < rowdisdata.length; k++) {
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                }
            }
        }        

        function Invoicebasis() {
            var idWoNo = $('#<%=hdnWoNo.ClientID%>')[0].value;
            var idWoPr = $('#<%=hdnWoPr.ClientID%>')[0].value;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/InvoiceBasis",
                data: "{'idWoNo':'" + idWoNo + "',idWoPr:'" + idWoPr + "'}",
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    if (Result.d.length > 0) {
                        $('#<%=hdnInvoiceType.ClientID%>').val("InvoiceBasis");
                        window.open("../Reports/frmShowReports.aspx?ReportHeader='Invoice Basis' &InvoiceType=INVOICEBASIS &Rpt=INVOICEPRINT &scrid='1'", "info6", "resizable=yes,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                    }
                }
            });

        }

        function Invoice() {
            var idWoNo = $('#<%=hdnWoNo.ClientID%>')[0].value;
            var idWoPr = $('#<%=hdnWoPr.ClientID%>')[0].value;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/Invoice",
                data: "{'idWoNo':'" + idWoNo + "',idWoPr:'" + idWoPr + "'}",
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    if (Result.d.length > 0) {
                        if (Result.d[0] == "SUCCESS") {
                            $('#<%=hdnInvoiceType.ClientID%>').val("Invoice");
                            PopulateWODetails(idWoNo, idWoPr, '');
                            //need to disable the save,upd,invoice buttons
                            $("#<%=btnInvoice.ClientID%>").attr('disabled', 'disabled');
                            $("#<%=btnRINV.ClientID%>").attr('disabled', 'disabled');
                           
                            $("#<%=btnSave.ClientID%>").attr('disabled', 'disabled');
                         
                            $("#<%=btnPickingList.ClientID%>").attr('disabled', 'disabled');
                            $("#<%=btnDeliveryNote.ClientID%>").attr('disabled', 'disabled');
                            $("#<%=btnOrderList.ClientID%>").attr('disabled', 'disabled');

                            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                            for (var k = 0; k < rowdisdata.length; k++) {
                                $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            }
                            window.open("../Reports/frmShowReports.aspx?ReportHeader='Invoice' &InvoiceType=INVOICE &Rpt=INVOICEPRINT &scrid='1'", "info6", "resizable=yes,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                        }
                    }
                }
            });
        }

       

        function PickingList() {            
            var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
            if (rowspareData.length != "0") {
                var reportType = "PICKINGLIST";
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/LoadReport",
                    data: "{'reportType':'" + reportType + "'}",
                    //data: {},
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (Result.d.length > 0) {
                            var strValue = "../Reports/frmShowReports.aspx?ReportHeader='WOHEADPICKINGLIST' &OrderType=Order &Rpt=WOHEADPICKINGLIST &scrid='1'";//Result.d;
                            if (strValue != "") {
                                var Url = strValue;//"../Reports/frmShowReports.aspx?ReportHeader=YF8c/MYCthcdMZ0D0ra6EQ==&InvoiceType=YF8c/MYCthcdMZ0D0ra6EQ==&Rpt=GPwu6EpyNgg8JACPpv3cVA==&scrid=" + WoPr + WoNo + "&JobCardSett=1"
                                window.open(Url, 'Reports', "menubar=no,location=no,status=no,scrollbars=yes,resizable=yes");
                            }
                        }
                        // var req = data.d.toString();
                        // window.open(req.toString(), "info6", "resizable=yes,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                    }
                });
            }
            //window.open("../Reports/frmShowReports.aspx?ReportHeader='WOHEADPICKINGLIST' &OrderType=Order &Rpt=WOHEADPICKINGLIST &scrid='1'", "info6", "resizable=yes,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
        }

        function DeliveryNote() {

            var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
            if (rowspareData.length != "0") {
                var reportType = "DELIVERYNOTE";
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/LoadReport",
                    data: "{'reportType':'" + reportType + "'}",
                    //data: {},
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (Result.d.length > 0) {
                            var strValue = Result.d;
                            if (strValue != "") {
                                var Url = strValue;//"../Reports/frmShowReports.aspx?ReportHeader=YF8c/MYCthcdMZ0D0ra6EQ==&InvoiceType=YF8c/MYCthcdMZ0D0ra6EQ==&Rpt=GPwu6EpyNgg8JACPpv3cVA==&scrid=" + WoPr + WoNo + "&JobCardSett=1"
                                window.open(Url, 'Reports', "menubar=no,location=no,status=no,scrollbars=yes,resizable=yes");
                            }
                        }
                       // var req = data.d.toString();
                        // window.open(req.toString(), "info6", "resizable=yes,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                    }
                });
            }
        }

        function OrderList() {
            var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
            if (rowspareData.length != "0") {
                var reportType = "WorkOrderSpares";
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/LoadReport",
                    data: "{'reportType':'" + reportType + "'}",
                    //data: {},
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (Result.d.length > 0) {
                            //var strValue = "../Reports/frmShowReports.aspx?ReportHeader='WOHEADPICKINGLIST' &OrderType=Order &Rpt=WOHEADPICKINGLIST &scrid='1'";//Result.d;
                            var strValue = Result.d;//= "../Reports/frmShowReports.aspx?ReportHeader='WorkOrderSpares' &Rpt=WorkOrderSpares &scrid='1'";

                            if (strValue != "") {
                                var Url = strValue;//"../Reports/frmShowReports.aspx?ReportHeader=YF8c/MYCthcdMZ0D0ra6EQ==&InvoiceType=YF8c/MYCthcdMZ0D0ra6EQ==&Rpt=GPwu6EpyNgg8JACPpv3cVA==&scrid=" + WoPr + WoNo + "&JobCardSett=1"
                                window.open(Url, 'Reports', "menubar=no,location=no,status=no,scrollbars=yes,resizable=yes");
                            }
                        }
                        // var req = data.d.toString();
                        // window.open(req.toString(), "info6", "resizable=yes,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
                    }
                });
            }
            //window.open("../Reports/frmShowReports.aspx?ReportHeader='WOHEADPICKINGLIST' &OrderType=Order &Rpt=WOHEADPICKINGLIST &scrid='1'", "info6", "resizable=yes,scrollbars=1,status=yes,width=1000px,height=700px,menubar=0,toolbar=0");
        }

        function setGridLinesColour() {
            var seperator = ',';
            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
            var focusRowNo;
            //reloading after recalculatetotals
            jQuery("#jobgrid").jqGrid('clearGridData');
            for (var i = 0; i < rowdisdata.length; i++) {
                jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowdisdata[i]);
            }

            for (var k = 0; k < rowdisdata.length; k++) {
                var boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator)
                if (boQty != "0" && rowdisdata[k].Diff == "S") {
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                        'color': 'rgba(255, 0, 0, 0.8)',
                        'background-image': 'none'
                    });
                }
                if (rowdisdata[k].Flag == "1" && (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined || rowdisdata[k].DebtType == "")) {
                    //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                    jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Rab', $('#<%=hdnOHCGenDisc.ClientID%>').val()); 
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });

                }                
                else if (rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford.toString() == "") {
                    focusRowNo = k;
                }
                else if (rowdisdata[k].DebtType == "OHC" && (rowdisdata[k].Diff == "RAOR" || rowdisdata[k].Diff == "RBOR") && rowdisdata[k].Ford.toString() == "") {
                    focusRowNo = k;
                }
                else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INSC") {
                    //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });

                } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INSC") {
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none',
                        'font-weight': 'normal',
                        'text-align': 'right'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'text-align': 'right'
                    });
                }


                else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INTC") {
                    //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });

                } else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INTC") {
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none',
                        'font-weight': 'normal',
                        'text-align': 'right'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'text-align': 'right'
                    });
                }

                else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "CLA") {
                    //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });

                }
                else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "CLA") {
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none',
                        'font-weight': 'normal',
                        'text-align': 'right'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'text-align': 'right'
                    });
                }
                else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "MISC") {
                    //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });

                }
                else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "MISC") {
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                        'background-color': 'rgba(41, 128, 185, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none',
                        'font-weight': 'normal',
                        'text-align': 'right'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'text-align': 'right'
                    });
                }

                else {
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                        'text-align': 'right'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                        'text-align': 'left'
                    });

                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Belop", "", 'ui-state-disabled');
                    if (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined) {
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(255, 255, 153, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                    }
                    else if (rowdisdata[k].DebtType == "INSC") {
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                    }
                    else if (rowdisdata[k].DebtType == "INTC") {
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(33, 186, 69, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                    }
                    else if (rowdisdata[k].DebtType == "CLA") {
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                    }
                    else if (rowdisdata[k].DebtType == "MISC") {
                        jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                            'background-color': 'rgba(41, 128, 185, 1)',
                            'color': 'rgba(0, 0, 0, 1)',
                            'background-image': 'none',
                            'font-weight': 'normal',
                            'text-align': 'right'
                        });
                    }

                    //$('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'IdWODetailseq', rowdisdata[k].IdWODetailseq);
                }
                if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC") || (rowdisdata[k].DebtType == "CLA") || (rowdisdata[k].DebtType == "INTC") || (rowdisdata[k].DebtType == "MISC")) {
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                }
                if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RAOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RAOR")) {
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                }
                if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RBOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RBOR")) {
                    $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                }
                if (rowdisdata[k].Diff == "S") {
                    var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                    cm.editable = true;
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');

                }
                else if (rowdisdata[k].Diff == "T") {
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Pris", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Rab", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                }
                else if (rowdisdata[k].Diff == "L") {
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                }
            }

            if (focusRowNo != undefined) {
                var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Ford');
                cm.editable = true;
                jQuery("#jobgrid").jqGrid("nextCell", (parseInt(focusRowNo) + 1), 3).focus();
                //document.getElementById((parseInt(focusRowNo) + 1) + '_Ford').select();

            }
        }

        function delInsCust() {
            clearInsCust();
            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
            var rowId;
            for (var i = 0; i < rowdisdata.length; i++) {
                if (rowdisdata[i].DebtType == "OHC" && (rowdisdata[i].Diff == "RAOR" || rowdisdata[i].Diff == "RBOR" || rowdisdata[i].Diff == "OR") && rowdisdata[i].Belop != "") {
                    rowId = rowdisdata[i].id;
                    $('#jobgrid').delRowData(rowId);
                    i = 0;
                }
            }
            var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');

            jQuery("#jobgrid").jqGrid('clearGridData');
            for (var i = 0; i < rowGrddata.length; i++) {
                jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
            }
            saveJobDet(1);
        }

        function delIntCust() {
            clearIntCust();
            saveJobDet(1);
        }

        function delClaCust() {
            clearClaCust();
            saveJobDet(1);
        }

        function delMiscCust() {
            clearMiscCust();
            saveJobDet(1);
        }       


        function viewDebitorTotals() {
            calcDebitorTotals();

            var debitors = [
                { "DebtType": "Main Customer", "Sum inkl.mva": $('#<%=hdnMainDebtAmt.ClientID%>').val().toString() },
                { "DebtType": "Insc Customer", "Sum inkl.mva": $('#<%=hdnInsDebtAmt.ClientID%>').val().toString() },
                { "DebtType": "Inter Customer", "Sum inkl.mva": $('#<%=hdnIntDeptDebtAmt.ClientID%>').val().toString() },
                { "DebtType": "Claim Customer", "Sum inkl.mva": $('#<%=hdnClaimDebtAmt.ClientID%>').val().toString() },
                { "DebtType": "Misc Customer", "Sum inkl.mva": $('#<%=hdnMiscDebtAmt.ClientID%>').val().toString() }
            ];
            
            $("#tbodyid").empty();
            var tbody = $('#debitors tbody'),
                props = ["DebtType", "Sum inkl.mva"];
                $.each(debitors, function (i, debitor) {
                    var tr = $('<tr>');
                    $.each(props, function (i, prop) {
                        $('<td>').html(debitor[prop]).appendTo(tr);
                    });
                    tbody.append(tr);
                });

            $('#modViewDebitorTotals').modal({               
                
            }).modal('show');
        }


        function calcDebitorTotals() {

            var arrDebitors = ['OHC', 'INSC', 'INTC', 'CLA', 'MISC']; // To add internal dept,claim,misc
            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var hpVat = 0.0;
            var gmVat = 0.0;
            var amtS = 0.0;
            var vatAmount = 0.0;
            var amtL = 0.0;
            var discAmount = 0.0;
            var TotalGM = 0.0;
            var amtG = 0.0;
            var labDisc = 0.0;
            var gmDisc = 0.0;
            var spareDisc = 0.0;
            var ownRiskAmt = 0.0;
            var redAfterOR = 0.0;
            var redBeforeOR = 0.0;
            var redAmt = 0.0;
            var hpVatPerDebt = 0.0;
            var gmVatPerDebt = 0.0;
            var spVatPerDebt = 0.0;
            var inscDebtExists = false;
            var redAmt = 0.0;
            var redPerc = 0.0;
            var fordIntPerc = 0.0;
            var fordClaPerc = 0.0;
            var fordOhcPerc = 0.0;
            var labVatDisc = 0.0;
            var gmVatDisc = 0.0;
            var spareVatDisc = 0.0;
            var totLabVatDisc = 0.0;
            var totGmVatDisc = 0.0;
            var totSpareVatDisc = 0.0;

            for (var i = 0; i < arrDebitors.length; i++) {
                var debtType = arrDebitors[i];

                hpVat = 0.0;
                gmVat = 0.0;
                amtS = 0.0;
                vatAmount = 0.0;
                amtL = 0.0;
                discAmount = 0.0;
                TotalGM = 0.0;
                amtG = 0.0;
                labDisc = 0.0;
                gmDisc = 0.0;
                spareDisc = 0.0;
                //ownRiskAmt = 0.0;
                redAfterOR = 0.0;
                redBeforeOR = 0.0;
                //redAmt = 0.0;
                hpVatPerDebt = 0.0;
                gmVatPerDebt = 0.0;
                spVatPerDebt = 0.0;
                //redAmt = 0.0;
                //redPerc = 0.0;

                labVatDisc = 0.0;
                gmVatDisc = 0.0;
                spareVatDisc = 0.0;
                totLabVatDisc = 0.0;
                totGmVatDisc = 0.0;
                totSpareVatDisc = 0.0;

                for (var k = 0; k < rowdisdata.length; k++) {

                    if (rowdisdata[k].DebtType == debtType) {
                        var idItem = rowdisdata[k].IdJob;
                        var idMake = rowdisdata[k].Id_Make;
                        var idCust = $('#<%=lblCustName.ClientID%>').text();
                        var vats = LoadGMHPVat(idItem, idMake, idCust);
                        gmVat = 0.0;
                        hpVat = 0.0;
                        spVat = 0.0;

                        if (vats.length > 0) {
                            gmVat = fnformatDecimalValue(vats[0], seperator);
                            hpVat = fnformatDecimalValue(vats[1], seperator);
                            spVat = fnformatDecimalValue(vats[2], seperator);
                        }

                        var hpVatPer = hpVat;
                        var gmVatPer = gmVat;
                        var spVatPer = spVat;

                        if (rowdisdata[k].Diff == "L") {
                            var amount = 0.0;
                            amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = fnformatDecimalValue($('#<%=txtGM.ClientID%>').val(), seperator);
                            if (rowdisdata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                            }

                            //Lab and GM Discount
                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                                totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                                totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                            }

                            hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                            gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                            hpVat = fnreformatDecimal(hpVat, seperator);
                            gmVat = fnreformatDecimal(gmVat, seperator);
                            amtL = fnreformatDecimal(amtL, seperator);
                            TotalGM = fnreformatDecimal(TotalGM, seperator);

                            //  $('#<%=txtGMVat.ClientID%>').val(gmVat);
                            //  $('#<%=txtTLab.ClientID%>').val(amtL);

                            hpVatPerDebt = hpVat;
                            gmVatPerDebt = gmVat;

                            var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            //  rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);
                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                            //  rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                        }

                        if (rowdisdata[k].Diff == "S") {
                            var amount = 0.0;
                            //amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator)
                            amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                            vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVat))).toFixed(2);
                            amtS = fnreformatDecimal(amtS, seperator);
                            vatAmount = fnreformatDecimal(vatAmount, seperator);
                            // $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                            // $('#<%=txtTSP.ClientID%>').val(amtS);
                            spVatPerDebt = vatAmount;

                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                var amt;
                                var boQty;
                                if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                    boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                } else {
                                    boQty = 0;
                                }

                                if (boQty != "0") {
                                    //discAmount = 0;
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                                } else {
                                    amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                    //discAmount = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2);
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                                }
                            }

                            //Spare Discount
                            var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                            spareVatDisc = (amount * (spVat / 100)).toFixed(2);
                            totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                        }

                        if (rowdisdata[k].Disc_Amt != undefined) {
                            discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                        }

                        discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);

                        if (rowdisdata[k].Diff == "OR" && rowdisdata[k].DebtType == "OHC") {
                            ownRiskAmt = fnformatDecimalValue(rowdisdata[k].Pris, seperator);
                        }

                        if ((rowdisdata[k].Diff == "RAOR" || rowdisdata[k].Diff == "RBOR") && rowdisdata[k].DebtType == "OHC") {
                            redAmt = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                            redPerc = fnformatDecimalValue(rowdisdata[k].Ford, seperator);
                        }
                        if (($('#<%=hdnIntCustId.ClientID%>').val() != "") && rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff != null) {
                            fordIntPerc = fnformatDecimalValue(rowdisdata[k].Ford, seperator);
                        }
                        if (($('#<%=hdnClaimCustId.ClientID%>').val() != "") && rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff != null) {
                            fordClaPerc = fnformatDecimalValue(rowdisdata[k].Ford, seperator);
                        }
                        if (($('#<%=hdnIntCustId.ClientID%>').val() != "") || ($('#<%=hdnClaimCustId.ClientID%>').val() != "")) {
                            if (rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff != null) {
                                fordOhcPerc = fnformatDecimalValue(rowdisdata[k].Ford, seperator);
                            }
                        }
                        if (($('#<%=hdnMiscCustId.ClientID%>').val() != "") && rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff != null) {
                            fordPerc = fnformatDecimalValue(rowdisdata[k].Ford, seperator);
                        }

                    }

                }//end of grid

                var total = (fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtL, seperator) + fnformatDecimalValue(amtS, seperator)).toFixed(2);
                var vatTotal = (fnformatDecimalValue(hpVatPerDebt, seperator) + fnformatDecimalValue(gmVatPerDebt, seperator) + fnformatDecimalValue(spVatPerDebt, seperator)).toFixed(2);
                var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                var TExclVat = ((fnformatDecimalValue(total, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                redAfterOR = fnformatDecimalValue(total, seperator) - fnformatDecimalValue(ownRiskAmt, seperator);
                redBeforeOR = fnformatDecimalValue(total, seperator);

                total = fnreformatDecimal(total, seperator);
                vatTotal = fnreformatDecimal(vatTotal, seperator);
                //TIncVat = fnreformatDecimal(TIncVat, seperator);
                discAmount = fnreformatDecimal(discAmount, seperator);
                if (fnformatDecimalValue(redPerc, seperator) == 0 && fnformatDecimalValue(redAmt, seperator) > 0) {
                    redPerc = ((fnformatDecimalValue(redAmt, seperator) / fnformatDecimalValue($('#<%=txtNet.ClientID%>').val(), seperator)) * 100).toFixed(2);
                }

                var redVAT = 0.0;

                if ($('#<%=hdnReductionType.ClientID%>').val() == "RBOR") {
                    redVAT = (fnformatDecimalValue($('#<%=txtVat.ClientID%>').val(), seperator) * fnformatDecimalValue(redPerc, seperator) * 0.01);
                } else if ($('#<%=hdnReductionType.ClientID%>').val() == "RAOR") {
                    var totvatPerc = fnformatDecimalValue($('#<%=txtNet.ClientID%>').val(), seperator) - fnformatDecimalValue(ownRiskAmt, seperator);

                    //totvatPerc = fnformatDecimalValue(totvatPerc, seperator) * (0.25); //[VAT Percentage to be done]
                    totvatPerc = fnformatDecimalValue(totvatPerc, seperator) * ($('#<%=hdnOrdHeadDebtVatPerc.ClientID%>').val() * 0.01); //[VAT Percentage to be done]

                    //redVAT = (fnformatDecimalValue($('#<%=txtVat.ClientID%>').val(), seperator) * fnformatDecimalValue(redPerc, seperator) * 0.01);
                    redVAT = (fnformatDecimalValue(totvatPerc, seperator) * fnformatDecimalValue(redPerc, seperator) * 0.01);
                }

                if (debtType == "OHC") {
                    var mainDebAmt = (fnformatDecimalValue(total, seperator) + fnformatDecimalValue(ownRiskAmt, seperator) + fnformatDecimalValue(redAmt, seperator) - fnformatDecimalValue(discAmount, seperator)).toFixed(2);

                    if (fnformatDecimalValue(redAmt, seperator) > 0 && fnformatDecimalValue(redPerc, seperator) > 0 && $('#<%=hdnOwnPayVAT.ClientID%>').val().toString() == "false") {
                        mainDebAmt = (fnformatDecimalValue(mainDebAmt, seperator) + fnformatDecimalValue(redVAT, seperator)).toFixed(2);
                    }
                    mainDebAmt = (fnformatDecimalValue(mainDebAmt, seperator) + fnformatDecimalValue(vatTotal, seperator)).toFixed(2);
                    $('#<%=hdnMainDebtAmt.ClientID%>').val(mainDebAmt);

                }
                else if (debtType == "INSC") {
                    if ($('#<%=hdnInsCustId.ClientID%>').val() != "" && $('#<%=hdnInsCustId.ClientID%>').val() != undefined) {
                        var inscDebAmt = (fnformatDecimalValue(TIncVat, seperator) - fnformatDecimalValue(ownRiskAmt, seperator) - fnformatDecimalValue(redAmt, seperator)).toFixed(2);
                        // inscDebAmt = (fnformatDecimalValue(inscDebAmt, seperator) - fnformatDecimalValue(redVAT, seperator)).toFixed(2);

                        if (fnformatDecimalValue(redAmt, seperator) > 0 && fnformatDecimalValue(redPerc, seperator) > 0 && $('#<%=hdnOwnPayVAT.ClientID%>').val().toString() == "false") {
                            inscDebAmt = (fnformatDecimalValue(inscDebAmt, seperator) - fnformatDecimalValue(redVAT, seperator)).toFixed(2);
                        }

                        if ($('#<%=hdnOwnPayVAT.ClientID%>').val().toString() == "true") {
                            inscDebAmt = (fnformatDecimalValue(inscDebAmt, seperator) - fnformatDecimalValue(vatTotal, seperator)).toFixed(2);

                            var ownPayVatMainDebt = $('#<%=hdnMainDebtAmt.ClientID%>').val();
                            ownPayVatMainDebt = (fnformatDecimalValue(ownPayVatMainDebt, seperator) + fnformatDecimalValue(vatTotal, seperator)).toFixed(2);
                            $('#<%=hdnMainDebtAmt.ClientID%>').val(ownPayVatMainDebt);
                        }

                        $('#<%=hdnInsDebtAmt.ClientID%>').val(inscDebAmt);
                    } else {
                        $('#<%=hdnInsDebtAmt.ClientID%>').val(0);
                    }
                }
                else if (debtType == "INTC") {
                    if ($('#<%=hdnIntCustId.ClientID%>').val() != "" && $('#<%=hdnIntCustId.ClientID%>').val() != undefined) {
                        var intcDebAmt = (fnformatDecimalValue(total, seperator) - fnformatDecimalValue(discAmount, seperator)).toFixed(2);
                        intcDebAmt = (fnformatDecimalValue(intcDebAmt, seperator) + fnformatDecimalValue(vatTotal, seperator)).toFixed(2);
                        //var intcDebAmt = (fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val(), seperator) * fnformatDecimalValue(fordIntPerc, seperator) * 0.01).toFixed(2);
                        $('#<%=hdnIntDeptDebtAmt.ClientID%>').val(intcDebAmt);
                    } else {
                        $('#<%=hdnIntDeptDebtAmt.ClientID%>').val(0);
                    }

                }
                else if (debtType == "CLA") {
                    if ($('#<%=hdnClaimCustId.ClientID%>').val() != "" && $('#<%=hdnClaimCustId.ClientID%>').val() != undefined) {
                        var claDebAmt = (fnformatDecimalValue(total, seperator) - fnformatDecimalValue(discAmount, seperator)).toFixed(2);
                        claDebAmt = (fnformatDecimalValue(claDebAmt, seperator) + fnformatDecimalValue(vatTotal, seperator)).toFixed(2);
                        $('#<%=hdnClaimDebtAmt.ClientID%>').val(claDebAmt);
                    } else {
                        $('#<%=hdnClaimDebtAmt.ClientID%>').val(0);
                    }
                }
                else if (debtType == "MISC") {
                    if ($('#<%=hdnMiscCustId.ClientID%>').val() != "" && $('#<%=hdnMiscCustId.ClientID%>').val() != undefined) {
                        var mainDebAmt = $('#<%=hdnMainDebtAmt.ClientID%>').val();
                        var miscDebAmt = 0;
                        if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {
                            fordPerc = fnformatDecimalValue("0", seperator);
                        } else {
                            //fordPerc = fnformatDecimalValue(100, seperator) - fnformatDecimalValue(fordPerc, seperator);
                            miscDebAmt = (fnformatDecimalValue(total, seperator) + fnformatDecimalValue(ownRiskAmt, seperator) + fnformatDecimalValue(redAmt, seperator) - fnformatDecimalValue(discAmount, seperator)).toFixed(2);
                            miscDebAmt = (fnformatDecimalValue(miscDebAmt, seperator) + fnformatDecimalValue(vatTotal, seperator)).toFixed(2);
                        }

                        //If own risk exists and if misc customer pays own risk amt
                        if (fnformatDecimalValue(ownRiskAmt, seperator) > 0) {
                            if ($('#<%=chkMiscMoveOwnRisk.ClientID%>').is(':checked')) {
                                mainDebAmt = (fnformatDecimalValue(mainDebAmt, seperator) - fnformatDecimalValue(ownRiskAmt, seperator)).toFixed(2);
                                miscDebAmt = (fnformatDecimalValue(miscDebAmt, seperator) + fnformatDecimalValue(ownRiskAmt, seperator)).toFixed(2);
                            }
                        }

                        $('#<%=hdnMainDebtAmt.ClientID%>').val(mainDebAmt);
                        $('#<%=hdnMiscDebtAmt.ClientID%>').val(miscDebAmt);
                    } else {
                        $('#<%=hdnMiscDebtAmt.ClientID%>').val(0);
                    }
                }
            }//end of debitors             
        }

        function saveJobDet(id) {
            var rowalldata = $('#jobgrid').jqGrid('getGridParam', 'data');
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var jobIdXml;
            var spareXml;
            var discXml;
            var mechXml;
            var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
            var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
            var idWODetSeq = "1";
            var idRpgCatgWO = "";
            var idRpgCodeWO = ""
            var idRepCodeWO = $('#<%=ddlRepairCode.ClientID%>').val();
            var idWorkCodeWO = $('#<%=ddlWorkCode.ClientID%>').val();
            var woFixedPrice;
            var idJobPcdWO;
            var woPlannedTime = "0";
            var woHourleyPrice = "0";
            var woClkTime = "0"; //load in service Fetch_WO_ClkTime() 
            var woChrgTime;
            var flgChrgStdTime;
            var woStdTime;
            var stationReq;
            var woJobTxt = "";
            var woOwnRiskAmt = "" // Check for own risk session
            var woTotLabAmt;
            var woTotSpareAmt;
            var woTotGmAmt;
            var woTotVatAmt;
            var woTotDiscAmt;
            var jobStatus = "" // "CSA";
            var woOwnRiskDesc = "";
            var desc = "";

            var woOwnPayVat, idDefectNoteSeq, totalamt, idMechComp, woOwnRiskCust, woOwnCrCust, idSerCallNo, woGmPer, woGmVatPer, woLbrVatPer, woInclVat, woDiscount;
            var subrepCodeWO, ownriskvat, flgSprsts, salesman;
            var flgVatFree, costPrice, finalTotal, finalVat, finalDiscount, woChrgTimeFp, woTotLabAmtFp, woTotSpareAmtFp, woTotGmAmtFp, woTotVatAmtFp, woTotDiscAmtFp, woIntNote, flgawaitingSp;
            var mode;
            spareXml = "<root></root>";
            discXml = "<root></root>";
            mechXml = "<root></root>";
            var idJob = "0";
            var jobNumber = "";

            if ($('#<%=ddlStatus.ClientID%>')[0].selectedIndex == 0) {
                jobStatus = "CSA";
            } else {
                jobStatus = $('#<%=ddlStatus.ClientID%>').val();
            }

            var rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);

            var noOfJobs = new Array();
            for (var i = 0; i < rowalldata.length; i++) {
                if (rowalldata[i].Flag == "1" && rowalldata[i].DebtType == "OHC") {
                    noOfJobs.push(rowalldata[i].JobId);
                }
            }

            //looping through jobs
            for (var j = 0; j < noOfJobs.length; j++) {
                var amtS = 0.0;
                var vatAmount = 0.0;
                var amtL = 0.0;
                var discAmount = 0.0;
                var TotalGM = 0.0;
                var amtG = 0.0;
                var hpVatAmt = 0.0;
                var gmvatAmt = 0.0;
                var woTotSpareAmt = "0";
                var woTotLabAmt = "0";
                var woTotGmAmt = "0";
                var woTotVatAmt = "0";
                var woTotDiscAmt = "0";
                var finalTotal = "0";
                var finalVat = "0";
                var finalDiscount = "0";
                var woTotDiscAmtFp = "0";
                var totalamt = "0";
                var amountS = 0.0;
                var amount = 0.0;
                var labDisc = 0.0;
                var gmDisc = 0.0;
                var spareDisc = 0.0;
                var discPerLine = 0.0;
                var discPerJob = 0.0;
                var idMech = "";
                var woOwnRiskSlNo = 0;
                var labVatDisc = 0.0;
                var gmVatDisc = 0.0;
                var spareVatDisc = 0.0;
                var totLabVatDisc = 0.0;
                var totGmVatDisc = 0.0;
                var totSpareVatDisc = 0.0;
                var isSpareExist = "False"

                idJob = noOfJobs[j];
                spareXml = "";
                discXml = "";
                mechXml = "";
                woOwnRiskAmt = "";
                woOwnRiskDesc = "";
                woOwnRiskSlNo = 0;
                var redPerc = "0";
                var redBefOR = "0";
                var redAftrOR = "0";
                var redAmt = "0";
                var woVatPercentage = "0"

                for (var k = 0; k < rowalldata.length; k++) {
                    //To save the details for each job
                    if (rowalldata[k].JobId == idJob) {

                        if (rowalldata[k].Flag == "1") {
                            if (rowalldata[k].RC == null) {
                                idRepCodeWO = $('#<%=ddlRepairCode.ClientID%>').val();
                            }
                            else {
                                idRepCodeWO = rowalldata[k].RC;
                            }

                            if (rowalldata[k].WC == null) {
                                idWorkCodeWO = $('#<%=ddlWorkCode.ClientID%>').val();
                            }
                            else {
                                idWorkCodeWO = rowalldata[k].WC;
                            }
                            idMech = rowalldata[k].MechanicName;
                        }
                        var idCust = $('#<%=lblCustName.ClientID%>').text();
                        var vats = LoadGMHPVat(rowalldata[k].IdJob, rowalldata[k].Id_Make, idCust);
                        var gmVat = 0.0;
                        var hpVat = 0.0;
                        var spVat = 0.0;

                        if (vats.length > 0) {
                            gmVat = fnformatDecimalValue(vats[0], seperator);
                            hpVat = fnformatDecimalValue(vats[1], seperator);
                            spVat = fnformatDecimalValue(vats[2], seperator);
                        }

                        woFixedPrice = "0";
                        idJobPcdWO = "0";

                        flgChrgStdTime = "0";
                        woStdTime = "0";
                        stationReq = "0";

                        woOwnPayVat = "0";
                        idDefectNoteSeq = "0";

                        idMechComp = "0";
                        woOwnRiskCust = $('#<%=lblCustName.ClientID%>').text();
                        woOwnCrCust = "";
                        idSerCallNo = "0";
                        woGmPer = $('#<%=txtGM.ClientID%>').val();

                        woGmVatPer = gmVat;
                        woLbrVatPer = hpVat;
                        woInclVat = "0";
                        subrepCodeWO = "0";
                        ownriskvat = "0";//calcuate based on session
                        flgSprsts = "0";//  Session("FlGSPSTS")
                        salesman = "";
                        flgVatFree = "0";
                        costPrice = "0";
                        woIntNote = "";
                        flgawaitingSp = "0";

                        //Discount Percentage for each line
                        if (rowalldata[k].Rab == "" || rowalldata[k].Rab == undefined) {
                            woDiscount = 0;
                        } else {
                            woDiscount = fnformatDecimalValue(rowalldata[k].Rab, seperator);
                        }

                        if (woTotLabAmtFp == undefined) {
                            woTotLabAmtFp = "0";
                        }

                        if (rowalldata[k].Ford >= "0" && rowalldata[k].Pris != "" && rowalldata[k].DebtType == "OHC" && rowalldata[k].Bestilt == "" && rowalldata[k].Levert == "" && rowalldata[k].Diff == "OR") {
                            woOwnRiskAmt = rowalldata[k].Pris;
                            woOwnRiskDesc = rowalldata[k].Text;
                            woOwnRiskSlNo = rowalldata[k].id;
                        } 

                        if (rowalldata[k].Diff == "L" && rowalldata[k].DebtType == "OHC") {
                            woHourleyPrice = rowalldata[k].Pris;

                            if (woHourleyPrice == "") {
                                woHourleyPrice = "0";
                            }

                            if (rowalldata[k].Levert == "") {
                                woChrgTime = "0";
                                woChrgTimeFp = "0";
                            } else {
                                woChrgTime = rowalldata[k].Levert;
                                woChrgTimeFp = rowalldata[k].Levert;
                            }

                            var amount = 0.0;
                            //amount = fnformatDecimalValue(rowalldata[k].Belop, seperator);
                            amount = fnformatDecimalValue(rowalldata[k].Levert, seperator) * fnformatDecimalValue(rowalldata[k].Pris, seperator);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = fnformatDecimalValue($('#<%=txtGM.ClientID%>').val(), seperator);
                            if (rowalldata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                            }

                            if (rowalldata[k].Belop == undefined) {
                                woTotLabAmt = "";
                            } else {
                                woTotLabAmt = fnreformatDecimal(amtL, seperator);
                            }

                            //labDisc = fnformatDecimalValue((amount * (woDiscount / 100)), seperator); // Discount Per Line
                            //gmDisc = fnformatDecimalValue((amtG * (woDiscount / 100)), seperator); // Discount Per Line

                            //Discount Per Line
                            labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (woDiscount / 100)), seperator)).toFixed(2);
                            gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (woDiscount / 100)), seperator)).toFixed(2);

                            labVatDisc = (amount * (hpVat / 100)).toFixed(2);
                            totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowalldata[k].Rab, seperator) * 0.01)).toFixed(2);

                            gmVatDisc = (amtG * (gmVat / 100)).toFixed(2);
                            totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowalldata[k].Rab, seperator) * 0.01)).toFixed(2);

                            discPerJob = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);
                            woTotDiscAmt = discPerJob;
                            finalDiscount = discPerJob;

                            woTotSpareAmt = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmt = fnreformatDecimal(TotalGM, seperator);
                            //hpVatAmt = (amtL * (hpVat / 100)).toFixed(2);
                            //gmVatAmt = (TotalGM * (gmVat / 100)).toFixed(2);
                            hpVatAmt = (amount * (hpVat / 100)).toFixed(2);
                            gmVatAmt = (amtG * (gmVat / 100)).toFixed(2);

                            woTotVatAmt = fnformatDecimalValue(hpVatAmt, seperator) + fnformatDecimalValue(gmVatAmt, seperator);
                            woTotVatAmt = fnreformatDecimal(woTotVatAmt, seperator);
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);

                            //finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amtL, seperator) + fnformatDecimalValue(TotalGM, seperator); //+ fnformatDecimalValue(woTotSpareAmt, seperator);
                            finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amount, seperator) + fnformatDecimalValue(amtG, seperator); //+ fnformatDecimalValue(woTotSpareAmt, seperator);
                            finalVat = fnformatDecimalValue(finalVat, seperator) + fnformatDecimalValue(woTotVatAmt, seperator);
                            //finalDiscount = "0";
                            //totalamt = fnformatDecimalValue(totalamt, seperator) + fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);
                            totalamt = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator) - fnformatDecimalValue(finalDiscount, seperator);

                            finalTotal = fnreformatDecimal(finalTotal, seperator);
                            finalVat = fnreformatDecimal(finalVat, seperator);
                            totalamt = fnreformatDecimal(totalamt, seperator);

                            woTotDiscAmt = fnreformatDecimal(woTotDiscAmt, seperator);
                            finalDiscount = fnreformatDecimal(finalDiscount, seperator);

                            if (rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined || rowalldata[k].IdWODetailseq == null && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" LineType ="L" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0" REDUCTION_AMOUNT="0" DBT_DIS_PER="0" DEB_STATUS=""  />';

                                mechXml = mechXml + ' <insert ID_MECH="' + rowalldata[k].IdMech.toString() + '" Id_Sl_No="' + rowalldata[k].id.toString() + '" ID_WOLAB_SEQ = "" LabourDesc = "' + rowalldata[k].Text.toString() + '"  Wo_Lab_Hrs = "' + fnformatDecimalValue(rowalldata[k].Levert.toString(), seperator) + '" HourlyPr = "' + fnformatDecimalValue(rowalldata[k].Pris.toString(), seperator) + '" WO_Lab_Discount = "' + fnformatDecimalValue(woDiscount) + '"  LineType ="L" />';
                            }
                            else {
                                if (rowalldata[k].DebtType == "OHC") {
                                    mode = "Update";
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                                'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00"  CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0" REDUCTION_AMOUNT="0" DBT_DIS_PER="0" DEB_STATUS="" />';

                                    mechXml = mechXml + ' <insert ID_MECH="' + rowalldata[k].IdMech.toString() + '" Id_Sl_No="' + rowalldata[k].id.toString() + '" ID_WOLAB_SEQ = "' + rowalldata[k].IdWOLabSeq.toString() + '" LabourDesc = "' + rowalldata[k].Text.toString() + '"  Wo_Lab_Hrs = "' + fnformatDecimalValue(rowalldata[k].Levert.toString(), seperator) + '" HourlyPr = "' + fnformatDecimalValue(rowalldata[k].Pris.toString(), seperator) + '" WO_Lab_Discount = "' + fnformatDecimalValue(woDiscount) + '"  LineType ="L" />';
                                }
                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }
                        else if (rowalldata[k].Diff == "S" && rowalldata[k].DebtType == "OHC") {
                            var idItem = rowalldata[k].IdJob.toString();
                            var idJobDeb = $('#<%=lblCustName.ClientID%>').text();
                            var idVeh = $('#<%=hdnVehId.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make.toString();
                            var idWh = "1";
                            var disSeq;
                            var jobVatPer = 0.0;
                            var jobVatSeq;
                            var item_avail_qty;
                            var bo_qty;
                            var delivQty;
                            var ordQty;
                            item_avail_qty = fnformatDecimalValue(rowalldata[k].Item_Avail_Qty, seperator);
                            ordQty = fnformatDecimalValue(rowalldata[k].Bestilt, seperator);
                            delivQty = fnformatDecimalValue(rowalldata[k].Levert, seperator);
                            isSpareExist = "True"


                            if (rowalldata[k].Jobi_Bo_Qty == "" || rowalldata[k].Jobi_Bo_Qty == undefined || rowalldata[k].Jobi_Bo_Qty == null) {
                                bo_qty = fnformatDecimalValue("0", seperator);
                            } else {
                                bo_qty = fnformatDecimalValue(rowalldata[k].Jobi_Bo_Qty, seperator);
                            }

                            var detSeq = GetVatDis(idItem, idJobDeb, idVeh, idMake, idWh);

                            disSeq = detSeq[0];
                            jobVatPer = fnformatDecimalValue(detSeq[1], seperator);
                            jobVatSeq = detSeq[2];

                            var disPer = rowalldata[k].Rab;
                            if (disPer == "" || disPer == undefined) {
                                disPer = "0.00";
                            }

                            // amountS = fnformatDecimalValue(rowalldata[k].Belop, seperator)
                            amountS = fnformatDecimalValue(rowalldata[k].Levert, seperator) * fnformatDecimalValue(rowalldata[k].Pris, seperator);
                            amtS = (fnformatDecimalValue(amtS, seperator) + amountS).toFixed(2);
                            //vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowalldata[k].Pris, seperator) * (fnformatDecimalValue(rowalldata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVat))).toFixed(2);
                            vatAmount = (((fnformatDecimalValue(rowalldata[k].Pris, seperator) * (fnformatDecimalValue(rowalldata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVat))).toFixed(2);
                            amtS = fnreformatDecimal(amtS, seperator);
                            vatAmount = fnreformatDecimal(vatAmount, seperator);

                            woChrgTime = "0";
                            woChrgTimeFp = "0";
                            woTotSpareAmt = amtS;
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            finalVat = fnformatDecimalValue(finalVat, seperator) + fnformatDecimalValue(vatAmount, seperator);
                            spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue((amountS * (woDiscount / 100)), seperator)).toFixed(2);
                            spareVatDisc = (amountS * (spVat / 100)).toFixed(2);
                            totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowalldata[k].Rab, seperator) * 0.01)).toFixed(2);
                            
                            discPerJob = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);
                            woTotDiscAmt = discPerJob;
                            finalDiscount = discPerJob;

                            //finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amtS, seperator);
                            finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amountS, seperator);

                            //totalamt = fnformatDecimalValue(totalamt, seperator) + fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);
                            totalamt = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator); //without discount
                            //totalamt = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator) - fnformatDecimalValue(finalDiscount, seperator);


                            //spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue((amountS * (woDiscount / 100)), seperator)).toFixed(2);

                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);
                            finalVat = fnreformatDecimal(finalVat, seperator);
                            finalTotal = fnreformatDecimal(finalTotal, seperator);
                            totalamt = fnreformatDecimal(totalamt, seperator);

                            if (rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined || rowalldata[k].IdWODetailseq == null && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + rowalldata[k].Id_Make + '" ID_WAREHOUSE = "' + rowalldata[k].Id_Warehouse + '" ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    fnformatDecimalValue(rowalldata[k].Bestilt, seperator) + '" JOBI_DELIVER_QTY= "' + fnformatDecimalValue(delivQty, seperator) + '" JOBI_BO_QTY ="' + fnformatDecimalValue(bo_qty, seperator) + '" JOBI_DIS_PER ="' + fnformatDecimalValue(disPer, seperator) + '" JOBI_VAT_PER ="' + fnformatDecimalValue(spVat, seperator) + '" ORDER_LINE_TEXT ="" ' +
                                     ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "' + fnformatDecimalValue(rowalldata[k].Sp_Cost_Price, seperator) + '" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="" TD_CALC ="True " ITEM_DESC="' +
                                     rowalldata[k].Text + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                     ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="S"  SPARE_DISCOUNT="' + rowalldata[k].SpareDiscount.toString() + '"   />';

                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                 'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue(vatAmount, seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue(woTotSpareAmt, seperator) + '" LineType ="S" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                            }
                            else {
                                //idWODetSeq = rowalldata[k].IdWODetailseq;
                                mode = "Update";
                                if (rowalldata[k].IdWOItemseq == "" || rowalldata[k].IdWOItemseq == undefined || rowalldata[k].IdWOItemseq == null && rowalldata[k].DebtType == "OHC") {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + rowalldata[k].Id_Make + '" ID_WAREHOUSE = "' + rowalldata[k].Id_Warehouse + '" ID_WODET_SEQ_JOB="0"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    fnformatDecimalValue(rowalldata[k].Bestilt, seperator) + '" JOBI_DELIVER_QTY= "' + fnformatDecimalValue(delivQty, seperator) + '" JOBI_BO_QTY ="' + fnformatDecimalValue(bo_qty, seperator) + '" JOBI_DIS_PER ="' + fnformatDecimalValue(disPer, seperator) + '" JOBI_VAT_PER ="' + fnformatDecimalValue(spVat, seperator) + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="0" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "' + fnformatDecimalValue(rowalldata[k].Sp_Cost_Price, seperator) + '" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="" TD_CALC ="True " ITEM_DESC="' +
                                    rowalldata[k].Text + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="S" SPARE_DISCOUNT="' + rowalldata[k].SpareDiscount.toString() + '" />';
                                }
                                else {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + rowalldata[k].Id_Make + '" ID_WAREHOUSE = "' + rowalldata[k].Id_Warehouse + '" ID_WODET_SEQ_JOB="' + rowalldata[k].IdWODetailseq + '"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                     fnformatDecimalValue(rowalldata[k].Bestilt, seperator) + '" JOBI_DELIVER_QTY= "' + fnformatDecimalValue(rowalldata[k].Levert, seperator) + '" JOBI_BO_QTY ="' + fnformatDecimalValue(bo_qty, seperator) + '" JOBI_DIS_PER ="' + fnformatDecimalValue(disPer, seperator) + '" JOBI_VAT_PER ="' + fnformatDecimalValue(spVat, seperator) + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="' + rowalldata[k].IdWOItemseq + '" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "' + fnformatDecimalValue(rowalldata[k].Sp_Cost_Price, seperator) + '" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="" TD_CALC ="True " ITEM_DESC="' +
                                    rowalldata[k].Text + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="S" SPARE_DISCOUNT="' + rowalldata[k].SpareDiscount.toString() + '"  />';
                                }

                                if (rowalldata[k].DebtType == "OHC") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue(vatAmount, seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue(woTotSpareAmt, seperator) + '" LineType ="S" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0" REDUCTION_AMOUNT="0" DBT_DIS_PER="0"  />';
                                }
                            }

                            jobIdXml = "<root>" + jobIdXml + "</root>";

                            var spDebRab;
                            if (rowalldata[k].Rab != undefined && rowalldata[k].Rab != "" && rowalldata[k].DebtType == "OHC") {
                                spDebRab = fnformatDecimalValue(rowalldata[k].Rab.toString(), seperator);
                            } else { spDebRab = "0"; }

                            discXml = discXml + '<insert ID_DEBTOR ="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_ITEM = "' + rowalldata[k].IdJob + '" ID_MAKE = "' + rowalldata[k].Id_Make + '" ID_WAREHOUSE = "' + rowalldata[k].Id_Warehouse + '" DBT_VAT_AMOUNT = "' +
                                 fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" DBT_DIS_AMT="' + fnformatDecimalValue($('#<%=txtDisc.ClientID%>').val().toString(), seperator) + '" JOB_VAT_PER="' + jobVatPer + '" JOB_VAT_SEQ="' + jobVatSeq + '" JOB_DIS_SEQ="' + disSeq + '" JOB_DIS_PER="' + spDebRab + '" />';
                        }
                        else if (((rowalldata[k].Diff == "T" && rowalldata[k].IdWOLabSeq == "") || (rowalldata[k].IdJob == "" && rowalldata[k].Text != "" && rowalldata[k].Levert == "" && rowalldata[k].IdWOLabSeq == "" && rowalldata[k].Pris == "")) && rowalldata[k].DebtType == "OHC" && rowalldata[k].Diff != "RAOR" && rowalldata[k].Diff != "RBOR") {
                            var idItem = rowalldata[k].IdJob.toString();
                            var idJobDeb = $('#<%=lblCustName.ClientID%>').text();
                            var idVeh = $('#<%=hdnVehId.ClientID%>').val();
                            var idMake = "";//rowalldata[k].Id_Make.toString();
                            var idWh = "1";
                            var disSeq;
                            var jobVatPer = 0.0;
                            var jobVatSeq;

                            var detSeq = GetVatDis(idItem, idJobDeb, idVeh, idMake, idWh);

                            disSeq = detSeq[0];
                            jobVatPer = fnformatDecimalValue(detSeq[1], seperator);
                            jobVatSeq = detSeq[2];

                            var disPer = rowalldata[k].Rab;
                            if (disPer == "") {
                                disPer = "0.00";
                            }

                            var idwarehouse = rowalldata[k].Id_Warehouse;
                            if (idwarehouse == undefined || idwarehouse == "" || idwarehouse == "0") {
                                idwarehouse = 1;//check this
                            }

                            woChrgTime = "0";
                            woChrgTimeFp = "0";
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);

                            if ((rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined) && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ' +
                                ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.0" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0" />';

                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val().toString(), seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                 'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue($('#<%=txtVat.ClientID%>').val().toString(), seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" LineType ="T"  CUST_TYPE="OHC"  WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                            }
                            else {
                                //idWODetSeq = rowalldata[k].IdWODetailseq;
                                mode = "Update";
                                if ((rowalldata[k].IdWOItemseq == "" || rowalldata[k].IdWOItemseq == undefined || rowalldata[k].IdWOItemseq == "0") && rowalldata[k].DebtType == "OHC") {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_WODET_SEQ_JOB="0"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="0" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.00" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                    "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0" />';
                                }
                                else {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_WODET_SEQ_JOB="' + rowalldata[k].IdWODetailseq + '"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="' + rowalldata[k].IdWOItemseq + '" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.00" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                    "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0"  />';
                                }
                                if (rowalldata[k].DebtType == "OHC") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val().toString(), seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                     'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue($('#<%=txtVat.ClientID%>').val().toString(), seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" LineType ="T" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0"  />';
                                }
                            }

                            jobIdXml = "<root>" + jobIdXml + "</root>";

                            discXml = discXml + '<insert ID_DEBTOR ="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_ITEM = "' + rowalldata[k].IdJob + '" ID_MAKE = "" ID_WAREHOUSE = "' + idwarehouse + '" DBT_VAT_AMOUNT = "' +
                                 fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" DBT_DIS_AMT="' + fnformatDecimalValue($('#<%=txtDisc.ClientID%>').val().toString(), seperator) + '" JOB_VAT_PER="' + jobVatPer + '" JOB_VAT_SEQ="' + jobVatSeq + '" JOB_DIS_SEQ="' + disSeq + '" JOB_DIS_PER="0" />';
                        }//Labour to TextLine
                        else if (rowalldata[k].Diff == "T" && rowalldata[k].Text != "" && rowalldata[k].Levert == "" && rowalldata[k].IdWOLabSeq != "" && rowalldata[k].DebtType == "OHC") {
                            woHourleyPrice = rowalldata[k].Pris;

                            if (woHourleyPrice == "") {
                                woHourleyPrice = "0";
                            }

                            if (rowalldata[k].Levert == "") {
                                woChrgTime = "0";
                                woChrgTimeFp = "0";
                            } else {
                                woChrgTime = rowalldata[k].Levert;
                                woChrgTimeFp = rowalldata[k].Levert;
                            }

                            var amount = 0.0;
                            //amount = fnformatDecimalValue(rowalldata[k].Belop, seperator);
                            amount = fnformatDecimalValue(rowalldata[k].Levert, seperator) * fnformatDecimalValue(rowalldata[k].Pris, seperator);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = fnformatDecimalValue($('#<%=txtGM.ClientID%>').val(), seperator);
                            if (rowalldata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                            }

                            if (rowalldata[k].Belop == undefined) {
                                woTotLabAmt = "";
                            } else {
                                woTotLabAmt = fnreformatDecimal(amtL, seperator);
                            }

                            //Discount Per Line
                            labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (woDiscount / 100)), seperator)).toFixed(2);
                            gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (woDiscount / 100)), seperator)).toFixed(2);

                            discPerJob = fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator);

                            woTotDiscAmt = discPerJob;
                            finalDiscount = discPerJob;

                            woTotSpareAmt = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmt = fnreformatDecimal(TotalGM, seperator);
                            //hpVatAmt = (amtL * (hpVat / 100)).toFixed(2);
                            //gmVatAmt = (TotalGM * (gmVat / 100)).toFixed(2);
                            hpVatAmt = (amount * (hpVat / 100)).toFixed(2);
                            gmVatAmt = (amtG * (gmVat / 100)).toFixed(2);

                            woTotVatAmt = fnformatDecimalValue(hpVatAmt, seperator) + fnformatDecimalValue(gmVatAmt, seperator);
                            woTotVatAmt = fnreformatDecimal(woTotVatAmt, seperator);
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);

                            //finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amtL, seperator) + fnformatDecimalValue(TotalGM, seperator); //+ fnformatDecimalValue(woTotSpareAmt, seperator);
                            finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amount, seperator) + fnformatDecimalValue(amtG, seperator); //+ fnformatDecimalValue(woTotSpareAmt, seperator);
                            finalVat = fnformatDecimalValue(finalVat, seperator) + fnformatDecimalValue(woTotVatAmt, seperator);
                            //finalDiscount = "0";
                            //totalamt = fnformatDecimalValue(totalamt, seperator) + fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);
                            totalamt = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);

                            finalTotal = fnreformatDecimal(finalTotal, seperator);
                            finalVat = fnreformatDecimal(finalVat, seperator);
                            totalamt = fnreformatDecimal(totalamt, seperator);

                            if ((rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined || rowalldata[k].IdWODetailseq == null) && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" LineType ="L" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0"  />';

                                mechXml = mechXml + ' <insert ID_MECH="' + rowalldata[k].IdMech.toString() + '" Id_Sl_No="' + rowalldata[k].id.toString() + '" ID_WOLAB_SEQ = "" LabourDesc = "' + rowalldata[k].Text.toString() + '"  Wo_Lab_Hrs = "' + fnformatDecimalValue(rowalldata[k].Levert.toString(), seperator) + '" HourlyPr = "' + fnformatDecimalValue(rowalldata[k].Pris.toString(), seperator) + '" WO_Lab_Discount = "' + fnformatDecimalValue(woDiscount) + '"  LineType ="L" />';
                            }
                            else {
                                mode = "Update";
                                if (rowalldata[k].DebtType == "OHC") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                     'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0"  />';
                                }
                                mechXml = mechXml + ' <insert ID_MECH="' + rowalldata[k].IdMech.toString() + '" Id_Sl_No="' + rowalldata[k].id.toString() + '" ID_WOLAB_SEQ = "' + rowalldata[k].IdWOLabSeq.toString() + '" LabourDesc = "' + rowalldata[k].Text.toString() + '"  Wo_Lab_Hrs = "' + fnformatDecimalValue(rowalldata[k].Levert.toString(), seperator) + '" HourlyPr = "' + fnformatDecimalValue(rowalldata[k].Pris.toString(), seperator) + '" WO_Lab_Discount = "' + fnformatDecimalValue(woDiscount) + '"  LineType ="LT" />';
                            }

                            //TextLine
                            var idItem = "";// rowalldata[k].IdJob.toString();
                            var idJobDeb = $('#<%=lblCustName.ClientID%>').text();
                            var idVeh = $('#<%=hdnVehId.ClientID%>').val();
                            var idMake = "";//rowalldata[k].Id_Make.toString();
                            var idWh = "1";
                            var disSeq;
                            var jobVatPer = 0.0;
                            var jobVatSeq;

                            var detSeq = GetVatDis(idItem, idJobDeb, idVeh, idMake, idWh);

                            disSeq = detSeq[0];
                            jobVatPer = fnformatDecimalValue(detSeq[1], seperator);
                            jobVatSeq = detSeq[2];

                            var disPer = rowalldata[k].Rab;
                            if (disPer == "") {
                                disPer = "0.00";
                            }

                            var idwarehouse = rowalldata[k].Id_Warehouse;
                            if (idwarehouse == undefined || idwarehouse == "" || idwarehouse == "0") {
                                idwarehouse = 1;//check this
                            }

                            woChrgTime = "0";
                            woChrgTimeFp = "0";
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);

                            if (rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined && rowalldata[k].DebtType == "OHC")  {
                                mode = "Add";
                                spareXml = spareXml + '<insert ID_ITEM_JOB ="' + idItem + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ' +
                                ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.0" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0" />';

                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val().toString(), seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                 'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue($('#<%=txtVat.ClientID%>').val().toString(), seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" LineType ="T" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                            }
                            else {
                                //idWODetSeq = rowalldata[k].IdWODetailseq;
                                mode = "Update";
                                if ((rowalldata[k].IdWOItemseq == "" || rowalldata[k].IdWOItemseq == undefined || rowalldata[k].IdWOItemseq == "0") && rowalldata[k].DebtType == "OHC") {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + idItem + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_WODET_SEQ_JOB="' + rowalldata[k].IdWODetailseq + '"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="0" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.00" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                    "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0"  />';
                                }
                                else {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + idItem + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_WODET_SEQ_JOB="' + rowalldata[k].IdWODetailseq + '"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="' + rowalldata[k].IdWOItemseq + '" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.00" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                    "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0"  />';
                                }
                                if (rowalldata[k].DebtType == "OHC") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val().toString(), seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                     'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue($('#<%=txtVat.ClientID%>').val().toString(), seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" LineType ="T" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                                }
                            }

                            //jobIdXml = "<root>" + jobIdXml + "</root>";

                            discXml = discXml + '<insert ID_DEBTOR ="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_ITEM = "' + idItem + '" ID_MAKE = "" ID_WAREHOUSE = "' + idwarehouse + '" DBT_VAT_AMOUNT = "' +
                                 fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" DBT_DIS_AMT="' + fnformatDecimalValue($('#<%=txtDisc.ClientID%>').val().toString(), seperator) + '" JOB_VAT_PER="' + jobVatPer + '" JOB_VAT_SEQ="' + jobVatSeq + '" JOB_DIS_SEQ="' + disSeq + '" JOB_DIS_PER="0" />';

                            jobIdXml = "<root>" + jobIdXml + "</root>";

                        }
                        else if (rowalldata[k].IdWODetailseq != "" && rowalldata[k].IdWODetailseq != undefined && rowalldata[k].IdWODetailseq != null && rowalldata[k].Flag == "0" && rowalldata[k].DebtType == "OHC") {
                            woChrgTime = "0";
                            woChrgTimeFp = "0";
                            woTotLabAmtFp = "0";
                            woTotSpareAmtFp = "0";
                            woTotGmAmtFp = "0";
                            woTotVatAmtFp = "0";
                            mode = "Update";
                            if (rowalldata[k].DebtType == "OHC") {
                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue(woTotSpareAmt, seperator) + '" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" DEB_STATUS=""  />';
                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }

                        if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {

                            var idItem = rowalldata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                            var idCust = $('#<%=hdnInsCustId.ClientID%>').val()

                            var vats = LoadGMHPVat(idItem, idMake, idCust);
                            var inscGmVat = 0.0;
                            var inscHpVat = 0.0;
                            var inscSpVat = 0.0;

                            if (vats.length > 0) {
                                inscGmVat = fnformatDecimalValue(vats[0], seperator);
                                inscHpVat = fnformatDecimalValue(vats[1], seperator);
                                inscSpVat = fnformatDecimalValue(vats[2], seperator);
                            }

                            
                            
                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;

                                if (idJobId == idJob && Debitor == $('#<%=hdnInsCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL"

                                }
                            }

                            //var delarr = new Array()
                            //delarr = fetchDelJobDet(idWONO, idWOPrefix)


                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" ||  rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "INSC" && rowalldata[k].DebtType == "OHC") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var debitorDisc = "";
                            var custLabDisc = "0";
                            var custSpareDisc = "0";
                            var custGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtInsDiscount.ClientID%>').val(), seperator) != "0") {
                                debitorDisc = fnformatDecimalValue($('#<%=txtInsDiscount.ClientID%>').val(), seperator);
                            } else {
                                debitorDisc = "0";
                            }

                            custLabDisc = fnformatDecimalValue($('#<%=hdnInsLabDisc.ClientID%>').val(), seperator);
                            custSpareDisc = fnformatDecimalValue($('#<%=hdnInsSpareDisc.ClientID%>').val(), seperator);
                            custGenDisc = fnformatDecimalValue($('#<%=hdnInsGenDisc.ClientID%>').val(), seperator);
                            if (fnformatDecimalValue(custLabDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custLabDisc = custGenDisc
                            }

                            if (fnformatDecimalValue(custSpareDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custSpareDisc = custGenDisc
                            }

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {
                                ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                if (status == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            if ($('#<%=chkInsMoveVat.ClientID%>').is(':checked') == false) {
                                if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                    var balPerc;
                                    var insDebPerc;
                                    desc = "Reduction After Own Risk"  //rowalldata[k].Text.toString()

                                    if (isSpareExist == "True")
                                    {
                                        woVatPercentage = inscSpVat
                                    }
                                    else {
                                        woVatPercentage = "1.00"
                                    }
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'

                                    balPerc = 100 - ordHeadCustDbtPer; // fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                    //insDebPerc = 100 - redPerc

                                    if (isSpareExist == "True") {
                                        woVatPercentage = inscSpVat
                                    }
                                    else {
                                        woVatPercentage = "0.00"
                                    }

                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + inscGmVat + '" PWO_LBR_VATPER="' + inscHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                            'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';
                                }
                                else {
                                    var balPerc;
                                    var insDebPerc;
                                    if (isSpareExist == "True") {
                                        woVatPercentage = inscSpVat
                                    }
                                    else {
                                        woVatPercentage = "1.00"
                                    }
                                    if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                        jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '"  DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                    } else {
                                        jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                      'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                    }

                                    balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                    //insDebPerc = 100 - redPerc;
                                    if (isSpareExist == "True") {
                                        woVatPercentage = inscSpVat
                                    }
                                    else {
                                        woVatPercentage = "0.00"
                                    }
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="0.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + inscGmVat + '" PWO_LBR_VATPER="' + inscHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                       'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '"  />';
                                }
                            }
                                //Owner pay vat
                            else {
                                if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                    var balPerc;
                                    var insDebPerc;
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '"  DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(finalVat, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />';

                                    balPerc = 100 - ordHeadCustDbtPer;
                                    // fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                    //insDebPerc = 100 - redPerc;
                                    jobIdXml = jobIdXml +
                                               '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(finalTotal, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="0.00" PWO_GM_PER="0.00" PWO_GM_VATPER="0.00" PWO_LBR_VATPER="0.00" PWO_SPR_DISCPER="0.00"  ' +
                                            'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';
                                }
                                else {
                                    var balPerc;
                                    var insDebPerc;
                                    balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)

                                    if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                        jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '"  DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(finalVat, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />';

                                    } else {
                                        jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '"  DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(finalVat, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />';
                                    }

                                    jobIdXml = jobIdXml +
                                        '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(finalTotal, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="0.00" PWO_GM_PER="0.00" PWO_GM_VATPER="0.00" PWO_LBR_VATPER="0.00" PWO_SPR_DISCPER="0.00"  ' +
                                            'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '"  CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';
                                }

                                woOwnPayVat = 1;
                                woOwnCrCust = $('#<%=lblCustName.ClientID%>').text();
                                woOwnRiskCust = $('#<%=hdnInsCustId.ClientID%>').val();
                            }
                                jobIdXml = "<root>" + jobIdXml + "</root>";
                           // }

                        }

                        if (($('#<%=hdnIntCustId.ClientID%>').val() != "") && ($('#<%=hdnClaimCustId.ClientID%>').val() == "")) {

                            var idItem = rowalldata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                            var idIntCust = $('#<%=hdnIntCustId.ClientID%>').val()

                            var vats = LoadGMHPVat(idItem, idMake, idIntCust);
                            var intcGmVat = 0.0;
                            var intcHpVat = 0.0;
                            var intcSpVat = 0.0;

                            if (vats.length > 0) {
                                intcGmVat = fnformatDecimalValue(vats[0], seperator);
                                intcHpVat = fnformatDecimalValue(vats[1], seperator);
                                intcSpVat = fnformatDecimalValue(vats[2], seperator);
                            }



                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;

                                if (idJobId == idJob && Debitor == $('#<%=hdnIntCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL"

                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "INTC") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var debitorDisc = "";
                            var custLabDisc = "0";
                            var custSpareDisc = "0";
                            var custGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtIntDiscount.ClientID%>').val(), seperator) != "0") {
                                debitorDisc = fnformatDecimalValue($('#<%=txtIntDiscount.ClientID%>').val(), seperator);

                            } else {
                                debitorDisc = "0";//[Check]                               
                            }

                            custLabDisc = fnformatDecimalValue($('#<%=hdnIntLabDisc.ClientID%>').val(), seperator);
                            custSpareDisc = fnformatDecimalValue($('#<%=hdnIntSpareDisc.ClientID%>').val(), seperator);
                            custGenDisc = fnformatDecimalValue($('#<%=hdnIntGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue(custLabDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custLabDisc = custGenDisc
                            }

                            if (fnformatDecimalValue(custSpareDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custSpareDisc = custGenDisc
                            }

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            if ($('#<%=hdnIntCustId.ClientID%>').val() != "") {
                                if ($('#<%=txtIntSplit.ClientID%>').val() == "" || $('#<%=txtIntSplit.ClientID%>').val() == "0") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                                else if ($('#<%=txtIntSplit.ClientID%>').val() == "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                }
                                else if (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) < "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue(100, seperator) - fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator);
                                    ordHeadCustDbtPer = fnformatDecimalValue(ordHeadCustDbtPer, seperator);
                                }

                                if (status == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            var orderheadCustAmt = (ordHeadCustDbtPer * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var ordHeadCustVatAmt = (ordHeadCustDbtPer * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            var intCustAmt = (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var intCustVatAmt = (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);

                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                if (isSpareExist == "True") {
                                    woVatPercentage = intcSpVat
                                }
                                else {
                                    woVatPercentage = "0.00"
                                }
                                jobIdXml = jobIdXml +
                                        '<insert ID_DETAIL="' + $('#<%=hdnIntCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(intCustAmt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + intcGmVat + '" PWO_LBR_VATPER="' + intcHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(intCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INTC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (isSpareExist == "True") {
                                    woVatPercentage = intcSpVat
                                }
                                else {
                                    woVatPercentage = "0.00"
                                }
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                  'PWO_FIXED_VATPER = "0.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                if (isSpareExist == "True") {
                                    woVatPercentage = intcSpVat
                                }
                                else {
                                    woVatPercentage = "0.00"
                                }
                                jobIdXml = jobIdXml +
                                '<insert ID_DETAIL="' + $('#<%=hdnIntCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(intCustAmt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + intcGmVat + '" PWO_LBR_VATPER="' + intcHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                   'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(intCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INTC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }
                        if (($('#<%=hdnClaimCustId.ClientID%>').val() != "") && ($('#<%=hdnIntCustId.ClientID%>').val() == "")) {

                            var idItem = rowalldata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                            var idClaCust = $('#<%=hdnClaimCustId.ClientID%>').val()

                            var vats = LoadGMHPVat(idItem, idMake, idClaCust);
                            var claGmVat = 0.0;
                            var claHpVat = 0.0;
                            var claSpVat = 0.0;

                            if (vats.length > 0) {
                                claGmVat = fnformatDecimalValue(vats[0], seperator);
                                claHpVat = fnformatDecimalValue(vats[1], seperator);
                                claSpVat = fnformatDecimalValue(vats[2], seperator);
                            } 
                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;

                                if (idJobId == idJob && Debitor == $('#<%=hdnClaimCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL"
                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "CLA") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var debitorDisc = "";
                            var custLabDisc = "0";
                            var custSpareDisc = "0";
                            var custGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtClaimDiscount.ClientID%>').val(), seperator) != "0") {
                                debitorDisc = fnformatDecimalValue($('#<%=txtClaimDiscount.ClientID%>').val(), seperator);
                            } else {
                                debitorDisc = "0";//[Check]
                            }

                            custLabDisc = fnformatDecimalValue($('#<%=hdnClaLabDisc.ClientID%>').val(), seperator);
                            custSpareDisc = fnformatDecimalValue($('#<%=hdnClaSpareDisc.ClientID%>').val(), seperator);
                            custGenDisc = fnformatDecimalValue($('#<%=hdnClaGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue(custLabDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custLabDisc = custGenDisc
                            }

                            if (fnformatDecimalValue(custSpareDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custSpareDisc = custGenDisc
                            }

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            if ($('#<%=hdnClaimCustId.ClientID%>').val() != "") {
                                if ($('#<%=txtClaimSplit.ClientID%>').val() == "" || $('#<%=txtClaimSplit.ClientID%>').val() == "0") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                                else if ($('#<%=txtClaimSplit.ClientID%>').val() == "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                }
                                else if (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) < "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue(100, seperator) - fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator);
                                    ordHeadCustDbtPer = fnformatDecimalValue(ordHeadCustDbtPer, seperator);
                                }

                                if (status == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            var orderheadCustAmt = (ordHeadCustDbtPer * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var ordHeadCustVatAmt = (ordHeadCustDbtPer * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            var claCustAmt = (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var claCustVatAmt = (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            if (isSpareExist == "True") {
                                woVatPercentage = claSpVat
                            }
                            else {
                                woVatPercentage = "0.00"
                            }
                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                jobIdXml = jobIdXml +
                                        '<insert ID_DETAIL="' + $('#<%=hdnClaimCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(claCustAmt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + claGmVat + '" PWO_LBR_VATPER="' + claHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(claCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="CLA"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '"  CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '"  />';
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                  'PWO_FIXED_VATPER = "0.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                jobIdXml = jobIdXml +
                                '<insert ID_DETAIL="' + $('#<%=hdnClaimCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(claCustAmt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="0.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + claGmVat + '" PWO_LBR_VATPER="' + claHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                   'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(claCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="CLA" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }


                        if (($('#<%=hdnClaimCustId.ClientID%>').val() != "" && $('#<%=hdnIntCustId.ClientID%>').val() != "")) {

                            var idItem = rowalldata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                            var idClaCust = $('#<%=hdnClaimCustId.ClientID%>').val()

                            var vats = LoadGMHPVat(idItem, idMake, idClaCust);
                            var claGmVat = 0.0;
                            var claHpVat = 0.0;
                            var claSpVat = 0.0;

                            if (vats.length > 0) {
                                claGmVat = fnformatDecimalValue(vats[0], seperator);
                                claHpVat = fnformatDecimalValue(vats[1], seperator);
                                claSpVat = fnformatDecimalValue(vats[2], seperator);
                            }


                            var idItem = rowalldata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                            var idIntCust = $('#<%=hdnIntCustId.ClientID%>').val()

                            var vats = LoadGMHPVat(idItem, idMake, idIntCust);
                            var intcGmVat = 0.0;
                            var intcHpVat = 0.0;
                            var intcSpVat = 0.0;

                            if (vats.length > 0) {
                                intcGmVat = fnformatDecimalValue(vats[0], seperator);
                                intcHpVat = fnformatDecimalValue(vats[1], seperator);
                                intcSpVat = fnformatDecimalValue(vats[2], seperator);
                            }
                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var claStatus = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            //var status = "";
                            //var miscStatus = "";
                            //var delarr = new Array()
                            //delarr = fetchDelJobDet(idWONO, idWOPrefix);

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;
                                if (idJobId == idJob && Debitor == $('#<%=hdnIntCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL"

                                }
                                if (idJobId == idJob && Debitor == $('#<%=hdnClaimCustId.ClientID%>').val() && Debitor != "") {
                                    claStatus = "DEL"

                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "CLA") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var intDebitorDisc = "";
                            var custIntLabDisc = "0";
                            var custIntSpareDisc = "0";
                            var custIntGenDisc = "0";

                            var claDebitorDisc = "";
                            var custClaLabDisc = "0";
                            var custClaSpareDisc = "0";
                            var custClaGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtIntDiscount.ClientID%>').val(), seperator) != "0") {
                                intDebitorDisc = fnformatDecimalValue($('#<%=txtIntDiscount.ClientID%>').val(), seperator);
                            } else {
                                intDebitorDisc = "0";//[Check]                                
                            }

                            custIntLabDisc = fnformatDecimalValue($('#<%=hdnIntLabDisc.ClientID%>').val(), seperator);
                            custIntSpareDisc = fnformatDecimalValue($('#<%=hdnIntSpareDisc.ClientID%>').val(), seperator);
                            custIntGenDisc = fnformatDecimalValue($('#<%=hdnIntGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue($('#<%=txtClaimDiscount.ClientID%>').val(), seperator) != "0") {
                                claDebitorDisc = fnformatDecimalValue($('#<%=txtClaimDiscount.ClientID%>').val(), seperator);
                            } else {
                                claDebitorDisc = "0";//[Check]
                            }

                            custClaLabDisc = fnformatDecimalValue($('#<%=hdnClaLabDisc.ClientID%>').val(), seperator);
                            custClaSpareDisc = fnformatDecimalValue($('#<%=hdnClaSpareDisc.ClientID%>').val(), seperator);
                            custClaGenDisc = fnformatDecimalValue($('#<%=hdnClaGenDisc.ClientID%>').val(), seperator);

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);

                            if ($('#<%=hdnClaimCustId.ClientID%>').val() != "" && $('#<%=hdnIntCustId.ClientID%>').val() != "") {
                                if (($('#<%=txtClaimSplit.ClientID%>').val() == "" || $('#<%=txtClaimSplit.ClientID%>').val() == "0") && ($('#<%=hdnIntCustId.ClientID%>').val() == "" || $('#<%=hdnIntCustId.ClientID%>').val() == "0")) {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                                else if (($('#<%=txtClaimSplit.ClientID%>').val() == "100") || ($('#<%=hdnIntCustId.ClientID%>').val() == "100")) {
                                    ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                }
                                else if ((fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) < "100") || (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) < "100")) {
                                    ordHeadCustDbtPer = fnformatDecimalValue(100, seperator) - fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) - fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator);
                                    ordHeadCustDbtPer = fnformatDecimalValue(ordHeadCustDbtPer, seperator);
                                }
                            }

                            if (ordHeadCustDbtPer < 0) {
                                var mess = GetMultiMessage('0116', GetMultiMessage('0338', '', ''), '');  //"Disc Percentage cannot be negative";
                                alert(mess);
                                return false;
                            }
                            else if (ordHeadCustDbtPer > 100) {
                                var mess = GetMultiMessage('0116', GetMultiMessage('0338', '', ''), '');  //"Disc Percentage cannot be greater than 100";
                                alert(mess);
                                return false;
                            }
                            var intCustPer = fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator);
                            var claCustPer = fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator);

                            var orderheadCustAmt = (ordHeadCustDbtPer * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var ordHeadCustVatAmt = (ordHeadCustDbtPer * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            var claCustAmt = (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var claCustVatAmt = (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            var intCustAmt = (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var intCustVatAmt = (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);

                            var claWoVatPercentage = "0.00"
                            woVatPercentage = "0.00"
                            if (isSpareExist == "True") {
                                woVatPercentage = intcSpVat//[Check for ]
                                claWoVatPercentage = claSpVat
                            }


                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                if (status == "DEL") {
                                    ordHeadCustDbtPer = ordHeadCustDbtPer + intCustPer;
                                    intCustPer = fnformatDecimalValue("0", seperator);
                                }

                                if (claStatus == "DEL") {
                                    ordHeadCustDbtPer = ordHeadCustDbtPer + claCustPer;
                                    claCustPer = fnformatDecimalValue("0", seperator);
                                }
                                jobIdXml = jobIdXml +
                                       '<insert ID_DETAIL="' + $('#<%=hdnIntCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(intCustAmt, seperator) + '" DBT_PER="' + intCustPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + intcGmVat + '" PWO_LBR_VATPER="' + intcHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(intCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INTC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + intDebitorDisc + '" CUST_DISC_GENERAL="' + custIntGenDisc + '" CUST_DISC_LABOUR="' + custIntLabDisc + '" CUST_DISC_SPARES="' + custIntSpareDisc + '" DEB_STATUS="' + status + '" />'

                                       + '<insert ID_DETAIL="' + $('#<%=hdnClaimCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(claCustAmt, seperator) + '" DBT_PER="' + claCustPer + '" PWO_VAT_PERCENTAGE="' + claWoVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + claGmVat + '" PWO_LBR_VATPER="' + claHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(claCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="CLA"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + claDebitorDisc + '" CUST_DISC_GENERAL="' + custClaGenDisc + '" CUST_DISC_LABOUR="' + custClaLabDisc + '" CUST_DISC_SPARES="' + custClaSpareDisc + '" DEB_STATUS="' + claStatus + '" />'
                                ;
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (status == "DEL") {
                                    ordHeadCustDbtPer = ordHeadCustDbtPer + intCustPer;
                                    intCustPer = fnformatDecimalValue("0", seperator);
                                }

                                if (claStatus == "DEL") {
                                    ordHeadCustDbtPer = ordHeadCustDbtPer + claCustPer;
                                    claCustPer = fnformatDecimalValue("0", seperator);
                                }
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + spVat + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + spVat + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                  'PWO_FIXED_VATPER = "0.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                jobIdXml = jobIdXml +
                                        '<insert ID_DETAIL="' + $('#<%=hdnIntCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(intCustAmt, seperator) + '" DBT_PER="' + intCustPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + intcGmVat + '" PWO_LBR_VATPER="' + intcHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(intCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INTC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + intDebitorDisc + '" CUST_DISC_GENERAL="' + custIntGenDisc + '" CUST_DISC_LABOUR="' + custIntLabDisc + '" CUST_DISC_SPARES="' + custIntSpareDisc + '" DEB_STATUS="' + status + '" />'

                                       + '<insert ID_DETAIL="' + $('#<%=hdnClaimCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(claCustAmt, seperator) + '" DBT_PER="' + claCustPer + '" PWO_VAT_PERCENTAGE="' + claWoVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + claGmVat + '" PWO_LBR_VATPER="' + claHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(claCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="CLA"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + claDebitorDisc + '" CUST_DISC_GENERAL="' + custClaGenDisc + '" CUST_DISC_LABOUR="' + custClaLabDisc + '" CUST_DISC_SPARES="' + custClaSpareDisc + '" DEB_STATUS="' + claStatus + '" />'
                                ;

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }

                        if (($('#<%=hdnMiscCustId.ClientID%>').val() != "")) {
                            var idItem = rowalldata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                            var idMiscCust = $('#<%=hdnMiscCustId.ClientID%>').val()

                            var vats = LoadGMHPVat(idItem, idMake, idMiscCust);
                            var miscGmVat = 0.0;
                            var miscHpVat = 0.0;
                            var miscSpVat = 0.0;

                            if (vats.length > 0) {
                                miscGmVat = fnformatDecimalValue(vats[0], seperator);
                                miscHpVat = fnformatDecimalValue(vats[1], seperator);
                                miscSpVat = fnformatDecimalValue(vats[2], seperator);
                            }
                            if (rowalldata[k].Flag == "1") {
                                var miscStatus = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;

                                if (idJobId == idJob && Debitor == $('#<%=hdnMiscCustId.ClientID%>').val() && Debitor != "") {
                                    miscStatus = "DEL"

                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "MISC" && rowalldata[k].DebtType == "OHC") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var debitorDisc = "";
                            var custLabDisc = "0";
                            var custSpareDisc = "0";
                            var custGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtMiscDiscount.ClientID%>').val(), seperator) != "0") {
                                debitorDisc = fnformatDecimalValue($('#<%=txtMiscDiscount.ClientID%>').val(), seperator);
                            } else {
                                debitorDisc = "0";
                            }

                            custLabDisc = fnformatDecimalValue($('#<%=hdnMiscLabDisc.ClientID%>').val(), seperator);
                            custSpareDisc = fnformatDecimalValue($('#<%=hdnMiscSpareDisc.ClientID%>').val(), seperator);
                            custGenDisc = fnformatDecimalValue($('#<%=hdnMiscGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue(custLabDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custLabDisc = custGenDisc
                            }

                            if (fnformatDecimalValue(custSpareDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custSpareDisc = custGenDisc
                            }

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            
                            var miscOwnRiskAmt = 0;

                            if ($('#<%=chkMiscMoveOwnRisk.ClientID%>').is(':checked')) {
                                miscOwnRiskAmt = woOwnRiskAmt;
                            } else
                            {
                                miscOwnRiskAmt = 0;
                            }


                            if ($('#<%=hdnMiscCustId.ClientID%>').val() != "") {
                                if ($('#<%=txtMiscSplit.ClientID%>').val() == "" || $('#<%=txtMiscSplit.ClientID%>').val() == "0") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                                else if ($('#<%=txtMiscSplit.ClientID%>').val() == "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                }
                                else if (fnformatDecimalValue($('#<%=txtMiscSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtMiscSplit.ClientID%>').val(), seperator) < "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue(100, seperator) - fnformatDecimalValue($('#<%=txtMiscSplit.ClientID%>').val(), seperator);
                                    ordHeadCustDbtPer = fnformatDecimalValue(ordHeadCustDbtPer, seperator);
                                }
                                if (miscStatus == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            if (isSpareExist == "True") {
                                woVatPercentage = miscSpVat
                            }
                            else {
                                woVatPercentage = "0.00"
                            }
                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                jobIdXml = jobIdXml +
                                        '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + miscGmVat + '" PWO_LBR_VATPER="' + miscHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                         'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + miscStatus + '" />';
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                  'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                jobIdXml = jobIdXml +
                                '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + miscGmVat + '" PWO_LBR_VATPER="' + miscHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                   'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + miscStatus + '" />';

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }

                        //Insurance and Miscellaneous Customer
                        if (($('#<%=hdnMiscCustId.ClientID%>').val() != "" && $('#<%=hdnInsCustId.ClientID%>').val() != "")) {

                            var idItem = rowalldata[k].IdJob;// rowdata.IdJob; //$('#<%=hdnIdItem.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make; //rowdata.Id_Make;//$('#<%=hdnIdMake.ClientID%>').val();
                            var idInscCust = $('#<%=hdnInsCustId.ClientID%>').val()

                            var vats = LoadGMHPVat(idItem, idMake, idInscCust);
                            var inscGmVat = 0.0;
                            var inscHpVat = 0.0;
                            var inscSpVat = 0.0;

                            if (vats.length > 0) {
                                inscGmVat = fnformatDecimalValue(vats[0], seperator);
                                inscHpVat = fnformatDecimalValue(vats[1], seperator);
                                inscSpVat = fnformatDecimalValue(vats[2], seperator);
                            }


                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var miscStatus = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            //var status = "";
                            //var miscStatus = "";
                            //var delarr = new Array()
                            //delarr = fetchDelJobDet(idWONO, idWOPrefix);

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;
                                if (idJobId == idJob && Debitor == $('#<%=hdnInsCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL"

                                }
                                if (idJobId == idJob && Debitor == $('#<%=hdnMiscCustId.ClientID%>').val() && Debitor != "") {
                                    miscStatus = "DEL"

                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "MISC" && rowalldata[k].DebtType == "OHC") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var miscOwnRiskAmt = 0;

                            if ($('#<%=chkMiscMoveOwnRisk.ClientID%>').is(':checked')) {
                                miscOwnRiskAmt = woOwnRiskAmt;
                            } else {
                                miscOwnRiskAmt = 0;
                            }

                            var insDebitorDisc = "";
                            var custInsLabDisc = "0";
                            var custInsSpareDisc = "0";
                            var custInsGenDisc = "0";

                            var miscDebitorDisc = "";
                            var custMiscLabDisc = "0";
                            var custMiscSpareDisc = "0";
                            var custMiscGenDisc = "0";
                            
                            if (fnformatDecimalValue($('#<%=txtInsDiscount.ClientID%>').val(), seperator) != "0") {
                                insDebitorDisc = fnformatDecimalValue($('#<%=txtInsDiscount.ClientID%>').val(), seperator);
                            } else {
                                insDebitorDisc = "0"; //[Check]                                
                            }

                            custInsLabDisc = fnformatDecimalValue($('#<%=hdnInsLabDisc.ClientID%>').val(), seperator);
                            custInsSpareDisc = fnformatDecimalValue($('#<%=hdnInsSpareDisc.ClientID%>').val(), seperator);
                            custInsGenDisc = fnformatDecimalValue($('#<%=hdnInsGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue($('#<%=txtMiscDiscount.ClientID%>').val(), seperator) != "0") {
                                miscDebitorDisc = fnformatDecimalValue($('#<%=txtMiscDiscount.ClientID%>').val(), seperator);
                            } else {
                                miscDebitorDisc = "0"; //[Check]
                            }
                            custMiscLabDisc = fnformatDecimalValue($('#<%=hdnMiscLabDisc.ClientID%>').val(), seperator);
                            custMiscSpareDisc = fnformatDecimalValue($('#<%=hdnMiscSpareDisc.ClientID%>').val(), seperator);
                            custMiscGenDisc = fnformatDecimalValue($('#<%=hdnMiscGenDisc.ClientID%>').val(), seperator);

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {
                                ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                if (status == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            var miscWoVatPercentage = "1.00"
                            woVatPercentage = "0.00"
                            if (isSpareExist == "True") {
                                woVatPercentage = inscSpVat//[Check for ]
                                miscWoVatPercentage = miscSpVat
                            }

                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                               

                                if (status == "DEL") {
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + inscGmVat + '" PWO_LBR_VATPER="' + inscHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + insDebitorDisc + '" CUST_DISC_GENERAL="' + custInsGenDisc + '" CUST_DISC_LABOUR="' + custInsLabDisc + '" CUST_DISC_SPARES="' + custInsSpareDisc + '"  DEB_STATUS="' + status + '" />' +
                                    '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="0.00" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + miscWoVatPercentage + '" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + miscDebitorDisc + '" CUST_DISC_GENERAL="' + custMiscGenDisc + '" CUST_DISC_LABOUR="' + custMiscLabDisc + '" CUST_DISC_SPARES="' + custMiscSpareDisc + '" DEB_STATUS="' + miscStatus + '"/>';
                                } else {
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + inscGmVat + '" PWO_LBR_VATPER="' + inscHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + insDebitorDisc + '" CUST_DISC_GENERAL="' + custInsGenDisc + '" CUST_DISC_LABOUR="' + custInsLabDisc + '" CUST_DISC_SPARES="' + custInsSpareDisc + '"  DEB_STATUS="" />' +
                                    '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + miscWoVatPercentage + '" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + miscDebitorDisc + '" CUST_DISC_GENERAL="' + custMiscGenDisc + '" CUST_DISC_LABOUR="' + custMiscLabDisc + '" CUST_DISC_SPARES="' + custMiscSpareDisc + '" DEB_STATUS=""/>';
                                }
                                
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                  'PWO_FIXED_VATPER = "0.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                if (status == "DEL") {
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + inscGmVat + '" PWO_LBR_VATPER="' + inscHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + insDebitorDisc + '" CUST_DISC_GENERAL="' + custInsGenDisc + '" CUST_DISC_LABOUR="' + custInsLabDisc + '" CUST_DISC_SPARES="' + custInsSpareDisc + '" DEB_STATUS="' + status + '" />' +
                                    '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="0.00" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + miscWoVatPercentage + '" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + miscDebitorDisc + '" CUST_DISC_GENERAL="' + custMiscGenDisc + '" CUST_DISC_LABOUR="' + custMiscLabDisc + '" CUST_DISC_SPARES="' + custMiscSpareDisc + '" DEB_STATUS="' + miscStatus + '" />';
                                }
                                else {
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="' + woVatPercentage + '" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + inscGmVat + '" PWO_LBR_VATPER="' + inscHpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + insDebitorDisc + '" CUST_DISC_GENERAL="' + custInsGenDisc + '" CUST_DISC_LABOUR="' + custInsLabDisc + '" CUST_DISC_SPARES="' + custInsSpareDisc + '" DEB_STATUS="" />' +
                                    '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="' + miscWoVatPercentage + '" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + miscDebitorDisc + '" CUST_DISC_GENERAL="' + custMiscGenDisc + '" CUST_DISC_LABOUR="' + custMiscLabDisc + '" CUST_DISC_SPARES="' + custMiscSpareDisc + '" DEB_STATUS="" />';
                                }                               

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }

                    }
                   
                }//end of looping through for each job

                discPerJob = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);

                discPerJob = fnreformatDecimal(discPerJob, seperator);

                woTotDiscAmt = discPerJob;
                finalDiscount = discPerJob;


                mechXml = "<root>" + mechXml + "</root>";
                spareXml = "<root>" + spareXml + "</root>";
                discXml = "<root>" + discXml + "</root>";

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/SaveJobDet",
                    data: "{jobIdXmls: '" + jobIdXml + "',spareXmls:'" + spareXml + "',discXmls:'" + discXml + "',mechXmls:'" + mechXml + "',idWODetSeq:'" + idWODetSeq + "',idWONO:'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "',idRpgCatgWO:'" + idRpgCatgWO +
                    "',idRpgCodeWO:'" + idRpgCodeWO + "',idRepCodeWO:'" + idRepCodeWO + "',idWorkCodeWO:'" + idWorkCodeWO + "',woFixedPrice:'" + woFixedPrice + "',idJobPcdWO:'" + idJobPcdWO + "',woPlannedTime:'" + woPlannedTime +
                    "',woHourleyPrice:'" + woHourleyPrice + "',woClkTime:'" + woClkTime + "',woChrgTime:'" + woChrgTime + "',flgChrgStdTime:'" + flgChrgStdTime + "',woStdTime:'" + woStdTime + "',statReq:'" + stationReq +
                    "',woJobTxt:'" + woJobTxt + "',woOwnRiskAmt:'" + woOwnRiskAmt + "',woTotLabAmt:'" + woTotLabAmt + "',woTotSpareAmt:'" + woTotSpareAmt + "',woTotGmAmt:'" + woTotGmAmt + "',woTotVatAmt:'" + finalVat + "',woTotDiscAmt:'" + woTotDiscAmt +
                    "',jobStatus:'" + jobStatus + "',woOwnPayVat:'" + woOwnPayVat + "',idDefectNoteSeq:'" + idDefectNoteSeq + "',totalamt:'" + totalamt + "',idMechComp:'" + idMechComp + "',woOwnRiskCust:'" + woOwnRiskCust +
                    "',woOwnCrCust:'" + woOwnCrCust + "',idSerCallNo:'" + idSerCallNo + "',woGmPer:'" + woGmPer + "',woGmVatPer:'" + woGmVatPer + "',woLbrVatPer:'" + woLbrVatPer + "',woInclVat:'" + woInclVat + "',woDiscount:'" + woDiscount +
                    "',subrepCodeWO:'" + subrepCodeWO + "',ownriskvat:'" + ownriskvat + "',flgSprsts:'" + flgSprsts + "',salesman:'" + salesman + "',flgVatFree:'" + flgVatFree + "',costPrice:'" + costPrice + "',finalTotal:'" + finalTotal + "',finalVat:'" + finalVat +
                    "',finalDiscount:'" + finalDiscount + "',woChrgTimeFp:'" + woChrgTimeFp + "',woTotLabAmtFp:'" + woTotLabAmtFp + "',woTotSpareAmtFp:'" + woTotSpareAmtFp + "',woTotGmAmtFp:'" + woTotGmAmtFp + "',woTotVatAmtFp:'" + woTotVatAmtFp + "',woTotDiscAmtFp:'" + woTotDiscAmtFp +
                    "',woIntNote:'" + woIntNote + "',idJob:'" + idJob + "',flgawaitingSp:'" + flgawaitingSp + "',mode:'" + mode + "',idMech:'" + idMech + "',woOwnRiskDesc:'" + woOwnRiskDesc + "',woOwnRiskSlNo:'" + woOwnRiskSlNo + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (jobNumber != "") {
                            jobNumber = jobNumber + ',' + idJob;
                        }
                        else {
                            jobNumber = idJob;
                        }
                        $('#<%=RTlblError.ClientID%>').text = "";
                        if (mode == "Add") {
                            if (Result.d[0] == "INSFLG") {
                                $('#<%=RTlblError.ClientID%>').text(jobNumber + 'Saved Successfully.');
                            }
                            else if (Result.d[0] == "VEHVAT") {
                                var errmsg = "Legg til momskode på kjøretøy via kjøretøyskjermen!";
                                $('#<%=RTlblError.ClientID%>').text(errmsg);
                                $('#<%=RTlblError.ClientID%>').addClass("lblErr");
                            }
                        } else if (mode == "Update") {
                            if (Result.d[0] == "UPDFLG") {
                                $('#<%=RTlblError.ClientID%>').text(jobNumber + 'Saved Successfully.');
                            }
                            else if (Result.d[0] == "VEHVAT") {
                                var errmsg = "Legg til momskode på kjøretøy via kjøretøyskjermen!";
                                $('#<%=RTlblError.ClientID%>').text(errmsg);
                                $('#<%=RTlblError.ClientID%>').addClass("lblErr");
                            }
                        }
                    }
                });

            }// end of jobs

            loadWOJobGrid(idWONO, idWOPrefix);

            var rowalldata = $('#jobgrid').jqGrid('getGridParam', 'data');
            var frowid = rowalldata.length;
            for (var i = 0; i < rowalldata.length; i++) {
                if (rowalldata[i].DebtType == "OHC") {
                    frowid = rowalldata[i].id;
                }
            }

            console.log("rowalldata.length::" + rowalldata.length + " parseInt(frowid)::"+parseInt(frowid));

            jQuery("#jobgrid").jqGrid("nextCell", parseInt(frowid), 0, true);
            document.getElementById((parseInt(frowid)) + '_IdJob').select();

        }


        function fnCalcLabTotal() {
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var totLabAmt = 0.0;
            var stdTime = fnformatDecimalValue($('#<%=txtStdTime.ClientID%>').val(), seperator).toFixed(2);
            var price = fnformatDecimalValue($('#<%=txtLabSalesPr.ClientID%>').val(), seperator).toFixed(2);
            var disc = fnformatDecimalValue($('#<%=txtLabDiscPer.ClientID%>').val()).toFixed(2);
            var discAmt = (stdTime * price) * (disc * 0.01);
            totLabAmt = ((stdTime * price) - ((stdTime * price) * (disc * 0.01))).toFixed(2);
            totLabAmt = fnreformatDecimal(totLabAmt,seperator);
            $('#<%=txtLabTotalAmt.ClientID%>').val(totLabAmt);
            $('#<%=txtDiscAmt.ClientID%>').val(discAmt);
        }

        function loadMechanics(result) {
            $('#<%=ddlMechanic.ClientID%>').empty();
            $('#<%=ddlMechanic.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
            $('#<%=ddlmechList.ClientID%>').empty();
            $('#<%=ddlmechList.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
            var Result = result;
            $.each(Result, function (key, value) {
                $('#<%=ddlMechanic.ClientID%>').append($("<option></option>").val(value.Id_Login).html(value.First_Name));
                $('#<%=ddlmechList.ClientID%>').append($("<option></option>").val(value.Id_Login).html(value.First_Name));
            });
        }

        function loadWorkCode() {
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/LoadWorkCode",
                data: {},
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    $('#<%=ddlWorkCode.ClientID%>').empty();
                    //$('#<%=ddlWorkCode.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    Result = Result.d;
                    $.each(Result, function (key, value) {
                        $('#<%=ddlWorkCode.ClientID%>').append($("<option></option>").val(value.Work_Code_Id_Settings).html(value.Work_Code_Description));
                    });
                }
            });
        }

        function loadRepairCode() {
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/LoadRepairCode",
                data: {},
                dataType: "json",
                async: false,//Very important
                success: function (Result) {
                    $('#<%=ddlRepairCode.ClientID%>').empty();
                    // $('#<%=ddlRepairCode.ClientID%>').prepend("<option value='0'>" + $('#<%=hdnSelect.ClientID%>').val() + "</option>");
                    Result = Result.d;
                    $.each(Result, function (key, value) {
                        $('#<%=ddlRepairCode.ClientID%>').append($("<option></option>").val(value.Id_Rep_Code).html(value.Rp_RepCode_Des));
                    });
                }
            });
        }

        function updateJobAfterDelete(id) {

            var rowalldata = $('#jobgrid').jqGrid('getGridParam', 'data');
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var jobIdXml;
            var spareXml;
            var discXml;
            var mechXml;
            var idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
            var idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
            var idWODetSeq = "1";
            var idRpgCatgWO = "";
            var idRpgCodeWO = ""
            var idRepCodeWO = $('#<%=ddlRepairCode.ClientID%>').val();
            var idWorkCodeWO = $('#<%=ddlWorkCode.ClientID%>').val();
            var woFixedPrice;
            var idJobPcdWO;
            var woPlannedTime = "0";
            var woHourleyPrice = "0";
            var woClkTime = "0"; //load in service Fetch_WO_ClkTime() 
            var woChrgTime;
            var flgChrgStdTime;
            var woStdTime;
            var stationReq;
            var woJobTxt = "";
            var woOwnRiskAmt = "" // Check for own risk session
            var woTotLabAmt;
            var woTotSpareAmt;
            var woTotGmAmt;
            var woTotVatAmt;
            var woTotDiscAmt;
            var jobStatus = "" // "CSA";
            var woOwnRiskDesc = "";
            var desc = "";

            var woOwnPayVat, idDefectNoteSeq, totalamt, idMechComp, woOwnRiskCust, woOwnCrCust, idSerCallNo, woGmPer, woGmVatPer, woLbrVatPer, woInclVat, woDiscount;
            var subrepCodeWO, ownriskvat, flgSprsts, salesman;
            var flgVatFree, costPrice, finalTotal, finalVat, finalDiscount, woChrgTimeFp, woTotLabAmtFp, woTotSpareAmtFp, woTotGmAmtFp, woTotVatAmtFp, woTotDiscAmtFp, woIntNote, flgawaitingSp;
            var mode;
            spareXml = "<root></root>";
            discXml = "<root></root>";
            mechXml = "<root></root>";
            var idJob = "0";
            var jobNumber = "";

            if ($('#<%=ddlStatus.ClientID%>')[0].selectedIndex == 0) {
                jobStatus = "CSA";
            } else {
                jobStatus = $('#<%=ddlStatus.ClientID%>').val();
            }

            var rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);

            var noOfJobs = new Array();
            for (var i = 0; i < rowalldata.length; i++) {
                if (rowalldata[i].Flag == "1" && rowalldata[i].DebtType == "OHC") {
                    noOfJobs.push(rowalldata[i].JobId);
                }
            }

            //looping through jobs
            for (var j = 0; j < noOfJobs.length; j++) {
                var amtS = 0.0;
                var vatAmount = 0.0;
                var amtL = 0.0;
                var discAmount = 0.0;
                var TotalGM = 0.0;
                var amtG = 0.0;
                var hpVatAmt = 0.0;
                var gmvatAmt = 0.0;
                var woTotSpareAmt = "0";
                var woTotLabAmt = "0";
                var woTotGmAmt = "0";
                var woTotVatAmt = "0";
                var woTotDiscAmt = "0";
                var finalTotal = "0";
                var finalVat = "0";
                var finalDiscount = "0";
                var woTotDiscAmtFp = "0";
                var totalamt = "0";
                var amountS = 0.0;
                var amount = 0.0;
                var labDisc = 0.0;
                var gmDisc = 0.0;
                var spareDisc = 0.0;
                var discPerLine = 0.0;
                var discPerJob = 0.0;
                var idMech = "";
                var woOwnRiskSlNo = 0;

                idJob = noOfJobs[j];
                spareXml = "";
                discXml = "";
                mechXml = "";
                woOwnRiskAmt = "";
                woOwnRiskDesc = "";
                woOwnRiskSlNo = 0;
                var redPerc = "0";
                var redBefOR = "0";
                var redAftrOR = "0";
                var redAmt = "0";
                for (var k = 0; k < rowalldata.length; k++) {

                    if (rowalldata[k].JobId == idJob) {
                        if (rowalldata[k].Flag == "1") {
                            if (rowalldata[k].RC == null) {
                                idRepCodeWO = $('#<%=ddlRepairCode.ClientID%>').val();
                            }
                            else {
                                idRepCodeWO = rowalldata[k].RC;
                            }

                            if (rowalldata[k].WC == null) {
                                idWorkCodeWO = $('#<%=ddlWorkCode.ClientID%>').val();
                            }
                            else {
                                idWorkCodeWO = rowalldata[k].WC;
                            }
                            idMech = rowalldata[k].MechanicName;
                        }
                        var idCust = $('#<%=lblCustName.ClientID%>').text();
                        var vats = LoadGMHPVat(rowalldata[k].IdJob, rowalldata[k].Id_Make, idCust);
                        var gmVat = 0.0;
                        var hpVat = 0.0;
                        var spVat = 0.0;

                        if (vats.length > 0) {
                            gmVat = fnformatDecimalValue(vats[0], seperator);
                            hpVat = fnformatDecimalValue(vats[1], seperator);
                            spVat = fnformatDecimalValue(vats[2], seperator);
                        }

                        woFixedPrice = "0";
                        idJobPcdWO = "0";

                        flgChrgStdTime = "0";
                        woStdTime = "0";
                        stationReq = "0";

                        woOwnPayVat = "0";
                        idDefectNoteSeq = "0";

                        idMechComp = "0";
                        woOwnRiskCust = $('#<%=lblCustName.ClientID%>').text();
                        woOwnCrCust = "";
                        idSerCallNo = "0";
                        woGmPer = $('#<%=txtGM.ClientID%>').val();
                        woGmVatPer = gmVat;
                        woLbrVatPer = hpVat;
                        woInclVat = "0";
                        subrepCodeWO = "0";
                        ownriskvat = "0";//calcuate based on session
                        flgSprsts = "0";//  Session("FlGSPSTS")
                        salesman = "";
                        flgVatFree = "0";
                        costPrice = "0";
                        woIntNote = "";
                        flgawaitingSp = "0";

                        //Discount Percentage for each line
                        if (rowalldata[k].Rab == "" || rowalldata[k].Rab == undefined) {
                            woDiscount = 0;
                        } else {
                            woDiscount = fnformatDecimalValue(rowalldata[k].Rab, seperator);
                        }

                        if (woTotLabAmtFp == undefined) {
                            woTotLabAmtFp = "0";
                        }

                        if (rowalldata[k].Ford >= "0" && rowalldata[k].Pris != "" && rowalldata[k].DebtType == "OHC" && rowalldata[k].Bestilt == "" && rowalldata[k].Levert == "" && rowalldata[k].Diff == "OR") {
                            woOwnRiskAmt = rowalldata[k].Pris;
                            woOwnRiskDesc = rowalldata[k].Text;
                            woOwnRiskSlNo = rowalldata[k].id;
                        }



                        if (rowalldata[k].Diff == "L" && rowalldata[k].DebtType == "OHC") {

                            woHourleyPrice = rowalldata[k].Pris;

                            if (woHourleyPrice == "") {
                                woHourleyPrice = "0";
                            }

                            if (rowalldata[k].Levert == "") {
                                woChrgTime = "0";
                                woChrgTimeFp = "0";
                            } else {
                                woChrgTime = rowalldata[k].Levert;
                                woChrgTimeFp = rowalldata[k].Levert;
                            }

                            var amount = 0.0;
                            //amount = fnformatDecimalValue(rowalldata[k].Belop, seperator);
                            amount = fnformatDecimalValue(rowalldata[k].Levert, seperator) * fnformatDecimalValue(rowalldata[k].Pris, seperator);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = fnformatDecimalValue($('#<%=txtGM.ClientID%>').val(), seperator);
                            if (rowalldata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                            }

                            if (rowalldata[k].Belop == undefined) {
                                woTotLabAmt = "";
                            } else {
                                woTotLabAmt = fnreformatDecimal(amtL, seperator);
                            }

                            //labDisc = fnformatDecimalValue((amount * (woDiscount / 100)), seperator); // Discount Per Line
                            //gmDisc = fnformatDecimalValue((amtG * (woDiscount / 100)), seperator); // Discount Per Line

                            //Discount Per Line
                            labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (woDiscount / 100)), seperator)).toFixed(2);
                            gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (woDiscount / 100)), seperator)).toFixed(2);

                            discPerJob = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator)).toFixed(2);

                            woTotDiscAmt = discPerJob;
                            finalDiscount = discPerJob;

                            woTotSpareAmt = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmt = fnreformatDecimal(TotalGM, seperator);
                            //hpVatAmt = (amtL * (hpVat / 100)).toFixed(2);
                            //gmVatAmt = (TotalGM * (gmVat / 100)).toFixed(2);
                            hpVatAmt = (amount * (hpVat / 100)).toFixed(2);
                            gmVatAmt = (amtG * (gmVat / 100)).toFixed(2);

                            woTotVatAmt = fnformatDecimalValue(hpVatAmt, seperator) + fnformatDecimalValue(gmVatAmt, seperator);
                            woTotVatAmt = fnreformatDecimal(woTotVatAmt, seperator);
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);

                            finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amount, seperator) + fnformatDecimalValue(amtG, seperator); //+ fnformatDecimalValue(woTotSpareAmt, seperator);
                            finalVat = fnformatDecimalValue(finalVat, seperator) + fnformatDecimalValue(woTotVatAmt, seperator);
                            //finalDiscount = "0";
                            //totalamt = fnformatDecimalValue(totalamt, seperator) + fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);
                            totalamt = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator) - fnformatDecimalValue(finalDiscount, seperator);

                            finalTotal = fnreformatDecimal(finalTotal, seperator);
                            finalVat = fnreformatDecimal(finalVat, seperator);
                            totalamt = fnreformatDecimal(totalamt, seperator);

                            woTotDiscAmt = fnreformatDecimal(woTotDiscAmt, seperator);
                            finalDiscount = fnreformatDecimal(finalDiscount, seperator);

                            if (rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined || rowalldata[k].IdWODetailseq == null && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                           'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" LineType ="L" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0" REDUCTION_AMOUNT="0" DBT_DIS_PER="0" DEB_STATUS="" />';

                                mechXml = mechXml + ' <insert ID_MECH="' + rowalldata[k].IdMech.toString() + '" Id_Sl_No="' + rowalldata[k].id.toString() + '" ID_WOLAB_SEQ = "" LabourDesc = "' + rowalldata[k].Text.toString() + '"  Wo_Lab_Hrs = "' + fnformatDecimalValue(rowalldata[k].Levert.toString(), seperator) + '" HourlyPr = "' + fnformatDecimalValue(rowalldata[k].Pris.toString(), seperator) + '" WO_Lab_Discount = "' + fnformatDecimalValue(woDiscount) + '"  LineType ="L" />';
                            }
                            else {
                                if (rowalldata[k].DebtType == "OHC") {
                                    mode = "Update";
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                             'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00"  CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0" REDUCTION_AMOUNT="0" DBT_DIS_PER="0" DEB_STATUS=""/>';

                                    mechXml = mechXml + ' <insert ID_MECH="' + rowalldata[k].IdMech.toString() + '" Id_Sl_No="' + rowalldata[k].id.toString() + '" ID_WOLAB_SEQ = "' + rowalldata[k].IdWOLabSeq.toString() + '" LabourDesc = "' + rowalldata[k].Text.toString() + '"  Wo_Lab_Hrs = "' + fnformatDecimalValue(rowalldata[k].Levert.toString(), seperator) + '" HourlyPr = "' + fnformatDecimalValue(rowalldata[k].Pris.toString(), seperator) + '" WO_Lab_Discount = "' + fnformatDecimalValue(woDiscount) + '"  LineType ="L" />';

                                }
                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }
                        else if (rowalldata[k].Diff == "S" && rowalldata[k].DebtType == "OHC") {
                            var idItem = rowalldata[k].IdJob.toString();
                            var idJobDeb = $('#<%=lblCustName.ClientID%>').text();
                            var idVeh = $('#<%=hdnVehId.ClientID%>').val();
                            var idMake = rowalldata[k].Id_Make.toString();
                            var idWh = "1";
                            var disSeq;
                            var jobVatPer = 0.0;
                            var jobVatSeq;
                            var item_avail_qty;
                            var bo_qty;
                            var delivQty;
                            var ordQty;
                            item_avail_qty = fnformatDecimalValue(rowalldata[k].Item_Avail_Qty, seperator);
                            ordQty = fnformatDecimalValue(rowalldata[k].Bestilt, seperator);
                            delivQty = fnformatDecimalValue(rowalldata[k].Levert, seperator);

                            if (rowalldata[k].Jobi_Bo_Qty == "" || rowalldata[k].Jobi_Bo_Qty == undefined || rowalldata[k].Jobi_Bo_Qty == null) {
                                bo_qty = fnformatDecimalValue("0", seperator);
                            } else {
                                bo_qty = fnformatDecimalValue(rowalldata[k].Jobi_Bo_Qty, seperator);
                            }

                            var detSeq = GetVatDis(idItem, idJobDeb, idVeh, idMake, idWh);

                            disSeq = detSeq[0];
                            jobVatPer = fnformatDecimalValue(detSeq[1], seperator);
                            jobVatSeq = detSeq[2];

                            var disPer = rowalldata[k].Rab;
                            if (disPer == "" || disPer == undefined) {
                                disPer = "0.00";
                            }

                            //var amount = 0.0;
                            //amount = fnformatDecimalValue(rowalldata[k].Belop, seperator)
                            //amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                            //amountS = fnformatDecimalValue(rowalldata[k].Belop, seperator);
                            amountS = fnformatDecimalValue(rowalldata[k].Levert, seperator) * fnformatDecimalValue(rowalldata[k].Pris, seperator);
                            amtS = (fnformatDecimalValue(amtS, seperator) + amountS).toFixed(2);
                            //vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowalldata[k].Pris, seperator) * (fnformatDecimalValue(rowalldata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVat))).toFixed(2);
                            vatAmount = (((fnformatDecimalValue(rowalldata[k].Pris, seperator) * (fnformatDecimalValue(rowalldata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVat))).toFixed(2);
                            amtS = fnreformatDecimal(amtS, seperator);
                            vatAmount = fnreformatDecimal(vatAmount, seperator);

                            woChrgTime = "0";
                            woChrgTimeFp = "0";
                            woTotSpareAmt = amtS;
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            finalVat = fnformatDecimalValue(finalVat, seperator) + fnformatDecimalValue(vatAmount, seperator);
                            finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amountS, seperator);
                            //totalamt = fnformatDecimalValue(totalamt, seperator) + fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);
                            totalamt = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);
                            spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue((amountS * (woDiscount / 100)), seperator)).toFixed(2);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);
                            finalVat = fnreformatDecimal(finalVat, seperator);
                            finalTotal = fnreformatDecimal(finalTotal, seperator);
                            totalamt = fnreformatDecimal(totalamt, seperator);

                            if (rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined || rowalldata[k].IdWODetailseq == null && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + rowalldata[k].Id_Make + '" ID_WAREHOUSE = "' + rowalldata[k].Id_Warehouse + '" ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    fnformatDecimalValue(rowalldata[k].Bestilt, seperator) + '" JOBI_DELIVER_QTY= "' + fnformatDecimalValue(delivQty, seperator) + '" JOBI_BO_QTY ="' + fnformatDecimalValue(bo_qty, seperator) + '" JOBI_DIS_PER ="' + fnformatDecimalValue(disPer, seperator) + '" JOBI_VAT_PER ="' + fnformatDecimalValue(spVat, seperator) + '" ORDER_LINE_TEXT ="" ' +
                                     ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "' + fnformatDecimalValue(rowalldata[k].Sp_Cost_Price, seperator) + '" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="" TD_CALC ="True " ITEM_DESC="' +
                                     rowalldata[k].Text + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                     ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="S" SPARE_DISCOUNT="' + rowalldata[k].SpareDiscount.toString() + '" />';

                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                 'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue(vatAmount, seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue(woTotSpareAmt, seperator) + '" LineType ="S" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                            }
                            else {
                                //idWODetSeq = rowalldata[k].IdWODetailseq;
                                mode = "Update";
                                if (rowalldata[k].IdWOItemseq == "" || rowalldata[k].IdWOItemseq == undefined || rowalldata[k].IdWOItemseq == null && rowalldata[k].DebtType == "OHC") {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + rowalldata[k].Id_Make + '" ID_WAREHOUSE = "' + rowalldata[k].Id_Warehouse + '" ID_WODET_SEQ_JOB="0"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    fnformatDecimalValue(rowalldata[k].Bestilt, seperator) + '" JOBI_DELIVER_QTY= "' + fnformatDecimalValue(delivQty, seperator) + '" JOBI_BO_QTY ="' + fnformatDecimalValue(bo_qty, seperator) + '" JOBI_DIS_PER ="' + fnformatDecimalValue(disPer, seperator) + '" JOBI_VAT_PER ="' + fnformatDecimalValue(spVat, seperator) + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="0" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "' + fnformatDecimalValue(rowalldata[k].Sp_Cost_Price, seperator) + '" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="" TD_CALC ="True " ITEM_DESC="' +
                                    rowalldata[k].Text + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="S" SPARE_DISCOUNT="' + rowalldata[k].SpareDiscount.toString() + '" />';
                                }
                                else {
                                    if (rowalldata[k].DebtType == "OHC") {
                                        spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + rowalldata[k].Id_Make + '" ID_WAREHOUSE = "' + rowalldata[k].Id_Warehouse + '" ID_WODET_SEQ_JOB="' + rowalldata[k].IdWODetailseq + '"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                         fnformatDecimalValue(rowalldata[k].Bestilt, seperator) + '" JOBI_DELIVER_QTY= "' + fnformatDecimalValue(rowalldata[k].Levert, seperator) + '" JOBI_BO_QTY ="' + fnformatDecimalValue(bo_qty, seperator) + '" JOBI_DIS_PER ="' + fnformatDecimalValue(disPer, seperator) + '" JOBI_VAT_PER ="' + fnformatDecimalValue(spVat, seperator) + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="' + rowalldata[k].IdWOItemseq + '" ' +
                                        ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "' + fnformatDecimalValue(rowalldata[k].Sp_Cost_Price, seperator) + '" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="" TD_CALC ="True " ITEM_DESC="' +
                                        rowalldata[k].Text + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                        ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="S" SPARE_DISCOUNT="' + rowalldata[k].SpareDiscount.toString() + '" />';
                                    }
                                }

                                if (rowalldata[k].DebtType == "OHC") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue(vatAmount, seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue(woTotSpareAmt, seperator) + '" LineType ="S" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0" REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                                }
                            }

                            jobIdXml = "<root>" + jobIdXml + "</root>";

                            var spDebRab;
                            if (rowalldata[k].Rab != undefined && rowalldata[k].Rab != "" && rowalldata[k].DebtType == "OHC") {
                                spDebRab = fnformatDecimalValue(rowalldata[k].Rab.toString(), seperator);
                            } else { spDebRab = "0"; }

                            discXml = discXml + '<insert ID_DEBTOR ="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_ITEM = "' + rowalldata[k].IdJob + '" ID_MAKE = "' + rowalldata[k].Id_Make + '" ID_WAREHOUSE = "' + rowalldata[k].Id_Warehouse + '" DBT_VAT_AMOUNT = "' +
                                 fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" DBT_DIS_AMT="' + fnformatDecimalValue($('#<%=txtDisc.ClientID%>').val().toString(), seperator) + '" JOB_VAT_PER="' + jobVatPer + '" JOB_VAT_SEQ="' + jobVatSeq + '" JOB_DIS_SEQ="' + disSeq + '" JOB_DIS_PER="' + spDebRab + '" />';
                        }
                        else if (((rowalldata[k].Diff == "T" && rowalldata[k].IdWOLabSeq == "") || (rowalldata[k].IdJob == "" && rowalldata[k].Text != "" && rowalldata[k].Levert == "" && rowalldata[k].IdWOLabSeq == "" && rowalldata[k].Pris == "")) && rowalldata[k].DebtType == "OHC" && rowalldata[k].Diff != "RAOR" && rowalldata[k].Diff != "RBOR") {
                            var idItem = rowalldata[k].IdJob.toString();
                            var idJobDeb = $('#<%=lblCustName.ClientID%>').text();
                            var idVeh = $('#<%=hdnVehId.ClientID%>').val();
                            var idMake = "";//rowalldata[k].Id_Make.toString();
                            var idWh = "1";
                            var disSeq;
                            var jobVatPer = 0.0;
                            var jobVatSeq;

                            var detSeq = GetVatDis(idItem, idJobDeb, idVeh, idMake, idWh);

                            disSeq = detSeq[0];
                            jobVatPer = fnformatDecimalValue(detSeq[1], seperator);
                            jobVatSeq = detSeq[2];

                            var disPer = rowalldata[k].Rab;
                            if (disPer == "") {
                                disPer = "0.00";
                            }

                            var idwarehouse = rowalldata[k].Id_Warehouse;
                            if (idwarehouse == undefined || idwarehouse == "" || idwarehouse == "0") {
                                idwarehouse = 1;//check this
                            }

                            woChrgTime = "0";
                            woChrgTimeFp = "0";
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);

                            if (rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ' +
                                ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.0" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0" />';

                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val().toString(), seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                 'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue($('#<%=txtVat.ClientID%>').val().toString(), seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" LineType ="T"  CUST_TYPE="OHC"  WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                            }
                            else {
                                //idWODetSeq = rowalldata[k].IdWODetailseq;
                                mode = "Update";
                                if (rowalldata[k].IdWOItemseq == "" || rowalldata[k].IdWOItemseq == undefined || rowalldata[k].IdWOItemseq == "0" && rowalldata[k].DebtType == "OHC") {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_WODET_SEQ_JOB="0"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="0" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.00" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                    "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0" />';
                                }
                                else {
                                    if (rowalldata[k].DebtType == "OHC") {
                                        spareXml = spareXml + '<insert ID_ITEM_JOB ="' + rowalldata[k].IdJob + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_WODET_SEQ_JOB="' + rowalldata[k].IdWODetailseq + '"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                        0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="' + rowalldata[k].IdWOItemseq + '" ' +
                                        ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.00" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                        "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                        ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0"  />';
                                    }
                                }
                                if (rowalldata[k].DebtType == "OHC") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val().toString(), seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                            'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue($('#<%=txtVat.ClientID%>').val().toString(), seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" LineType ="T"  CUST_TYPE="OHC"  WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                                }


                            }

                            jobIdXml = "<root>" + jobIdXml + "</root>";

                            discXml = discXml + '<insert ID_DEBTOR ="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_ITEM = "' + rowalldata[k].IdJob + '" ID_MAKE = "" ID_WAREHOUSE = "' + idwarehouse + '" DBT_VAT_AMOUNT = "' +
                                 fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" DBT_DIS_AMT="' + fnformatDecimalValue($('#<%=txtDisc.ClientID%>').val().toString(), seperator) + '" JOB_VAT_PER="' + jobVatPer + '" JOB_VAT_SEQ="' + jobVatSeq + '" JOB_DIS_SEQ="' + disSeq + '" JOB_DIS_PER="0" />';
                        }//Labour to TextLine
                        else if (rowalldata[k].Diff == "T" && rowalldata[k].Text != "" && rowalldata[k].Levert == "" && rowalldata[k].IdWOLabSeq != "" && rowalldata[k].DebtType == "OHC") {
                            woHourleyPrice = rowalldata[k].Pris;

                            if (woHourleyPrice == "") {
                                woHourleyPrice = "0";
                            }

                            if (rowalldata[k].Levert == "") {
                                woChrgTime = "0";
                                woChrgTimeFp = "0";
                            } else {
                                woChrgTime = rowalldata[k].Levert;
                                woChrgTimeFp = rowalldata[k].Levert;
                            }

                            var amount = 0.0;
                            //amount = fnformatDecimalValue(rowalldata[k].Belop, seperator);
                            amount = fnformatDecimalValue(rowalldata[k].Levert, seperator) * fnformatDecimalValue(rowalldata[k].Pris, seperator);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = fnformatDecimalValue($('#<%=txtGM.ClientID%>').val(), seperator);
                            if (rowalldata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                            }

                            if (rowalldata[k].Belop == undefined) {
                                woTotLabAmt = "";
                            } else {
                                woTotLabAmt = fnreformatDecimal(amtL, seperator);
                            }

                            //Discount Per Line
                            labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (woDiscount / 100)), seperator)).toFixed(2);
                            gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (woDiscount / 100)), seperator)).toFixed(2);

                            discPerJob = fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator);

                            woTotDiscAmt = discPerJob;
                            finalDiscount = discPerJob;

                            woTotSpareAmt = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmt = fnreformatDecimal(TotalGM, seperator);
                            //hpVatAmt = (amtL * (hpVat / 100)).toFixed(2);
                            //gmVatAmt = (TotalGM * (gmVat / 100)).toFixed(2);
                            hpVatAmt = (amount * (hpVat / 100)).toFixed(2);
                            gmVatAmt = (amtG * (gmVat / 100)).toFixed(2);

                            woTotVatAmt = fnformatDecimalValue(hpVatAmt, seperator) + fnformatDecimalValue(gmVatAmt, seperator);
                            woTotVatAmt = fnreformatDecimal(woTotVatAmt, seperator);
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);

                            finalTotal = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(amount, seperator) + fnformatDecimalValue(amtG, seperator); //+ fnformatDecimalValue(woTotSpareAmt, seperator);
                            finalVat = fnformatDecimalValue(finalVat, seperator) + fnformatDecimalValue(woTotVatAmt, seperator);
                            //finalDiscount = "0";
                            //totalamt = fnformatDecimalValue(totalamt, seperator) + fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);
                            totalamt = fnformatDecimalValue(finalTotal, seperator) + fnformatDecimalValue(finalVat, seperator);

                            finalTotal = fnreformatDecimal(finalTotal, seperator);
                            finalVat = fnreformatDecimal(finalVat, seperator);
                            totalamt = fnreformatDecimal(totalamt, seperator);

                            if (rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined || rowalldata[k].IdWODetailseq == null && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" LineType ="L" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';

                                mechXml = mechXml + ' <insert ID_MECH="' + rowalldata[k].IdMech.toString() + '" Id_Sl_No="' + rowalldata[k].id.toString() + '" ID_WOLAB_SEQ = "" LabourDesc = "' + rowalldata[k].Text.toString() + '"  Wo_Lab_Hrs = "' + fnformatDecimalValue(rowalldata[k].Levert.toString(), seperator) + '" HourlyPr = "' + fnformatDecimalValue(rowalldata[k].Pris.toString(), seperator) + '" WO_Lab_Discount = "' + fnformatDecimalValue(woDiscount) + '"  LineType ="L" />';
                            }
                            else {
                                mode = "Update";
                                if (rowalldata[k].DebtType == "OHC") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                                }
                                mechXml = mechXml + ' <insert ID_MECH="' + rowalldata[k].IdMech.toString() + '" Id_Sl_No="' + rowalldata[k].id.toString() + '" ID_WOLAB_SEQ = "' + rowalldata[k].IdWOLabSeq.toString() + '" LabourDesc = "' + rowalldata[k].Text.toString() + '"  Wo_Lab_Hrs = "' + fnformatDecimalValue(rowalldata[k].Levert.toString(), seperator) + '" HourlyPr = "' + fnformatDecimalValue(rowalldata[k].Pris.toString(), seperator) + '" WO_Lab_Discount = "' + fnformatDecimalValue(woDiscount) + '"  LineType ="LT" />';
                            }

                            //TextLine
                            var idItem = ""; //rowalldata[k].IdJob.toString();
                            var idJobDeb = $('#<%=lblCustName.ClientID%>').text();
                            var idVeh = $('#<%=hdnVehId.ClientID%>').val();
                            var idMake = "";//rowalldata[k].Id_Make.toString();
                            var idWh = "1";
                            var disSeq;
                            var jobVatPer = 0.0;
                            var jobVatSeq;

                            var detSeq = GetVatDis(idItem, idJobDeb, idVeh, idMake, idWh);

                            disSeq = detSeq[0];
                            jobVatPer = fnformatDecimalValue(detSeq[1], seperator);
                            jobVatSeq = detSeq[2];

                            var disPer = rowalldata[k].Rab;
                            if (disPer == "") {
                                disPer = "0.00";
                            }

                            var idwarehouse = rowalldata[k].Id_Warehouse;
                            if (idwarehouse == undefined || idwarehouse == "" || idwarehouse == "0") {
                                idwarehouse = 1;//check this
                            }

                            woChrgTime = "0";
                            woChrgTimeFp = "0";
                            woTotLabAmtFp = fnreformatDecimal(amtL, seperator);
                            woTotSpareAmtFp = fnreformatDecimal(woTotSpareAmt, seperator);
                            woTotGmAmtFp = fnreformatDecimal(TotalGM, seperator);
                            woTotVatAmtFp = fnreformatDecimal(finalVat, seperator);

                            if (rowalldata[k].IdWODetailseq == "" || rowalldata[k].IdWODetailseq == undefined && rowalldata[k].DebtType == "OHC") {
                                mode = "Add";
                                spareXml = spareXml + '<insert ID_ITEM_JOB ="' + idItem + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ' +
                                ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.0" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0"  />';

                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val().toString(), seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                 'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue($('#<%=txtVat.ClientID%>').val().toString(), seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" LineType ="T" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0"  />';
                            }
                            else {
                                //idWODetSeq = rowalldata[k].IdWODetailseq;
                                mode = "Update";
                                if (rowalldata[k].IdWOItemseq == "" || rowalldata[k].IdWOItemseq == undefined || rowalldata[k].IdWOItemseq == "0" && rowalldata[k].DebtType == "OHC") {
                                    spareXml = spareXml + '<insert ID_ITEM_JOB ="' + idItem + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_WODET_SEQ_JOB="' + rowalldata[k].IdWODetailseq + '"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                    0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="0" ' +
                                    ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.00" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                    "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                    ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T"  SPARE_DISCOUNT="0"  />';
                                }
                                else {
                                    if (rowalldata[k].DebtType == "OHC") {

                                        spareXml = spareXml + '<insert ID_ITEM_JOB ="' + idItem + '" ID_MAKE_JOB = "' + "" + '" ID_WAREHOUSE = "' + idwarehouse + '" ID_WODET_SEQ_JOB="' + rowalldata[k].IdWODetailseq + '"  ID_ITEM_CATG_JOB = "" JOBI_ORDER_QTY = "' +
                                        0.00 + '" JOBI_DELIVER_QTY= "' + 0.00 + '" JOBI_BO_QTY ="0.00" JOBI_DIS_PER ="' + 0.00 + '" JOBI_VAT_PER ="' + spVat + '" ORDER_LINE_TEXT ="" ID_WOITEM_SEQ="' + rowalldata[k].IdWOItemseq + '" ' +
                                        ' JOBI_SELL_PRICE ="' + fnformatDecimalValue(rowalldata[k].Pris, seperator) + '" JOBI_COST_PRICE = "0.00" ID_CUST_WO = "' + $('#<%=lblCustName.ClientID%>').text() + '" TEXT ="' + rowalldata[k].Text + '" TD_CALC ="True " ITEM_DESC="' +
                                        "" + '" PICKINGLIST_PREV_PRINTED ="False" DELIVERYNOTE_PREV_PRINTED ="False" PREV_PICKED ="0" SPARE_TYPE="ORD" FLG_FORCE_VAT ="False " ' +
                                        ' FLG_EDIT_SP="False" EXPORT_TYPE="" Id_Sl_No="' + rowalldata[k].id.toString() + '" LineType ="T" SPARE_DISCOUNT="0"   />';
                                    }
                                }
                                if (rowalldata[k].DebtType == "OHC") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue($('#<%=txtTotal.ClientID%>').val().toString(), seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue($('#<%=txtVat.ClientID%>').val().toString(), seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="0.00" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" LineType ="T" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" />';
                                }
                            }

                            //jobIdXml = "<root>" + jobIdXml + "</root>";

                            discXml = discXml + '<insert ID_DEBTOR ="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_ITEM = "' + idItem + '" ID_MAKE = "" ID_WAREHOUSE = "' + idwarehouse + '" DBT_VAT_AMOUNT = "' +
                                     fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" DBT_DIS_AMT="' + fnformatDecimalValue($('#<%=txtDisc.ClientID%>').val().toString(), seperator) + '" JOB_VAT_PER="' + jobVatPer + '" JOB_VAT_SEQ="' + jobVatSeq + '" JOB_DIS_SEQ="' + disSeq + '" JOB_DIS_PER="0" />';

                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }
                        else if (rowalldata[k].IdWODetailseq != "" && rowalldata[k].IdWODetailseq != undefined && rowalldata[k].IdWODetailseq != null && rowalldata[k].Flag == "0" && rowalldata[k].DebtType == "OHC") {
                            woChrgTime = "0";
                            woChrgTimeFp = "0";
                            woTotLabAmtFp = "0";
                            woTotSpareAmtFp = "0";
                            woTotGmAmtFp = "0";
                            woTotVatAmtFp = "0";
                            mode = "Update";
                            if (rowalldata[k].DebtType == "OHC") {
                                jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="100.00" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                   'PWO_FIXED_VATPER = "1.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "" REDUCTION_PER="0" REDUCTION_BEFORE_OR="0" REDUCTION_AFTER_OR="0"  REDUCTION_AMOUNT="0" DBT_DIS_PER="0" DEB_STATUS="" />';
                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }

                        if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {

                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;

                                if (idJobId == idJob && Debitor == $('#<%=hdnInsCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL"

                                }
                            }

                            //var delarr = new Array()
                            //delarr = fetchDelJobDet(idWONO, idWOPrefix)


                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "INSC" && rowalldata[k].DebtType == "OHC") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var debitorDisc = "";
                            var custLabDisc = "0";
                            var custSpareDisc = "0";
                            var custGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtInsDiscount.ClientID%>').val(), seperator) != "0") {
                                debitorDisc = fnformatDecimalValue($('#<%=txtInsDiscount.ClientID%>').val(), seperator);
                            } else {
                                debitorDisc = "0";
                            }

                            custLabDisc = fnformatDecimalValue($('#<%=hdnInsLabDisc.ClientID%>').val(), seperator);
                            custSpareDisc = fnformatDecimalValue($('#<%=hdnInsSpareDisc.ClientID%>').val(), seperator);
                            custGenDisc = fnformatDecimalValue($('#<%=hdnInsGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue(custLabDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custLabDisc = custGenDisc
                            }

                            if (fnformatDecimalValue(custSpareDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custSpareDisc = custGenDisc
                            }

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {
                                ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                if (status == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            if ($('#<%=chkInsMoveVat.ClientID%>').is(':checked') == false) {
                                if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                    var balPerc;
                                    var insDebPerc;
                                    desc = "Reduction After Own Risk"  //rowalldata[k].Text.toString()

                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
						'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'

                                    balPerc = 100 - ordHeadCustDbtPer; // fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                    //insDebPerc = 100 - redPerc;
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';
                                }
                                else {
                                    var balPerc;
                                    var insDebPerc;
                                    if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                        jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '"  DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                    } else {
                                        jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                          'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                    }

                                    balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                    //insDebPerc = 100 - redPerc;
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                       'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '"  />';
                                }
                            }
                                //Owner pay vat
                            else {
                                if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                    var balPerc;
                                    var insDebPerc;
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '"  DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(finalVat, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />';

                                    balPerc = 100 - ordHeadCustDbtPer;
                                    // fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                    //insDebPerc = 100 - redPerc;
                                    jobIdXml = jobIdXml +
                                           '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(finalTotal, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="0.00" PWO_GM_PER="0.00" PWO_GM_VATPER="0.00" PWO_LBR_VATPER="0.00" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';
                                }
                                else {
                                    var balPerc;
                                    var insDebPerc;
                                    balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)

                                    if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                        jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '"  DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(finalVat, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />';

                                    } else {
                                        jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '"  DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(finalVat, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                        'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />';
                                    }

                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(finalTotal, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="0.00" PWO_GM_PER="0.00" PWO_GM_VATPER="0.00" PWO_LBR_VATPER="0.00" PWO_SPR_DISCPER="0.00"  ' +
                                        'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '"  CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';
                                }

                                woOwnPayVat = 1;
                                woOwnCrCust = $('#<%=lblCustName.ClientID%>').text();
                                woOwnRiskCust = $('#<%=hdnInsCustId.ClientID%>').val();
                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                            // }

                        }


                        if (($('#<%=hdnIntCustId.ClientID%>').val() != "") && ($('#<%=hdnClaimCustId.ClientID%>').val() == "")) {
                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;

                                if (idJobId == idJob && Debitor == $('#<%=hdnIntCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL"

                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "INTC") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var debitorDisc = "";
                            var custLabDisc = "0";
                            var custSpareDisc = "0";
                            var custGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtIntDiscount.ClientID%>').val(), seperator) != "0") {
                                debitorDisc = fnformatDecimalValue($('#<%=txtIntDiscount.ClientID%>').val(), seperator);

                            } else {
                                debitorDisc = "0";//[Check]                               
                            }

                            custLabDisc = fnformatDecimalValue($('#<%=hdnIntLabDisc.ClientID%>').val(), seperator);
                            custSpareDisc = fnformatDecimalValue($('#<%=hdnIntSpareDisc.ClientID%>').val(), seperator);
                            custGenDisc = fnformatDecimalValue($('#<%=hdnIntGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue(custLabDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custLabDisc = custGenDisc
                            }

                            if (fnformatDecimalValue(custSpareDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custSpareDisc = custGenDisc
                            }

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            if ($('#<%=hdnIntCustId.ClientID%>').val() != "") {
                                if ($('#<%=txtIntSplit.ClientID%>').val() == "" || $('#<%=txtIntSplit.ClientID%>').val() == "0") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                                else if ($('#<%=txtIntSplit.ClientID%>').val() == "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                }
                                else if (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) < "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue(100, seperator) - fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator);
                                    ordHeadCustDbtPer = fnformatDecimalValue(ordHeadCustDbtPer, seperator);
                                }

                                if (status == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            var orderheadCustAmt = (ordHeadCustDbtPer * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var ordHeadCustVatAmt = (ordHeadCustDbtPer * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            var intCustAmt = (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var intCustVatAmt = (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);

                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnIntCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(intCustAmt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
						'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(intCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INTC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                  'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                jobIdXml = jobIdXml +
                                '<insert ID_DETAIL="' + $('#<%=hdnIntCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(intCustAmt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                   'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(intCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INTC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }

                        if (($('#<%=hdnClaimCustId.ClientID%>').val() != "") && ($('#<%=hdnIntCustId.ClientID%>').val() == "")) {

                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;

                                if (idJobId == idJob && Debitor == $('#<%=hdnClaimCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL"

                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "CLA") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var debitorDisc = "";
                            var custLabDisc = "0";
                            var custSpareDisc = "0";
                            var custGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtClaimDiscount.ClientID%>').val(), seperator) != "0") {
                                debitorDisc = fnformatDecimalValue($('#<%=txtClaimDiscount.ClientID%>').val(), seperator);
                            } else {
                                debitorDisc = "0";//[Check]
                            }

                            custLabDisc = fnformatDecimalValue($('#<%=hdnClaLabDisc.ClientID%>').val(), seperator);
                            custSpareDisc = fnformatDecimalValue($('#<%=hdnClaSpareDisc.ClientID%>').val(), seperator);
                            custGenDisc = fnformatDecimalValue($('#<%=hdnClaGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue(custLabDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custLabDisc = custGenDisc
                            }

                            if (fnformatDecimalValue(custSpareDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custSpareDisc = custGenDisc
                            }

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            if ($('#<%=hdnClaimCustId.ClientID%>').val() != "") {
                                if ($('#<%=txtClaimSplit.ClientID%>').val() == "" || $('#<%=txtClaimSplit.ClientID%>').val() == "0") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                                else if ($('#<%=txtClaimSplit.ClientID%>').val() == "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                }
                                else if (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) < "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue(100, seperator) - fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator);
                                    ordHeadCustDbtPer = fnformatDecimalValue(ordHeadCustDbtPer, seperator);
                                }

                                if (status == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            var orderheadCustAmt = (ordHeadCustDbtPer * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var ordHeadCustVatAmt = (ordHeadCustDbtPer * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            var claCustAmt = (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var claCustVatAmt = (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);

                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnClaimCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(claCustAmt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
							'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(claCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="CLA"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '"  CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '"  />';
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                  'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                jobIdXml = jobIdXml +
                                '<insert ID_DETAIL="' + $('#<%=hdnClaimCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(claCustAmt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                   'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(claCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="CLA" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + status + '" />';

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }


                        if (($('#<%=hdnClaimCustId.ClientID%>').val() != "" && $('#<%=hdnIntCustId.ClientID%>').val() != "")) {
                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var claStatus = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            //var status = "";
                            //var miscStatus = "";
                            //var delarr = new Array()
                            //delarr = fetchDelJobDet(idWONO, idWOPrefix);

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;
                                if (idJobId == idJob && Debitor == $('#<%=hdnIntCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL";
                                }
                                if (idJobId == idJob && Debitor == $('#<%=hdnClaimCustId.ClientID%>').val() && Debitor != "") {
                                    claStatus = "DEL";
                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "CLA") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var intDebitorDisc = "";
                            var custIntLabDisc = "0";
                            var custIntSpareDisc = "0";
                            var custIntGenDisc = "0";

                            var claDebitorDisc = "";
                            var custClaLabDisc = "0";
                            var custClaSpareDisc = "0";
                            var custClaGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtIntDiscount.ClientID%>').val(), seperator) != "0") {
                                intDebitorDisc = fnformatDecimalValue($('#<%=txtIntDiscount.ClientID%>').val(), seperator);
                            } else {
                                intDebitorDisc = "0";//[Check]                                
                            }

                            custIntLabDisc = fnformatDecimalValue($('#<%=hdnIntLabDisc.ClientID%>').val(), seperator);
                            custIntSpareDisc = fnformatDecimalValue($('#<%=hdnIntSpareDisc.ClientID%>').val(), seperator);
                            custIntGenDisc = fnformatDecimalValue($('#<%=hdnIntGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue($('#<%=txtClaimDiscount.ClientID%>').val(), seperator) != "0") {
                                claDebitorDisc = fnformatDecimalValue($('#<%=txtClaimDiscount.ClientID%>').val(), seperator);
                            } else {
                                claDebitorDisc = "0";//[Check]
                            }

                            custClaLabDisc = fnformatDecimalValue($('#<%=hdnClaLabDisc.ClientID%>').val(), seperator);
                            custClaSpareDisc = fnformatDecimalValue($('#<%=hdnClaSpareDisc.ClientID%>').val(), seperator);
                            custClaGenDisc = fnformatDecimalValue($('#<%=hdnClaGenDisc.ClientID%>').val(), seperator);

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);

                            if ($('#<%=hdnClaimCustId.ClientID%>').val() != "" && $('#<%=hdnIntCustId.ClientID%>').val() != "") {
                                if (($('#<%=txtClaimSplit.ClientID%>').val() == "" || $('#<%=txtClaimSplit.ClientID%>').val() == "0") && ($('#<%=hdnIntCustId.ClientID%>').val() == "" || $('#<%=hdnIntCustId.ClientID%>').val() == "0")) {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                                else if (($('#<%=txtClaimSplit.ClientID%>').val() == "100") || ($('#<%=hdnIntCustId.ClientID%>').val() == "100")) {
                                    ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                }
                                else if ((fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) < "100") || (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) < "100")) {
                                    ordHeadCustDbtPer = fnformatDecimalValue(100, seperator) - fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) - fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator);
                                    ordHeadCustDbtPer = fnformatDecimalValue(ordHeadCustDbtPer, seperator);
                                }
                            }

                            if (ordHeadCustDbtPer < 0) {
                                var mess = GetMultiMessage('0116', GetMultiMessage('0338', '', ''), '');  //"Disc Percentage cannot be negative";
                                alert(mess);
                                return false;
                            }
                            else if (ordHeadCustDbtPer > 100) {
                                var mess = GetMultiMessage('0116', GetMultiMessage('0338', '', ''), '');  //"Disc Percentage cannot be greater than 100";
                                alert(mess);
                                return false;
                            }
                            var intCustPer = fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator);
                            var claCustPer = fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator);

                            var orderheadCustAmt = (ordHeadCustDbtPer * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var ordHeadCustVatAmt = (ordHeadCustDbtPer * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            var claCustAmt = (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var claCustVatAmt = (fnformatDecimalValue($('#<%=txtClaimSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);
                            var intCustAmt = (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(totalamt, seperator) * 0.01).toFixed(2);
                            var intCustVatAmt = (fnformatDecimalValue($('#<%=txtIntSplit.ClientID%>').val(), seperator) * fnformatDecimalValue(finalVat, seperator) * 0.01).toFixed(2);

                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                if (status == "DEL") {
                                    ordHeadCustDbtPer = ordHeadCustDbtPer + intCustPer;
                                    intCustPer = fnformatDecimalValue("0", seperator);
                                }

                                if (claStatus == "DEL") {
                                    ordHeadCustDbtPer = ordHeadCustDbtPer + claCustPer;
                                    claCustPer = fnformatDecimalValue("0", seperator);
                                }
                                jobIdXml = jobIdXml +
                                       '<insert ID_DETAIL="' + $('#<%=hdnIntCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(intCustAmt, seperator) + '" DBT_PER="' + intCustPer + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
								'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(intCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INTC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + intDebitorDisc + '" CUST_DISC_GENERAL="' + custIntGenDisc + '" CUST_DISC_LABOUR="' + custIntLabDisc + '" CUST_DISC_SPARES="' + custIntSpareDisc + '" DEB_STATUS="' + status + '" />'

				       + '<insert ID_DETAIL="' + $('#<%=hdnClaimCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(claCustAmt, seperator) + '" DBT_PER="' + claCustPer + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
								'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(claCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="CLA"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + claDebitorDisc + '" CUST_DISC_GENERAL="' + custClaGenDisc + '" CUST_DISC_LABOUR="' + custClaLabDisc + '" CUST_DISC_SPARES="' + custClaSpareDisc + '" DEB_STATUS="' + claStatus + '" />'
                                ;
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (status == "DEL") {
                                    ordHeadCustDbtPer = ordHeadCustDbtPer + intCustPer;
                                    intCustPer = fnformatDecimalValue("0", seperator);
                                }

                                if (claStatus == "DEL") {
                                    ordHeadCustDbtPer = ordHeadCustDbtPer + claCustPer;
                                    claCustPer = fnformatDecimalValue("0", seperator);
                                }
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="' + fnformatDecimalValue(orderheadCustAmt, seperator) + '" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                  'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(ordHeadCustVatAmt, seperator) + '" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnIntCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(intCustAmt, seperator) + '" DBT_PER="' + intCustPer + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(intCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INTC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + intDebitorDisc + '" CUST_DISC_GENERAL="' + custIntGenDisc + '" CUST_DISC_LABOUR="' + custIntLabDisc + '" CUST_DISC_SPARES="' + custIntSpareDisc + '" DEB_STATUS="' + status + '" />'

                                       + '<insert ID_DETAIL="' + $('#<%=hdnClaimCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(claCustAmt, seperator) + '" DBT_PER="' + claCustPer + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(claCustVatAmt, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="CLA"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + claDebitorDisc + '" CUST_DISC_GENERAL="' + custClaGenDisc + '" CUST_DISC_LABOUR="' + custClaLabDisc + '" CUST_DISC_SPARES="' + custClaSpareDisc + '" DEB_STATUS="' + claStatus + '" />'
                                ;

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }


                        if (($('#<%=hdnMiscCustId.ClientID%>').val() != "")) {
                            if (rowalldata[k].Flag == "1") {
                                var miscStatus = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;

                                if (idJobId == idJob && Debitor == $('#<%=hdnMiscCustId.ClientID%>').val() && Debitor != "") {
                                    miscStatus = "DEL";
                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "MISC" && rowalldata[k].DebtType == "OHC") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var debitorDisc = "";
                            var custLabDisc = "0";
                            var custSpareDisc = "0";
                            var custGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtMiscDiscount.ClientID%>').val(), seperator) != "0") {
                                debitorDisc = fnformatDecimalValue($('#<%=txtMiscDiscount.ClientID%>').val(), seperator);
                            } else {
                                debitorDisc = "0";
                            }

                            custLabDisc = fnformatDecimalValue($('#<%=hdnMiscLabDisc.ClientID%>').val(), seperator);
                            custSpareDisc = fnformatDecimalValue($('#<%=hdnMiscSpareDisc.ClientID%>').val(), seperator);
                            custGenDisc = fnformatDecimalValue($('#<%=hdnMiscGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue(custLabDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custLabDisc = custGenDisc
                            }

                            if (fnformatDecimalValue(custSpareDisc, seperator) == 0 && fnformatDecimalValue(custGenDisc, seperator) > 0) {
                                custSpareDisc = custGenDisc
                            }

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);

                            var miscOwnRiskAmt = 0;

                            if ($('#<%=chkMiscMoveOwnRisk.ClientID%>').is(':checked')) {
                                miscOwnRiskAmt = woOwnRiskAmt;
                            } else {
                                miscOwnRiskAmt = 0;
                            }


                            if ($('#<%=hdnMiscCustId.ClientID%>').val() != "") {
                                if ($('#<%=txtMiscSplit.ClientID%>').val() == "" || $('#<%=txtMiscSplit.ClientID%>').val() == "0") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                                else if ($('#<%=txtMiscSplit.ClientID%>').val() == "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                }
                                else if (fnformatDecimalValue($('#<%=txtMiscSplit.ClientID%>').val(), seperator) > "0" && fnformatDecimalValue($('#<%=txtMiscSplit.ClientID%>').val(), seperator) < "100") {
                                    ordHeadCustDbtPer = fnformatDecimalValue(100, seperator) - fnformatDecimalValue($('#<%=txtMiscSplit.ClientID%>').val(), seperator);
                                    ordHeadCustDbtPer = fnformatDecimalValue(ordHeadCustDbtPer, seperator);
                                }
                                if (miscStatus == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                             'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + miscStatus + '" />';
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                  'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS="" />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                jobIdXml = jobIdXml +
                                '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                   'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + debitorDisc + '" CUST_DISC_GENERAL="' + custGenDisc + '" CUST_DISC_LABOUR="' + custLabDisc + '" CUST_DISC_SPARES="' + custSpareDisc + '" DEB_STATUS="' + miscStatus + '" />';

                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }

                        //Insurance and Miscellaneous Customer
                        if (($('#<%=hdnMiscCustId.ClientID%>').val() != "" && $('#<%=hdnInsCustId.ClientID%>').val() != "")) {
                            if (rowalldata[k].Flag == "1") {
                                var status = "";
                                var miscStatus = "";
                                var delarr = new Array()
                                delarr = fetchDelJobDet(idWONO, idWOPrefix);
                            }

                            //var status = "";
                            //var miscStatus = "";
                            //var delarr = new Array()
                            //delarr = fetchDelJobDet(idWONO, idWOPrefix);

                            var array = delarr;//[{ idDebitor: "18014", jobId: 2 }];
                            var length = array.length;
                            for (var i = 0; i < length; i++) {
                                var obj = array[i];
                                var idJobId = obj.idJobId;
                                var Debitor = obj.Debitor;
                                if (idJobId == idJob && Debitor == $('#<%=hdnInsCustId.ClientID%>').val() && Debitor != "") {
                                    status = "DEL";
                                }
                                if (idJobId == idJob && Debitor == $('#<%=hdnMiscCustId.ClientID%>').val() && Debitor != "") {
                                    miscStatus = "DEL";

                                }
                            }

                            if (rowalldata[k].JobId == "1" && (rowalldata[k].Diff == "RAOR" || rowalldata[k].Diff == "RBOR")) {
                                if (rowalldata[k].DebtType != "MISC" && rowalldata[k].DebtType == "OHC") {
                                    redPerc = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                                    redAmt = fnformatDecimalValue(rowalldata[k].Belop.toString(), seperator);
                                }

                                if (rowalldata[k].Diff == "RAOR") {
                                    redBefOR = "0";
                                    redAftrOR = "1";
                                } else if (rowalldata[k].Diff == "RBOR") {
                                    redBefOR = "1";
                                    redAftrOR = "0";
                                } else {
                                    redBefOR = "0";
                                    redAftrOR = "0";
                                }
                            }

                            var miscOwnRiskAmt = 0;

                            if ($('#<%=chkMiscMoveOwnRisk.ClientID%>').is(':checked')) {
                                miscOwnRiskAmt = woOwnRiskAmt;
                            } else {
                                miscOwnRiskAmt = 0;
                            }

                            var insDebitorDisc = "";
                            var custInsLabDisc = "0";
                            var custInsSpareDisc = "0";
                            var custInsGenDisc = "0";

                            var miscDebitorDisc = "";
                            var custMiscLabDisc = "0";
                            var custMiscSpareDisc = "0";
                            var custMiscGenDisc = "0";

                            if (fnformatDecimalValue($('#<%=txtInsDiscount.ClientID%>').val(), seperator) != "0") {
                                insDebitorDisc = fnformatDecimalValue($('#<%=txtInsDiscount.ClientID%>').val(), seperator);
                            } else {
                                insDebitorDisc = "0"; //[Check]                                
                            }

                            custInsLabDisc = fnformatDecimalValue($('#<%=hdnInsLabDisc.ClientID%>').val(), seperator);
                            custInsSpareDisc = fnformatDecimalValue($('#<%=hdnInsSpareDisc.ClientID%>').val(), seperator);
                            custInsGenDisc = fnformatDecimalValue($('#<%=hdnInsGenDisc.ClientID%>').val(), seperator);

                            if (fnformatDecimalValue($('#<%=txtMiscDiscount.ClientID%>').val(), seperator) != "0") {
                                miscDebitorDisc = fnformatDecimalValue($('#<%=txtMiscDiscount.ClientID%>').val(), seperator);
                            } else {
                                miscDebitorDisc = "0"; //[Check]
                            }
                            custMiscLabDisc = fnformatDecimalValue($('#<%=hdnMiscLabDisc.ClientID%>').val(), seperator);
                            custMiscSpareDisc = fnformatDecimalValue($('#<%=hdnMiscSpareDisc.ClientID%>').val(), seperator);
                            custMiscGenDisc = fnformatDecimalValue($('#<%=hdnMiscGenDisc.ClientID%>').val(), seperator);

                            var ordHeadCustDbtPer = fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator);
                            if ($('#<%=hdnInsCustId.ClientID%>').val() != "") {
                                ordHeadCustDbtPer = fnformatDecimalValue("0", seperator);
                                if (status == "DEL") {
                                    ordHeadCustDbtPer = fnformatDecimalValue("100", seperator);
                                }
                            }

                            if (rowalldata[k].Ford >= "0" && rowalldata[k].Levert == "" && rowalldata[k].Bestilt == "" && rowalldata[k].Pris == "" && rowalldata[k].Diff == "OR") {
                                var balPerc;
                                var insDebPerc;
                                balPerc = 100 - ordHeadCustDbtPer;
                                if (status == "DEL") {
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + insDebitorDisc + '" CUST_DISC_GENERAL="' + custInsGenDisc + '" CUST_DISC_LABOUR="' + custInsLabDisc + '" CUST_DISC_SPARES="' + custInsSpareDisc + '"  DEB_STATUS="' + status + '" />' +
                                '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="0.00" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + miscDebitorDisc + '" CUST_DISC_GENERAL="' + custMiscGenDisc + '" CUST_DISC_LABOUR="' + custMiscLabDisc + '" CUST_DISC_SPARES="' + custMiscSpareDisc + '" DEB_STATUS="' + miscStatus + '"/>';
                                } else {
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                    'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + insDebitorDisc + '" CUST_DISC_GENERAL="' + custInsGenDisc + '" CUST_DISC_LABOUR="' + custInsLabDisc + '" CUST_DISC_SPARES="' + custInsSpareDisc + '"  DEB_STATUS="" />' +
                                    '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                    'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + miscDebitorDisc + '" CUST_DISC_GENERAL="' + custMiscGenDisc + '" CUST_DISC_LABOUR="' + custMiscLabDisc + '" CUST_DISC_SPARES="' + custMiscSpareDisc + '" DEB_STATUS=""/>';
                                }
                            }
                            else {
                                var balPerc;
                                var insDebPerc;
                                if (rowalldata[k].Id_Deb_Seq.toString() == "") {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                    'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                } else {
                                    jobIdXml = '<insert ID_DETAIL="' + $('#<%=lblCustName.ClientID%>').text() + '" ID_DBT_SEQ="' + rowalldata[k].Id_Deb_Seq.toString() + '" DEBITOR_TYPE="C" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="1.00" PWO_GM_PER="1.00" PWO_GM_VATPER="1.00" PWO_LBR_VATPER="1.00" PWO_SPR_DISCPER="1.00"  ' +
                                  'PWO_FIXED_VATPER = "1.00" ORG_PER="0.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="0.00" LABOUR_DISCOUNT="0.00" GM_AMOUNT="0.00" GM_DISCOUNT="0.00" OWNRISK_AMOUNT="0.00" SP_VAT="0.00" SP_AMT_DEB="0.00" CUST_TYPE="OHC" WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="0" CUST_DISC_GENERAL="0" CUST_DISC_LABOUR="0" CUST_DISC_SPARES="0" DEB_STATUS=""  />'
                                }

                                balPerc = 100 - ordHeadCustDbtPer;// fnformatDecimalValue(rowalldata[k].Ford.toString(), seperator)
                                //insDebPerc = 100 - redPerc;
                                if (status == "DEL") {
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                    'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + insDebitorDisc + '" CUST_DISC_GENERAL="' + custInsGenDisc + '" CUST_DISC_LABOUR="' + custInsLabDisc + '" CUST_DISC_SPARES="' + custInsSpareDisc + '" DEB_STATUS="' + status + '" />' +
                                    '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="0.00" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                    'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + miscDebitorDisc + '" CUST_DISC_GENERAL="' + custMiscGenDisc + '" CUST_DISC_LABOUR="' + custMiscLabDisc + '" CUST_DISC_SPARES="' + custMiscSpareDisc + '" DEB_STATUS="' + miscStatus + '" />';
                                }
                                else {
                                    jobIdXml = jobIdXml +
                                    '<insert ID_DETAIL="' + $('#<%=hdnInsCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="' + fnformatDecimalValue(totalamt, seperator) + '" DBT_PER="' + balPerc + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                    'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="' + fnformatDecimalValue(finalVat, seperator) + '" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="0.00" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="INSC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + insDebitorDisc + '" CUST_DISC_GENERAL="' + custInsGenDisc + '" CUST_DISC_LABOUR="' + custInsLabDisc + '" CUST_DISC_SPARES="' + custInsSpareDisc + '" DEB_STATUS="" />' +
                                    '<insert ID_DETAIL="' + $('#<%=hdnMiscCustId.ClientID%>').val() + '" ID_DBT_SEQ="1" DEBITOR_TYPE="D" DBT_AMT="0.00" DBT_PER="' + ordHeadCustDbtPer + '" PWO_VAT_PERCENTAGE="25.00" PWO_GM_PER="' + fnformatDecimalValue($('#<%=txtGM.ClientID%>').val().toString(), seperator) + '" PWO_GM_VATPER="' + gmVat + '" PWO_LBR_VATPER="' + hpVat + '" PWO_SPR_DISCPER="0.00"  ' +
                                    'PWO_FIXED_VATPER = "0.00" ORG_PER="100.00" JOB_VAT_AMOUNT="0.00" LABOUR_AMOUNT="' + amtL + '" LABOUR_DISCOUNT="' + labDisc + '" GM_AMOUNT="' + TotalGM + '" GM_DISCOUNT="' + gmDisc + '" OWNRISK_AMOUNT="' + fnformatDecimalValue(miscOwnRiskAmt, seperator) + '" SP_VAT="' + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val().toString(), seperator) + '" SP_AMT_DEB="' + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val().toString(), seperator) + '" CUST_TYPE="MISC"  WO_OWN_RISK_DESC = "' + desc + '" REDUCTION_PER="' + redPerc + '" REDUCTION_BEFORE_OR="' + redBefOR + '" REDUCTION_AFTER_OR="' + redAftrOR + '" REDUCTION_AMOUNT="' + redAmt + '" DBT_DIS_PER="' + miscDebitorDisc + '" CUST_DISC_GENERAL="' + custMiscGenDisc + '" CUST_DISC_LABOUR="' + custMiscLabDisc + '" CUST_DISC_SPARES="' + custMiscSpareDisc + '" DEB_STATUS="" />';
                                }
                            }
                            jobIdXml = "<root>" + jobIdXml + "</root>";
                        }
                    }
                }//end of looping through for each job

                discPerJob = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator)).toFixed(2);
                discPerJob = fnreformatDecimal(discPerJob, seperator);
                woTotDiscAmt = discPerJob;
                finalDiscount = discPerJob;

                mechXml = "<root>" + mechXml + "</root>";
                spareXml = "<root>" + spareXml + "</root>";
                discXml = "<root>" + discXml + "</root>";

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/DeleteSaveJobDet",
                    data: "{jobIdXmls: '" + jobIdXml + "',spareXmls:'" + spareXml + "',discXmls:'" + discXml + "',mechXmls:'" + mechXml + "',idWODetSeq:'" + idWODetSeq + "',idWONO:'" + idWONO + "',idWOPrefix:'" + idWOPrefix + "',idRpgCatgWO:'" + idRpgCatgWO +
                    "',idRpgCodeWO:'" + idRpgCodeWO + "',idRepCodeWO:'" + idRepCodeWO + "',idWorkCodeWO:'" + idWorkCodeWO + "',woFixedPrice:'" + woFixedPrice + "',idJobPcdWO:'" + idJobPcdWO + "',woPlannedTime:'" + woPlannedTime +
                    "',woHourleyPrice:'" + woHourleyPrice + "',woClkTime:'" + woClkTime + "',woChrgTime:'" + woChrgTime + "',flgChrgStdTime:'" + flgChrgStdTime + "',woStdTime:'" + woStdTime + "',statReq:'" + stationReq +
                    "',woJobTxt:'" + woJobTxt + "',woOwnRiskAmt:'" + woOwnRiskAmt + "',woTotLabAmt:'" + woTotLabAmt + "',woTotSpareAmt:'" + woTotSpareAmt + "',woTotGmAmt:'" + woTotGmAmt + "',woTotVatAmt:'" + finalVat + "',woTotDiscAmt:'" + woTotDiscAmt +
                    "',jobStatus:'" + jobStatus + "',woOwnPayVat:'" + woOwnPayVat + "',idDefectNoteSeq:'" + idDefectNoteSeq + "',totalamt:'" + totalamt + "',idMechComp:'" + idMechComp + "',woOwnRiskCust:'" + woOwnRiskCust +
                    "',woOwnCrCust:'" + woOwnCrCust + "',idSerCallNo:'" + idSerCallNo + "',woGmPer:'" + woGmPer + "',woGmVatPer:'" + woGmVatPer + "',woLbrVatPer:'" + woLbrVatPer + "',woInclVat:'" + woInclVat + "',woDiscount:'" + woDiscount +
                    "',subrepCodeWO:'" + subrepCodeWO + "',ownriskvat:'" + ownriskvat + "',flgSprsts:'" + flgSprsts + "',salesman:'" + salesman + "',flgVatFree:'" + flgVatFree + "',costPrice:'" + costPrice + "',finalTotal:'" + finalTotal + "',finalVat:'" + finalVat +
                    "',finalDiscount:'" + finalDiscount + "',woChrgTimeFp:'" + woChrgTimeFp + "',woTotLabAmtFp:'" + woTotLabAmtFp + "',woTotSpareAmtFp:'" + woTotSpareAmtFp + "',woTotGmAmtFp:'" + woTotGmAmtFp + "',woTotVatAmtFp:'" + woTotVatAmtFp + "',woTotDiscAmtFp:'" + woTotDiscAmtFp +
                    "',woIntNote:'" + woIntNote + "',idJob:'" + idJob + "',flgawaitingSp:'" + flgawaitingSp + "',mode:'" + mode + "',idMech:'" + idMech + "',woOwnRiskDesc:'" + woOwnRiskDesc + "',woOwnRiskSlNo:'" + woOwnRiskSlNo + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {
                        if (jobNumber != "") {
                            jobNumber = jobNumber + ',' + idJob;
                        }
                        else {
                            jobNumber = idJob;
                        }
                        $('#<%=RTlblError.ClientID%>').text = "";
                        if (mode == "Add") {
                            if (Result.d[0] == "INSFLG") {
                                $('#<%=RTlblError.ClientID%>').text(jobNumber + 'Saved Successfully.');
                            }
                        } else if (mode == "Update") {
                            if (Result.d[0] == "UPDFLG") {
                                $('#<%=RTlblError.ClientID%>').text(jobNumber + 'Saved Successfully.');
                            }
                        }
                    }
                });

            }// end of jobs

            loadWOJobGrid(idWONO, idWOPrefix);

            var rowalldata = $('#jobgrid').jqGrid('getGridParam', 'data');
            var frowid = rowalldata.length;
            for (var i = 0; i < rowalldata.length; i++) {
                if (rowalldata[i].DebtType == "OHC") {
                    frowid = rowalldata[i].id;
                }
            }
            jQuery("#jobgrid").jqGrid("nextCell", parseInt(frowid), 0, true);
            document.getElementById((parseInt(frowid)) + '_IdJob').select();
        }



    function loadSparesGrid(Spname, CustId, VehId, makeArr, suppArr, locArr) {
        var makeIdXml = "";
        var makeIdXmls;
        var suppIdXml = "";
        var suppIdXmls;

        var locXml = "";
        var locXmls;
        for (var k = 0; k < makeArr.length; k++) {
            if (makeArr[k] != null)
            {
                makeIdXml = makeIdXml + "<MAKE><ID_MAKE>" + makeArr[k] + "</ID_MAKE></MAKE>";
            }
            else {
                makeIdXml = makeIdXml + "<MAKE><ID_MAKE></ID_MAKE></MAKE>";
            }
        }

        for (n = 0; n < suppArr.length; n++) {
            if (suppArr[n] != null)
            {
                suppIdXml = suppIdXml + "<SUPPLIER><ID_SUPPLIER>" + suppArr[n] + "</ID_SUPPLIER></SUPPLIER>";
            }
            else
            {
                suppIdXml = suppIdXml + "<SUPPLIER><ID_SUPPLIER></ID_SUPPLIER></SUPPLIER>";
            }
        }

        for (var i = 0; i < locArr.length; i++) {
            if (locArr[i] != null)
            {
                locXml = locXml + "<LOCATION><LOC>" + locArr[i] + "</LOC></LOCATION>";
            }
            else {
                locXml = locXml + "<LOCATION><LOC></LOC></LOCATION>";
            }
        }
        makeIdXmls = "<ROOT>" + makeIdXml + "</ROOT>";
        suppIdXmls = "<ROOT>" + suppIdXml + "</ROOT>";
        locXmls = "<ROOT>" + locXml + "</ROOT>";

        var grid = $("#dgdSpareGrid");
        pageSizeSet = document.getElementById('<%=hdnPageSize.ClientID%>').value;;
        var orderdata;
        var arrayId = new Array();
        grid.jqGrid({
            datatype: "local",
            data: orderdata,
            colNames: ['ID Item', 'Description', 'Stock Quantity', 'Make', 'Location', 'RAB', 'Replacement Spare', 'Item Price', 'Price Incl VAT', 'ID_WAREHOUSE', 'ORDER_QTY'],
            colModel: [
                     { name: 'Id_Item', index: 'Id_Item', width: 120, sorttype: "string" },
                     { name: 'Item_Sp_Desc', index: 'Item_Sp_Desc', width: 200, sorttype: "string" },
                     { name: 'Sp_StockQty', index: 'Sp_StockQty', width: 120, sorttype: "string" },
                     { name: 'Id_Make', index: 'Id_Make', width: 100, sorttype: "string" },
                     { name: 'Sp_Location', index: 'Sp_Location', width: 80, sorttype: "string" },
                     { name: 'Jobi_Dis_Per', index: 'Jobi_Dis_Per', width: 80, sorttype: "string" },
                     { name: 'Id_Sp_Replace', index: 'Id_Sp_Replace', width: 80, sorttype: "string" },
                     { name: 'Sp_Item_Price', index: 'Sp_Item_Price', width: 80, sorttype: "string" },
                     { name: 'PriceInclVat', index: 'PriceInclVat', width: 80, sorttype: "string" },
                     { name: 'Id_Wh_Item', index: 'Id_Wh_Item', width: 60, sorttype: "string", hidden: true },
                     { name: 'Jobi_Order_Qty', index: 'Jobi_Order_Qty', width: 60, sorttype: "string", hidden: true, },
            ],
            multiselect: false,
            pager: jQuery('#pagerSpareGrid'),
            rowNum: pageSizeSet,//can fetch from webconfig
            rowList: 5,
            viewrecords: true,
            height: "50%",
            async: false, //Very important,
            subGrid: false
           <%-- ,
            onCellSelect: function (rowId, iCol, content, event) {
                // debugger;
                var jobGrdId = $('#<%=hdnGridId.ClientID%>').val();
                var rowdata = jQuery("#jobgrid").jqGrid('getRowData', jobGrdId);
                var idWodetSeq = rowdata.IdWODetailseq;
                var idDebSeq = rowdata.Id_Deb_Seq;
                var jobNo = rowdata.JobId;
                var rowdataGrd;
                rowdataGrd = jQuery("#dgdSpareGrid").jqGrid('getRowData', rowId);
                loadSelectedSparesGrid(rowdataGrd);
            }--%>
            ,
            ondblClickRow: function (rowid) {
                var rowdataGrd;
                rowdataGrd = jQuery("#dgdSpareGrid").jqGrid('getRowData', rowid);

                var rowSelSPdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                for (var k = 0; k < rowSelSPdata.length; k++) {
                    if (rowSelSPdata[k].IdJob == rowdataGrd.Id_Item && rowSelSPdata[k].Id_Make == rowdataGrd.Id_Make && rowSelSPdata[k].Id_Warehouse == rowdataGrd.Id_Wh_Item) {
                        alert(rowdataGrd.Id_Item + " already exists in job grid.");
                    }
                }
                loadSelectedSparesGrid(rowdataGrd);
            }

        });

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: "frmWOJobDetails.aspx/GetSpareslist",
            data: "{'spName':'" + Spname + "',idCustomer:'" + CustId + "',vehId:'" + VehId + "',make:'" + makeIdXmls + "',supplier:'" + suppIdXmls + "',location:'" + locXmls + "',FlgstockItem:'" + $('#<%=chkSPStkQty.ClientID%>').is(':checked') + "',FlgStockItemStatus:'" + $('#<%=chkFlgStockItem.ClientID%>').is(':checked') + "',FlgNonStockItemStatus:'" + $('#<%=chkFlgNonStockItem.ClientID%>').is(':checked') + "'}",
                dataType: "json",
                async: false,//Very important
                success: function (data) {
                    jQuery("#dgdSpareGrid").jqGrid('clearGridData');
                    for (i = 0; i < data.d.length; i++) {
                        orderdata = data;
                        jQuery("#dgdSpareGrid").jqGrid('addRowData', i + 1, orderdata.d[i]);
                    }
                }
            });
            jQuery("#dgdSpareGrid").setGridParam({ rowNum: pageSizeSet }).trigger("reloadGrid");
            $("#dgdSpareGrid").jqGrid("hideCol", "subGrid");
        }


        function loadSelectedSparesGrid(rowdataGrd) {
            $('#divSelSPGrid').show();
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var grid = $("#dgdSelectedSPGrid");
            pageSizeSet = document.getElementById('<%=hdnPageSize.ClientID%>').value;;
            var orderdata;
            var ctr = 0;
            var id;
            var orderQty = 0;
            grid.jqGrid({
                datatype: "local",
                data: orderdata,
                colNames: ['ID Item', 'Description', 'Stock Quantity', 'Ordered Quantity QTY', 'Make', 'Location', 'RAB', 'ReplacementSpare', 'Item Price', 'Price Incl VAT', 'Id_WareHouse'],
                colModel: [
                         { name: 'Id_Item', index: 'Id_Item', width: 100, sorttype: "string" },
                         { name: 'Item_Sp_Desc', index: 'Item_Sp_Desc', width: 180, sorttype: "string" },
                         { name: 'Sp_StockQty', index: 'Sp_StockQty', width: 80, sorttype: "string" },
                         { name: 'Jobi_Order_Qty', index: 'Jobi_Order_Qty', width: 80, sorttype: "string" },
                         { name: 'Id_Make', index: 'Id_Make', width: 100, sorttype: "string" },
                         { name: 'Sp_Location', index: 'Sp_Location', width: 80, sorttype: "string" },
                         { name: 'Jobi_Dis_Per', index: 'Jobi_Dis_Per', width: 80, sorttype: "string" },
                         { name: 'Id_Sp_Replace', index: 'Id_Sp_Replace', width: 80, sorttype: "string" },
                         { name: 'Sp_Item_Price', index: 'Sp_Item_Price', width: 80, sorttype: "string" },
                         { name: 'PriceInclVat', index: 'PriceInclVat', width: 80, sorttype: "string" },
                         { name: 'Id_Wh_Item', index: 'Id_Wh_Item', width: 60, sorttype: "string", hidden: true }
                ],
                multiselect: false,
                pager: jQuery('#pagerSelectedSPGrid'),
                rowNum: pageSizeSet,//can fetch from webconfig
                rowList: 5,
                viewrecords: true,
                height: "50%",
                async: false, //Very important,
                subGrid: false
                //,
                //onCellSelect: function (rowId, iCol, content, event) {
                //    grid.delRowData(rowId);
                //}
            });

            var rowSelSPdata = $('#dgdSelectedSPGrid').jqGrid('getGridParam', 'data');
            rowSelSPdata[rowSelSPdata.length] = rowdataGrd;
            for (var k = 0; k < rowSelSPdata.length; k++) {
                if (rowSelSPdata[k].Id_Item == rowdataGrd.Id_Item && rowSelSPdata[k].Id_Make == rowdataGrd.Id_Make && rowSelSPdata[k].Id_Wh_Item == rowdataGrd.Id_Wh_Item) {
                    ctr = ctr + 1;
                    if (rowSelSPdata[k].id != undefined) {
                        id = rowSelSPdata[k].id;
                    }
                }
                if (ctr > 1) {
                    var ordQty = fnformatDecimalValue(orderQty, seperator).toFixed(2);
                    var defQty = 1;
                    ordQty = (fnformatDecimalValue(ordQty, seperator) + fnformatDecimalValue(defQty, seperator)).toFixed(2);
                    rowSelSPdata[k].Jobi_Order_Qty = fnreformatDecimal(ordQty, seperator);
                    $('#dgdSelectedSPGrid').delRowData(id);
                }
                else {
                    orderQty = rowSelSPdata[k].Jobi_Order_Qty;
                }
            }

            jQuery("#dgdSelectedSPGrid").jqGrid('clearGridData');
            for (var i = 0; i < rowSelSPdata.length; i++) {
                jQuery("#dgdSelectedSPGrid").jqGrid('addRowData', i + 1, rowSelSPdata[i]);
            }
        }

        function arrayInsertAt(destArray, pos, arrayToInsert) {
            var args = [];
            args.push(pos);                           // where to insert
            args.push(0);                             // nothing to remove
            args = args.concat(arrayToInsert);        // add on array to insert
            destArray.splice.apply(destArray, args);  // splice it in
        }

        function loadjobGrid(rowId, jobNo, arrData) {
            //debugger;
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
            for (var j = 0; j < arrData.length; j++) {
                arrayInsertAt(rowdisdata, parseInt(rowId) - 1, arrData[j]);
            }
            jQuery("#jobgrid").jqGrid('clearGridData');
            for (var i = 0; i <= rowdisdata.length; i++) {
                jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowdisdata[i]);
            }

            jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
            //$("#jobGrid").jqGrid("hideCol", "subGrid");
            var rowGrddata = $('#jobgrid').jqGrid('getGridParam', 'data');
            jQuery("#jobgrid").jqGrid('clearGridData');
            for (var i = 0; i < rowGrddata.length; i++) {
                rowGrddata[i].LineNo = rowGrddata[i].id;
                jQuery("#jobgrid").jqGrid('addRowData', i + 1, rowGrddata[i]);
            }

            for (var k = 0; k < rowGrddata.length; k++) {
                if (rowGrddata[k].id != rowId) {
                    if (rowGrddata[k].Jobi_Bo_Qty != undefined) {
                        var boQty = fnformatDecimalValue(rowGrddata[k].Jobi_Bo_Qty, seperator);
                        if (boQty != "0" && rowGrddata[k].Diff == "S") {
                            jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Bestilt", "", {
                                'color': 'rgba(255, 0, 0, 0.8)',
                                'background-image': 'none'
                            });
                        }
                    }
                }

                if (rowGrddata[k].Flag == "1" && (rowGrddata[k].DebtType == "OHC" || rowGrddata[k].DebtType == null || rowGrddata[k].DebtType == undefined)) {
                    //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                    $('#' + rowGrddata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "IdJob", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Text", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Nei", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Ford", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Bestilt", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Levert", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Pris", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Rab", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Belop", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                }                
                else if (rowGrddata[k].Flag == "1" && rowGrddata[k].DebtType == "INSC") {
                    //$('#' + rowdisdata[k].id + ' > td:not(.jqgrid-rownum)').attr('disabled', 'disabled');//disable the jobno row
                    $('#' + rowGrddata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "IdJob", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Text", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Nei", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Ford", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Bestilt", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Levert", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Pris", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Rab", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Belop", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'font-weight': 'normal',
                        'background-image': 'none'
                    });

                } else if (rowGrddata[k].Flag == "0" && rowGrddata[k].DebtType == "INSC") {
                    $('#' + rowGrddata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Belop", "", {
                        'background-color': 'rgba(33, 186, 69, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none',
                        'text-align': 'right'
                    });

                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Pris", "", {
                        'text-align': 'right'
                    });
                }
                else {
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Pris", "", {
                        'text-align': 'right'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "IdJob", "", {
                        'text-align': 'left'
                    });
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Text", "", {
                        'text-align': 'left'
                    });

                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Belop", "", 'ui-state-disabled');
                    jQuery("#jobgrid").jqGrid('setCell', rowGrddata[k].id, "Belop", "", {
                        'background-color': 'rgba(255, 255, 153, 1)',
                        'color': 'rgba(0, 0, 0, 1)',
                        'background-image': 'none',
                        'text-align': 'right'
                    });
                }
                if ((rowGrddata[k].DebtType == "OHC" && rowGrddata[k].Diff == "OR" && rowGrddata[k].Ford != "") || (rowGrddata[k].DebtType == "INSC") || (rowGrddata[k].DebtType == "INTC") || (rowGrddata[k].DebtType == "CLA") || (rowGrddata[k].DebtType == "MISC")) {
                    $('#' + rowGrddata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                 }
                if ((rowGrddata[k].DebtType == "OHC" && rowGrddata[k].Diff == "RAOR" && rowGrddata[k].Ford != "") || (rowGrddata[k].DebtType == "INSC" && rowGrddata[k].Diff == "RAOR") || (rowGrddata[k].DebtType == "INTC" && rowGrddata[k].Diff == "RAOR") || (rowGrddata[k].DebtType == "CLA" && rowGrddata[k].Diff == "RAOR") || (rowGrddata[k].DebtType == "MISC" && rowGrddata[k].Diff == "RAOR")) {
                     $('#' + rowGrddata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                 }
                if ((rowGrddata[k].DebtType == "OHC" && rowGrddata[k].Diff == "RBOR" && rowGrddata[k].Ford != "") || (rowGrddata[k].DebtType == "INSC" && rowGrddata[k].Diff == "RBOR") || (rowGrddata[k].DebtType == "INTC" && rowGrddata[k].Diff == "RBOR") || (rowGrddata[k].DebtType == "CLA" && rowGrddata[k].Diff == "RBOR") || (rowGrddata[k].DebtType == "MISC" && rowGrddata[k].Diff == "RBOR")) {
                     $('#' + rowGrddata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                 }
                if (rowGrddata[k].Diff == "S") {
                    var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                    cm.editable = true;
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Ford", "", 'not-editable-cell');
                    //jQuery("#jobgrid").jqGrid("nextCell", parseInt(id), 4, true);
                    //document.getElementById((parseInt(id)) + '_Bestilt').select();
                }
                else if (rowGrddata[k].Diff == "T") {
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "IdJob", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Bestilt", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Levert", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Pris", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Rab", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Ford", "", 'not-editable-cell');
                }
                else if (rowGrddata[k].Diff == "L") {
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Bestilt", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "IdJob", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(rowGrddata[k].id, "Ford", "", 'not-editable-cell');
                }
            }
            recalculateTotals();

            if ($('#<%=chkSaveSprSettings.ClientID%>').is(':checked')) {
                SaveSPRSettings();
            }
            saveJobDet(1);
        }

        function SaveSPRSettings() {
            var mkArr = new Array();
            var supArr = new Array();
            var locArr = new Array();
            var makelist = $('#<%=selMake.ClientID%>').dropdown('get value');
            if (makelist.length > 1) {
                for (var i = 0; i < makelist.length -1; i++) {
                    mkArr[i] = makelist[i];
                }
            }

            var suppList = $('#<%=selSupp.ClientID%>').dropdown('get value');
            if (suppList.length > 1) {
                for (var k = 0; k < suppList.length-1; k++) {
                    supArr[k] = suppList[k];
                }
            }

            var locList = $('#<%=selLoc.ClientID%>').dropdown('get value');
            if (locList.length > 1) {
                for (var k = 0; k < locList.length - 1; k++) {
                    locArr[k] = locList[k];
                }
            }

            var makeIdXml = "";
            var makeIdXmls;

            var suppIdXml = "";
            var suppIdXmls;

            var locXml = "";
            var locXmls;


            for (var k = 0; k < mkArr.length; k++) {
                makeIdXml = makeIdXml + "<MAKE><ID_MAKE>" + mkArr[k] + "</ID_MAKE></MAKE>";
            }

            for (n = 0; n < supArr.length; n++) {
                    suppIdXml = suppIdXml + "<SUPPLIER><ID_SUPPLIER>" + supArr[n] + "</ID_SUPPLIER></SUPPLIER>";
            }

            for (var i = 0; i < locArr.length; i++) {
                locXml = locXml + "<LOCATION><LOC>" + locArr[i] + "</LOC></LOCATION>";
            }

            makeIdXmls = "<ROOT>" + makeIdXml + "</ROOT>";
            suppIdXmls = "<ROOT>" + suppIdXml + "</ROOT>";
            locXmls = "<ROOT>" + locXml + "</ROOT>";

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/SaveSparesSett",
                data: "{'makeIdXml':'" + makeIdXmls + "',suppIdXmls:'" + suppIdXmls + "',locXmls:'" + locXmls + "',FlgstockItem:'" + $('#<%=chkSPStkQty.ClientID%>').is(':checked') + "',FlgStockItemStatus:'" + $('#<%=chkFlgStockItem.ClientID%>').is(':checked') + "',FlgNonStockItemStatus:'" + $('#<%=chkFlgNonStockItem.ClientID%>').is(':checked') + "'}",
                dataType: "json",
                async: false,//Very important
                success: function (data) {
                    // debugger;
                    //alert("Saved successfully");
                }
            });
        }

        function RINVRecs() {
            var row;
            var idWoNo;
            var idWoPr;
            var idJob;
            var jobStatus;
            var debitorIdxml;
            var debitorIdxmls = "";

            <%-- $('#jobgrid input:checkbox').attr("checked", function () {
                if (this.checked) {
                    row = $(this).closest('td').parent()[0].sectionRowIndex;
                    idJob = $('#jobgrid tr ')[row].cells[10].innerText.toString();
                    jobStatus = $('#jobgrid tr ')[row].cells[24].innerText.toString();
                    idWoNo = '<%= Session("WONO")%>';
                    idWoPr = '<%= Session("WOPR")%>';
                    debitorIdxml = '<JOBNO WOORDNO ="' + idWoNo.toString() + '" WOJOBNO = "' + idJob.toString() + '" WOPREFIX ="' + idWoPr.toString() + '" > </JOBNO>';
                    debitorIdxmls += debitorIdxml;

                }
            });--%>

            var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
            for (var k = 0; k < rowspareData.length; k++) {
                if (rowspareData[k].DebtType == "OHC") {
                    if (rowspareData[k].Flag == "1")
                    {
                        idJob = rowspareData[k].JobId;
                        jobStatus = rowspareData[k].Job_Status;
                         idWONO = $('#<%=hdnWoNo.ClientID%>')[0].value;
                        idWOPrefix = $('#<%=hdnWoPr.ClientID%>')[0].value;
                        debitorIdxml = '<JOBNO WOORDNO ="' + idWONO + '" WOJOBNO = "' + idJob + '" WOPREFIX ="' + idWOPrefix + '" > </JOBNO>';
                        debitorIdxmls += debitorIdxml;
                    }
                }
            }

            if (debitorIdxmls != "") {
                debitorIdxmls = "<ROOT>" + debitorIdxmls + "</ROOT>";
                var userId = '<%= Session("UserID")%>';
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOPaydetails.aspx/SetReadyToInv",
                    data: "{'debitorIdxmls':'" + debitorIdxmls + "',userId:'" + userId + "'}",
                    dataType: "json",
                    success: function (data) {
                        //reloadGrid(idWoNo, idWoPr);
                        loadWOJobGrid(idWONO, idWOPrefix);
                        var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
                        for (var k = 0; k < rowspareData.length; k++) {
                            var status = rowspareData[k].Job_Status;
                        }
                        if (status == "RINV") {
                            $('#<%=RTlblError.ClientID%>').text('Job(s) set to ‘Ready to Invoice’.');
                        }
                        else if (status == "JCD") {
                            $('#<%=RTlblError.ClientID%>').text('Job(s) set to Completed');
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }
        }

        function jobCard() {

            var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
            if (rowspareData.length != "0") {
                var reportType = "JOBCARD";

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/LoadReport",
                    data: "{'reportType':'" + reportType + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {

                        if (Result.d.length > 0) {
                            var strValue = Result.d;
                            if (strValue != "") {
                                var Url = strValue;//"../Reports/frmShowReports.aspx?ReportHeader=YF8c/MYCthcdMZ0D0ra6EQ==&InvoiceType=YF8c/MYCthcdMZ0D0ra6EQ==&Rpt=GPwu6EpyNgg8JACPpv3cVA==&scrid=" + WoPr + WoNo + "&JobCardSett=1"
                                window.open(Url, 'Reports', "menubar=no,location=no,status=no,scrollbars=yes,resizable=yes");
                            }
                        }
                    }
                });
            }
        }

        function updateVehicle(vehicleId, customerId) {
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/UpdVehicle",
                data: "{'vehicleId':'" + vehicleId + "',customerId:'" + customerId + "'}",
                dataType: "json",
                success: function (data) {
                    if (data.d.length > 0) {
                        if (data.d == "UPD") {
                            $('#<%=RTlblError.ClientID%>').text('Owner is updated successfully.');
                            $('#<%=RTlblError.ClientID%>').removeClass();
                            $('#<%=RTlblError.ClientID%>').addClass("lblMessage");
                        }
                    }
                },
                error: function (result) {
                    alert("Error");
                }
            });
        }


        function GenerateXML() {
            var idWoNo = $('#<%=hdnWoNo.ClientID%>')[0].value;
            var idWoPr = $('#<%=hdnWoPr.ClientID%>')[0].value;
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "frmWOJobDetails.aspx/EHF",
                data: "{'idWoNo':'" + idWoNo + "',idWoPr:'" + idWoPr + "'}",
                dataType: "json",
                success: function (data) {
                    if (data.d == "True") {
                        $('#<%=RTlblError.ClientID%>').text('EHF File Created Successfully.'); 
                    }
                },
                error: function (result) {
                    alert("Error");
                }
            });
        }
        function OnEndCallbackcbOpenReport(s, e) {
            popupReport.ShowWindow(popupReport.GetWindow(0));
        }
        function cbStockQuantityEndCallback(s, e) {
            console.log("cpErrorMessage " + gvStockQty.cpErrorMessage);
            if (gvStockQty.cpErrorMessage == "ConfigError") {
                popupStockQuantity.Hide();
                swal("Feil ! Ugyldig leverandør Spare Id or Dealer No. Spare");

            }
            else {
                gvStockQty.SetClientVisible(true);
                $('#<%=btnSendPurchase.ClientID%>').show();
                txtAPIAnnotation.SetClientVisible(true);
            }
        }
        function popupStockQuantityClosing(s, e) {
          gvStockQty.SetClientVisible(false);
          $('#<%=btnSendPurchase.ClientID%>').hide();  
            txtAPIAnnotation.SetClientVisible(false);
        }
        function cbSendPurchaseEndCallback(s, e) {
            if (cbSendPurchase.cpPONumber != null && cbSendPurchase.cpPONumber != ""){
                swal("Purchase Order Created with PO Number " + cbSendPurchase.cpPONumber);
                popupStockQuantity.Hide();
            }
        }
        function gvStockQtyBatchEditRowValidating(s, e) {
            var grid = ASPxClientGridView.Cast(s);
            var bestiltCellInfo = e.validationInfo[grid.GetColumnByField("bestilt").index];
            if (bestiltCellInfo.value != null) {
                if (bestiltCellInfo.value < 0) {
                    bestiltCellInfo.isValid = false;
                    bestiltCellInfo.errorText = "Cannot have negative value";
                }
            }
        }
        function SearchRepairPackage() {
            var searchText = $('#txtRPCodeSearch').val();
            cbRepPack.PerformCallback(searchText);
            //lbRepPakHead.PerformCallback(searchText);
        }
        function OncbRepPackEndCallback(s, e) {
            console.log(lbRepPakHead.GetItemCount());
            if (lbRepPakHead.GetItemCount() > 0) {
                $('#<%=lblSearchResult.ClientID%>').text("");
                $('#divRepPack').show();
            }
            else {
                $('#<%=lblSearchResult.ClientID%>').text("No result found");
                $('#divRepPack').hide();
            }
        }
        function OnlbRepPakHeadItemDoubleClick(s, e) {
            var id = jQuery("#jobgrid").jqGrid('getGridParam', 'selrow');
            var selectedItem = lbRepPakHead.GetSelectedItems();
            //alert(selectedItem[0].texts[2] + " " + selectedItem[0].texts[0]);
            var repPackSeq = selectedItem[0].texts[0];
            var repPackageId = selectedItem[0].texts[2];
            FetchRepairPackageDetails(repPackSeq, repPackageId, id);
            $('#modRepairPackage').modal('hide');
        }
        function FetchRepairPackageDetails(repPkgSeq, packageNo, rowId) {
            var isRepPackageAdded = false;
            $.ajax({
                type: "POST",
                url: "frmRepairPackage.aspx/FetchRPDetailsWO",
                data: "{'JOB_ID':'" + packageNo + "',ID_RPKG_SEQ:'" + repPkgSeq + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (Result) {
                    var arrRPSpare = [];
                    var arrRPLabour = [];
                    Result = Result.d;
                    console.log(Result);
                    if (Result != "") {
                        for (var i = 0; i < Result.length; i++) {
                            if (Result[i].LINE_TYPE == "D") { // For Spare Lines

                                var spLine = {};
                                spLine.Id_Item = Result[i].ID_ITEM;
                                spLine.Item_Sp_Desc = Result[i].ITEM_DESC;
                                spLine.Item_Avail_Qty = Result[i].ITEM_AVAIL_QTY_WO;
                                spLine.Sp_Item_Price = Result[i].ITEM_PRICE;
                                spLine.Id_Wh_Item = Result[i].ID_WH_ITEM;
                                spLine.SuppCurrNo = Result[i].SUPP_CURRENTNO;

                                if (Result[i].COST_PRICE1 != null) {
                                    spLine.Cost_Price = Result[i].COST_PRICE1;
                                }
                                else {
                                    spLine.Cost_Price = 0;
                                }

                                if (Result[i].ITEM_AVAIL_QTY != null) {
                                    spLine.Jobi_Order_Qty = Result[i].ITEM_AVAIL_QTY;
                                }
                                else {
                                    spLine.Jobi_Order_Qty = 1; //Making Bestilt = 1 for now
                                }

                                arrRPSpare.push(spLine);
                            }
                            else if (Result[i].LINE_TYPE == "A" || Result[i].LINE_TYPE == "T") { // For Labour Lines

                                var labLine = {};
                                labLine.labourTimeWithPerAdded = Result[i].ITEM_AVAIL_QTY;
                                labLine.aw_betegnelse = Result[i].ITEM_DESC;
                                if (Result[i].LINE_TYPE == "A") {
                                    labLine.time = Result[i].ITEM_AVAIL_QTY;
                                    labLine.labourTime = Result[i].ITEM_AVAIL_QTY;
                                }
                                else {
                                    labLine.time = "0";
                                    labLine.labourTime = 0;
                                }

                                labLine.Sp_Item_Price = Result[i].ITEM_PRICE;

                                if (Result[i].COST_PRICE1 != null) {
                                    labLine.Cost_Price = Result[i].COST_PRICE1;
                                }
                                else {
                                    labLine.Cost_Price = 0;
                                }

                                if (Result[i].ITEM_AVAIL_QTY != null) {
                                    labLine.Jobi_Order_Qty = Result[i].ITEM_AVAIL_QTY;
                                }
                                else {
                                    labLine.Jobi_Order_Qty = 1; //Making Bestilt = 1 for now
                                }

                                arrRPLabour.push(labLine);
                            }
                        }
                    }
                    else {
                        swal("No Result");
                    }

                    console.log(arrRPLabour);
                    if (arrRPSpare.length > 0) {
                        isRepPackageAdded = true;
                        rowId = AddRepPakSparesLines(arrRPSpare, rowId);
                    }
                    if (arrRPLabour.length > 0) {
                        isRepPackageAdded = true;
                        AddRepPakLabourLines(arrRPLabour, rowId);
                    }

                    if (isRepPackageAdded) {
                        swal("Lagt til reparasjonspakke med pakkenummer " + packageNo);
                    }

                },
                failure: function () {
                    alert("Failed!");
                }
            });
        }
        function AddRepPakSparesLines(spareList, rowId) {
            //debugger;
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var n_idwodetseq = "";
            var n_iddebseq = "";
            var n_idwoitemseq = "";
            var idwhitem = "";
            var n_makeid = "";

            var n_Ford = "100";
            var n_Bestilt = "";
            var n_Levert = "";
            var n_Pris = "";
            var n_IdItem = "";
            var n_IdItemDesc = "";
            var n_Sp_Cost_Price = "";
            var n_SpareDiscount = "0";
            var n_Belop, n_Disc_Amt;
            var n_Rab = $('#<%=hdnOHCSpareDisc.ClientID%>').val();
                var n_ItemAvailQty = "";
                for (var a = 0; a < spareList.length; a++) {
                    console.log("a " + a);
                    var n_rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    console.log(n_rowdisdata.length);
                    var id = rowId;//n_rowdisdata.length;
                    //console.log("rowId => " + rowId);
                    rowId = parseInt(rowId) + 1;

                    var n_rowdata = jQuery("#jobgrid").jqGrid('getRowData', id);
                    var n_debtType = n_rowdata.DebtType;
                    var n_jobId = n_rowdata.JobId;
                    var n_idMechanic = n_rowdata.IdMech;
                    n_idwodetseq = n_rowdata.IdWODetailseq;
                    n_idwoitemseq = n_rowdata.IdWOItemseq;
                    n_iddebseq = n_rowdata.Id_Deb_Seq;

                    idwhitem = spareList[a].Id_Wh_Item;
                    n_makeid = spareList[a].SuppCurrNo;
                    n_Bestilt = spareList[a].Jobi_Order_Qty;
                    n_Levert = 0;
                    n_Pris = spareList[a].Sp_Item_Price;
                    n_IdItem = spareList[a].Id_Item;
                    n_IdItemDesc = spareList[a].Item_Sp_Desc;
                    n_Sp_Cost_Price = spareList[a].Cost_Price;
                    n_ItemAvailQty = spareList[a].Item_Avail_Qty;


                    var backOrdQty = 0;
                    var spavailqty = 0;
                    var orderQty = 0;
                    var delvQty = 0;
                    var qtyDeliver = 0;
                    var Availa_Qty = 0.0;
                    var qtyDeliv = 0.0;
                    var ordType = $('#<%=ddlType.ClientID%>').val();
                    spavailqty = fnformatDecimalValue(n_ItemAvailQty, seperator);
                    orderQty = fnformatDecimalValue(n_Bestilt, seperator);
                    qtyDeliver = fnformatDecimalValue(n_Levert, seperator) + fnformatDecimalValue(qtyDeliver, seperator);

                    if (spavailqty == 0) {
                        delvQty = 0;
                        backOrdQty = orderQty;
                    }
                    else if (spavailqty >= orderQty) {
                        delvQty = orderQty;
                        backOrdQty = orderQty - delvQty;
                    }
                    else if (spavailqty < orderQty) {
                        Availa_Qty = spavailqty + qtyDeliver;
                        if ((fnformatDecimalValue(orderQty, seperator) - fnformatDecimalValue(Availa_Qty, seperator)) > 0) {
                            backOrdQty = orderQty - Availa_Qty;

                            if (ordType.toString().trim() == "KRE") {
                                backOrdQty = 0;
                            }

                            if (backOrdQty > 0) {
                                backOrdQty = backOrdQty;
                                qtyDeliv = Availa_Qty; //orderQty - Availa_Qty;
                                delvQty = qtyDeliv;
                            }
                            else {
                                backOrdQty = 0;
                                qtyDeliv = orderQty;
                                delvQty = qtyDeliv;
                            }
                        }

                        else {
                            backOrdQty = 0;
                            qtyDeliv = orderQty;
                            delvQty = qtyDeliv;
                        }

                    }

                    n_Bestilt = orderQty;
                    n_Levert = delvQty;
                    n_ItemAvailQty = spavailqty;

                    var amt = (fnformatDecimalValue(n_Levert, seperator) * fnformatDecimalValue(n_Pris, seperator) * (fnformatDecimalValue(n_Ford, seperator) * 0.01)).toFixed(2);
                    var disc = 0.0;

                    if (n_Rab != undefined && n_Rab != "0") {
                        disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(n_Rab, seperator) / 100)).toFixed(2)
                        amt = (amt - disc).toFixed(2);
                    }

                    n_Disc_Amt = fnreformatDecimal(disc, seperator);
                    n_Belop = fnreformatDecimal(amt, seperator);

                    //adding new Spare Line
                    $("#<%=hdnIdItem.ClientID%>").val(n_IdItem);
                    $("#<%=hdnIdMake.ClientID%>").val(n_makeid);
                    jQuery("#jobgrid").setCell(id, "Nei", "", 'not-editable-cell');
                    jQuery("#jobgrid").setCell(id, "Ford", "", 'not-editable-cell');
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Nei', "0");
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Ford', n_Ford);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Bestilt', n_Bestilt);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Levert', n_Levert);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Pris', n_Pris);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Text', n_IdItemDesc);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Diff', "S");
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Item_Avail_Qty', n_ItemAvailQty);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'IdJob', n_IdItem);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Make', n_makeid);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'ItemDesc', n_IdItemDesc);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Warehouse', idwhitem);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Sp_Cost_Price', n_Sp_Cost_Price);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'SpareDiscount', n_SpareDiscount);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'IdWODetailseq', n_idwodetseq);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'IdWOItemseq', n_idwoitemseq);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Id_Deb_Seq', n_iddebseq);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'DebtType', n_debtType);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Flag', "0");
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Belop', n_Belop);
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Rab', $('#<%=hdnOHCSpareDisc.ClientID%>').val().toString());
                    jQuery("#jobgrid").jqGrid('setCell', id, 'Disc_Amt', n_Disc_Amt);
                    jQuery('#jobgrid').jqGrid("setCell", id, 'Jobi_Bo_Qty', backOrdQty);


                    //adding new line
                    var spares = {
                        id: parseInt(id) + 1,
                        IdJob: "",
                        Text: "",
                        Nei: "0",
                        Ford: "100",
                        Bestilt: "",
                        Levert: "",
                        Pris: "",
                        Rab: "",
                        Belop: "",
                        JobId: n_jobId,
                        Flag: "0",
                        Diff: "",
                        Item_Avail_Qty: "",
                        Disc_Amt: "0",
                        ForeignJob: "",
                        ItemDesc: "",
                        IdWOLabSeq: "",
                        IdWODetailseq: n_idwodetseq,
                        Id_Deb_Seq: n_iddebseq,
                        Id_Make: n_makeid,
                        IdMech: n_idMechanic,
                        IdWOItemseq: n_idwoitemseq,
                        DebtType: n_debtType,
                        SpareDiscount: 0
                    }

                    var n_rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');

                    var actualsparelength = n_rowspareData.length;
                    if (id == n_rowspareData.length) {
                        n_rowspareData[parseInt(id)] = spares;
                        actualsparelength = n_rowspareData.length;
                    }

                    jQuery("#jobgrid").jqGrid('clearGridData');
                    for (var j = 0; j < actualsparelength; j++) {
                        sparedata = n_rowspareData;
                        jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                    }
                    jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                    $("#jobgrid").jqGrid("hideCol", "subGrid");

                    // need to recalculate
                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    var hpVatPer = 0.0;
                    var gmVatPer = 0.0;
                    var spVatPer = 0.0;
                    var hpVat = 0.0;
                    var gmVat = 0.0;
                    var amtS = 0.0;
                    var vatAmount = 0.0;
                    var amtL = 0.0;
                    var discAmount = 0.0;
                    var TotalGM = 0.0;
                    var amtG = 0.0;
                    //var jobDisc = 0.0;
                    var labDisc = 0.0;
                    var gmDisc = 0.0;
                    var spareDisc = 0.0;

                    var labVatDisc = 0.0;
                    var gmVatDisc = 0.0;
                    var spareVatDisc = 0.0;
                    var totLabVatDisc = 0.0;
                    var totGmVatDisc = 0.0;
                    var totSpareVatDisc = 0.0;
                    var spVat = 0.0;
                    var idCust = $('#<%=lblCustName.ClientID%>').text();

                    for (var k = 0; k < rowdisdata.length; k++) {

                        var vats = LoadGMHPVat(rowdisdata[k].IdJob, rowdisdata[k].Id_Make, idCust);
                        if (vats.length > 0) {
                            gmVat = fnformatDecimalValue(vats[0], seperator);
                            hpVat = fnformatDecimalValue(vats[1], seperator);
                            spVat = fnformatDecimalValue(vats[2], seperator);
                        }

                        gmVatPer = gmVat;
                        hpVatPer = hpVat;
                        spVatPer = spVat;

                        if (rowdisdata[k].Diff == "S") {
                            if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                var boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                if (boQty != "0") {
                                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                        'color': 'rgba(255, 0, 0, 0.8)',
                                        'background-image': 'none'
                                    });
                                }
                            }
                        }

                        if (rowdisdata[k].Flag == "1" && (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined || rowdisdata[k].DebtType == "")) {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INSC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INSC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INTC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INTC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "CLA") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "CLA") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "MISC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "MISC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else {
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'text-align': 'left'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'text-align': 'left'
                            });
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Belop", "", 'ui-state-disabled');

                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                        }

                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC") || (rowdisdata[k].DebtType == "INTC") || (rowdisdata[k].DebtType == "CLA") || (rowdisdata[k].DebtType == "MISC")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }
                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RAOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RAOR")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }
                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RBOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RBOR")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }

                        if (rowdisdata[k].Diff == "T") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Pris", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Rab", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }
                        if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {
                            if ((rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) && (rowdisdata[k].Diff == "S")) {
                                jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                            }
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }

                        if (rowdisdata[k].Diff == "L") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');

                            // var amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                            var amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = $('#<%=txtGM.ClientID%>').val();

                            if (rowdisdata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                                //$('#<%=txtTGM.ClientID%>').val(TotalGM);
                            }

                            //Lab and GM Discount
                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                                totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                                totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                            }

                            hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                            gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                            hpVat = fnreformatDecimal(hpVat, seperator);
                            gmVat = fnreformatDecimal(gmVat, seperator);
                            amtL = fnreformatDecimal(amtL, seperator);
                            TotalGM = fnreformatDecimal(TotalGM, seperator);

                            $('#<%=txtTGM.ClientID%>').val(TotalGM);
                            $('#<%=txtHPVat.ClientID%>').val(hpVat);
                            $('#<%=txtGMVat.ClientID%>').val(gmVat);
                            $('#<%=txtTLab.ClientID%>').val(amtL);

                            var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);

                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                            rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                        }

                        if (rowdisdata[k].Diff == "S") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                            cm.editable = true;
                            var amount;
                            if (rowdisdata[k].Belop != undefined) {
                                amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            } else {
                                amount = fnformatDecimalValue("", seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            }
                            amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                            vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);
                            amtS = fnreformatDecimal(amtS, seperator);
                            vatAmount = fnreformatDecimal(vatAmount, seperator);
                            $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                            $('#<%=txtTSP.ClientID%>').val(amtS);

                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                var amt;
                                var boQty;
                                if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                    boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                } else {
                                    boQty = 0;
                                }

                                if (boQty != "0") {
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                                } else {
                                    amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                                }
                            }
                            spareVatDisc = (amount * (spVatPer / 100)).toFixed(2);
                            totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                            var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            rowdisdata[k].Disc_Amt = fnreformatDecimal(spchck, seperator);

                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                            rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);

                        }

                        if (rowdisdata[k].Disc_Amt != undefined) {
                            discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                        }

                        discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);

                    }

                    if ($('#<%=txtTLab.ClientID%>').val() == "") {
                        $('#<%=txtTLab.ClientID%>').val('0');
                        $('#<%=txtTGM.ClientID%>').val('0');
                        $('#<%=txtHPVat.ClientID%>').val('0');
                        $('#<%=txtGMVat.ClientID%>').val('0');
                    }

                    if ($('#<%=txtSPVat.ClientID%>').val() == "") {
                        $('#<%=txtSPVat.ClientID%>').val('0');
                        $('#<%=txtTSP.ClientID%>').val('0');
                    }

                    var total = (fnformatDecimalValue($('#<%=txtTGM.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTLab.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val(), seperator)).toFixed(2);
                    var vatTotal = (fnformatDecimalValue($('#<%=txtHPVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtGMVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val(), seperator)).toFixed(2);
                    var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                    total = fnreformatDecimal(total, seperator);
                    vatTotal = fnreformatDecimal(vatTotal, seperator);
                    TIncVat = fnreformatDecimal(TIncVat, seperator);
                    discAmount = fnreformatDecimal(discAmount, seperator);
                    $('#<%=txtNet.ClientID%>').val(total);
                    $('#<%=txtVat.ClientID%>').val(vatTotal);
                    $('#<%=txtTotal.ClientID%>').val(TIncVat);
                    $('#<%=txtDisc.ClientID%>').val(discAmount);

                // save the line
                saveJobDet(1);

            }
            return rowId;
        } //end of AddRepPakSparesLines


        function AddRepPakLabourLines(labourList, rowId) {
            var seperator = '<%= Session("Decimal_Seperator") %>';
            var nbkl_idwodetseq = "";
            var nbkl_iddebseq = "";
            var nbkl_idwoitemseq = "";
            var nbkl_Ford = "100";
            var nbkl_Levert = "";
            var nbkl_Pris = "";
            var nbkl_Belop, nbkl_Disc_Amt;
            var nbkl_Rab;
            var nbkl_makeid = "";

            for (var c = 0; c < labourList.length; c++) {

                var lab_rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                var id_last = rowId;//lab_rowdisdata.length;
                var nbkl_rowdata = jQuery("#jobgrid").jqGrid('getRowData', id_last);
                var nbkl_debtType = nbkl_rowdata.DebtType;
                var nbkl_jobId = nbkl_rowdata.JobId;
                var nbkl_idMechanic = nbkl_rowdata.IdMech;
                var nHPPrice = $('#<%=hdnHP.ClientID%>').val();
                    var labText = "";
                    var labDiff = "";
                    var nbklrowId = id_last;
                    rowId = parseInt(rowId) + 1;

                    nbkl_idwodetseq = nbkl_rowdata.IdWODetailseq;
                    nbkl_idwoitemseq = nbkl_rowdata.IdWOItemseq;
                    nbkl_iddebseq = nbkl_rowdata.Id_Deb_Seq;

                    console.log(labourList[c].time + " ==> " + labourList[c].labourTime);
                    if (labourList[c].time == "0" && labourList[c].labourTime == 0) {
                        labDiff = "T";
                        textLinesCount = textLinesCount + 1;
                    } else {
                        labDiff = "L";
                        labourLinesCount = labourLinesCount + 1;
                    }


                    nbkl_Levert = labourList[c].labourTimeWithPerAdded;
                    labText = labourList[c].aw_betegnelse;
                    //nbkl_Pris = fnformatDecimalValue(nHPPrice, seperator)
                    nbkl_Pris = labourList[c].Sp_Item_Price;


                    if (fnformatDecimalValue($('#<%=hdnOHCLabDisc.ClientID%>').val(), seperator) > 0) {
                        nbkl_Rab = $('#<%=hdnOHCLabDisc.ClientID%>').val();
                    }
                    else if (fnformatDecimalValue($('#<%=hdnOHCGenDisc.ClientID%>').val(), seperator) > 0) {
                        nbkl_Rab = $('#<%=hdnOHCGenDisc.ClientID%>').val();
                    }
                    else {
                        nbkl_Rab = "0";
                    }

                    var amt = (fnformatDecimalValue(nbkl_Levert, seperator) * fnformatDecimalValue(nbkl_Pris, seperator) * (fnformatDecimalValue(nbkl_Ford, seperator) * 0.01)).toFixed(2);
                    var disc = 0.0;

                    if (nbkl_Rab != undefined && nbkl_Rab != "0") {
                        disc = (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(nbkl_Rab, seperator) / 100)).toFixed(2)
                        amt = (amt - disc).toFixed(2);
                    }

                    nbkl_Disc_Amt = fnreformatDecimal(disc, seperator);
                    nbkl_Belop = fnreformatDecimal(amt, seperator);


                    if (nbkl_rowdata.Diff != "S" && nbkl_rowdata.Diff != undefined) {
                        if (labDiff == "L") {
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Pris', nbkl_Pris);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Text', labText);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Diff', labDiff);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Levert', nbkl_Levert);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Rab', nbkl_Rab);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Belop', nbkl_Belop);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'IdMech', $('#<%=hdnDuser.ClientID%>').val());
                        } else if (labDiff == "T") {
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Pris', "");
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Text', labText);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Diff', labDiff);
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Levert', "");
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Rab', "");
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'Belop', "0");
                            jQuery('#jobgrid').jqGrid("setCell", nbklrowId, 'IdMech', $('#<%=hdnDuser.ClientID%>').val());
                        }

                    }

                    jQuery('#jobgrid').setColProp('Nei', { editable: false });
                    jQuery('#jobgrid').setColProp('Ford', { editable: false });


                    // To be loaded from LoadHourlyPrice
                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    for (var k = 0; k < rowdisdata.length; k++) {
                        if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {

                            if (rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) {
                                jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                            }

                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }
                        if ((rowdisdata[k].IdJob == "")) {
                            jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Nei', "0");
                            if (rowdisdata[k].Diff != "RAOR" || rowdisdata[k].Diff != "RBOR") {
                                if ($('#<%=hdnInsCustId.ClientID%>').val() == "") {
                                    jQuery('#jobgrid').jqGrid("setCell", rowdisdata[k].id, 'Ford', "100");
                                }
                            }

                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                            cm.editable = false;
                        }
                    }



                    //adding new line
                    var spares = {
                        id: parseInt(id_last) + 1,
                        IdJob: "",
                        Text: "",
                        Nei: "0",
                        Ford: "100",
                        Bestilt: "",
                        Levert: "",
                        Pris: "",
                        Rab: "",
                        Belop: "",
                        JobId: nbkl_jobId,
                        Flag: "0",
                        Diff: "",
                        Item_Avail_Qty: "",
                        Disc_Amt: "0",
                        ForeignJob: "",
                        ItemDesc: "",
                        IdWOLabSeq: "",
                        IdWODetailseq: nbkl_idwodetseq,
                        Id_Deb_Seq: nbkl_iddebseq,
                        Id_Make: nbkl_makeid,
                        IdMech: nbkl_idMechanic,
                        IdWOItemseq: nbkl_idwoitemseq,
                        DebtType: nbkl_debtType,
                        SpareDiscount: 0
                    }

                    var n_rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');

                    var actualsparelength = n_rowspareData.length;
                    if (id_last == n_rowspareData.length) {
                        n_rowspareData[parseInt(id_last)] = spares;
                        actualsparelength = n_rowspareData.length;
                    }

                    jQuery("#jobgrid").jqGrid('clearGridData');
                    for (var j = 0; j < actualsparelength; j++) {
                        sparedata = n_rowspareData;
                        jQuery("#jobgrid").jqGrid('addRowData', j + 1, sparedata[j]);
                    }
                    jQuery("#jobgrid").setGridParam({ rowNum: 1000 }).trigger("reloadGrid");
                    $("#jobgrid").jqGrid("hideCol", "subGrid");

                    // need to recalculate
                    var rowdisdata = $('#jobgrid').jqGrid('getGridParam', 'data');
                    var hpVatPer = 0.0;
                    var gmVatPer = 0.0;
                    var spVatPer = 0.0;
                    var hpVat = 0.0;
                    var gmVat = 0.0;
                    var amtS = 0.0;
                    var vatAmount = 0.0;
                    var amtL = 0.0;
                    var discAmount = 0.0;
                    var TotalGM = 0.0;
                    var amtG = 0.0;
                    //var jobDisc = 0.0;
                    var labDisc = 0.0;
                    var gmDisc = 0.0;
                    var spareDisc = 0.0;

                    var labVatDisc = 0.0;
                    var gmVatDisc = 0.0;
                    var spareVatDisc = 0.0;
                    var totLabVatDisc = 0.0;
                    var totGmVatDisc = 0.0;
                    var totSpareVatDisc = 0.0;
                    var spVat = 0.0;
                    var idCust = $('#<%=lblCustName.ClientID%>').text();

                    for (var k = 0; k < rowdisdata.length; k++) {

                        var vats = LoadGMHPVat(rowdisdata[k].IdJob, rowdisdata[k].Id_Make, idCust);
                        if (vats.length > 0) {
                            gmVat = fnformatDecimalValue(vats[0], seperator);
                            hpVat = fnformatDecimalValue(vats[1], seperator);
                            spVat = fnformatDecimalValue(vats[2], seperator);
                        }

                        gmVatPer = gmVat;
                        hpVatPer = hpVat;
                        spVatPer = spVat;

                        if (rowdisdata[k].Diff == "S") {
                            if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                var boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                if (boQty != "0") {
                                    jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                        'color': 'rgba(255, 0, 0, 0.8)',
                                        'background-image': 'none'
                                    });
                                }
                            }
                        }

                        if (rowdisdata[k].Flag == "1" && (rowdisdata[k].DebtType == "OHC" || rowdisdata[k].DebtType == null || rowdisdata[k].DebtType == undefined || rowdisdata[k].DebtType == "")) {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INSC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INSC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "INTC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "INTC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(33, 186, 69, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "CLA") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "CLA") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else if (rowdisdata[k].Flag == "1" && rowdisdata[k].DebtType == "MISC") {

                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Nei", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Ford", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Bestilt", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Levert", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Rab", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'font-weight': 'normal',
                                'background-image': 'none'
                            });
                        }
                        else if (rowdisdata[k].Flag == "0" && rowdisdata[k].DebtType == "MISC") {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(41, 128, 185, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                        }
                        else {
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Pris", "", {
                                'text-align': 'right'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "IdJob", "", {
                                'text-align': 'left'
                            });
                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Text", "", {
                                'text-align': 'left'
                            });
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Belop", "", 'ui-state-disabled');

                            jQuery("#jobgrid").jqGrid('setCell', rowdisdata[k].id, "Belop", "", {
                                'background-color': 'rgba(255, 255, 153, 1)',
                                'color': 'rgba(0, 0, 0, 1)',
                                'background-image': 'none',
                                'font-weight': 'normal',
                                'text-align': 'right'
                            });
                        }

                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "OR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC") || (rowdisdata[k].DebtType == "INTC") || (rowdisdata[k].DebtType == "CLA") || (rowdisdata[k].DebtType == "MISC")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }
                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RAOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RAOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RAOR")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }
                        if ((rowdisdata[k].DebtType == "OHC" && rowdisdata[k].Diff == "RBOR" && rowdisdata[k].Ford != "") || (rowdisdata[k].DebtType == "INSC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "INTC" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "CLA" && rowdisdata[k].Diff == "RBOR") || (rowdisdata[k].DebtType == "MISC" && rowdisdata[k].Diff == "RBOR")) {
                            $('#' + rowdisdata[k].id, $("#jobgrid")).addClass("ui-state-disabled");
                        }

                        if (rowdisdata[k].Diff == "T") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Pris", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Rab", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }
                        if ((rowdisdata[k].Text != "") && (rowdisdata[k].Diff == "S")) {
                            if ((rowdisdata[k].ItemDesc != "" && rowdisdata[k].ItemDesc != undefined) && (rowdisdata[k].Diff == "S")) {
                                jQuery("#jobgrid").setCell(rowdisdata[k].id, "Text", "", 'not-editable-cell');
                            }
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Nei", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');
                        }

                        if (rowdisdata[k].Diff == "L") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Bestilt", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Ford", "", 'not-editable-cell');

                            // var amount = fnformatDecimalValue(rowdisdata[k].Belop, seperator);
                            var amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            amtL = (fnformatDecimalValue(amtL, seperator) + amount).toFixed(2);

                            var GM = $('#<%=txtGM.ClientID%>').val();

                            if (rowdisdata[k].ForeignJob != "FJ") {
                                amtG = ((fnformatDecimalValue(amount, seperator) * fnformatDecimalValue(GM, seperator)) / 100).toFixed(2);
                                TotalGM = fnformatDecimalValue(TotalGM, seperator) + fnformatDecimalValue(amtG, seperator);
                                //$('#<%=txtTGM.ClientID%>').val(TotalGM);
                            }

                            //Lab and GM Discount
                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                labDisc = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue((amount * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                gmDisc = (fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue((amtG * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)), seperator)).toFixed(2);
                                labVatDisc = (amount * (hpVatPer / 100)).toFixed(2);
                                totLabVatDisc = (fnformatDecimalValue(totLabVatDisc, seperator) + (fnformatDecimalValue(labVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                                gmVatDisc = (amtG * (gmVatPer / 100)).toFixed(2);
                                totGmVatDisc = (fnformatDecimalValue(totGmVatDisc, seperator) + (fnformatDecimalValue(gmVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);
                            }

                            hpVat = (amtL * (hpVatPer / 100)).toFixed(2);
                            gmVat = (TotalGM * (gmVatPer / 100)).toFixed(2);
                            hpVat = fnreformatDecimal(hpVat, seperator);
                            gmVat = fnreformatDecimal(gmVat, seperator);
                            amtL = fnreformatDecimal(amtL, seperator);
                            TotalGM = fnreformatDecimal(TotalGM, seperator);

                            $('#<%=txtTGM.ClientID%>').val(TotalGM);
                            $('#<%=txtHPVat.ClientID%>').val(hpVat);
                            $('#<%=txtGMVat.ClientID%>').val(gmVat);
                            $('#<%=txtTLab.ClientID%>').val(amtL);

                            var discChk = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            rowdisdata[k].Disc_Amt = fnreformatDecimal(discChk, seperator);

                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(discChk, seperator)).toFixed(2);
                            rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);
                        }

                        if (rowdisdata[k].Diff == "S") {
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "Levert", "", 'not-editable-cell');
                            jQuery("#jobgrid").setCell(rowdisdata[k].id, "IdJob", "", 'not-editable-cell');
                            var cm = jQuery("#jobgrid").jqGrid('getColProp', 'Bestilt');
                            cm.editable = true;
                            var amount;
                            if (rowdisdata[k].Belop != undefined) {
                                amount = (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator)) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            } else {
                                amount = fnformatDecimalValue("", seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                            }
                            amtS = (fnformatDecimalValue(amtS, seperator) + amount).toFixed(2);
                            vatAmount = (fnformatDecimalValue(vatAmount, seperator) + ((fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01) * (fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Levert, seperator) * 0.01 * 100) * 0.01 * spVatPer))).toFixed(2);
                            amtS = fnreformatDecimal(amtS, seperator);
                            vatAmount = fnreformatDecimal(vatAmount, seperator);
                            $('#<%=txtSPVat.ClientID%>').val(vatAmount);
                            $('#<%=txtTSP.ClientID%>').val(amtS);

                            if (rowdisdata[k].Rab != undefined && rowdisdata[k].Rab != "0" && rowdisdata[k].Rab != "") {
                                var amt;
                                var boQty;
                                if (rowdisdata[k].Jobi_Bo_Qty != undefined) {
                                    boQty = fnformatDecimalValue(rowdisdata[k].Jobi_Bo_Qty, seperator);
                                } else {
                                    boQty = 0;
                                }

                                if (boQty != "0") {
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(0, seperator)).toFixed(2);
                                } else {
                                    amt = fnformatDecimalValue(rowdisdata[k].Levert, seperator) * fnformatDecimalValue(rowdisdata[k].Pris, seperator) * (fnformatDecimalValue(rowdisdata[k].Ford, seperator) * 0.01);
                                    spareDisc = (fnformatDecimalValue(spareDisc, seperator) + (fnformatDecimalValue(amt, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100))).toFixed(2);
                                }
                            }
                            spareVatDisc = (amount * (spVatPer / 100)).toFixed(2);
                            totSpareVatDisc = (fnformatDecimalValue(totSpareVatDisc, seperator) + (fnformatDecimalValue(spareVatDisc, seperator) * fnformatDecimalValue(rowdisdata[k].Rab, seperator) * 0.01)).toFixed(2);

                            var spchck = ((fnformatDecimalValue(amount, seperator) * (fnformatDecimalValue(rowdisdata[k].Rab, seperator) / 100)).toFixed(2));
                            rowdisdata[k].Disc_Amt = fnreformatDecimal(spchck, seperator);

                            var perLineDisc = (fnformatDecimalValue(amount, seperator) - fnformatDecimalValue(spchck, seperator)).toFixed(2);
                            rowdisdata[k].Belop = fnreformatDecimal(perLineDisc, seperator);

                        }

                        if (rowdisdata[k].Disc_Amt != undefined) {
                            discAmount = (fnformatDecimalValue(discAmount, seperator) + fnformatDecimalValue(rowdisdata[k].Disc_Amt, seperator)).toFixed(2);
                        }

                        discAmount = (fnformatDecimalValue(labDisc, seperator) + fnformatDecimalValue(gmDisc, seperator) + fnformatDecimalValue(spareDisc, seperator) + fnformatDecimalValue(totLabVatDisc, seperator) + fnformatDecimalValue(totGmVatDisc, seperator) + fnformatDecimalValue(totSpareVatDisc, seperator)).toFixed(2);

                    }

                    if ($('#<%=txtTLab.ClientID%>').val() == "") {
                        $('#<%=txtTLab.ClientID%>').val('0');
                        $('#<%=txtTGM.ClientID%>').val('0');
                        $('#<%=txtHPVat.ClientID%>').val('0');
                        $('#<%=txtGMVat.ClientID%>').val('0');
                    }

                    if ($('#<%=txtSPVat.ClientID%>').val() == "") {
                        $('#<%=txtSPVat.ClientID%>').val('0');
                        $('#<%=txtTSP.ClientID%>').val('0');
                    }

                    var total = (fnformatDecimalValue($('#<%=txtTGM.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTLab.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtTSP.ClientID%>').val(), seperator)).toFixed(2);
                    var vatTotal = (fnformatDecimalValue($('#<%=txtHPVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtGMVat.ClientID%>').val(), seperator) + fnformatDecimalValue($('#<%=txtSPVat.ClientID%>').val(), seperator)).toFixed(2);
                    var TIncVat = ((fnformatDecimalValue(total, seperator) + fnformatDecimalValue(vatTotal, seperator) - fnformatDecimalValue(discAmount, seperator))).toFixed(2);
                    total = fnreformatDecimal(total, seperator);
                    vatTotal = fnreformatDecimal(vatTotal, seperator);
                    TIncVat = fnreformatDecimal(TIncVat, seperator);
                    discAmount = fnreformatDecimal(discAmount, seperator);
                    $('#<%=txtNet.ClientID%>').val(total);
                    $('#<%=txtVat.ClientID%>').val(vatTotal);
                    $('#<%=txtTotal.ClientID%>').val(TIncVat);
                    $('#<%=txtDisc.ClientID%>').val(discAmount);
                
                // save the line
                saveJobDet(1);
                console.log("Saved");
            } //end of Labour For Loop

        } //end of AddRepPakLabourLines
        function ModifySpareLine(rowId,quantity) {
            var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
            $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Levert', quantity);
            recalculateTotals();
            saveJobDet(1);
        }
        function SaveReturnSpares(rowDetails) {
            if (rowDetails != null) {
                var woNum= $('#<%=hdnWoNo.ClientID%>').val();
                var woPrefix  = $('#<%=hdnWoPr.ClientID%>').val() ;

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/SaveReturnSpare",
                    data: "{idItem: '" + rowDetails.IdJob + "', itemDesc:'" + rowDetails.ItemDesc + "', returnQty:'" + rowDetails.Levert + "', salePrice:'" + rowDetails.Pris
                        + "', costPrice:'" + rowDetails.Sp_Cost_Price + "', idMake:'" + rowDetails.Id_Make + "', woPrefix:'" + woPrefix + "', woNum:'" + woNum + "'}",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        if (data.d[0] == "SUCCESS") {
                            swal("Returned Spare '" + rowDetails.IdJob + "' saved with return number " + data.d[1]);
                        }
                        else if (data.d[0] == "FAIL" || data.d[0] == "") {
                            swal("Failed to save return spare '" + rowDetails.IdJob+"'");
                        }
                    },
                    error: function (result) {
                        alert("Error");
                    }
                });
            }
            
        }
        function updateSPPrice(rowId,spCostPrice,spSalePrice) {
            var rowdata = jQuery("#jobgrid").jqGrid('getRowData', rowId);
            $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Pris', spSalePrice);
            $('#jobgrid').jqGrid("setCell", (parseInt(rowId)), 'Sp_Cost_Price', spCostPrice);

            recalculateTotals();
            saveJobDet(1);
        }
        function dxJobCard() {

            var rowspareData = $('#jobgrid').jqGrid('getGridParam', 'data');
            if (rowspareData.length != "0") {
                var reportType = "JOBCARD";

                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: "frmWOJobDetails.aspx/LoadReport",
                    data: "{'reportType':'" + reportType + "'}",
                    dataType: "json",
                    async: false,//Very important
                    success: function (Result) {

                        if (Result.d.length > 0) {
                            var strValue = Result.d;
                            if (strValue != "") {
                                //var Url = strValue;//"../Reports/frmShowReports.aspx?ReportHeader=YF8c/MYCthcdMZ0D0ra6EQ==&InvoiceType=YF8c/MYCthcdMZ0D0ra6EQ==&Rpt=GPwu6EpyNgg8JACPpv3cVA==&scrid=" + WoPr + WoNo + "&JobCardSett=1"
                                //window.open(Url, 'Reports', "menubar=no,location=no,status=no,scrollbars=yes,resizable=yes");
                                cbPanel.PerformCallback();
                            }
                        }
                    }
                });
            }
        }
    </script>
     <asp:HiddenField ID="hdnXmlInv" runat="server" />
    <asp:HiddenField ID="hdnVAMode" runat="server" />
    <asp:HiddenField ID="hdnViewCap" runat="server" Value="View" />
    <asp:HiddenField ID="hdnWoNo" runat="server" />
    <asp:HiddenField ID="hdnWoPr" runat="server" />
    <asp:HiddenField ID="hdnVehId" runat="server" />
    <asp:HiddenField ID="hdnVehGrpDesc" runat="server" />
    <asp:HiddenField ID="hdnDateFormat" Value="<%$ appSettings:DateFormatValidate %>" runat="server" />
    <asp:HiddenField ID="hdnDateFormatLang" Value="<%$ appSettings:DateFormatLang %>" runat="server" />
    <asp:HiddenField ID="hdnConfigZipSave" runat="server" Value="1" />
    <asp:HiddenField ID="hdnNewZip" runat="server" />
    <asp:HiddenField ID="hdnJobId" runat="server" />
    <asp:HiddenField ID="hdnRowId" runat="server" />
    <asp:HiddenField ID="hdnSelect" runat="server" />
    <asp:HiddenField ID="hdnGMVat" runat="server" />
    <asp:HiddenField ID="hdnHPVat" runat="server" />
    <asp:HiddenField ID="hdnSPVat" runat="server" />
    <asp:HiddenField ID="hdnHP" runat="server" />
    <asp:HiddenField ID="hdnIdMake" runat="server" />
    <asp:HiddenField ID="hdnIdItem" runat="server" />
    <asp:HiddenField ID="hdnAvail_Qty" runat="server" />
    <asp:HiddenField ID="hdnOrgJobId" runat="server" />
    <asp:HiddenField ID="hdnDuser" runat="server" />
    <asp:HiddenField ID="hdnGridId" runat="server" />
    <asp:HiddenField ID="hdnSuppId" runat="server" />
    <asp:HiddenField ID="hdnDbtSeq" runat="server" />
    <asp:HiddenField ID="hdnIntDbtSeq" runat="server" />
    <asp:HiddenField ID="hdnClaimDbtSeq" runat="server" />
    <asp:HiddenField ID="hdnInsCustId" runat="server" />
    <asp:HiddenField ID="hdnIntCustId" runat="server" />
    <asp:HiddenField ID="hdnClaimCustId" runat="server" />
    <asp:HiddenField ID="hdnMiscCustId" runat="server" />
    <asp:HiddenField ID="hdnMiscDbtSeq" runat="server" />
    <asp:HiddenField ID="hdnReductionType" runat="server" />
    <asp:HiddenField ID="hdnMainDebtAmt" runat="server" />
    <asp:HiddenField ID="hdnInsDebtAmt" runat="server" />
    <asp:HiddenField ID="hdnIntDeptDebtAmt" runat="server" />
    <asp:HiddenField ID="hdnClaimDebtAmt" runat="server" />
    <asp:HiddenField ID="hdnMiscDebtAmt" runat="server" />
    <asp:HiddenField ID="hdnOwnPayVAT" runat="server" />
    <asp:HiddenField ID="hdnOHCGenDisc" runat="server" />
    <asp:HiddenField ID="hdnOHCLabDisc" runat="server" />
    <asp:HiddenField ID="hdnOHCSpareDisc" runat="server" />
    <asp:HiddenField ID="hdnInsGenDisc" runat="server" />
    <asp:HiddenField ID="hdnInsLabDisc" runat="server" />
    <asp:HiddenField ID="hdnInsSpareDisc" runat="server" />
    <asp:HiddenField ID="hdnIntGenDisc" runat="server" />
    <asp:HiddenField ID="hdnIntLabDisc" runat="server" />
    <asp:HiddenField ID="hdnIntSpareDisc" runat="server" />
    <asp:HiddenField ID="hdnClaGenDisc" runat="server" />
    <asp:HiddenField ID="hdnClaLabDisc" runat="server" />
    <asp:HiddenField ID="hdnClaSpareDisc" runat="server" />
    <asp:HiddenField ID="hdnMiscGenDisc" runat="server" />
    <asp:HiddenField ID="hdnMiscLabDisc" runat="server" />
    <asp:HiddenField ID="hdnMiscSpareDisc" runat="server" />    
    <asp:HiddenField ID="hdnIdDebtor" runat="server" />
    <asp:HiddenField ID="hdnJobNum" runat="server" />
    <asp:HiddenField ID="hdnOrdHeadDebtVatPerc" runat="server" />
    <asp:HiddenField ID="hdnInvoiceType" runat="server" />
    <asp:HiddenField ID="hdnCustBorn" runat="server" />
    <asp:HiddenField ID="hdnCustSsn" runat="server" />
    <asp:HiddenField ID="hdnPageSize" runat="server"/>
    <asp:HiddenField ID="hdnIdBargain" runat="server"/>
    <asp:HiddenField ID="hdnIdXtraScheme" runat="server"/>
        <asp:HiddenField ID="hdnSupplierStockId" runat="server"/>
    <asp:HiddenField ID="hdnDealerNoSpare" runat="server"/>
    <asp:HiddenField ID="hdnIdDeptWo" runat="server"/>
    <asp:HiddenField ID="hdnSupplierCurrentNo" runat="server"/>
    <asp:HiddenField ID="hdnJobGridSparesJson" runat="server"/>

      <div id="divJobDetheader" class="ui raised segment signup inactive" style="margin: 0em 0em 0.5em !important;">
        <div class="twelve fields">
            <asp:Label ID="lblCustomer" runat="server" Text="Kunde:" Width="50px" Style="font-weight: bold" meta:resourcekey="lblCustomerResource1"></asp:Label>
            <asp:Label ID="lblCustName" runat="server" Width="50px" meta:resourcekey="lblCustNameResource1"></asp:Label>
            <asp:Label ID="lblCustName2" runat="server" Width="200px" meta:resourcekey="lblCustName2Resource1"></asp:Label>
            <asp:Label ID="Label13" runat="server" Width="50px" meta:resourcekey="Label13Resource1"></asp:Label>
            <asp:Label ID="lblRegnNo" runat="server" Text="RegNr." Width="50px" Style="font-weight: bold" meta:resourcekey="lblRegnNoResource1"></asp:Label>
            <asp:Label ID="lblRegistation" runat="server" Width="80px" meta:resourcekey="lblRegistationResource1"></asp:Label>
            <asp:Label ID="Label15" runat="server" Width="50px" meta:resourcekey="Label15Resource1"></asp:Label>
            <asp:Label ID="lblOrder" runat="server" Text="OrdreNr." Width="60px" Style="font-weight: bold" meta:resourcekey="lblOrderResource1"></asp:Label>
            <asp:Label ID="lblOrderNo" runat="server" Width="120px" meta:resourcekey="lblOrderNoResource1"></asp:Label>
            <asp:Label ID="lblOrdDate" runat="server" Text="Order Date: " meta:resourcekey="lblOrdDateResource1"></asp:Label>
            <asp:Label ID="RTlblOrderDate" runat="server" Width="93px" meta:resourcekey="RTlblOrderDateResource1"></asp:Label>
            <asp:Label ID="Label28" runat="server" Width="40px" meta:resourcekey="Label15Resource1"></asp:Label>
            <asp:Label ID="lblStatus" runat="server" Text="Status" meta:resourcekey="lblStatusResource1"></asp:Label><span class="mand">*</span>
            <asp:DropDownList ID="ddlStatus" CssClass="carsInput" runat="server" ></asp:DropDownList>
            <asp:Label ID="Label27" runat="server" Width="40px" meta:resourcekey="Label15Resource1"></asp:Label>
            <asp:Label ID="lblSpareStatus" runat="server" Text="Delestatus" meta:resourcekey="lblStatusResource1"></asp:Label>
            <asp:DropDownList ID="ddlSpareStatus" CssClass="carsInput" runat="server" style="border: 1px solid rgba(34, 36, 38, 0.15);color: rgba(0, 0, 0, 0.87); border-radius: 0.28571429rem;" ></asp:DropDownList>
        </div>
    </div>
      <asp:Label ID="RTlblError" runat="server" CssClass="lblErr" meta:resourcekey="RTlblErrorResource1"></asp:Label>
    <div class="overlayHide"></div>
    

     <div class="ui top attached tabular menu">
                    <a class="cTab item active"  data-tab="Head">Ordrehode</a>
                    <a class="cTab item" data-tab="OrderDetails">Ordrelinjer</a>
                    <a class="cTab item " data-tab="Insurance" id="btnSpareHistory">Forsikring</a>
                    <a class="cTab item " data-tab="InternalDepartment" id="btnSpareSold">Intern avd.</a>
                    <a class="cTab item " data-tab="Claim">Claim</a>
                    <a class="cTab item " data-tab="Miscellaneous">Misc</a>
                    <a class="cTab item " data-tab="SpareImages">Split</a>


       </div>



  
  
  <div class="ui bottom attached tab segment active" data-tab="Head">
                    

    <div id="tabHead" class="tTab">
        <%--########################################## Head ##########################################--%>
        <div class="ui form stackable two column grid ">
            <div class="ten wide column">
                <%--left column--%>
                 <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H4" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Kunde</h3>
                     <div class="inHeaderCheckbox">
                        <div class="ui checkbox ">
                                      <input type="checkbox" id="chkCompany" name="Firma" />
                                      <label>Firma</label>
                                    </div>
                         </div>
                    
                    <%--vehicle info panel--%>
                    <div class="fields">
                        <div class="five wide field">
                          
                            
                        </div>
                        <div class="two wide field">
                              <asp:Label ID="lblCusGroup" runat="server" CssClass="hidden" Text="Group" meta:resourcekey="lblCusGroupResource1"></asp:Label>
                     <div class="ui mini input">
                            <asp:DropDownList ID="ddlCusGroup" CssClass="carsInput hidden" runat="server" class="" meta:resourcekey="ddlCusGroupResource1">
                                </asp:DropDownList>
                                </div>
                              <asp:Label ID="lblPaymentType" runat="server" CssClass="hidden" Text="Payment Type" meta:resourcekey="lblPaymentTypeResource1"></asp:Label>
                         
                             <asp:DropDownList ID="ddlPayType" CssClass="carsInput hidden" runat="server" class="" meta:resourcekey="ddlPayTypeResource1">
                                </asp:DropDownList>
                               
                               <asp:Label ID="lblPaymentTerms" CssClass="hidden" runat="server" Text="Payment Terms" meta:resourcekey="lblPaymentTermsResource1"></asp:Label>
                            <div class="ui mini input">
                            <asp:DropDownList ID="ddlPayTerms" CssClass="carsInput hidden" runat="server" class="" meta:resourcekey="ddlPayTermsResource1">
                                </asp:DropDownList>
                                </div>
                        </div>
                        
                        
                        <div class="three wide field">
                              <asp:Label ID="Label33" runat="server" Text="Eniro ID" meta:resourcekey="Label2Resource1"></asp:Label>
                          <asp:TextBox ID="txtEniroId"  CssClass="carsInput" runat="server" meta:resourcekey="txtSrchCustResource1"></asp:TextBox>
                        </div>
                        <div class="five wide field">
                              <asp:Label ID="Label2" runat="server" Text="Search customer" meta:resourcekey="Label2Resource1"></asp:Label>
                            <div class="ui mini input">
                          <asp:TextBox ID="txtSrchCust"  PlaceHolder="Søk etter kunder her.." CssClass="carsInput" runat="server" meta:resourcekey="txtSrchCustResource1"></asp:TextBox>
                                </div>
                        </div>
                       <div class="one wide field">
                             <button class="mini ui btn" id="fetchEniro" title="Hent fra telefonkatalogen" style="max-height: 25px;margin-top: 19px;width: 2.7em;">Vask</button>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="five wide field" id="priv">
                               <asp:Label ID="lblName" runat="server" Text="First Name" meta:resourcekey="lblNameResource1"></asp:Label><span class="mand">*</span>
                            <div class="ui mini input">
                                 <asp:TextBox ID="txtName" CssClass="carsInput" runat="server" meta:resourcekey="txtNameResource1"></asp:TextBox>
                                </div>
                                
                        </div>
                        <div class="five wide field" id="priv2">
                                <asp:Label ID="Label6" runat="server" Text="Middle Name" meta:resourcekey="Label6Resource1"></asp:Label><span class="mand">*</span>
                            <div class="ui mini input">
                                 <asp:TextBox ID="txtMName" CssClass="carsInput" runat="server" meta:resourcekey="txtMNameResource1"></asp:TextBox>
                                </div>
                        </div>
                        <div class="five wide field">
                                <asp:Label ID="lblPrivLastName" runat="server" Text="Last Name"></asp:Label>
                            <asp:Label ID="lblCompName" runat="server" Text="Company name" CssClass="hidden"></asp:Label><span class="mand">*</span>
                            <div class="ui mini input">
                                 <asp:TextBox ID="txtLName" CssClass="carsInput" runat="server" meta:resourcekey="txtLNameResource1"></asp:TextBox>
                                </div>
                        </div>
                         <div class="five wide field hidden" id="comp">
                                <asp:Label ID="Label21" runat="server" Text="Contact person" meta:resourcekey="Label6Resource1"></asp:Label><span class="mand">*</span>
                            <div class="ui mini input">
                                 <asp:TextBox ID="txtContact" CssClass="carsInput" runat="server" meta:resourcekey="txtMNameResource1"></asp:TextBox>
                                </div>
                        </div>
                         <div class="three wide field hidden" id="comp2">
                                <asp:Label ID="lblContactTitle" runat="server" Text="Title" meta:resourcekey="Label6Resource1"></asp:Label><span class="mand">*</span>
                            <div class="ui mini input">
                                 <asp:TextBox ID="txtContactTitle" CssClass="carsInput" runat="server" meta:resourcekey="txtMNameResource1"></asp:TextBox>
                                </div>
                        </div>
                         <div class="two wide field hidden" id="comp3"></div>
                        <div class="one wide field">
                             <button class="mini ui btn" id="custMoreInfo" title="Se kunde" style="max-height: 25px;margin-top: 19px;width: 2.7em;"> <i class="user icon" style="font-size: 20px"></i></button>
                        </div>
                    </div>

                    <div class="fields">
                        <div class="seven wide field">
                            <asp:Label ID="lblAddress1" runat="server" Text="Address1" meta:resourcekey="lblAddress1Resource1"></asp:Label>
                            <div class="ui mini input">
                             <asp:TextBox ID="txtAddress1" CssClass="carsInput" runat="server" meta:resourcekey="txtAddress1Resource1"></asp:TextBox>
                                </div>
                        </div>
                        <div class="three wide field">
                             <asp:Label ID="lblZipcode" runat="server" Text="ZipCode" meta:resourcekey="lblZipcodeResource1"></asp:Label>
                            <div class="ui mini input">
                            <asp:TextBox ID="txtZipCode" CssClass="carsInput" runat="server" meta:resourcekey="txtZipCodeResource1"></asp:TextBox>
                                </div>
                        </div>
                        <div class="five wide field">
                               <asp:Label ID="lblState" runat="server" Text="State" meta:resourcekey="lblStateResource1"></asp:Label>
                            <div class="ui mini input">
                             <asp:TextBox ID="txtState" CssClass="carsInput" runat="server" meta:resourcekey="txtStateResource1"></asp:TextBox>
                                </div>
                        </div>
                 <div class="one wide field hidden" style="display:none;">
                              <asp:Label ID="lblAddress2" runat="server" Text="Adress2" meta:resourcekey="lblAddress2Resource1"></asp:Label>
                            <div class="ui mini input">
                            <asp:TextBox ID="txtAddress2" CssClass="carsInput" runat="server" meta:resourcekey="txtAddress2Resource1"></asp:TextBox>
                                </div>
                        </div>
                          <div class="one wide field">
                        <button class="mini ui btn" id="btnReferenceCustomer" title="Referansekunde" style="max-height: 25px;margin-top: 19px;width: 2.7em;"><i class="users icon" style="font-size: 20px"></i></button>
                        </div>
                             </div>
                   
                    <div class="fields">
                        <div class="seven wide field">
                             <asp:Label ID="lblEmail" runat="server" Text="Email" meta:resourcekey="lblMobNoResource1"></asp:Label>
                            <div class="ui mini input">
                           <asp:TextBox ID="txtEmail" CssClass="carsInput" runat="server" meta:resourcekey="txtMobNoResource1"></asp:TextBox>
                                </div>
                        </div>
                         <div class="five wide field">
                             <asp:Label ID="lblMobNo" runat="server" Text="Contact Phone" meta:resourcekey="lblMobNoResource1"></asp:Label>
                            <div class="ui mini input">
                           <asp:TextBox ID="txtMobNo" CssClass="carsInput" runat="server" meta:resourcekey="txtMobNoResource1"></asp:TextBox>
                                </div>
                        </div>
                         <div class="three wide field"></div>
                        <div class="one wide field">
                         <input type="button" id="btnNoteCustomer" title="Se anmerkning" style="max-height: 25px;margin-top: 19px;" runat="server" class="mini ui btn" value="Anm." />
                   </div>
                        </div>
                       
                    </div>
                    

                       
               
                  
                <%--end vehicle model panel--%>

                <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H16" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Kjøretøy</h3>
                    
                    <%--vehicle model panel--%>
                    <div class="fields">



                        <div class="four wide field">
                           <asp:Label ID="lblVehicle" runat="server"  Text="Search vehicle" meta:resourcekey="lblVehicleResource1"></asp:Label>
                            <div class="ui mini input">
                          <asp:TextBox ID="txtSrchVeh" PlaceHolder="Søk etter kjøretøy her..." CssClass="carsInput" runat="server" meta:resourcekey="txtSrchVehResource1"></asp:TextBox>
                                </div>
                          <asp:ListBox ID="lst_veh" runat="server" meta:resourcekey="lst_vehResource1"></asp:ListBox>
                        
                        </div>
                        <div class="four wide field">
                                <asp:Label ID="lblMake" runat="server" Text="Make" meta:resourcekey="lblMakeResource1"></asp:Label><span class="mand">*</span>
                            <div class="ui mini input">
                                <asp:DropDownList ID="ddlMake" CssClass="carsInput" runat="server" class="" meta:resourcekey="ddlMakeResource1">
                                </asp:DropDownList>
                                </div>
                        </div>
                         <div class="seven wide field">
                                <asp:Label ID="lblModel" runat="server" Text="Model" meta:resourcekey="lblModelResource1"></asp:Label><span class="mand">*</span>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtbxModel" CssClass="carsInput" runat="server" class="" meta:resourcekey="ddlModelResource1">
                                </asp:TextBox>
                                </div>
                        </div>
                        <div class="one wide field">
                            <button class="mini ui btn" id="vehMoreInfo" title="Se kjøretøy" style="max-height: 25px;margin-top: 19px;width: 2.7em;"> <i class="fas fa-car" style="font-size: 20px"></i></button>
                        </div>
                    </div>
                    <div class="fields">
                         <div class="three wide field">
                                <asp:Label ID="lblRegNo" runat="server" Text="Reg.No" meta:resourcekey="lblRegNoResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtRegNo" CssClass="carsInput" runat="server" meta:resourcekey="txtRegNoResource1"></asp:TextBox>
                                </div>
                        </div>

                        <div class="three wide field">
                                <asp:Label ID="lblInternalNo" runat="server" Text="Internal No" meta:resourcekey="lblInternalNoResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtInternalNo" CssClass="carsInput" runat="server" meta:resourcekey="txtInternalNoResource1"></asp:TextBox>
                                </div>
                        </div>
                       
                        

                        <div class="three wide field" style="display: none;">
                                <asp:Label ID="lblVehHours" runat="server" Text="Hours" meta:resourcekey="lblVehHoursResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtHours"  CssClass="carsInput" runat="server" meta:resourcekey="txtHoursResource1"></asp:TextBox>
                                </div>
                        </div>
                        <div class="three wide field">
                                <asp:Label ID="lblVehMileage" runat="server" Text="Mileage" meta:resourcekey="lblVehMileageResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtMileage" CssClass="carsInput" runat="server" meta:resourcekey="txtMileageResource1"></asp:TextBox>
                                </div>
                        </div>
                        <div class="three wide field">
                                <asp:Label ID="lblVehWarranty" runat="server" Text="Warranty" meta:resourcekey="lblVehMileageResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtVehWarranty" CssClass="carsInput" runat="server" meta:resourcekey="txtMileageResource1"></asp:TextBox>
                                </div>
                        </div>
                        <div class="three wide field">
                                <asp:Label ID="lblVehColor" runat="server" Text="Color" meta:resourcekey="lblVehMileageResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtColor" CssClass="carsInput" runat="server" meta:resourcekey="txtMileageResource1"></asp:TextBox>
                                </div>
                        </div>
                        <div class="one wide field">
                            <input type="button" id="btnNoteVehicle" title="Se anmerkning" style="max-height: 25px;margin-top: 19px;" runat="server" class="mini ui btn" value="Anm." />
                        </div>
                    </div>
                     <div class="fields">
                        <div class="five wide field">
                                <asp:Label ID="lblVin" runat="server" Text="VIN" meta:resourcekey="lblVinResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtVIN" CssClass="carsInput" runat="server" meta:resourcekey="txtVINResource1"></asp:TextBox>
                                </div>
                        </div>
                         
                         <div class="three wide field">
                                <asp:Label ID="lblVANum" runat="server" Text="VA Number" meta:resourcekey="lblVANumResource1"></asp:Label>
                              <div class="ui mini input">
                                <asp:TextBox ID="txtVANum" CssClass="carsInput" runat="server" meta:resourcekey="txtVANumResource1"></asp:TextBox>
                                  </div>
                        </div> 
                         <div class="seven wide field">
                             </div>
                          <div class="one wide field">
                         <button class="mini ui btn" id="btnScheme" title="Xtrasjekken" style="max-height: 25px;margin-top: 19px;width: 2.7em;"><div class="xtrasjekken"><img src="../Images/xtrascheme.png" style="max-width: 25px"/></div><div class="xtrasjekkenActive hidden"><img src="../Images/xtraschemeActive.png" style="max-width: 25px"/></div></button>

                         </div>
                       
                        
                    </div>

                     <div class="fields">
                        
                          
                          <div class="three wide field">
                                <asp:Label ID="lblVehLastServiceDate" runat="server" Text="Last service" meta:resourcekey="lblVehMileageResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtVehLastServiceDate" CssClass="carsInput" runat="server" meta:resourcekey="txtMileageResource1"></asp:TextBox>
                                </div>
                        </div>

                        <div class="three wide field">
                                <asp:Label ID="lblVehLastServiceMileage" runat="server" Text="Km." meta:resourcekey="lblVinResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtVehLastServiceMileage" CssClass="carsInput" runat="server" meta:resourcekey="txtVINResource1"></asp:TextBox>
                                </div>
                        </div>
                         
                          <div class="three wide field">
                                <asp:Label ID="lblVehLastControlDate" runat="server" Text="Last control" meta:resourcekey="lblVehMileageResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtVehLastControlDate" CssClass="carsInput" runat="server" meta:resourcekey="txtMileageResource1"></asp:TextBox>
                                </div>
                        </div>

                         <div class="three wide field">
                                <asp:Label ID="lblVehLastControlMileage" runat="server" Text="Km." meta:resourcekey="lblVehMileageResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtVehLastControlMileage" CssClass="carsInput" runat="server" meta:resourcekey="txtMileageResource1"></asp:TextBox>
                                </div>
                        </div>
                         
                       
                          <div class="two wide field" style="display:none;">
                                <asp:Label ID="lblSellPrice" runat="server" Text="Selling Price" Visible="False" meta:resourcekey="lblSellPriceResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtSellPrice" CssClass="carsInput" runat="server" Visible="False" meta:resourcekey="txtSellPriceResource1"></asp:TextBox>
                                </div>
                            <asp:Label ID="lblCostPrice" runat="server" Text="Cost Price" Visible="False" meta:resourcekey="lblCostPriceResource1"></asp:Label>
                            <div class="ui mini input">
                                <asp:TextBox ID="txtCostPrice" CssClass="carsInput" runat="server" Visible="False" meta:resourcekey="txtCostPriceResource1"></asp:TextBox>
                                </div>
                              <asp:HyperLink ID="lnkDefect" runat="server" NavigateUrl="javascript:openDefect()" meta:resourcekey="lnkDefectResource1">Defect Note</asp:HyperLink>
                            </div>
                         <div class="one wide field"></div>
                          <div class="two wide field">
                               <button class="ui button carsButtonBlueInverted wide hidden" type="button" id="btnJobCard">Job Card</button>
                                            </div>
                        <div class="one wide field">
                            <button class="mini ui btn" id="btnOffer" title="Send tilbud" style="max-height: 25px;margin-top: 19px;width: 2.7em;">Tilb.</button>
                        </div>
                    </div>

                    <div class="fields" >


                                            <div class="three wide field">
                                                

                                            </div>
                                            <div class="three wide field">
                                               

                                            </div>
                                            <div class="three wide field">
                                               

                                            </div>
                                            <div class="three wide field">
                                                
                                                
                                            </div>
                                            
                                            
                                        </div>
                    
                        

                  
                </div>
                
                    
                <%--end vehicle info panel--%>

                
            </div>
            <%--end left column--%>
            <div class="six wide column">
                <%--right column--%>
               <%--   <a class="active item" runat="server" class="ui top attached tiny header"id="aAddrComm" style="background-color: transparent"></a>
                  <asp:Label ID="Label6" runat="server" CssClass="lblErr"></asp:Label>--%>
                <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                    <h3 id="H11" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Ordredetaljer</h3>


                    <div class="fields">
                        <div class="six wide field">
                            <asp:Label ID="lblType" runat="server" Text="Type" meta:resourcekey="lblTypeResource1"></asp:Label><span class="mand">*</span>
                            <asp:DropDownList ID="ddlType" CssClass="carsInput" runat="server" meta:resourcekey="ddlTypeResource1"></asp:DropDownList>

                        </div>


                    </div>
                    <div class="fields">
                        <div class="six wide field">
                            <asp:Label ID="lblDeliveryDate" runat="server" Text="Delivery Date" meta:resourcekey="lblDeliveryDateResource1"></asp:Label>
                            <asp:TextBox ID="txtDeliveryDate" CssClass="carsInput" runat="server" MaxLength="25" Columns="50" meta:resourcekey="txtDeliveryDateResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <asp:Label ID="lblDeliveryTime" runat="server" Text="Delivery Time" meta:resourcekey="lblDeliveryTimeResource1"></asp:Label>
                            <asp:TextBox ID="txtDeliveryTime" CssClass="carsInput" runat="server" Columns="50" MaxLength="25" meta:resourcekey="txtDeliveryTimeResource1"></asp:TextBox>
                        </div>
                        <div class="two wide field">
                        </div>
                        <div class="one wide field">
                            <input type="button" id="btnNoteOrder" title="Se anmerkning" style="max-height: 25px; margin-top: 19px;" runat="server" class="mini ui btn" value="Anm." />
                        </div>

                    </div>

                    <div class="fields">
                        <div class="six wide field">
                            <asp:Label ID="lblFinishDate" runat="server" Text="Finish Date" meta:resourcekey="lblFinishDateResource1"></asp:Label>
                            <asp:TextBox ID="txtFinishDate" CssClass="carsInput" runat="server" Columns="50" MaxLength="25" meta:resourcekey="txtFinishDateResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <asp:Label ID="lblFinishTime" runat="server" Text="Finish Time" meta:resourcekey="lblFinishDateResource1"></asp:Label>
                            <asp:TextBox ID="txtFinishTime" CssClass="carsInput" runat="server" Columns="50" MaxLength="25" meta:resourcekey="txtFinishDateResource1"></asp:TextBox>
                        </div>
                        <div class="two wide field"></div>
                        <div class="one wide field">
                            <input type="button" id="btnMobilityWarranty" title="Mobilitetsgaranti" style="max-height: 25px; margin-top: 19px;" runat="server" class="mini ui btn" value="Mob." />
                        </div>
                    </div>
                    <div class="fields">

                        <div class="six wide field">
                            <asp:Label ID="lblDeptAccntNum" runat="server" Text="Dept. Account Number" meta:resourcekey="lblDeptAccntNumResource1"></asp:Label>
                            <asp:TextBox ID="txtDeptAccntNum" CssClass="carsInput" runat="server" MaxLength="50" meta:resourcekey="txtDeptAccntNumResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <asp:Label ID="lblRefWoNo" runat="server" Text="Ref.WoNo" meta:resourcekey="lblRefWoNoResource1"></asp:Label>
                            <asp:TextBox ID="txtRefWoNo" CssClass="carsInput" runat="server" MaxLength="50" meta:resourcekey="txtRefWoNoResource1"></asp:TextBox>
                        </div>
                        <div class="four wide field">
                        </div>
                    </div>
                    <div class="fields">
                        <div class="six wide field">
                            <asp:Label ID="lblEarlierControl" runat="server" Text="Tidl. kontrollnr." meta:resourcekey="lblEarligerControlResource1"></asp:Label>
                            <asp:TextBox ID="txtEarlierControl" CssClass="carsInput" runat="server" meta:resourcekey="txtEarlierControlResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <asp:Label ID="lblDiscount" runat="server" Text="Rabatt %" meta:resourcekey="lblDiscountResource1"></asp:Label>
                            <asp:TextBox ID="txtDiscount" CssClass="carsInput" runat="server" meta:resourcekey="txtDiscountResource1"></asp:TextBox>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="six wide field">
                            <asp:Label ID="lblRecuisitionNo" runat="server" Text="Rekv. nr." meta:resourcekey="lblRecuisitionNoResource1"></asp:Label>
                            <asp:TextBox ID="txtRecuisitionNo" CssClass="carsInput" runat="server" meta:resourcekey="txtRecuisitionNoResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <asp:Label ID="lblMechanicName" runat="server" Text="Mechanic" meta:resourcekey="lblMechanicNameResource1"></asp:Label>
                            <asp:TextBox ID="txtMechName" runat="server" CssClass="carsInput" MaxLength="50" PlaceHolder="Select Mechanic here"></asp:TextBox>                            
                        </div>
                        <div class="two wide field">
                           <asp:Label runat="server" Text="&nbsp;"></asp:Label>
                           <asp:TextBox ID="txtMechanic" runat="server" CssClass="carsInput" ></asp:TextBox>
                       </div>
                    </div>
                </div>
                
                
                <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                    <h3 id="H5" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Velg alternativer</h3>

                    <div class="fields">
                        <div class="six wide field">
                            <div class="list">
                                <div class="item">
                                    <div class="ui child checkbox">
                                        <input type="checkbox" id="chkpkk" name="Periodisk kontroll" />
                                        <label>Periodisk kontroll</label>
                                    </div>
                                </div>
                                <div class="item">
                                    <div class="ui child checkbox">
                                        <input type="checkbox" id="chkpkkafter" name="Etterkontroll" />
                                        <label>Etterkontroll</label>
                                    </div>
                                </div>
                                <div class="item">
                                    <div class="ui child checkbox">
                                        <input type="checkbox" id="chkservice" name="Periodisk service" />
                                        <label>Periodisk service</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="six wide field">
                            <div class="list">
                                <div class="item">
                                    <div class="ui child checkbox">
                                        <input type="checkbox" id="chkRentalCar" name="Leiebil" />
                                        <label>Leiebil</label>
                                    </div>
                                </div>
                                <div class="item">
                                    <div class="ui child checkbox">
                                        <input type="checkbox" id="chkTectyl" name="Tectyl" />
                                        <label>Tectyl beh.</label>
                                    </div>
                                </div>
                                <div class="item">
                                    <div class="ui child checkbox">
                                        <input type="checkbox" name="pear" id="chkMoistCtrl" disabled="disabled" />
                                        <label>Fuktkontroll</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>  
        </div>
        
</div>
</div>
</div>
    <%--########################################## OrderDetails ##########################################--%>
    <div class="ui bottom attached tab segment" data-tab="OrderDetails">
    <div id="tabOrderDetails" >
        <table id="jobgrid"></table>
        <div id="pager"></div>
        <div id="divCfInvDetails" class="ui raised segment signup inactive">
            <div class="thirteen fields">
                <asp:Label ID="lblGM" runat="server" Text="Vk.Mat" Width="70px" meta:resourcekey="lblGMResource1"></asp:Label>
                <asp:Label ID="lblTGM" runat="server" Text="TotalGM" Width="80px" meta:resourcekey="lblTGMResource1"></asp:Label>
                <asp:Label ID="lblTLab" runat="server" Text="TotalLab" Width="80px" meta:resourcekey="lblTLabResource1"></asp:Label>
                <asp:Label ID="lblTSp" runat="server" Text="TotalSpare" Width="80px" meta:resourcekey="lblTSpResource1"></asp:Label>
                <asp:Label ID="lblHPVat" runat="server" Text="HPVat" Width="60px" meta:resourcekey="lblHPVatResource1"></asp:Label>
                <asp:Label ID="lblGMVat" runat="server" Text="GMVat" Width="60px" meta:resourcekey="lblGMVatResource1"></asp:Label>
                <asp:Label ID="lblSPVat" runat="server" Text="SPVat" Width="60px" meta:resourcekey="lblSPVatResource1"></asp:Label>
                <asp:Label ID="Label4" runat="server" Width="100px" meta:resourcekey="Label4Resource1"></asp:Label>
                <asp:Label ID="Label1" runat="server" Width="100px" meta:resourcekey="Label1Resource1"></asp:Label>
                <asp:Label ID="Label5" runat="server" Width="100px" meta:resourcekey="Label5Resource1"></asp:Label>
                <asp:Label ID="lblNetSum" runat="server" Text="Net Sum" Width="120px" Style="text-align: left; margin-left: -56px" meta:resourcekey="lblNetSumResource1"></asp:Label>
                <asp:Label ID="lblDisc" runat="server" Text="Discount" Width="120px" Style="text-align: left" meta:resourcekey="lblDiscResource1"></asp:Label>
                <asp:Label ID="lblTotalVat" runat="server" Text="Vat" Width="120px" Style="text-align: left" meta:resourcekey="lblTotalVatResource1"></asp:Label>
                <asp:Label ID="lblTotal" runat="server" Text="Total Including Vat" Width="120px" Style="text-align: left" meta:resourcekey="lblTotalResource1"></asp:Label>
            </div>
            <div class="thirteen fields">
                <asp:TextBox ID="txtGM" runat="server" Width="70px" Enabled="False" meta:resourcekey="txtGMResource1"></asp:TextBox>
                <asp:TextBox ID="txtTGM" runat="server" Width="80px" Enabled="False" meta:resourcekey="txtTGMResource1"></asp:TextBox>
                <asp:TextBox ID="txtTLab" runat="server" Width="80px" Enabled="False" meta:resourcekey="txtTLabResource1"></asp:TextBox>
                <asp:TextBox ID="txtTSP" runat="server" Width="80px" Enabled="False" meta:resourcekey="txtTSPResource1"></asp:TextBox>
                <asp:TextBox ID="txtHPVat" runat="server" Width="60px" Enabled="False" meta:resourcekey="txtHPVatResource1"></asp:TextBox>
                <asp:TextBox ID="txtGMVat" runat="server" Width="60px" Enabled="False" meta:resourcekey="txtGMVatResource1"></asp:TextBox>
                <asp:TextBox ID="txtSPVat" runat="server" Width="60px" Enabled="False" meta:resourcekey="txtSPVatResource1"></asp:TextBox>
                <%--<input id="btnPris" runat="server" class="ui button" value="Hent Pris" type="button" />--%>
                <input id="btnView" runat="server" class="ui button" value="View" type="button" onclick="viewDebitorTotals()"/>
                <input id="btnSave" runat="server" class="ui button" value="Save" type="button" onclick="saveJobDet(1)" />
                <input id="btnCancel" runat="server" class="ui button"  value="Cancel" type="button"  />
                <asp:TextBox ID="txtNet" runat="server" Width="120px" Enabled="False" meta:resourcekey="txtNetResource1"></asp:TextBox>
                <asp:TextBox ID="txtDisc" runat="server" Width="120px" Enabled="False" meta:resourcekey="txtDiscResource1"></asp:TextBox>
                <asp:TextBox ID="txtVat" runat="server" Width="120px" Enabled="False" meta:resourcekey="txtVatResource1"></asp:TextBox>
                <asp:TextBox ID="txtTotal" runat="server" Width="120px" Enabled="False" meta:resourcekey="txtTotalResource1"></asp:TextBox>
                <input id="btnInvBasis" runat="server" class="ui button"  value="Invoice Basis" type="button" style="background-color: #E0E0E0" visible="false" onclick ="Invoicebasis()" />
                <input id="btnInvoice" runat="server" class="ui button"  value="Invoice" type="button" style="background-color: #E0E0E0" visible="false" onclick ="Invoice()" />
                <input id="btnRINV" runat="server" class="ui button"  value="ReadyToInvoice" type="button" style="background-color: #E0E0E0" />
                <input id="btnPickingList" runat="server" class="ui button"  value="Picking List" type="button" style="background-color: #E0E0E0" visible="false" onclick ="PickingList()" />
                <input id="btnDeliveryNote" runat="server" class="ui button"  value="DeliveryNote" type="button" style="background-color: #E0E0E0" visible="false"  onclick ="DeliveryNote()" />
                <input id="btnOrderList" runat="server" class="ui button"  value="OrderList" type="button" style="background-color: #E0E0E0" visible="false"  onclick ="OrderList()" />
                <%--<input id="btnPrint" runat="server" class="ui button" value="Print" type="button"  />--%>

            </div>
        </div>
    </div>
    </div>
    <asp:Label ID="lbReport" runat="server" meta:resourcekey="lbReportResource1" />
    
    <div id="modWashCustomer" class="ui modal">
        <i class="close icon"></i>
        <div class="header">
            Add Job
        </div>
        <div class="content">
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">

                        <div class="inline fields">
                            <div class="four wide field">
                                <label>
                                    <asp:Label ID="lblWorkCode" Text="WorkCode" runat="server" meta:resourcekey="lblWorkCodeResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:DropDownList ID="ddlWorkCode" CssClass="dropdowns" runat="server" meta:resourcekey="ddlWorkCodeResource1"></asp:DropDownList>
                            </div>
                            <div class="five wide field">
                                <label>
                                    <asp:Label ID="lblRPCode" Text="RepairCode" runat="server" meta:resourcekey="lblRPCodeResource1"></asp:Label></label>
                            </div>
                            <div class="two wide field">
                                <asp:DropDownList ID="ddlRepairCode" CssClass="dropdowns" runat="server" meta:resourcekey="ddlRepairCodeResource1"></asp:DropDownList>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                                <label>
                                    <asp:Label ID="lblJobId" Text="JobId" runat="server" meta:resourcekey="lblJobIdResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtJobId" runat="server" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                                <label>
                                    <asp:Label ID="Label3" Text="Foreign jobs From 90-99" runat="server" meta:resourcekey="Label3Resource1"></asp:Label></label>
                            </div>

                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                                <label>
                                    <asp:Label ID="lblMechanic" Text="Mechanic" runat="server" meta:resourcekey="lblMechanicResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:DropDownList ID="ddlMechanic" CssClass="dropdowns" runat="server" meta:resourcekey="ddlMechanicResource1"></asp:DropDownList>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="actions">
            <div class="ui button ok positive">Ok</div>
            <div class="ui button cancel negative">Avbryt</div>
        </div>
    </div>
    <div id="modRefCustomer" class="ui modal">
        <i class="close icon"></i>
        <div class="header">
            Send tilbud til kunde
        </div>
        <div class="content">
            <div class="ui form stackable two column grid ">
            <div class="ten wide column">
                
                    <div class="ui form">
                          <div class=" fields">
                           <div class="three wide field">
                                <label>
                                    <asp:Label ID="Label29" Text="Eier" runat="server"></asp:Label></label>
                            </div>
                              <div class="three wide field">
                           <asp:TextBox ID="TextBox8" runat="server" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                                  </div>
                              <div class="ten wide field">
                           <asp:TextBox ID="TextBox9" runat="server" Enabled="false" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                                  </div>
                              
                          

                        </div>

                        <div class=" fields">
                           <div class="three wide field">
                                <label>
                                    <asp:Label ID="Label30" Text="Kjøper" runat="server"></asp:Label></label>
                            </div>
                              <div class="three wide field">
                           <asp:TextBox ID="TextBox7" runat="server" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                                  </div>
                              <div class="ten wide field">
                           <asp:TextBox ID="TextBox10" runat="server" Enabled="false" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                                  </div>
                           
                        </div>
                        <div class=" fields">
                           <div class="three wide field">
                                <label>
                                    <asp:Label ID="Label31" Text="Leasing" runat="server"></asp:Label></label>
                            </div>
                              <div class="three wide field">
                           <asp:TextBox ID="TextBox11" runat="server" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                                  </div>
                              <div class="ten wide field">
                           <asp:TextBox ID="TextBox12" runat="server" Enabled="false" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                                  </div>
                           
                        </div>
                        <div class=" fields">
                           <div class="three wide field">
                                <label>
                                    <asp:Label ID="Label32" Text="Fører" runat="server"></asp:Label></label>
                            </div>
                              <div class="three wide field">
                           <asp:TextBox ID="TextBox13" runat="server" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                                  </div>
                              <div class="ten wide field">
                           <asp:TextBox ID="TextBox14" runat="server" Enabled="false" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                                  </div>
                           
                        </div>
                        
                    </div>
                </div>
                <div class="six wide column">
                    <div class="ui form">
                        <div class=" fields">
                            <h3>Faktura stiles til</h3>
                            
                            </div>
                          <div class=" fields">

                    <div class="five wide field">
                                           
                                  <div class="grouped fields">
                                    <label>Lager</label>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" checked="checked" />
                                        <label>Eier</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" />
                                        <label>Kjøper</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" />
                                        <label>Leasing</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" />
                                        <label>Fører</label>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                   <div class="five wide field">            
                                  <div class="grouped fields">
                                    <label>Verksted</label>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" checked="checked" />
                                        <label>Eier</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" />
                                        <label>Kjøper</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" />
                                        <label>Leasing</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" />
                                        <label>Fører</label>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                   <div class="five wide field">            
                                  <div class="grouped fields">
                                    <label>Bilsalg</label>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" checked="checked" />
                                        <label>Eier</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" />
                                        <label>Kjøper</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2">
                                        <label>Leasing</label>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="ui radio checkbox">
                                        <input type="radio" name="example2" />
                                        <label>Fører</label>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                    </div>
               
                </div>
            </div>
                </div>
            </div>
        <div class="actions">
            <div class="ui button ok positive" id="Div1" runat="server">Lagre</div>
            <div class="ui button cancel negative">Avbryt</div>
        </div>
    

    </div>

    <div id="modOffer" class="ui modal">
        <i class="close icon"></i>
        <div class="header">
            Send tilbud til kunde
        </div>
        <div class="content">
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                          <div class=" fields">
                           <div class="two wide field">
                                <label>
                                    <asp:Label ID="lblOfferText" Text="Tekst" runat="server"></asp:Label></label>
                            </div>
                              <div class="ten wide field">
                            <textarea id="txtOfferText" class="CarsBoxes" runat="server" style="height:100px;width:100%"></textarea>
                                  </div>
                        </div>
                        <div class=" fields">
                            <div class="two wide field">
                                <label>
                                    <asp:Label ID="lblOfferAmount" Text="Beløp" runat="server"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtOfferAmount" runat="server" meta:resourcekey="txtJobIdResource1"></asp:TextBox>
                            </div>
                           
                        </div>
                        
                    </div>
                </div>
            </div>

        </div>
        <div class="actions">
            <div class="ui button ok positive" id="btnBargain" runat="server">Send Tilbud</div>
            <div class="ui button cancel negative">Avbryt</div>
        </div>
    </div>
    <div class="ui first coupled modal" id="modScheme">
        <div class="ui blue top medium header center aligned" style="text-align: center;">Tilhenger etc.</div>
        <div class="content">
            <div class="ui form ">
                
            <div class="ui grid">
                <div class="two wide column"></div>
                <div class="twelve wide column">
                    <div class="ui form">
                        <div class="fields">
                            <table class="ui celled structured table" id="xtraCheckTable" style="height: 80%; text-align:center">
                                <thead style="text-align:center">
                                    <tr>
                                        <th colspan="2">BilXtra - Gratis Xtrasjekk</th>
                                        <th style="background-color: #ff6666; width:120px;">Bør utbedres</th>
                                        <th style="background-color: #FFFF55; width:120px;">Under oppsyn</th>
                                        <th style="background-color: #00CC00; width:120px;">OK</th>
                                        <th style="width:120px;">Anm.</th>
                                        <th style="width:120px;">SMS</th>
                                    </tr>
                                </thead>
                                <tbody style="text-align:center">
                                    <tr>
                                        <td>Motorolje</td>
                                        <td>Nivå</td>
                                        <td id="engineOilBad" >
                                            <i class="XtraCheck engineOil bad" id="engineOilBadBox"></i>
                                        </td>
                                        <td id="engineOilOK">
                                           <i class="XtraCheck engineOil okXtra" id="engineOilOKBox"></i>
                                        </td>
                                        <td id="engineOilGood">
                                            <i class="XtraCheck engineOil good" id="engineOilGoodBox"></i>
                                        </td>
                                        <td id="engineOilAnnot">
                                            <i class="XtraCheck engineOil annot"  id="engineOilAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="engineOilSMS">
                                            <i class="XtraCheck engineOil" id="engineOilSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td rowspan="2">Frostvæske</td>
                                        <td>Nivå</td>
                                        <td id="cFLevelBad" >
                                            <i class="XtraCheck cFLevel bad" id="cFLevelBadBox"></i>
                                        </td>
                                        <td id="cFLevelOK">
                                            <i class="XtraCheck cFLevel okXtra" id="cFLevelOKBox"></i>
                                        </td>
                                        <td id="cFLevelGood">
                                            <i class="XtraCheck cFLevel good" id="cFLevelGoodBox"></i>
                                        </td>
                                        <td id="cFLevelAnnot">
                                            <i class="XtraCheck cFLevel annot" id="cFLevelAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="cFlevelSMS">
                                            <i class="XtraCheck cFLevel" id="cFLEVELSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Frysepunkt</td>
                                        <td id="cFTempBad" >
                                            <i class="XtraCheck cFTemp bad" id="cFTempBadBox"></i>
                                        </td>
                                        <td id="cFTempOK">
                                            <i class="XtraCheck cFTemp okXtra" id="cFTempOKBox"></i>
                                        </td>
                                        <td id="cFTempGood">
                                            <i class="XtraCheck cFTemp good" id="cFTempGoodBox"></i>
                                        </td>
                                        <td id="cfTempAnnot">
                                            <i class="XtraCheck cFTemp annot" id="cfTempAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="cFtempSMS">
                                            <i class="XtraCheck cFTemp" id="cFTempSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Bremsevæske</td>
                                        <td>Nivå</td>
                                        <td id="brakeFluidBad" >
                                            <i class="XtraCheck brakeFluid bad"  id="brakeFluidBadBox"></i>
                                        </td>
                                        <td id="brakeFluidOK">
                                            <i class="XtraCheck brakeFluid okXtra" id="brakeFluidOKBox"></i>
                                        </td>
                                        <td id="brakeFluidGood">
                                            <i class="XtraCheck brakeFluid good" id="brakeFluidGoodBox"></i>
                                        </td>
                                        <td id="brakeFluidAnnot">
                                            <i class="XtraCheck brakeFluid annot" id="brakeFluidAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="brakeFluidSMS">
                                            <i class="XtraCheck brakeFluid" id="brakeFluidSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Batteri</td>
                                        <td>Nivå</td>
                                        <td id="batteryBad" >
                                            <i class="XtraCheck battery bad" id="batteryBadBox"></i>
                                        </td>
                                        <td id="batteryOK">
                                            <i class="XtraCheck battery okXtra" id="batteryOKBox"></i>
                                        </td>
                                        <td id="batteryGood">
                                            <i class="XtraCheck battery good" id="batteryGoodBox"></i>
                                        </td>
                                        <td id="batteryAnnot">
                                            <i class="XtraCheck battery annot" id="batteryAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="batterySMS">
                                            <i class="XtraCheck battery" id="batterySMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td rowspan="2">Vindusvisker</td>
                                        <td>Foran</td>
                                        <td id="vipesFrontBad" ">
                                            <i class="XtraCheck vipesFront bad" id="vipesFrontBadBox"></i>
                                        </td>
                                        <td id="vipesFrontOK">
                                            <i class="XtraCheck vipesFront okXtra" id="vipesFrontOKBox"></i>
                                        </td>
                                        <td id="vipesFrontGood">
                                            <i class="XtraCheck vipesFront good" id="vipesFrontGoodBox"></i>
                                        </td>
                                        <td id="vipesFrontAnnot">
                                            <i class="XtraCheck vipesFront annot" id="vipesFrontAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="vipesFrontSMS">
                                            <i class="XtraCheck vipesFront" id="vipesFrontSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Bak</td>
                                        <td id="vipesBackBad">
                                            <i class="XtraCheck vipesBack bad" id="vipesBackBadBox"></i>
                                        </td>
                                        <td id="vipesBackOK">
                                            <i class="XtraCheck vipesBack okXtra" id="vipesBackOKBox"></i>
                                        </td>
                                        <td id="vipesBackGood">
                                            <i class="XtraCheck vipesBack good" id="vipesBackGoodBox"></i>
                                        </td>
                                        <td id="vipesBackAnnot">
                                            <i  class="XtraCheck vipesBack annot" id="vipesBackAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="vipesBackSMS">
                                            <i class="XtraCheck vipesBack" id="vipesBackSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td rowspan="2">Lyspærer</td>
                                        <td>Foran</td>
                                        <td id="lightsFrontBad" >
                                            <i class="XtraCheck lightsFront bad" id="lightsFrontBadBox"></i>
                                        </td>
                                        <td id="lightsFrontOK">
                                            <i class="XtraCheck lightsFront okXtra" id="lightsFrontOKBox"></i>
                                        </td>
                                        <td id="lightsFrontGood">
                                            <i class="XtraCheck lightsFront good" id="lightsFrontGoodBox"></i>
                                        </td>
                                        <td id="lightsFrontAnnot">
                                            <i class="XtraCheck lightsFront annot" id="lightsFrontAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="lightsFrontSMS">
                                            <i class="XtraCheck lightsFront" id="lightsFrontSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Bak</td>
                                        <td id="lightsBackBad" >
                                            <i class="XtraCheck lightsBack bad" id="lightsBackBadBox"></i>
                                        </td>
                                        <td id="lightsBackOK">
                                            <i class="XtraCheck lightsBack okXtra" id="lightsBackOKBox"></i>
                                        </td>
                                        <td id="lightsBackGood">
                                            <i class="XtraCheck lightsBack good" id="lightsBackGoodBox"></i>
                                        </td>
                                        <td id="lightsBackAnnot">
                                            <i class="XtraCheck lightsBack annot" id="lightsBackAnnotIcon"></i>
                                        </td>
                                       <td class="SMSXTRACHECK" id="lightsBackSMS">
                                            <i class="XtraCheck lightsBack" id="lightsBackSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td rowspan="2">Støtdempere</td>
                                        <td>Foran</td>
                                        <td id="bumperFrontBad" >
                                            <i class="XtraCheck bumperFront bad" id="bumperFrontBadBox"></i>
                                        </td>
                                        <td id="bumperFrontOK">
                                            <i  class="XtraCheck bumperFront okXtra" id="bumperFrontOKBox"></i>
                                        </td>
                                        <td id="bumperFrontGood">
                                            <i class="XtraCheck bumperFront good" id="bumperFrontGoodBox"></i>
                                        </td>
                                        <td id="bumperFrontAnnot">
                                            <i class="XtraCheck bumperFront annot" id="bumperFrontAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="bumperFrontSMS">
                                            <i class="XtraCheck bumperFront" id="bumperFrontSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Bak</td>
                                        <td id="bumperBackBad">
                                            <i class="XtraCheck bumperBack bad" id="bumperBackBadBox"></i>
                                        </td>
                                        <td id="bumperBackOK">
                                            <i class="XtraCheck bumperBack okXtra" id="bumperBackOKBox"></i>
                                        </td>
                                        <td id="bumperBackGood">
                                            <i class="XtraCheck bumperBack good" id="bumperBackGoodBox"></i>
                                        </td>
                                        <td id="bumperBackAnnot">
                                            <i class="XtraCheck bumperBack annot" id="bumperBackAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="bumperBackSMS">
                                            <i class="XtraCheck bumperBack" id="bumperBackSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td rowspan="2">Dekk</td>
                                        <td>Foran</td>
                                        <td id="tiresFrontBad" >
                                            <i  class="XtraCheck tiresFront bad" id="tiresFrontBadBox"></i>
                                        </td>
                                        <td id="tiresFrontOK">
                                            <i class="XtraCheck tiresFront okXtra" id="tiresFrontOKBox"></i>
                                        </td>
                                        <td id="tiresFrontGood">
                                            <i class="XtraCheck tiresFront good" id="tiresFrontGoodBox"></i>
                                        </td>
                                        <td id="tiresFrontAnnot">
                                            <i class="XtraCheck tiresFront annot" id="tiresFrontAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="tiresFrontSMS">
                                            <i class="XtraCheck tiresFront" id="tiresFrontSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Bak</td>
                                        <td id="tiresBackBad" >
                                            <i class="XtraCheck tiresBack bad" id="tiresBackBadBox"></i>
                                        </td>
                                        <td id="tiresBackOK">
                                            <i class="XtraCheck tiresBack okXtra" id="tiresBackOKBox"></i>
                                        </td>
                                        <td id="tiresBackGood">
                                            <i class="XtraCheck tiresBack good" id="tiresBackGoodBox"></i>
                                        </td>
                                        <td id="tiresBackAnnot">
                                            <i class="XtraCheck tiresBack annot" id="tiresBackAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="tiresBackSMS">
                                            <i class="XtraCheck tiresBack" id="tiresBackSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Forstilling</td>
                                        <td></td>
                                        <td id="suspensionFrontBad" >
                                            <i class="XtraCheck suspensionFront bad" id="suspensionFrontBadBox"></i>
                                        </td>
                                        <td id="suspensionFrontOK">
                                            <i class="XtraCheck suspensionFront okXtra" id="suspensionFrontOKBox"></i>
                                        </td>
                                        <td id="suspensionFrontGood">
                                            <i class="XtraCheck suspensionFront good" id="suspensionFrontGoodBox"></i>
                                        </td>
                                        <td id="suspensionFrontAnnot">
                                            <i class="XtraCheck suspensionFront annot" id="suspensionFrontAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="suspensionFrontSMS">
                                            <i class="XtraCheck suspensionFront" id="suspensionFrontSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Bakstilling</td>
                                        <td></td>
                                        <td id="suspensionBackBad">
                                            <i class="XtraCheck suspensionBack bad" id="suspensionBackBadBox"></i>
                                        </td>
                                        <td id="suspensionBackOK">
                                            <i class="XtraCheck suspensionBack okXtra" id="suspensionBackOKBox"></i>
                                        </td>
                                        <td id="suspensionBackGood">
                                            <i class="XtraCheck suspensionBack good" id="suspensionBackGoodBox"></i>
                                        </td>
                                        <td id="suspensionBackAnnot">
                                            <i class="XtraCheck suspensionBack annot" id="suspensionBackAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="suspensionBackSMS">
                                            <i class="XtraCheck suspensionBack" id="suspensionBackSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td rowspan="2">Bremser</td>
                                        <td>Klosser foran</td>
                                        <td id="brakesFrontBad">
                                            <i class="XtraCheck brakesFront bad" id="brakesFrontBadBox"></i>
                                        </td>
                                        <td id="brakesFrontOK">
                                            <i class="XtraCheck brakesFront okXtra" id="brakesFrontOKBox"></i>
                                        </td>
                                        <td id="brakesFrontGood">
                                            <i class="XtraCheck brakesFront good" id="brakesFrontGoodBox"></i>
                                        </td>
                                        <td id="brakesFrontAnnot">
                                            <i class="XtraCheck brakesFront annot" id="brakesFrontAnnotIcon"></i>
                                        </td>
                                       <td class="SMSXTRACHECK" id="brakesFrontSMS">
                                            <i class="XtraCheck brakesFront" id="brakesFrontSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Klosser bak</td>
                                        <td id="brakesBackBad">
                                            <i class="XtraCheck brakesBack bad" id="brakesBackBadBox"></i>
                                        </td>
                                        <td id="brakesBackOK">
                                            <i class="XtraCheck brakesBack okXtra" id="brakesBackOKBox"></i>
                                        </td>
                                        <td id="brakesBackGood">
                                            <i class="XtraCheck brakesBack good" id="brakesBackGoodBox"></i>
                                        </td>
                                        <td id="brakesBackAnnot">
                                            <i class="XtraCheck brakesBack annot" id="brakesBackAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="brakesBackSMS">
                                            <i class="XtraCheck brakesBack" id="brakesBackSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Eksosanlegg</td>
                                        <td></td>
                                        <td id="exhaustBad" >
                                            <i class="XtraCheck exhaust bad" id="exhaustBadBox"></i>
                                        </td>
                                        <td id="exhaustOK">
                                            <i class="XtraCheck exhaust okXtra" id="exhaustOKBox"></i>
                                        </td>
                                        <td id="exhaustGood">
                                            <i class="XtraCheck exhaust good" id="exhaustGoodBox"></i>
                                        </td>
                                        <td id="exhaustAnnot">
                                            <i class="XtraCheck exhaust annot" id="exhaustAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="exhaustSMS">
                                            <i class="XtraCheck exhaust" id="exhaustSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td rowspan="2">Tetthet</td>
                                        <td>Motor</td>
                                        <td id="sealedEngineBad" >
                                            <i class="XtraCheck engine bad" id="sealedEngineBadBox"></i>
                                        </td>
                                        <td id="sealedEngineOK">
                                            <i class="XtraCheck engine okXtra"  id="sealedEngineOKBox"></i>
                                        </td>
                                        <td id="sealedEngineGood">
                                            <i class="XtraCheck engine good"  id="sealedEngineGoodBox"></i>
                                        </td>
                                        <td id="sealedEngineAnnot">
                                            <i class="XtraCheck annot" id="sealedEngineAnnotIcon"></i>
                                        </td>
                                        <td class="SMSXTRACHECK" id="sealedEngineSMS">
                                            <i id="sealedEngineSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Girkasse</td>
                                        <td id="sealedGearboxBad" >
                                            <i class="XtraCheck engine bad"  id="sealedGearboxBadBox"></i>
                                        </td>
                                        <td id="sealedGearboxOK">
                                            <i class="XtraCheck engine okXtra"  id="sealedGearboxOKBox"></i>
                                        </td>
                                        <td id="sealedGearboxGood">
                                            <i class="XtraCheck engine good" id="sealedGearboxGoodBox"></i>
                                        </td>
                                        <td id="sealedGearboxAnnot">
                                             <i class="XtraCheck annot" id="sealedGearboxAnnotIcon"></i>
                                        </td>
                                       <td class="SMSXTRACHECK" id="sealedGearboxSMS">
                                            <i id="sealedGearboxSMSBox"></i>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="7">
                                            <label>Beskrivelse</label>
                                             <textarea id="generalAnnotation" class="CarsBoxes" style="height:100px;width:100%"></textarea>
                                           
                                        </td>
                                    </tr>
                                    
                                </tbody>



                            </table>
                            
                        </div>
                    </div>
                </div>
                <div class="two wide column"></div>
            </div>
               
        </div>
                
        </div>
        <div class="actions">
            <div class="ui blue right labeled icon button" id="btn_elin_xtracheck_get">
                 <div>Hent</div>

                <i class="checkmark icon"></i>
                 </div>
            <div class="ui orange right labeled icon button" id="btn_elin_xtracheck">
                 <div>App</div>

                <i class="checkmark icon"></i>
                 </div>
             <div class="ui positive right labeled icon button" id="btn_save_xtracheck">
                 <div>Lagre</div>

                <i class="checkmark icon"></i>
                 </div>
            <div class="ui black right labeled icon button" id="btn_print_xtracheck">
                 <div>skriv ut</div>

                <i class="checkmark icon"></i>
                 </div>
            <div class="ui cancel button">Lukk</div>
        </div>
    </div>



      <%-- POP UP BOXES FOR ANNOTATION ON THE BILXTRA fORM TAB  --%>
    <div id="modEngineOil" class="ui small two coupled modal" style="z-index: 5002 !important;">
        <div class="modHeader">
            <h2>Annotation on Engine Oil</h2>
            <div class="modCloseEngineOil"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Engine Oil</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            <textarea id="txtFormengineOilAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormEngineOilAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormEngineOilAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveEngineOilAnnot" value="Lagre" />
                                </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modcFLevel" class="ui small three coupled modal">
        <div class="modHeader">
            <h2>Annotation on cold fluid level</h2>
            <div class="modClosecFLevel"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on cold fluid level</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            <textarea id="txtFormcFLevelAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormcFLevelAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormcFLevelAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSavecFLevelAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modcfTemp" class="ui small four coupled modal">
        <div class="modHeader">
            <h2>Annotation on cold fluid temperature</h2>
            <div class="modClosecfTemp"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on cold fluid temperature</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormcfTempAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormcfTempAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormcfTempAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSavecfTempAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modbrakeFluid" class="ui small five coupled modal">
        <div class="modHeader">
            <h2>Annotation on brake fluid level</h2>
            <div class="modCloseBrakeFluid"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on brake fluid level</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormbrakeFluidAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormBrakeFluidAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormBrakeFluidAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveBrakeFluidAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modBattery" class="ui small six coupled modal">
        <div class="modHeader">
            <h2>Annotation on battery</h2>
            <div class="modCloseBattery"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on battery</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormbatteryAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormBatteryAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormBatteryAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveBatteryAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modVipesFront" class="ui small seven coupled modal">
        <div class="modHeader">
            <h2>Annotation on vipes front</h2>
            <div class="modCloseVipesFront"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on vipes front</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormvipesFrontAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormVipesFrontAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormVipesFrontAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveVipesFrontAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modVipesBack" class="ui small eight coupled modal">
        <div class="modHeader">
            <h2>Annotation on vipes back</h2>
            <div class="modCloseVipesBack"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on vipes back</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormvipesBackAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormVipesBackAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormVipesBackAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveVipesBackAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modLightsFront" class="ui small nine coupled modal">
        <div class="modHeader">
            <h2>Annotation on lights front</h2>
            <div class="modCloseLightsFront"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on lights front</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormlightsFrontAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormLightsFrontAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormLightsFrontAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveLightsFrontAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modLightsBack" class="ui small ten coupled modal">
        <div class="modHeader">
            <h2>Annotation on lights back</h2>
            <div class="modCloseLightsBack"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on lights back</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormlightsBackAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormLightsBackAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormLightsBackAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveLightsBackAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modBumperFront" class="ui small eleven coupled modal">
        <div class="modHeader">
            <h2>Annotation on lights front</h2>
            <div class="modCloseBumperFront"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Bumper front</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormbumperFrontAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormBumperFrontAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormBumperFrontAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveBumperFrontAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modBumperBack" class="ui small twelve coupled modal">
        <div class="modHeader">
            <h2>Annotation on Bumper back</h2>
            <div class="modCloseBumperBack"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Bumper back</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormbumperBackAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormBumperBackAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormBumperBackAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveBumperBackAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modTiresFront" class="ui small thirteen coupled modal">
        <div class="modHeader">
            <h2>Annotation on Tires front</h2>
            <div class="modCloseTiresFront"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Tires front</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormtiresFrontAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormTiresFrontAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormTiresFrontAnnotResource1" CssClass="CarsBoxes"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveTiresFrontAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modTiresBack" class="ui small fourteen coupled modal">
        <div class="modHeader">
            <h2>Annotation on Tires back</h2>
            <div class="modCloseTiresBack"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Tires back</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormtiresBackAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormTiresBackAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormTiresBackAnnotResource1"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveTiresBackAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modSuspensionFront" class="ui small fifteen coupled modal">
        <div class="modHeader">
            <h2>Annotation on Suspension front</h2>
            <div class="modCloseSuspensionFront"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Suspension front</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormsuspensionFrontAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormSuspensionFrontAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormSuspensionFrontAnnotResource1"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveSuspensionFrontAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modSuspensionBack" class="ui small sixteen coupled modal">
        <div class="modHeader">
            <h2>Annotation on Suspension back</h2>
            <div class="modCloseSuspensionBack"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Suspension back</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormsuspensionBackAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormSuspensionBackAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormSuspensionBackAnnotResource1"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveSuspensionBackAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modBrakesFront" class="ui small seventeen coupled modal">
        <div class="modHeader">
            <h2>Annotation on Brakes front</h2>
            <div class="modCloseBrakesFront"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Brakes front</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormbrakesFrontAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormBrakesFrontAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormBrakesFrontAnnotResource1"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveBrakesFrontAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modBrakesBack" class="ui small eighteen coupled modal">
        <div class="modHeader">
            <h2>Annotation on Brakes back</h2>
            <div class="modCloseBrakesBack"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Brakes back</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormbrakesBackAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormBrakesBackAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormBrakesBackAnnotResource1"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveBrakesBackAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modExhaust" class="ui small nineteen coupled modal">
        <div class="modHeader">
            <h2>Annotation on Exhaust</h2>
            <div class="modCloseExhaust"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Exhaust</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormexhaustAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormExhaustAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormExhaustAnnotResource1"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveExhaustAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modSealedEngine" class="ui small twenty coupled modal">
        <div class="modHeader">
            <h2>Annotation on Sealed Engine</h2>
            <div class="modCloseSealedEngine"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Sealed Engine</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormsealedEngineAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormSealedEngineAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormSealedEngineAnnotResource1"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveSealedEngineAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modSealedGearbox" class="ui small twentyone coupled modal">
        <div class="modHeader">
            <h2>Annotation on Sealed Gearbox</h2>
            <div class="modCloseSealedGearbox"><i class="remove icon"></i></div>
        </div>
        <div class="ui form">
            <div class="field">
                <label class="sr-only">Annotation on Sealed Gearbox</label>
            </div>
        </div>
        <div class="ui grid">
            <div class="one wide column"></div>
            <div class="twelve wide column">
                <div class="ui form">
                    <div class="fields">
                        <label>
                            <h3>Note:</h3>
                        </label>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <textarea id="txtFormsealedGearboxAnnot" class="CarsBoxes" style="height:100px;width:400px"></textarea>
                            <%--<asp:TextBox ID="txtFormSealedGearboxAnnot" TextMode="MultiLine" runat="server" meta:resourcekey="txtFormSealedGearboxAnnotResource1"></asp:TextBox>--%>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                             <div class="actions">
                            <input type="button" class="ui approve button" id="btnSaveSealedGearboxAnnot" value="Lagre" />
                                 </div>
                        </div>
                    </div>
                    <div class="fields">
                        <div class="sixteen wide field">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <%-- END OF POP UP BOXES FOR ANNOTATION ON THE BILXTRA fORM TAB  --%>


    <div id="modSpare" class="ui modal" style="width: 1000px; height: 700px; overflow: scroll;">
        <i class="close icon"></i>
        <div class="header">
            Add Spares
        </div>
        <div class="content">
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="inline fields">
                            <div class="two wide field">
                                <label>
                                    <asp:Label ID="lblSPSearch" Text="Spare Search" runat="server" meta:resourcekey="lblSPSearchResource1"></asp:Label></label>
                            </div>
                            <div>
                                <%--<asp:TextBox ID="txtSPSearch" runat="server" style="width:200px"></asp:TextBox>--%>
                                <input id="txtSPSearch" type="text" style="width: 200px" />
                            </div>
                            <div class="two wide field">
                                <input type="button" id="btnSearchSpares" runat="server" value="Search" class="ui btn mini" />
                            </div>
                        </div>
                        <div id="divSPGrid">
                            <div class="inline fields">
                                <!-- Grid--->
                                <table id="dgdSpareGrid"></table>
                                <div id="pagerSpareGrid"></div>
                            </div>
                        </div>
                        <div id="divSelSPGrid">
                            <div class="inline fields">
                                <!-- Grid--->
                                <table id="dgdSelectedSPGrid"></table>
                                <div id="pagerSelectedSPGrid"></div>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="two wide field">
                                <label>
                                    <asp:Label ID="lblSrchMake" Text="Make" runat="server" meta:resourcekey="lblSrchMakeResource1" Visible="false"></asp:Label></label>
                            </div>
                            <div style="width:180px">
                                <%--<input id="txtSrchMake" type="text" style="width: 200px; border: none" />--%>
                                <select id="selMake" runat="server" name="skills" multiple="true" class="ui fluid search dropdown " visible="false"></select>
                            </div>                                                      
                        </div>
                        <div class="inline fields">
                            <div class="two wide field">
                                <label>
                                    <asp:Label ID="lblSrchSupplier" Text="Supplier" runat="server" meta:resourcekey="lblSrchSupplierResource1"></asp:Label></label>
                            </div>
                            <div style="width:180px">
                                <%--<input id="txtSrchSuppler" type="text" style="width: 200px; border: none" />--%>
                                <select id="selSupp" runat="server" name="skills" multiple="true" class="ui fluid search dropdown "></select>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="two wide field">
                                <label>
                                    <asp:Label ID="lblSrchLocation" Text="Location" runat="server" meta:resourcekey="lblSrchLocationResource1"></asp:Label></label>
                            </div>
                            <div style="width:180px">
                                <%--<input id="txtSrchLocation" type="text" style="width: 200px; border: none" />--%>
                                <select id="selLoc" runat="server" name="skills" multiple="true" class="ui fluid search dropdown "></select>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkSPStkQty" runat="server" Text="Kun varer m/beholdning"  Checked="True" meta:resourcekey="chkSPStkQtyResource1" />
                            </div>
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkFlgStockItem" runat="server" Text="Kun varer m/ beh. Kontr." Checked="True" meta:resourcekey="chkFlgStockItemResource1"  />
                            </div>
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkFlgNonStockItem" runat="server" Text="Kun varer u/beh. Kontr" Checked="True" meta:resourcekey="chkFlgNonStockItemResource1"  />
                            </div>                         
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkSaveSprSettings" runat="server" Text="Save Spr Settings" meta:resourcekey="chkSaveSprSettingsResource1" />
                            </div>
                        </div>
                        <div class="actions">
                            <div class="ui button ok positive">Ok</div>
                            <div class="ui button cancel negative">Avbryt</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Labourline popup -->
    <div id="modLabPopup" class="ui modal" style="width: 800px; height: 500px; overflow: scroll;">
        <i class="close icon"></i>
        <div class="header">
            LabourLine
        </div>
        <div class="content">
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        
                        <div class="inline fields">
                            <!-- Grid--->
                            <table id="dgdLabLine"></table>
                            <div id="pagerLabLine"></div>
                        </div>
                      
                        <div class="inline fields">
                             <div class="ten wide field">
                                <asp:TextBox ID="txtLabDesc" runat="server" meta:resourcekey="txtLabDescResource1"></asp:TextBox>
                            </div>                                                     
                        </div>
                        <div class="inline fields">
                            <div class="two wide field">
                                <label>
                                    <asp:Label ID="lblMId" Text="MechId" runat="server" meta:resourcekey="lblMIdResource1"></asp:Label></label>
                            </div>
                            <div class="two wide field">
                                 <asp:TextBox ID="txtMId" runat="server" meta:resourcekey="txtMIdResource1"></asp:TextBox>
                            </div>
                            <div class="four wide field">
                                 <label>
                                    <asp:Label ID="LblMName" runat="server" meta:resourcekey="LblMNameResource1"></asp:Label></label>
                            </div>
                            <div class="two wide field">
                            </div>
                             <div class="two wide field">
                                 <label>
                                    <asp:Label ID="lblLabFord" Text="Ford %" runat="server" meta:resourcekey="lblLabFordResource1"></asp:Label></label>
                            </div>
                            <div class="two wide field">
                                <asp:TextBox ID="txtLabFord" runat="server" ReadOnly="True" meta:resourcekey="txtLabFordResource1"></asp:TextBox>
                            </div>

                        </div>
                        <div class="inline fields">
                            <div class="two wide field">
                                     <label><asp:Label ID="lblMech" Text="Mekaniker" runat="server" meta:resourcekey="lblMechResource1"></asp:Label></label>
                            </div>
                            <div class="four wide field">
                                  <asp:DropDownList ID="ddlmechList" CssClass="dropdowns" runat="server" meta:resourcekey="ddlmechListResource1"></asp:DropDownList>

                            </div>
                            <div class="four wide field">
                                 <label>
                                    <asp:Label ID="Label17" runat="server" meta:resourcekey="Label17Resource1"></asp:Label></label>
                            </div>
                            <div class="two wide field">
                                 <label>
                                    <asp:Label ID="lblLab" Text="Avtalenr" runat="server" meta:resourcekey="lblLabResource1"></asp:Label></label>
                            </div>
                            <div class="two wide field">
                                <asp:TextBox ID="TextBox1" runat="server" meta:resourcekey="TextBox1Resource1"></asp:TextBox>
                            </div>
                        </div>                        
                        <div class="fields">
                             <div class="field">
                                 <div class="ui radio checkbox">                                    
                                    <asp:RadioButton ID="rbClkOut" GroupName="dpStatus" runat="server" Text="Stemplet ut" meta:resourcekey="rbClkOutResource1"  />    
                                 </div>
                                 <div class="ui radio checkbox">
                                     <asp:RadioButton ID="rbComp" GroupName="dpStatus" runat="server" Text="Ferdig" meta:resourcekey="rbCompResource1"  />
                                 </div>
                             </div>                        
                        </div>                        
                        <div class="twelve fields">
                         <asp:Label ID="lblStdTime" runat="server" Text="Fakt.Tid" Width="70px" meta:resourcekey="lblStdTimeResource1"></asp:Label>
                        <asp:Label ID="Label10" runat="server" Width="80px" meta:resourcekey="Label10Resource1"></asp:Label>
                         <asp:Label ID="lblClkTime" runat="server" Text="Brukt tid" Width="80px" meta:resourcekey="lblClkTimeResource1"></asp:Label>
                            <asp:Label ID="Label11" runat="server" Width="80px" meta:resourcekey="Label11Resource1"></asp:Label>
                        <asp:Label ID="lblLabSalesPr" runat="server" Text="Salgsprice" Width="80px" meta:resourcekey="lblLabSalesPrResource1"></asp:Label>
                            <asp:Label ID="Label12" runat="server" Width="80px" meta:resourcekey="Label12Resource1"></asp:Label>
                        <asp:Label ID="lblLabDiscpercent" runat="server" Text="Rabatt%" Width="80px" meta:resourcekey="lblLabDiscpercentResource1"></asp:Label>
                            <asp:Label ID="Label14" runat="server" Width="80px" meta:resourcekey="Label14Resource1"></asp:Label>
                        <asp:Label ID="lblLabAmt" runat="server" Text="Belop" Width="60px" meta:resourcekey="lblLabAmtResource1"></asp:Label>
                        <asp:Label ID="lblDiscAmt" runat="server" Width="60px" meta:resourcekey="lblDiscAmtResource1"></asp:Label>
                        </div>
                        <div class="twelve fields">
                             <asp:TextBox ID="txtStdTime" runat="server" Width="70px" meta:resourcekey="txtStdTimeResource1"></asp:TextBox>
                            <asp:Label ID="Label16" runat="server" Width="80px" meta:resourcekey="Label16Resource1"></asp:Label>
                             <asp:TextBox ID="txtClkTime" runat="server" Width="80px" ReadOnly="True" meta:resourcekey="txtClkTimeResource1"></asp:TextBox>
                            <asp:Label ID="Label18" runat="server" Width="80px" meta:resourcekey="Label18Resource1"></asp:Label>
                            <asp:TextBox ID="txtLabSalesPr" runat="server" Width="80px" meta:resourcekey="txtLabSalesPrResource1" ></asp:TextBox>
                            <asp:Label ID="Label19" runat="server" Width="80px" meta:resourcekey="Label19Resource1"></asp:Label>
                            <asp:TextBox ID="txtLabDiscPer" runat="server" Width="80px" meta:resourcekey="txtLabDiscPerResource1" ></asp:TextBox>
                            <asp:Label ID="Label20" runat="server" Width="80px" meta:resourcekey="Label20Resource1"></asp:Label>
                            <asp:TextBox ID="txtLabTotalAmt" runat="server" Width="60px" ReadOnly="True" meta:resourcekey="txtLabTotalAmtResource1"></asp:TextBox>
                             <asp:TextBox ID="txtDiscAmt" runat="server" Width="60px" Visible="False" ReadOnly="True" meta:resourcekey="txtDiscAmtResource1"></asp:TextBox>
                            
                        </div>
                        
                        <div class="actions">
                            <div class="ui button ok positive">Ok</div>
                            <div class="ui button cancel negative">Avbryt</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div id="modEditTextLine" class="ui modal" style="width: 1000px; height: 700px; overflow: scroll;">
        <i class="close icon"></i>
        <div class="header">
            Edit Text Line
        </div>
        <div class="content">
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="inline fields">
                            <div class="two wide field">
                                <label>
                                    <asp:Label ID="lblOrdTextLine" Text="Order Text Line" runat="server" meta:resourcekey="lblOrdTextLineResource1"></asp:Label>
                                </label>
                            </div>
                            <div>
                                <input id="txtOrdTextLine" type="text" runat="server" style="width: 200px" />
                            </div>                            
                        </div>
                        <div class="inline fields">
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkViewInv" runat="server" Text="Vis pa faktura" meta:resourcekey="chkViewInvResource1" />
                            </div>
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkTextToLab" runat="server" Text="Omgjor til arbeidslinje" meta:resourcekey="chkTextToLabResource1" />
                            </div>
                        </div>
                        <div class="actions">
                            <div class="ui button ok positive">Ok</div>
                            <div class="ui button cancel negative">Avbryt</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modEditSpareLine" class="ui modal" style="width: 1000px; height: 700px; overflow: scroll;">
        <i class="close icon"></i>
        <div class="header">
            Edit Spare Line
        </div>
        <div class="content">
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="inline fields">
                            <table id="dgdSpareLine"></table>
                            <div id="pagerSpareLine"></div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                                 <asp:Label ID="lblSpareLine" Text="Spare Part Number" runat="server" meta:resourcekey="lblSpareLineResource1"></asp:Label>
                            </div>
                            <div class="seven wide field">
                                <asp:Label ID="Label7" runat="server" meta:resourcekey="Label7Resource1"></asp:Label>
                            </div>
                            <div class="two wide field">
                                <asp:Label ID="Label8" runat="server" meta:resourcekey="Label8Resource1"></asp:Label>
                            </div>
                            <div class="two wide field">
                                 <asp:Label ID="lblSpareFord" Text="Ford %" runat="server" meta:resourcekey="lblSpareFordResource1"></asp:Label>
                            </div>                                                    
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                                <input id="txtSpareId" type="text" runat="server" readonly="true" />
                            </div>
                            <div class="seven wide field">    
                                <input id="txtSpareDesc" type="text" runat="server" readonly="true"  />
                            </div>
                            <div class="two wide field">
                                <asp:Label ID="Label9" runat="server" meta:resourcekey="Label9Resource1"></asp:Label>
                            </div>
                            <div class="one wide field">    
                                <input id="txtSpareFord" type="text" runat="server"  readonly="true" />
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                                <asp:Label ID="lblSpareQty" Text="Antail" runat="server" meta:resourcekey="lblSpareQtyResource1"></asp:Label>
                            </div>                            
                            <div class="four wide field">
                                <asp:Label ID="lblSpareCP" Text="KostPris" runat="server" meta:resourcekey="lblSpareCPResource1"></asp:Label>
                            </div>                            
                            <div class="four wide field">
                                <asp:Label ID="lblSpareSP" Text="SalgPris" runat="server" meta:resourcekey="lblSpareSPResource1"></asp:Label>
                            </div>                            
                            <div class="four wide field">
                                <asp:Label ID="lblSpareDisc" Text="Rabat %" runat="server" meta:resourcekey="lblSpareDiscResource1"></asp:Label>
                            </div>                            
                            <div class="four wide field">
                                <asp:Label ID="lblSpareAmt" Text="Belop" runat="server" meta:resourcekey="lblSpareAmtResource1"></asp:Label>
                            </div>                            
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                                <input id="txtSpareOrdQty" type="text" runat="server" style="width: 100px;" />
                            </div>
                            <div class="four wide field">
                                <input id="txtSpareCP" type="text" runat="server" style="width: 100px;" />
                            </div>
                            <div class="four wide field">
                                <input id="txtSpareSP" type="text" runat="server" style="width: 100px;" />
                            </div>
                            <div class="four wide field">
                                <input id="txtSpareDisc" type="text" runat="server" style="width: 100px;" />
                            </div>
                            <div class="four wide field">
                                <input id="txtSpareAmount" type="text" runat="server" style="width: 100px;" readonly="true" />
                            </div>
                        </div>
                        <div class="actions">
                            <div class="ui button ok positive">Ok</div>
                            <div class="ui button cancel negative">Avbryt</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="ui small modal" id="modPhoneInsurance">
        <div class="header" style="text-align: center">Phone</div>
        <div class="content">
            <div class="ui form ">
                <div class="ui  grid">
        
                <div class="sixteen wide column">
                    
                
                        <h4 class="ui dividing header">Phone</h4>
                        <div class="inline field">
                            <label for="txtInsPhonePrivate" id="lblInsPhonePrivate">
                                <asp:Literal ID="litInsPhonePrivate" runat="server" Text="Private" meta:resourcekey="litInsPhonePrivateResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsPhonePrivate" runat="server" data-cp-submit="INS_PHONE_PRIVATE" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsPhonePrivateResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtInsPhoneSwitch" id="lblInsPhoneSwitch">
                                <asp:Literal ID="Literal1" runat="server" Text="Switch" meta:resourcekey="Literal1Resource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsPhoneSwitch" runat="server" data-cp-submit="INS_PHONE_SWITCH" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsPhoneSwitchResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtInsPhoneFax" id="lblInsPhoneFax">
                                <asp:Literal ID="litInsPhoneFax" runat="server" Text="Fax" meta:resourcekey="litInsPhoneFaxResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsPhoneFax" runat="server" data-cp-submit="INS_PHONE_FAX" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsPhoneFaxResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtInsPhoneMobile" id="lblInsPhoneMobile">
                                <asp:Literal ID="litInsPhoneMobile" runat="server" Text="Mobile" meta:resourcekey="litInsPhoneMobileResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsPhoneMobile" runat="server" data-cp-submit="INS_PHONE_MOBILE" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsPhoneMobileResource1"></asp:TextBox>
                        </div>
                   
                    </div>
            </div>
                </div>

           

        </div>
        <div class="actions">
            
            <div class="ui approve success button">OK</div>
            <div class="ui cancel button">Avbryt</div>
        </div>
    </div>

    <div id="modViewDebitorTotals" class="ui modal" style="width:25%">
        <i class="close icon"></i>
        <div class="header">
            View Debitor Totals
        </div>
        <div class="content">
            
            <table id="debitors" class="ui sortable celled table">
                <thead>
                    <tr>
                        <th>Split Customer</th><th>Sum inkl.mva</th>
                    </tr>
                </thead>
                <tbody id="tbodyid">
                </tbody>
            </table>
        </div>
        <div class="actions">
            <div class="ui button okk positive">Ok</div>
        </div>
    </div>

    <div id="modCustomerLock" class="ui modal">
        <i class="close icon"></i>
        <div class="header">
            Delete Job
        </div>
        <div class="image content">
            <div class="description">
                Do you want to delete job?
            </div>
        </div>
        <div class="actions">
            <div class="ui button ok positive">Ok</div>
            <div class="ui button cancel negative">Avbryt</div>
        </div>
    </div>

    <div id="modContact" class="ui modal">
        <i class="close icon"></i>
        <div class="header">
            Delete Job
        </div>
        <div class="image content">
            <div id="desc" class="description">
                Cannot delete the job
            </div>
        </div>
        <div class="actions">
            <div class="ui button ok positive">Ok</div>
        </div>
    </div>

    <div id="modVehicleChange" class="ui modal">
        <i class="close icon"></i>
        <div class="header">
            Vehicle
        </div>
        <div class="image content">
            <div class="description">
                 <p id="mceMSG"></p>
            </div>
        </div>
        <div class="actions">
             <div class="ui button ok positive">Ok</div>
            <div class="ui button cancel negative">Avbryt</div>
        </div>
    </div>

        <div
 class="ui bottom attached tab segment" data-tab="Insurance">
    <div id="tabInsurance" >
        <div class="ui form stackable two column grid">
                <div class="thirteen wide column">



       <div class="GenGeneral">
                    <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="lblVehicleModel" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Generelt</h3>
            <div class="ui divider"></div>
                <!-- Left Column -->
                <div class="ui stackable grid ">
                <div class="ten wide column">
                    <div class="ui stackable grid ">
                        <div class="three wide field" style="min-width:110px">
                            <label for="txtInsCustID" id="lblInsCustID">
                                <asp:Literal ID="litInsCustID" runat="server" Text="Customer ID" meta:resourcekey="litInsCustIDResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsCustID" runat="server" data-submit="INS_CUST_ID"  CssClass="carsInput" meta:resourcekey="txtInsCustIDResource1"></asp:TextBox>
                        </div>
                        <div class="seven wide field">
                            <label for="txtInsCompanyName" id="lblInsCompanyName">
                                <asp:Literal ID="litInsCompanyName" runat="server" Text="Company name" meta:resourcekey="litInsCompanyNameResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsCompanyName" runat="server" data-submit="INS_COMPANY_NAME" data-required="REQUIRED" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsCompanyNameResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <label for="ddlInsContactPerson" id="lblInsContactPerson">
                                <asp:Literal ID="litInsContactPerson" runat="server" Text="Contact person" meta:resourcekey="litInsContactPersonResource1"></asp:Literal></label>
                            <asp:DropDownList ID="ddlInsContactPerson" class="dropdowns" runat="server" data-submit="INS_ID_CP" CssClass="carsInput" meta:resourcekey="ddlInsContactPersonResource1"></asp:DropDownList>
                        </div>
                        <div class="ten wide column">
                            <div class="ui stackable grid">
                                <div class="eight wide field">
                                    <label for="txtInsPostalAddress" id="lblInsPostalAddress">
                                        <asp:Literal ID="litInsPostalAddress" runat="server" Text="Postal address" meta:resourcekey="litInsPostalAddressResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtInsPostalAddress" runat="server" data-cp-submit="INS_POSTAL_ADD" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsPostalAddressResource1"></asp:TextBox>
                                </div>
                                <div class="eight wide field">
                                    <label for="txtInsVisitAddress" id="lblInsVisitAddress">
                                        <asp:Literal ID="litInsVisitAddress" runat="server" Text="Visit address" meta:resourcekey="litInsVisitAddressResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtInsVisitAddress" runat="server" data-cp-submit="INS_VISIT_ADD" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsVisitAddressResource1"></asp:TextBox>
                                </div>
                                
                            <div class="four wide field">
                                    <label for="txtInsZip" id="lblInsZip">
                                        <asp:Literal ID="litInsZip" runat="server" Text="Zip code" meta:resourcekey="litInsZipResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtInsZip" CssClass="carsInput" runat="server" data-cp-submit="INS_ZIP"  ReadOnly="True" meta:resourcekey="txtInsZipResource1"></asp:TextBox>
                                </div>
                                <div class="twelve wide field">
                                    <label for="txtZipCity" id="lblZipCity">
                                        <asp:Literal ID="litZipCity" runat="server" Text="Zip city" meta:resourcekey="litZipCityResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtZipCity" runat="server" data-cp-submit="INS_ZIP_CITY" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtZipCityResource1"></asp:TextBox>
                                </div>
                                
                            </div>
                        </div>
                        
                        
                      
                      
                        <div id="insPaymentDetails" class="ten wide column">
                        <div class="ui stackable grid">
                            <div class="four wide field">
                                <label for="txtInsSalesGroup" id="lblInsSalesGroup" >
                                    <asp:Literal ID="litInsSalesGroup" runat="server" Text="Sales group" meta:resourcekey="litInsSalesGroupResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtInsSalesGroup" runat="server" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsSalesGroupResource1"></asp:TextBox>
                            </div>
                            <div class="eight wide field">
                                <label for="txtInsPaymentTerms" id="lblInsPaymentTerms">
                                    <asp:Literal ID="litInsPaymentTerms" runat="server" Text="Payment terms" meta:resourcekey="litInsPaymentTermsResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtInsPaymentTerms" runat="server" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsPaymentTermsResource1"></asp:TextBox>
                            </div>
                            <div class="four wide field">
                                <label for="txtInsDiscount" id="lblInsDiscount">
                                    <asp:Literal ID="litInsDiscount" runat="server" Text="Discount" meta:resourcekey="litInsDiscountResource1" ></asp:Literal>
                                </label>
                                    <asp:TextBox ID="txtInsDiscount" runat="server"   CssClass="carsInput" meta:resourcekey="txtInsDiscountResource1"></asp:TextBox>
                            </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui stackable grid">
                        <div class="two wide field">
                            <label for="txtInsSplit" id="lblInsSplit">
                                <asp:Literal ID="litInsSplit" runat="server" Text="Split %" meta:resourcekey="litInsSplitResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsSplit" runat="server" Text="100 %" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsSplitResource1"></asp:TextBox>
                        </div>
                        <div class="two wide field">
                            <label for="txtInsGM" id="lblInsGM">
                                <asp:Literal ID="litInsGM" runat="server" Text="GM Sum" meta:resourcekey="litInsGMResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsGM" runat="server" Text=",00" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsGMResource1"></asp:TextBox>
                        </div>
                        <div class="three wide field">
                            <label for="txtInsEnvFee" id="lblInsEnvFee">
                                <asp:Literal ID="litInsEnvFee" runat="server" Text="Env. Fee Sum" meta:resourcekey="litInsEnvFeeResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsEnvFee" runat="server" Text=",00" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsEnvFeeResource1"></asp:TextBox>
                        </div>
                        <div class="three wide field">
                            <label for="txtInsInvFee" id="lblInsInvFee">
                                <asp:Literal ID="litInsInvFee" runat="server" Text="Inv. Fee" meta:resourcekey="litInsInvFeeResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtInsInvFee" runat="server" Text=",00" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsInvFeeResource1"></asp:TextBox>
                        </div>
                        <div class="five wide field">
                            <label>&nbsp;</label>
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkInsMoveVat" runat="server" Text="Main debtor pays VAT" data-cp-submit="INS_MOVE_VAT" meta:resourcekey="chkInsMoveVatResource1" />
                            </div>
                        </div>
                    </div>
                    <div class="ui stackable grid">
                        <div class="two wide field">
                            <input id="btnDeleteInsCust" runat="server" class="ui button" value="Delete" type="button" onclick="delInsCust()" />
                        </div>
                    </div>
                    <div class="ui stackable grid"></div>
                </div>
                <!-- End Left column /-->
                <div class="six wide column">
                    <!-- Right Column -->
                    
                    <div class="column">
                        <h4 class="ui dividing header">Reduction</h4>
                        <div class="field">
                            <div class="ui radio checkbox">
                                <asp:RadioButton ID="radInsNoReduction" GroupName="reduction" runat="server"  Checked="True" meta:resourcekey="radInsNoReductionResource1" />
                                <label>
                                    <asp:Literal ID="lblInsNoReduction" runat="server" Text="No reduction" meta:resourcekey="lblInsNoReductionResource1"></asp:Literal></label>
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui radio checkbox">
                                <asp:RadioButton ID="radInsReductioAfter" GroupName="reduction" runat="server" meta:resourcekey="radInsReductioAfterResource1" />
                                <label>
                                    <asp:Literal ID="litInsReductionAfter" runat="server" Text="Reduction after own risk" meta:resourcekey="litInsReductionAfterResource1"></asp:Literal></label>
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui radio checkbox">
                                <asp:RadioButton ID="radInsReductionBefore" GroupName="reduction" runat="server" meta:resourcekey="radInsReductionBeforeResource1"  />
                                <label>
                                    <asp:Literal ID="litInsReductionBefore" runat="server" Text="Reduction before own risk" meta:resourcekey="litInsReductionBeforeResource1"></asp:Literal></label>
                            </div>
                        </div>
                    </div>
                     <div class="fields" style="margin-top: 3rem;">


                                            <div class="four wide field">
                                                <button class="ui button carsButtonBlueInverted wide" type="button" id="btnPhoneInsurance">Phone</button>

                                            </div>
                                            
                                        </div>
                </div>
                </div>
                <!-- End Right Column /-->
         </div>
         <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H7" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Invoice</h3>
            <div class="ui divider"></div>
        
            <div class="ui stackable grid container shift-container">
                <div class="three wide column">
                    <div class="ui checkbox">
                        <asp:CheckBox ID="chkInsInvPaid" runat="server" Text="Invoice paid" data-cp-submit="INS_INV_PAID" meta:resourcekey="chkInsInvPaidResource1" />
                    </div>
                </div>
                <div class="five wide column">
                    <div class="inline field">
                        <label for="txtInsInvID" id="lblInsInvID">
                            <asp:Literal ID="litInsInvID" runat="server" Text="Invoice nr.: " meta:resourcekey="litInsInvIDResource1"></asp:Literal></label>
                        <asp:TextBox ID="txtInsInvID" runat="server" data-cp-submit="INS_INV_ID" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsInvIDResource1"></asp:TextBox>
                        <asp:Literal ID="litInsInvDate" runat="server" Text="00/00/0000" meta:resourcekey="litInsInvDateResource1"></asp:Literal>
                    </div>
                </div>
                <div class="three wide column">
                    <div class="inline field">
                        <label id="lblInvDue">
                            <asp:Literal ID="litInsInvDue" runat="server" Text="Due date: " meta:resourcekey="litInsInvDueResource1"></asp:Literal></label>
                        <asp:Literal ID="litInsInvDueDate" runat="server" Text="00/00/0000" meta:resourcekey="litInsInvDueDateResource1"></asp:Literal>
                    </div>
                </div>
                <div class="five wide column">
                    <div class="inline field">
                        <label for="txtInsInvJournal" id="lblInsInvJournal">
                            <asp:Literal ID="litInsInvJournal" runat="server" Text="Journal nr.: " meta:resourcekey="litInsInvJournalResource1"></asp:Literal></label>
                        <asp:TextBox ID="txtInsInvJournal" runat="server" data-cp-submit="INS_INV_JOURNAL" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsInvJournalResource1"></asp:TextBox>
                        <asp:Literal ID="litInsInvJournalDate" runat="server" Text="00/00/0000" meta:resourcekey="litInsInvJournalDateResource1"></asp:Literal>
                    </div>
                </div>
            </div>
       </div>
      </div>
      <div class="GenDamage">
        
         <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H6" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Skadereferanser</h3>
            <div class="ui divider"></div>
            <div class="ui stackable grid ">
                <div class="six wide column">
                 <div class="ui grid">
                    <div class="five wide field">
                        <label for="txtInsDmgID" id="lblInsDmgID">
                            <asp:Literal ID="litInsDmgID" runat="server" Text="Damage nr." meta:resourcekey="litInsDmgIDResource1"></asp:Literal></label>
                       
                    </div>
                     <div class="eleven wide field">
                     <asp:TextBox ID="txtInsDmgID" runat="server" data-cp-submit="INS_DMG_ID" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsDmgIDResource1"></asp:TextBox>
                     </div>
                    <div class="five wide field">
                        <label for="txtInsReferance" id="lblInsReferance">
                            <asp:Literal ID="litInsReferance" runat="server" Text="Referance" meta:resourcekey="litInsReferanceResource1"></asp:Literal></label>
                       
                    </div>
                    <div class="eleven wide field">
                     <asp:TextBox ID="txtInsReferance" runat="server" data-cp-submit="INS_REFERANCE" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsReferanceResource1"></asp:TextBox>
                     </div>
                    <div class="five wide field">
                        <label for="txtInsRefPhone" id="lblInsRefPhone">
                            <asp:Literal ID="litInsRefPhone" runat="server" Text="Phone" meta:resourcekey="litInsRefPhoneResource1"></asp:Literal></label>
                        
                    </div>
                    
                      <div class="eleven wide field">
                     <asp:TextBox ID="txtInsRefPhone" runat="server" data-cp-submit="INS_REF_PHONE" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsRefPhoneResource1"></asp:TextBox>
                     </div>
                    <div class="five wide field">
                        <label for="txtInsDate" id="lblInsDate">
                            <asp:Literal ID="litInsDate" runat="server" Text="Date/ time" meta:resourcekey="litInsDateResource1"></asp:Literal></label>
                       
                    </div>
                      <div class="eleven wide field">
                     <asp:TextBox ID="txtInsDate" runat="server" data-cp-submit="INS_REF_DATE" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsDateResource1"></asp:TextBox>
                     </div>
                    <div class="five wide field">
                        <label for="txtInsDBS" id="lblInsDBS">
                            <asp:Literal ID="litInsDBS" runat="server" Text="DBS" meta:resourcekey="litInsDBSResource1"></asp:Literal></label>
                       
                    </div>
                      <div class="eleven wide field">
                      <asp:TextBox ID="txtInsDBS" runat="server" data-cp-submit="INS_DBS_ID" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsDBSResource1"></asp:TextBox>
                     </div>
                </div>
                </div>

                <div class="four wide column">
                </div>
                <div class="six wide column">
                    <h4 class="ui dividing header">Invoice is addressed to</h4>
                    <div class="ui grid">
                        <div class="five wide field">
                            <label for="txtInsAddressedName" id="lblInsAddressedName">
                                <asp:Literal ID="litInsAddressedName" runat="server" Text="Name" meta:resourcekey="litInsAddressedNameResource1"></asp:Literal></label>
                        </div>
                        <div class="eleven wide field">
                            <asp:TextBox ID="txtInsAddressedName" runat="server" data-cp-submit="INS_ADDRESSED_NAME" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsAddressedNameResource1"></asp:TextBox>
                        </div>
                        <div class="five wide field">
                            <label for="txtInsAddressedPostalAddress" id="lblInsAddressedPostalAddress">
                                <asp:Literal ID="litInsAddressedPostalAddress" runat="server" Text="Postal address" meta:resourcekey="litInsAddressedPostalAddressResource1"></asp:Literal></label>
                        </div>
                        <div class="eleven wide field">
                            <asp:TextBox ID="txtInsAddressedPostalAddress" runat="server" data-cp-submit="INS_ADDRESSED_POSTAL_ADD" ReadOnly="True"  CssClass="carsInput" meta:resourcekey="txtInsAddressedPostalAddressResource1" ></asp:TextBox>
                        </div>
                        <div class="five wide field">
                            <label for="txtInsAddressedVisitAddress" id="lblInsvVisitAddress">
                                <asp:Literal ID="litInsAddressedVisitAddress" runat="server" Text="Visit address" meta:resourcekey="litInsAddressedVisitAddressResource1"></asp:Literal></label>
                        </div>
                        <div class="eleven wide field">
                            <asp:TextBox ID="txtInsAddressedVisitAddress" runat="server" data-cp-submit="INS_ADDRESSED_VISIT_ADD" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsAddressedVisitAddressResource1"></asp:TextBox>
                        </div>
                        <div class="five wide field">
                            <label for="txtInsZip" id="lblAddressedInsZip">
                                <asp:Literal ID="litInsAddressedZip" runat="server" Text="Zip code/ city" meta:resourcekey="litInsAddressedZipResource1"></asp:Literal></label>
                        </div>
                        <div class="three wide field">
                            <asp:TextBox ID="txtInsAddressedZip" CssClass="carsInput" runat="server" data-cp-submit="INS_ADDRESSED_ZIP" ReadOnly="True" meta:resourcekey="txtInsAddressedZipResource1"></asp:TextBox>
                        </div>
                        <div class="eight wide field">
                            <asp:TextBox ID="txtInsAddressedZipCity" runat="server" data-cp-submit="INS_ADRESSED_ZIP_CITY" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtInsAddressedZipCityResource1"></asp:TextBox>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
        <div class="three wide column">
        <div class="ui form">
                            <%--<div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">--%>
                            <h3 id="H19" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Velg fra listen</h3>
                                <div class="fields">
                                <button type="button" id="btnGen1" class="ui button carsButtonBlueNotInverted wide">Generelt</button> 
                                </div>
                                <div class="fields">
                                <button type="button" id="btnGen2" class="ui button carsButtonBlueInverted wide">Skade</button> 
                                </div>
                               
                            <%--</div>--%>
                        </div>
        </div>
        </div>

    </div>
    </div>
    <div class="ui bottom attached tab segment" data-tab="InternalDepartment">
    <div id="tabInternalDepartment" >
        <div class="ui form stackable one column grid">
                <div class="sixteen wide column">

         <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H9" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Generelt</h3>
            <div class="ui divider"></div>

       
            <div class="ui stackable grid ">
                <!-- Left Column -->
                <div class="ten wide column">
                    <div class="ui stackable grid ">
                        <div class="three wide field">
                            <label for="txtIntCustID" id="lblIntCustID">
                                <asp:Literal ID="litIntCustID" runat="server" Text="Customer ID" meta:resourcekey="litIntCustIDResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntCustID" runat="server" data-submit="INT_CUST_ID" CssClass="carsInput" meta:resourcekey="txtIntCustIDResource1"></asp:TextBox>
                        </div>
                        <div class="seven wide field">
                            <label for="txtIntCompanyName" id="lblIntCompanyName">
                                <asp:Literal ID="litIntCompanyName" runat="server" Text="Company name" meta:resourcekey="litIntCompanyNameResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntCompanyName" runat="server" data-submit="INT_COMPANY_NAME" data-required="REQUIRED" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntCompanyNameResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <label for="ddlIntContactPerson" id="lblIntContactPerson">
                                <asp:Literal ID="litIntContactPerson" runat="server" Text="Contact person" meta:resourcekey="litIntContactPersonResource1"></asp:Literal></label>
                            <asp:DropDownList ID="ddlIntContactPerson" class="dropdowns" runat="server" CssClass="carsInput" data-submit="INT_ID_CP" meta:resourcekey="ddlIntContactPersonResource1"></asp:DropDownList>
                        </div>
                        <div class="ten wide column">
                            <div class="ui stackable grid">
                                <div class="eight wide field">
                                    <label for="txtIntPostalAddress" id="lblIntPostalAddress">
                                        <asp:Literal ID="litIntPostalAddress" runat="server" Text="Postal address" meta:resourcekey="litIntPostalAddressResource1"></asp:Literal></label>
                                        <asp:TextBox ID="txtIntPostalAddress" runat="server" data-cp-submit="INT_POSTAL_ADD" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntPostalAddressResource1"></asp:TextBox>
                                </div>
                                <div class="eight wide field">
                                    <label for="txtIntVisitAddress" id="lblIntVisitAddress">
                                        <asp:Literal ID="litIntVisitAddress" runat="server" Text="Visit address" meta:resourcekey="litIntVisitAddressResource1"></asp:Literal></label>
                                        <asp:TextBox ID="txtIntVisitAddress" runat="server" data-cp-submit="INT_VISIT_ADD" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntVisitAddressResource1"></asp:TextBox>
                                </div>
                                <div class="four wide field">
                                    <label for="txtIntip" id="lblIntZip">
                                        <asp:Literal ID="litIntZip" runat="server" Text="Zip code" meta:resourcekey="litIntZipResource1"></asp:Literal></label>
                                        <asp:TextBox ID="txtIntZip" CssClass="carsInput" runat="server" data-cp-submit="INT_ZIP" ReadOnly="True" meta:resourcekey="txtIntZipResource1"></asp:TextBox>
                                </div>
                                <div class="twelve wide field">
                                    <label for="txtIntZipCity" id="lblIntZipCity">
                                        <asp:Literal ID="litIntZipCity" runat="server" Text="Zip city" meta:resourcekey="litIntZipCityResource1"></asp:Literal></label>
                                        <asp:TextBox ID="txtIntZipCity" runat="server" data-cp-submit="INT_ZIP_CITY" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntZipCityResource1"></asp:TextBox>
                                </div>
                            </div>
                        </div>


                       

                        <div id="intPaymentDetails" class="ten wide column">
                        <div class="ui stackable grid">
                            <div class="four wide field">
                                <label for="txtIntSalesGroup" id="lblIntSalesGroup">
                                    <asp:Literal ID="litIntSalesGroup" runat="server" Text="Sales group" meta:resourcekey="litIntSalesGroupResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtIntSalesGroup" runat="server" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntSalesGroupResource1"></asp:TextBox>
                            </div>
                            <div class="eight wide field">
                                <label for="txtIntPaymentTerms" id="lblIntPaymentTerms">
                                    <asp:Literal ID="litIntPaymentTerms" runat="server" Text="Payment terms" meta:resourcekey="litIntPaymentTermsResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtIntPaymentTerms" runat="server" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntPaymentTermsResource1"></asp:TextBox>
                            </div>
                            <div class="four wide field">
                                <label for="txtIntDiscount" id="lblIntDiscount" >
                                    <asp:Literal ID="litIntDiscount" runat="server" Text="Discount" meta:resourcekey="litIntDiscountResource1" ></asp:Literal>
                                </label>
                                    <asp:TextBox ID="txtIntDiscount" runat="server"  CssClass="carsInput" meta:resourcekey="txtIntDiscountResource1"></asp:TextBox>
                            </div>
                            </div>
                        </div>
                    </div>
                    <div class="ui stackable grid">
                        <div class="two wide field">
                            <label for="txtIntSplit" id="lblIntSplit">
                                <asp:Literal ID="litIntSplit" runat="server" Text="Split %" meta:resourcekey="litIntSplitResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntSplit" runat="server" Text="100"  CssClass="carsInput" meta:resourcekey="txtIntSplitResource1"></asp:TextBox>
                        </div>
                        <div class="two wide field">
                            <label for="txtIntGM" id="lblIntGM">
                                <asp:Literal ID="litIntGM" runat="server" Text="GM Sum" meta:resourcekey="litIntGMResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntGM" runat="server" Text=",00" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntGMResource1"></asp:TextBox>
                        </div>
                        <div class="three wide field">
                            <label for="txtIntEnvFee" id="lblIntEnvFee">
                                <asp:Literal ID="litIntEnvFee" runat="server" Text="Env. Fee Sum" meta:resourcekey="litIntEnvFeeResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntEnvFee" runat="server" Text=",00" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntEnvFeeResource1"></asp:TextBox>
                        </div>
                        <div class="three wide field">
                            <label for="txtIntInvFee" id="lblIntInvFee">
                                <asp:Literal ID="litIntInvFee" runat="server" Text="Inv. Fee" meta:resourcekey="litIntInvFeeResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntInvFee" runat="server" Text=",00" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntInvFeeResource1"></asp:TextBox>
                        </div>
                        <div class="five wide field">
                            <label>&nbsp;</label>
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkIntMoveOwnRisk" runat="server" Text="Own risk to this debtor" Enabled="False" data-cp-submit="INT_MOVE_OWN_RISK" meta:resourcekey="chkIntMoveOwnRiskResource1" />
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Left column /-->
                <div class="six wide column">
                    <!-- Right Column -->
                    <div id="intPhone" class="column">
                        <h4 class="ui dividing header">Phone</h4>
                        <div class="inline field">
                            <label for="txtIntPhonePrivate" id="lblIntPhonePrivate">
                                <asp:Literal ID="litIntPhonePrivate" runat="server" Text="Private" meta:resourcekey="litIntPhonePrivateResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntPhonePrivate" runat="server" data-cp-submit="INT_PHONE_PRIVATE"  CssClass="carsInput" meta:resourcekey="txtIntPhonePrivateResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtIntPhoneSwitch" id="lblIntPhoneSwitch">
                                <asp:Literal ID="litIntPhoneSwitch" runat="server" Text="Switch" meta:resourcekey="litIntPhoneSwitchResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntPhoneSwitch" runat="server" data-cp-submit="INT_PHONE_SWITCH"  CssClass="carsInput" meta:resourcekey="txtIntPhoneSwitchResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtIntPhoneFax" id="lblIntPhoneFax">
                                <asp:Literal ID="litIntPhoneFax" runat="server" Text="Fax" meta:resourcekey="litIntPhoneFaxResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntPhoneFax" runat="server" data-cp-submit="INT_PHONE_FAX" CssClass="carsInput" meta:resourcekey="txtIntPhoneFaxResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtIntPhoneMobile" id="lblIntPhoneMobile">
                                <asp:Literal ID="litIntPhoneMobile" runat="server" Text="Mobile" meta:resourcekey="litIntPhoneMobileResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtIntPhoneMobile" runat="server" data-cp-submit="INT_PHONE_MOBILE"  CssClass="carsInput" meta:resourcekey="txtIntPhoneMobileResource1"></asp:TextBox>
                        </div>
                    </div>
                    <div class="column">
                        <h4 class="ui dividing header">Reduction</h4>
                        <div class="field">
                            <div class="ui radio checkbox">
                                <asp:RadioButton ID="radIntNoReduction" GroupName="reduction" runat="server" CssClass="hidden" Checked="True" meta:resourcekey="radIntNoReductionResource1" />
                                <label>
                                    <asp:Literal ID="lblIntNoReduction" runat="server" Text="No reduction" meta:resourcekey="lblIntNoReductionResource1"></asp:Literal></label>
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui radio checkbox">
                                <asp:RadioButton ID="radIntReductioAfter" GroupName="reduction" runat="server" CssClass="hidden" meta:resourcekey="radIntReductioAfterResource1" />
                                <label>
                                    <asp:Literal ID="litIntReductionAfter" runat="server" Text="Reduction after own risk" meta:resourcekey="litIntReductionAfterResource1"></asp:Literal></label>
                            </div>
                        </div>
                        <div class="field">
                            <div class="ui radio checkbox">
                                <asp:RadioButton ID="radIntReductionBefore" GroupName="reduction" runat="server" CssClass="hidden" meta:resourcekey="radIntReductionBeforeResource1" />
                                <label>
                                    <asp:Literal ID="litIntReductionBefore" runat="server" Text="Reduction before own risk" meta:resourcekey="litIntReductionBeforeResource1"></asp:Literal></label>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Right Column /-->
            </div>
        </div>



         <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H12" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Invoice</h3>
            <div class="ui divider"></div>
            <div class="ui stackable grid container shift-container">
                <div class="three wide column">
                    <div class="ui checkbox">
                        <asp:CheckBox ID="chkIntInvPaid" runat="server" Text="Invoice paid" data-cp-submit="INT_INV_PAID" meta:resourcekey="chkIntInvPaidResource1" />
                    </div>
                </div>
                <div class="five wide column">
                    <div class="inline field">
                        <label for="txtIntInvID" id="lblIntInvID">
                            <asp:Literal ID="litIntInvID" runat="server" Text="Invoice nr.: " meta:resourcekey="litIntInvIDResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtIntInvID" runat="server" data-cp-submit="INT_INV_ID" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntInvIDResource1"></asp:TextBox>
                            <asp:Literal ID="litIntInvDate" runat="server" Text="00/00/0000" meta:resourcekey="litIntInvDateResource1"></asp:Literal>
                    </div>
                </div>
                <div class="three wide column">
                    <div class="inline field">
                        <label id="lblIntInvDue">
                            <asp:Literal ID="litIntInvDue" runat="server" Text="Due date: " meta:resourcekey="litIntInvDueResource1"></asp:Literal></label>
                            <asp:Literal ID="litIntInvDueDate" runat="server" Text="00/00/0000" meta:resourcekey="litIntInvDueDateResource1"></asp:Literal>
                    </div>
                </div>
                <div class="five wide column">
                    <div class="inline field">
                        <label for="txtIntInvJournal" id="lblIntInvJournal">
                            <asp:Literal ID="litIntInvJournal" runat="server" Text="Journal nr.: " meta:resourcekey="litIntInvJournalResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtIntInvJournal" runat="server" data-cp-submit="INT_INV_JOURNAL" ReadOnly="True" CssClass="carsInput" meta:resourcekey="txtIntInvJournalResource1"></asp:TextBox>
                            <asp:Literal ID="litIntInvJournalDate" runat="server" Text="00/00/0000" meta:resourcekey="litIntInvJournalDateResource1"></asp:Literal>
                    </div>
                </div>
            </div>
        </div>
        <input id="btnIntDelete" runat="server" class="ui button" value="Delete" type="button" onclick="delIntCust()" />
    </div>
    </div>
    </div>
    </div>

    

    <div class="ui bottom attached tab segment" data-tab="Claim">
    <div id="tabClaim" >
       
        <div class="ui form stackable one column grid">
        <div class="sixteen wide column">
        <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H10" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Split 3(claim)</h3>
            <div class="ui divider"></div>
            
            <div class="ui stackable grid">
                <!-- Left Column -->
                <div class="ten wide column">
                    <div class="ui stackable grid ">
                        <div class="three wide field">
                            <label for="txtClaimCustID" id="lblClaimCustID">
                                <asp:Literal ID="litClaimCustID" runat="server" Text="Customer ID" meta:resourcekey="litClaimCustIDResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimCustID" runat="server" data-submit="CLAIM_CUST_ID" CssClass="carsInput" meta:resourcekey="txtClaimCustIDResource1"></asp:TextBox>
                        </div>
                        <div class="seven wide field">
                            <label for="txtClaimCompanyName" id="lblClaimCompanyName">
                                <asp:Literal ID="litClaimCompanyName" runat="server" Text="Company name" meta:resourcekey="litClaimCompanyNameResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimCompanyName" runat="server" data-submit="CLAIM_COMPANY_NAME" data-required="REQUIRED" CssClass="carsInput" meta:resourcekey="txtClaimCompanyNameResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <label for="ddlClaimContactPerson" id="lblClaimContactPerson">
                                <asp:Literal ID="litClaimContactPerson" runat="server" Text="Contact person" meta:resourcekey="litClaimContactPersonResource1"></asp:Literal></label>
                            <asp:DropDownList ID="ddlClaimContactPerson" class="dropdowns" runat="server" CssClass="carsInput" data-submit="CLAIM_ID_CP" meta:resourcekey="ddlClaimContactPersonResource1"></asp:DropDownList>
                        </div>
                        <div class="ten wide column">
                            <div class="ui stackable grid">
                                <div class="eight wide field">
                                    <label for="txtClaimPostalAddress" id="lblClaimPostalAddress">
                                        <asp:Literal ID="litClaimPostalAddress" runat="server" Text="Postal address" meta:resourcekey="litClaimPostalAddressResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtClaimPostalAddress" runat="server" data-cp-submit="CLAIM_POSTAL_ADD" CssClass="carsInput" meta:resourcekey="txtClaimPostalAddressResource1"></asp:TextBox>
                                </div>
                                <div class="eight wide field">
                                    <label for="txtClaimVisitAddress" id="lblClaimVisitAddress">
                                        <asp:Literal ID="litClaimVisitAddress" runat="server" Text="Visit address" meta:resourcekey="litClaimVisitAddressResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtClaimVisitAddress" runat="server" data-cp-submit="CLAIM_VISIT_ADD" CssClass="carsInput" meta:resourcekey="txtClaimVisitAddressResource1"></asp:TextBox>
                                </div>
                                <div class="four wide field">
                                    <label for="txtClaimZip" id="lblClaimZip">
                                        <asp:Literal ID="litClaimZip" runat="server" Text="Zip code" meta:resourcekey="litClaimZipResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtClaimZip" CssClass="carsInput" runat="server" data-cp-submit="CLAIM_ZIP" meta:resourcekey="txtClaimZipResource1"></asp:TextBox>
                                </div>
                                <div class="twelve wide field">
                                    <label for="txtClaimZipCity" id="lblClaimZipCity">
                                        <asp:Literal ID="litClaimZipCity" runat="server" Text="Zip city" meta:resourcekey="litClaimZipCityResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtClaimZipCity" runat="server" data-cp-submit="CLAIM_ZIP_CITY" CssClass="carsInput" meta:resourcekey="txtClaimZipCityResource1"></asp:TextBox>
                                </div>
                            </div>
                        </div>
                        <div id="claimPaymentDetails" class="ten wide column">
                        <div class="ui stackable grid">
                            
                            <div class="four wide field">
                                <label for="txtClaimSalesGroup" id="lblClaimSalesGroup" >
                                    <asp:Literal ID="litClaimSalesGroup" runat="server" Text="Sales group" meta:resourcekey="litClaimSalesGroupResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtClaimSalesGroup" runat="server" CssClass="carsInput" meta:resourcekey="txtClaimSalesGroupResource1"></asp:TextBox>
                            </div>
                            <div class="eight wide field">
                                <label for="txtClaimPaymentTerms" id="lblClaimPaymentTerms">
                                    <asp:Literal ID="litClaimPaymentTerms" runat="server" Text="Payment terms" meta:resourcekey="litClaimPaymentTermsResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtClaimPaymentTerms" runat="server" CssClass="carsInput" meta:resourcekey="txtClaimPaymentTermsResource1"></asp:TextBox>
                            </div>
                            <div class="four wide field">
                                <label for="txtClaimDiscount" id="lblClaimDiscount" >
                                    <asp:Literal ID="litClaimDiscount" runat="server" Text="Discount" meta:resourcekey="litClaimDiscountResource1" ></asp:Literal>
                                </label>
                                    <asp:TextBox ID="txtClaimDiscount" runat="server"   CssClass="carsInput" meta:resourcekey="txtClaimDiscountResource1"></asp:TextBox>
                            </div>
                        </div>
                        </div>
                    </div>
                    <div class="ui stackable grid">
                        <div class="two wide field">
                            <label for="txtClaimSplit" id="lblClaimSplit">
                                <asp:Literal ID="litClaimSplit" runat="server" Text="Split %" meta:resourcekey="litClaimSplitResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimSplit" runat="server" Text="100" CssClass="carsInput" meta:resourcekey="txtClaimSplitResource1"></asp:TextBox>
                        </div>
                        <div class="two wide field">
                            <label for="txtClaimM" id="lblClaimGM">
                                <asp:Literal ID="litClaimGM" runat="server" Text="GM Sum" meta:resourcekey="litClaimGMResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimGM" runat="server" Text=",00" CssClass="carsInput" meta:resourcekey="txtClaimGMResource1"></asp:TextBox>
                        </div>
                        <div class="three wide field">
                            <label for="txtClaimEnvFee" id="lblClaimEnvFee">
                                <asp:Literal ID="litClaimEnvFee" runat="server" Text="Env. Fee Sum" meta:resourcekey="litClaimEnvFeeResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimEnvFee" runat="server" Text=",00" CssClass="carsInput" meta:resourcekey="txtClaimEnvFeeResource1"></asp:TextBox>
                        </div>
                        <div class="three wide field">
                            <label for="txtClaimInvFee" id="lblClaimInvFee">
                                <asp:Literal ID="litClaimInvFee" runat="server" Text="Inv. Fee" meta:resourcekey="litClaimInvFeeResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimInvFee" runat="server" Text=",00" CssClass="carsInput" meta:resourcekey="txtClaimInvFeeResource1"></asp:TextBox>
                        </div>
                    </div>
                </div>
                <!-- End Left column /-->
                <div class="six wide column">
                    <!-- Right Column -->
                    <div id="claimPhone" class="column">
                        <h4 class="ui dividing header">Phone</h4>
                        <div class="inline field">
                            <label for="txtClaimPhonePrivate" id="lblClaimPhonePrivate">
                                <asp:Literal ID="litClaimPhonePrivate" runat="server" Text="Private" meta:resourcekey="litClaimPhonePrivateResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimPhonePrivate" runat="server" data-cp-submit="CLAIM_PHONE_PRIVATE" CssClass="carsInput" meta:resourcekey="txtClaimPhonePrivateResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtClaimPhoneSwitch" id="lblClaimPhoneSwitch">
                                <asp:Literal ID="litClaimPhoneSwitch" runat="server" Text="Switch" meta:resourcekey="litClaimPhoneSwitchResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimPhoneSwitch" runat="server" data-cp-submit="CLAIM_PHONE_SWITCH" CssClass="carsInput" meta:resourcekey="txtClaimPhoneSwitchResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtClaimPhoneFax" id="lblClaimPhoneFax">
                                <asp:Literal ID="litClaimPhoneFax" runat="server" Text="Fax" meta:resourcekey="litClaimPhoneFaxResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimPhoneFax" runat="server" data-cp-submit="CLAIM_PHONE_FAX" CssClass="carsInput" meta:resourcekey="txtClaimPhoneFaxResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtClaimPhoneMobile" id="lblClaimPhoneMobile">
                                <asp:Literal ID="litClaimPhoneMobile" runat="server" Text="Mobile" meta:resourcekey="litClaimPhoneMobileResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtClaimPhoneMobile" runat="server" data-cp-submit="CLAIM_PHONE_MOBILE" CssClass="carsInput" meta:resourcekey="txtClaimPhoneMobileResource1"></asp:TextBox>
                        </div>
                    </div>
                </div>
                <!-- End Right Column /-->
            </div>
           
        </div>
        </div>
        </div>
         <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H13" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Invoice</h3>
            <div class="ui divider"></div>
            <div class="ui stackable grid container shift-container">
                <div class="three wide column">
                    <div class="ui checkbox">
                        <asp:CheckBox ID="chkClaimInvPaid" runat="server" Text="Invoice paid" data-cp-submit="CLAIM_INV_PAID" meta:resourcekey="chkClaimInvPaidResource1" />
                    </div>
                </div>
                <div class="five wide column">
                    <div class="inline field">
                        <label for="txtClaimInvID" id="lblClaimInvID">
                            <asp:Literal ID="litClaimInvID" runat="server" Text="Invoice nr.: " meta:resourcekey="litClaimInvIDResource1"></asp:Literal></label>
                        <asp:TextBox ID="txtClaimInvID" runat="server" data-cp-submit="CLAIM_INV_ID" CssClass="carsInput" meta:resourcekey="txtClaimInvIDResource1"></asp:TextBox>
                        <asp:Literal ID="litClaimInvDate" runat="server" Text="00/00/0000" meta:resourcekey="litClaimInvDateResource1"></asp:Literal>
                    </div>
                </div>
                <div class="three wide column">
                    <div class="inline field">
                        <label id="lblClaimInvDue">
                            <asp:Literal ID="litClaimInvDue" runat="server" Text="Due date: " meta:resourcekey="litClaimInvDueResource1"></asp:Literal></label>
                        <asp:Literal ID="litClaimInvDueDate" runat="server" Text="00/00/0000" meta:resourcekey="litClaimInvDueDateResource1"></asp:Literal>
                    </div>
                </div>
                <div class="five wide column">
                    <div class="inline field">
                        <label for="txtClaimInvJournal" id="lblClaimInvJournal">
                            <asp:Literal ID="litClaimInvJournal" runat="server" Text="Journal nr.: " meta:resourcekey="litClaimInvJournalResource1"></asp:Literal></label>
                        <asp:TextBox ID="txtClaimInvJournal" runat="server" data-cp-submit="CLAIM_INV_JOURNAL" CssClass="carsInput" meta:resourcekey="txtClaimInvJournalResource1"></asp:TextBox>
                        <asp:Literal ID="litClaimInvJournalDate" runat="server" Text="00/00/0000" meta:resourcekey="litClaimInvJournalDateResource1"></asp:Literal>
                    </div>
                </div>
            </div>
        </div>
        <input id="btnDelClaim" runat="server" class="ui button" value="Delete" type="button" onclick="delClaCust()" />
    </div>
    </div>

    
       
      
      
            
            


    <div class="ui bottom attached tab segment" data-tab="Miscellaneous">
    <div id="tabMiscellaneous" >
      <div class="ui form stackable one column grid">
        <div class="sixteen wide column">
       <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
                        <h3 id="H15" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Split 4(misc)</h3>
            <div class="ui divider"></div>
        
            <div class="ui stackable grid">
                <!-- Left Column -->
                <div class="ten wide column">
                    <div class="ui stackable grid ">
                        <div class="three wide field">
                            <label for="txtMiscCustID" id="lblMiscCustID">
                                <asp:Literal ID="litMiscCustID" runat="server" Text="Customer ID" meta:resourcekey="litMiscCustIDResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscCustID" runat="server" data-submit="MISC_CUST_ID" CssClass="carsInput" meta:resourcekey="txtMiscCustIDResource1"></asp:TextBox>
                        </div>
                        <div class="seven wide field">
                            <label for="txtMiscCompanyName" id="lblMiscCompanyName">
                                <asp:Literal ID="litMiscCompanyName" runat="server" Text="Company name" meta:resourcekey="litMiscCompanyNameResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscCompanyName" runat="server" data-submit="MISC_COMPANY_NAME" data-required="REQUIRED" CssClass="carsInput" meta:resourcekey="txtMiscCompanyNameResource1"></asp:TextBox>
                        </div>
                        <div class="six wide field">
                            <label for="ddlMiscContactPerson" id="lblMiscContactPerson">
                                <asp:Literal ID="litMiscContactPerson" runat="server" Text="Contact person" meta:resourcekey="litMiscContactPersonResource1"></asp:Literal></label>
                            <asp:DropDownList ID="ddlMiscContactPerson" class="dropdowns" runat="server" CssClass="carsInput" data-submit="MISC_ID_CP" meta:resourcekey="ddlMiscContactPersonResource1"></asp:DropDownList>
                        </div>
                        <div class="ten wide column">
                            <div class="ui stackable grid">
                                <div class="eight wide field">
                                    <label for="txtMiscPostalAddress" id="lblMiscPostalAddress">
                                        <asp:Literal ID="litMiscPostalAddress" runat="server" Text="Postal address" meta:resourcekey="litMiscPostalAddressResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtMiscPostalAddress" runat="server" data-cp-submit="MISC_POSTAL_ADD" CssClass="carsInput" meta:resourcekey="txtMiscPostalAddressResource1"></asp:TextBox>
                                </div>
                                <div class="eight wide field">
                                    <label for="txtMiscVisitAddress" id="lblMiscVisitAddress">
                                        <asp:Literal ID="litMiscVisitAddress" runat="server" Text="Visit address" meta:resourcekey="litMiscVisitAddressResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtMiscVisitAddress" runat="server" data-cp-submit="MISC_VISIT_ADD" CssClass="carsInput" meta:resourcekey="txtMiscVisitAddressResource1"></asp:TextBox>
                                </div>
                                <div class="four wide field">
                                    <label for="txtMiscZip" id="lblMiscZip">
                                        <asp:Literal ID="litMiscZip" runat="server" Text="Zip code" meta:resourcekey="litMiscZipResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtMiscZip" CssClass="carsInput" runat="server" data-cp-submit="MISC_ZIP" meta:resourcekey="txtMiscZipResource1"></asp:TextBox>
                                </div>
                                <div class="twelve wide field">
                                    <label for="txtMiscZipCity" id="lblMiscZipCity">
                                        <asp:Literal ID="litMiscZipCity" runat="server" Text="Zip city" meta:resourcekey="litMiscZipCityResource1"></asp:Literal></label>
                                    <asp:TextBox ID="txtMiscZipCity" runat="server" data-cp-submit="MISC_ZIP_CITY" CssClass="carsInput" meta:resourcekey="txtMiscZipCityResource1"></asp:TextBox>
                                </div>
                            </div>
                        </div>
                        <div id="miscPaymentDetails" class="ten wide column">
                        <div class="ui stackable grid">
                            <div class="four wide field">
                                <label for="txtMiscSalesGroup" id="lblMiscSalesGroup" >
                                    <asp:Literal ID="litMiscSalesGroup" runat="server" Text="Sales group" meta:resourcekey="litMiscSalesGroupResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtMiscSalesGroup" runat="server" CssClass="carsInput" meta:resourcekey="txtMiscSalesGroupResource1"></asp:TextBox>
                            </div>
                           <div class="eight wide field">
                                <label for="txtMiscPaymentTerms" id="lblMiscPaymentTerms">
                                    <asp:Literal ID="litMiscPaymentTerms" runat="server" Text="Payment terms" meta:resourcekey="litMiscPaymentTermsResource1"></asp:Literal></label>
                                <asp:TextBox ID="txtMiscPaymentTerms" runat="server" CssClass="carsInput" meta:resourcekey="txtMiscPaymentTermsResource1"></asp:TextBox>
                            </div>
                          <div class="four wide field">
                                <label for="txtMiscDiscount" id="lblMiscDiscount" >
                                    <asp:Literal ID="litMiscDiscount" runat="server" Text="Discount" meta:resourcekey="litMiscDiscountResource1" ></asp:Literal>
                                </label>
                                    <asp:TextBox ID="txtMiscDiscount" runat="server"   CssClass="carsInput" meta:resourcekey="txtMiscDiscountResource1"></asp:TextBox>
                            </div>
                        </div>
                        </div>
                    </div>
                    <div class="ui stackable grid">
                        <div class="two wide field">
                            <label for="txtMiscSplit" id="lblMiscSplit">
                                <asp:Literal ID="litMiscSplit" runat="server" Text="Split %" meta:resourcekey="litMiscSplitResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscSplit" runat="server" Text="100 %" CssClass="carsInput" meta:resourcekey="txtMiscSplitResource1"></asp:TextBox>
                        </div>
                        <div class="two wide field">
                            <label for="txtMiscGM" id="lblMiscGM">
                                <asp:Literal ID="litMiscGM" runat="server" Text="GM Sum" meta:resourcekey="litMiscGMResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscGM" runat="server" Text=",00" CssClass="carsInput" meta:resourcekey="txtMiscGMResource1"></asp:TextBox>
                        </div>
                        <div class="three wide field">
                            <label for="txtMiscEnvFee" id="lblMiscEnvFee">
                                <asp:Literal ID="litMiscEnvFee" runat="server" Text="Env. Fee Sum" meta:resourcekey="litMiscEnvFeeResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscEnvFee" runat="server" Text=",00" CssClass="carsInput" meta:resourcekey="txtMiscEnvFeeResource1"></asp:TextBox>
                        </div>
                        <div class="three wide field">
                            <label for="txtMiscInvFee" id="lblMiscInvFee">
                                <asp:Literal ID="litMiscInvFee" runat="server" Text="Inv. Fee" meta:resourcekey="litMiscInvFeeResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscInvFee" runat="server" Text=",00" CssClass="carsInput" meta:resourcekey="txtMiscInvFeeResource1"></asp:TextBox>
                        </div>
                        <div class="five wide field">
                            <label>&nbsp;</label>
                            <div class="ui checkbox">
                                <asp:CheckBox ID="chkMiscMoveOwnRisk" runat="server" Text="Own risk to this debtor"  data-cp-submit="MISC_MOVE_OWN_RISK" meta:resourcekey="chkMiscMoveOwnRiskResource1" />
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Left column /-->
                <div class="six wide column">
                    <!-- Right Column -->
                    <div id="miscPhone" class="column">
                        <h4 class="ui dividing header">Phone</h4>
                        <div class="inline field">
                            <label for="txtMiscPhonePrivate" id="lblMiscPhonePrivate">
                                <asp:Literal ID="litMiscPhonePrivate" runat="server" Text="Private" meta:resourcekey="litMiscPhonePrivateResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscPhonePrivate" runat="server" data-cp-submit="MISC_PHONE_PRIVATE" CssClass="carsInput" meta:resourcekey="txtMiscPhonePrivateResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtMiscPhoneSwitch" id="lblMiscPhoneSwitch">
                                <asp:Literal ID="litMiscPhoneSwitch" runat="server" Text="Switch" meta:resourcekey="litMiscPhoneSwitchResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscPhoneSwitch" runat="server" data-cp-submit="MISC_PHONE_SWITCH" CssClass="carsInput" meta:resourcekey="txtMiscPhoneSwitchResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtMiscPhoneFax" id="lblMiscPhoneFax">
                                <asp:Literal ID="litMiscPhoneFax" runat="server" Text="Fax" meta:resourcekey="litMiscPhoneFaxResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscPhoneFax" runat="server" data-cp-submit="MISC_PHONE_FAX" CssClass="carsInput" meta:resourcekey="txtMiscPhoneFaxResource1"></asp:TextBox>
                        </div>
                        <div class="inline field">
                            <label for="txtMiscPhoneMobile" id="lblMiscPhoneMobile">
                                <asp:Literal ID="litMiscPhoneMobile" runat="server" Text="Mobile" meta:resourcekey="litMiscPhoneMobileResource1"></asp:Literal></label>
                            <asp:TextBox ID="txtMiscPhoneMobile" runat="server" data-cp-submit="MISC_PHONE_MOBILE" CssClass="carsInput" meta:resourcekey="txtMiscPhoneMobileResource1"></asp:TextBox>
                        </div>
                    </div>
                </div>
                <!-- End Right Column /-->
            </div>
        </div>
        </div>
        </div>
        <div class="ui raised segment" style="box-shadow: 2px 2px 14px 2px rgba(166, 209, 241, 1), 2px 2px 2px 2px rgba(34, 36, 38, 0.15);">
            <h3 id="H14" runat="server" class="ui blue top medium header center aligned" style="border-color: blue !important">Invoice</h3>
            <div class="ui divider"></div>
            <div class="ui stackable grid container shift-container">
                <div class="three wide column">
                    <div class="ui checkbox">
                        <asp:CheckBox ID="chkMiscInvPaid" runat="server" Text="Invoice paid" data-cp-submit="MISC_INV_PAID" meta:resourcekey="chkMiscInvPaidResource1" />
                    </div>
                </div>
                <div class="five wide column">
                    <div class="inline field">
                        <label for="txtMiscInvID" id="lblMiscInvID">
                            <asp:Literal ID="litMiscInvID" runat="server" Text="Invoice nr.: " meta:resourcekey="litMiscInvIDResource1"></asp:Literal></label>
                        <asp:TextBox ID="txtMiscInvID" runat="server" data-cp-submit="MISC_INV_ID" CssClass="carsInput" meta:resourcekey="txtMiscInvIDResource1"></asp:TextBox>
                        <asp:Literal ID="litMiscInvDate" runat="server" Text="00/00/0000" meta:resourcekey="litMiscInvDateResource1"></asp:Literal>
                    </div>
                </div>
                <div class="three wide column">
                    <div class="inline field">
                        <label id="lblMiscInvDue">
                            <asp:Literal ID="litMiscInvDue" runat="server" Text="Due date: " meta:resourcekey="litMiscInvDueResource1"></asp:Literal></label>
                        <asp:Literal ID="litMiscInvDueDate" runat="server" Text="00/00/0000" meta:resourcekey="litMiscInvDueDateResource1"></asp:Literal>
                    </div>
                </div>
                <div class="five wide column">
                    <div class="inline field">
                        <label for="txtMiscInvJournal" id="lblMiscInvJournal">
                            <asp:Literal ID="litMiscInvJournal" runat="server" Text="Journal nr.: " meta:resourcekey="litMiscInvJournalResource1"></asp:Literal></label>
                        <asp:TextBox ID="txtMiscInvJournal" runat="server" data-cp-submit="MISC_INV_JOURNAL" CssClass="carsInput" meta:resourcekey="txtMiscInvJournalResource1"></asp:TextBox>
                        <asp:Literal ID="litMiscInvJournalDate" runat="server" Text="00/00/0000" meta:resourcekey="litMiscInvJournalDateResource1"></asp:Literal>
                    </div>
                </div>
            </div>
        </div>
        <input id="btnDelMisc" runat="server" class="ui button" value="Delete" type="button" onclick="delMiscCust()" />
    </div>
    </div>
    <%-- Customer notes Modal --%>
    <div id="modCustNotes" class="modal hidden">
        <div class="modHeader">
            <h2 id="H8" runat="server">Notat</h2>
            <div class="modClose"><i class="remove icon"></i></div>
        </div>
        <div class="modContent">
            <div class="ui form">
                <div class="field">
                    <label class="sr-only">Notat</label>
                    <div class="ui small info message">
                        <p id="P1" runat="server">Legg inn notater på kunden.</p>
                    </div>
                </div>
            </div>
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="fields">
                            <div class="sixteen wide field">
                                <label for="txtNotes">
                                    <asp:Literal ID="liNotes" Text="Notes" runat="server" meta:resourcekey="liNotesResource1"></asp:Literal>
                                </label>
                                <asp:TextBox runat="server" ID="txtCustNotes" TextMode="MultiLine" CssClass="texttest" Height="181px" data-submit="CUST_NOTES" meta:resourcekey="txtNotesResource1"></asp:TextBox>
                            </div>
                        </div>
                        <div class="fields">
                            &nbsp;
                        </div>
                        <div class="fields">
                            <div class="eight wide field">
                                <input type="button" id="btnCustNotesSave" runat="server" class="ui btn wide" value="Lagre" />
                            </div>
                            <div class="eight wide field">
                                <input type="button" id="btnCustNotesCancel" runat="server" class="ui btn wide" value="Avbryt" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="tabBottom">
        <div class="ui form">
            <div class="inline fields">
                <div class="four wide field"></div>
                <div class="two wide field">
                    <div id="btnCatalogue" class="ui button wide">Catalogue</div>
                </div>
                <div class="two wide field">
                    <div id="btnEmptyScreen" class="ui button wide negative">Tøm</div>
                </div>
                <div class="two wide field">
                    <%--<div id="btnPrintVehicle" class="ui button wide">Skriv ut</div>--%>
                    <input id="btnPrint" runat="server" class="ui button" value="Skriv ut" type="button"  />
                </div>
                <div class="two wide field">
                    <div id="btnNewVehicle" class="ui button wide blue">Ny ordre</div>
                </div>
                <div class="two wide field">
                    <div id="btnSaveOrder" class="ui button wide positive">Lagre</div>
                </div>
                <div class="two wide field">
                    <div id="btnCloseOrder" class="ui button wide">Close</div>
                </div>
                <div class="two wide field">
                    <div id="btnHentPris" class="ui button wide">Hent pris</div>
                </div>
                <div class="four wide field"></div>
            </div>
        </div>
    </div>

    <%-- Vehicle notes Modal --%>
    <div id="modVehNotes" class="modal hidden">
        <div class="modHeader">
            <h2 id="H1" runat="server">Notat</h2>
            <div class="modClose"><i class="remove icon"></i></div>
        </div>
        <div class="modContent">
            <div class="ui form">
                <div class="field">
                    <label class="sr-only">Notat</label>
                    <div class="ui small info message">
                        <p id="P2" runat="server">Legg inn notater på kjøretøy.</p>
                    </div>
                </div>
            </div>
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="fields">
                            <div class="sixteen wide field">
                                <label for="txtNotes">
                                    <asp:Literal ID="Literal2" Text="Notes" runat="server" meta:resourcekey="liNotesResource1"></asp:Literal>
                                </label>
                                <asp:TextBox runat="server" ID="txtVehNotes" TextMode="MultiLine" CssClass="texttest" Height="181px" data-submit="CUST_NOTES" meta:resourcekey="txtNotesResource1"></asp:TextBox>
                            </div>
                        </div>
                        <div class="fields">
                            &nbsp;
                        </div>
                        <div class="fields">
                            <div class="eight wide field">
                                <input type="button" id="btnVehNotesSave" runat="server" class="ui btn wide" value="Lagre" />
                            </div>
                            <div class="eight wide field">
                                <input type="button" id="btnVehNotesCancel" runat="server" class="ui btn wide" value="Avbryt" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <%-- Vehicle notes Modal --%>
    <div id="modOrderNotes" class="modal hidden">
        <div class="modHeader">
            <h2 id="H2" runat="server">Notat</h2>
            <div class="modClose"><i class="remove icon"></i></div>
        </div>
        <div class="modContent">
            <div class="ui form">
                <div class="field">
                    <label class="sr-only">Notat</label>
                    <div class="ui small info message">
                        <p id="P3" runat="server">Legg inn notater på ordre.</p>
                    </div>
                </div>
            </div>
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="fields">
                            <div class="sixteen wide field">
                                 <asp:Label ID="lblAnnotation" runat="server" Text="Annotation" meta:resourcekey="lblAnnotationResource1"></asp:Label>
                                 <asp:TextBox ID="TxtAnnotation" runat="server" MaxLength="50" TextMode="MultiLine" Height="60px" meta:resourcekey="TxtAnnotationResource1"></asp:TextBox> </div>
                        </div>
                        <div class="fields">
                            &nbsp;
                        </div>
                        <div class="fields">
                            <div class="eight wide field">
                                <input type="button" id="btnOrderNotesSave" runat="server" class="ui btn wide" value="Lagre" />
                            </div>
                            <div class="eight wide field">
                                <input type="button" id="btnOrderNotesCancel" runat="server" class="ui btn wide" value="Avbryt" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%-- Bilxtra mob warranty Modal --%>
    <div id="modMobWarranty" class="modal hidden">
        <div class="modHeader">
            <h2 id="H3" runat="server">Mobilitetsgaranti</h2>
            <div class="modClose"><i class="remove icon"></i></div>
        </div>
        <div class="modContent">
            <div class="ui form">
                <div class="field">
                    <label class="sr-only">Mobilitetsgaranti</label>
                    <div class="ui small info message">
                        <p id="P4" runat="server">Velg hvilken type mobiltetsgaranti som skal benyttes.</p>
                    </div>
                </div>
            </div>
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="fields">
                            <div class="six wide field">
                                <label>&nbsp;</label>
                               <div class="ui radio checkbox">
                                <input type="radio" id="rbMobWarrantyViking" name="frequency" />
                                <label>Viking mobilitetsgaranti</label>
                              </div>   
                            </div>
                             <div class="four wide field">
                               <asp:Label ID="Label24" runat="server" Text="Sendt dato" meta:resourcekey="Label24Resource1"></asp:Label>
                                 <asp:TextBox ID="TextBox4" CssClass="carsInput" runat="server" MaxLength="50" meta:resourcekey="TextBox4Resource1"></asp:TextBox> 
                            </div>
                            
                            <div class="two wide field">
                                <asp:Label ID="Label25" runat="server" Text="Kl." meta:resourcekey="Label25Resource1"></asp:Label>
                                 <asp:TextBox ID="TextBox5" CssClass="carsInput" runat="server" MaxLength="50" meta:resourcekey="TextBox5Resource1"></asp:TextBox>   
                            </div>
                            
                        </div>
                         <div class="fields">
                               <div class="sixteen wide field">
                                  <div class="ui divider" style="margin: 5px 0px -10px;"></div>
                                   </div>
                             </div>
                        <div class="fields">
                            <div class="six wide field">
                               <div class="ui radio checkbox">
                                <input type="radio" id="rbMobWarrantyBilXtra12" name="frequency"/>
                                <label>BilXtra mob.garanti 12 mnd</label>
                              </div>   
                            </div>
                             <div class="four wide field">
                               <asp:Label ID="Label22" runat="server" Text="Sendt dato" meta:resourcekey="Label22Resource1"></asp:Label>
                                 <asp:TextBox ID="TextBox2" CssClass="carsInput" runat="server" MaxLength="50" meta:resourcekey="TextBox2Resource1"></asp:TextBox> 
                            </div>
                            
                            <div class="two wide field">
                                <asp:Label ID="Label23" runat="server" Text="Kl." meta:resourcekey="Label23Resource1"></asp:Label>
                                 <asp:TextBox ID="TextBox3" CssClass="carsInput" runat="server" MaxLength="50" meta:resourcekey="TextBox3Resource1"></asp:TextBox>   
                            </div>
                            <div class="four wide field">
                                <asp:Label ID="Label26" runat="server" Text="Varighet til" meta:resourcekey="Label26Resource1"></asp:Label>
                                 <asp:TextBox ID="TextBox6" CssClass="carsInput" runat="server" MaxLength="50" meta:resourcekey="TextBox6Resource1"></asp:TextBox>   
                            </div>
                        </div>
                        <div class="fields">
                            <div class="eight wide field">
                               <div class="ui radio checkbox">
                                <input type="radio" id="rbMobWarrantyBilXtra24" name="frequency"/>
                                <label>BilXtra mob.garanti 24 mnd</label>
                              </div>   
                            </div>
                             <div class="eight wide field">
                              
                            </div>
                           
                        </div>
                        <div class="fields">
                            &nbsp;
                        </div>
                        <div class="fields">
                            <div class="five wide field">
                                <input type="button" id="btnMobWarrantySave" runat="server" class="ui btn wide" value="Lagre" />
                            </div>
                            <div class="five wide field">
                                <input type="button" id="btnMobWarrantyCancel" runat="server" class="ui btn wide" value="Avbryt" />
                            </div>
                            <div class="five wide field">
                                <input type="button" id="btnMobWarrantyReset" runat="server" class="ui btn wide" value="Nullstill" />
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>


    <%-- EniroCustomer Modal --%>
    <div id="modEniroCustomer" class="ui modal">
        <i class="close icon"></i>
        <div class="header">
            Wash Customer
        </div>
        <div class="scrolling content">
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="inline fields">
                            <div class="four wide field">
                                 &nbsp;
                            </div>
                            <div class="five wide field">
                                Local data
                            </div>
                            <div class="five wide field">
                                Eniro data
                            </div>
                            <div class="two wide field">
                                Oppdatere?
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                                <label><asp:Label ID="lblWashLastName" Text="Last name/ Subsidiary" runat="server" meta:resourcekey="lblWashLastNameResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalLastName" runat="server" meta:resourcekey="txtWashLocalLastNameResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashEniroLastName" runat="server" meta:resourcekey="txtWashEniroLastNameResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">    
                                    <asp:CheckBox ID="chkWashLastName" runat="server" meta:resourcekey="chkWashLastNameResource1"></asp:CheckBox>
                                    <%--<label for="ctl00_cntMainPanel_chkContactType"></label>--%>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                                <label><asp:Label ID="lblWashFirstName" Text="First name" runat="server" meta:resourcekey="lblWashFirstNameResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalFirstName" runat="server" meta:resourcekey="txtWashLocalFirstNameResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                              <asp:TextBox ID="txtWashEniroFirstName" runat="server" meta:resourcekey="txtWashEniroFirstNameResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashFirstName" runat="server" meta:resourcekey="chkWashFirstNameResource1"></asp:CheckBox>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashMiddleName" Text="Middle name" runat="server" meta:resourcekey="lblWashMiddleNameResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                               <asp:TextBox ID="txtWashLocalMiddleName" runat="server" meta:resourcekey="txtWashLocalMiddleNameResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                            <asp:TextBox ID="txtWashEniroMiddleName" runat="server" meta:resourcekey="txtWashEniroMiddleNameResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashMiddleName" runat="server" meta:resourcekey="chkWashMiddleNameResource1"></asp:CheckBox>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashVisitAdress" Text="Visit address" runat="server" meta:resourcekey="lblWashVisitAdressResource1"></asp:Label></label>
                               <label></label>
                            </div>
                            <div class="five wide field">
                               <asp:TextBox ID="txtWashLocalVisitAddress" runat="server" meta:resourcekey="txtWashLocalVisitAddressResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                              <asp:TextBox ID="txtWashEniroVisitAddress" runat="server" meta:resourcekey="txtWashEniroVisitAddressResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashVisitAddress" runat="server" meta:resourcekey="chkWashVisitAddressResource1"></asp:CheckBox>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashBillAddress" Text="Bill address" runat="server" meta:resourcekey="lblWashBillAddressResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalBillAddress" runat="server" meta:resourcekey="txtWashLocalBillAddressResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                            <asp:TextBox ID="txtWashEniroBillAddress" runat="server" meta:resourcekey="txtWashEniroBillAddressResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashBillAddress" runat="server" meta:resourcekey="chkWashBillAddressResource1"></asp:CheckBox>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashZipCode" Text="Postnr" runat="server" meta:resourcekey="lblWashZipCodeResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalZipCode" runat="server" meta:resourcekey="txtWashLocalZipCodeResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                            <asp:TextBox ID="txtWashEniroZipCode" runat="server" meta:resourcekey="txtWashEniroZipCodeResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashZipCode" runat="server" meta:resourcekey="chkWashZipCodeResource1"></asp:CheckBox>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashZipPlace" Text="Sted" runat="server" meta:resourcekey="lblWashZipPlaceResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalZipPlace" runat="server" meta:resourcekey="txtWashLocalZipPlaceResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                              <asp:TextBox ID="txtWashEniroZipPlace" runat="server" meta:resourcekey="txtWashEniroZipPlaceResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashZipPlace" runat="server" meta:resourcekey="chkWashZipPlaceResource1"></asp:CheckBox>
                            </div>
                        </div>

                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashPhone" Text="Telefon" runat="server" meta:resourcekey="lblWashPhoneResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalPhone" runat="server" meta:resourcekey="txtWashLocalPhoneResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                            <asp:TextBox ID="txtWashEniroPhone" runat="server" meta:resourcekey="txtWashEniroPhoneResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashPhone" runat="server" meta:resourcekey="chkWashPhoneResource1"></asp:CheckBox>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashMobile" Text="Mobil" runat="server" meta:resourcekey="lblWashMobileResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalMobile" runat="server" meta:resourcekey="txtWashLocalMobileResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                            <asp:TextBox ID="txtWashEniroMobile" runat="server" meta:resourcekey="txtWashEniroMobileResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashMobile" runat="server" meta:resourcekey="chkWashMobileResource1"></asp:CheckBox>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashBorn" Text="Born" runat="server" meta:resourcekey="lblWashBornResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalBorn" runat="server" meta:resourcekey="txtWashLocalBornResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                            <asp:TextBox ID="txtWashEniroBorn" runat="server" meta:resourcekey="txtWashEniroBornResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashBorn" runat="server" meta:resourcekey="chkWashBornResource1"></asp:CheckBox>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="four wide field">
                               <label><asp:Label ID="lblWashSsnNo" Text="SSN No" runat="server" meta:resourcekey="lblWashSsnNoResource1"></asp:Label></label>
                            </div>
                            <div class="five wide field">
                                <asp:TextBox ID="txtWashLocalSsnNo" runat="server" meta:resourcekey="txtWashLocalSsnNoResource1"></asp:TextBox>
                            </div>
                            <div class="five wide field">
                            <asp:TextBox ID="txtWashEniroSsnNo" runat="server" meta:resourcekey="txtWashEniroSsnNoResource1"></asp:TextBox>
                            </div>
                            <div class="two wide field">
                                <asp:CheckBox ID="chkWashSsnNo" runat="server" meta:resourcekey="chkWashSsnNoResource1"></asp:CheckBox>
                            </div>
                        </div>
                </div>
            </div>
        </div>

    </div>
    <div class="actions">
        <div class="ui button ok positive">Oppdater</div>
        <div class="ui button cancel negative">Avbryt</div>
    </div>
    </div>

    <dx:ASPxPopupControl ID="popupCatalogue" runat="server" ShowFooter="false" ClientInstanceName="popupCatalogue" PopupHorizontalAlign="Center" Modal="True" HeaderText="Catalogue" PopupVerticalAlign="Middle" Top="250" Left="550" Width="500" Height="350" CloseAction="CloseButton" Theme="Office365" ShowCloseButton="true" AllowDragging="True">
        <ContentCollection>
            <dx:PopupControlContentControl>
                <div style="display: flex">
                    <div class="popupContent" style="border-right: 2px solid #aaa;">
                        <div class="two wide field">
                            <div id="btnOpenCatalogue" class="ui button">Open NBK</div>
                        </div>
                        <p></p>
                        <div class="two wide field">
                            <div id="btnOpenAutoFrontal" class="ui button">Autofrontal</div>
                        </div>
                    </div>
                    <div class="popupContentMiddle">
                        <div class="ui form">
                        <div class="fifteen wide field" style="padding-left:5%">
                            <input id="txtOdrNoBilGlPort" placeholder="OrderNo.(Bilglassportalen)" class="carsInput" runat="server" type="text" style="height:30px"/>
                        </div>
                            </div>
                        <p></p>
                        <div class="two wide field">
                            <div id="btnFetchBilglassportalen" class="ui button">Bilglassportalen</div>
                        </div>
                        <p></p>
                        <p></p>
                        <div class="two wide field">
                            <div id="btnFetchFromCart" class="ui button">Fetch</div>
                        </div>
                        <p></p>
                        <div class="two wide field">
                            <input id="btnFetchBargain" runat="server" class="ui button" value="Bargain Status" type="button" style="background-color: #E0E0E0" />
                        </div>
                        <p></p>
                        <div class="two wide field">
                            <input id="btnFetchXtraScheme" runat="server" class="ui button" value="XtraScheme Status" type="button" style="background-color: #E0E0E0" />
                        </div>
                    </div>
                    <div class="popupContent">
                        <div class="two wide field">
                            <div id="btnStockQuantity" class="ui button">Stock Quantity</div>
                        </div>
                    </div>
                </div>
            </dx:PopupControlContentControl>
        </ContentCollection>
    </dx:ASPxPopupControl>
     <dx:ASPxLoadingPanel ID="LoadingPanel" runat="server" ClientInstanceName="LoadingPanel" Modal="True"></dx:ASPxLoadingPanel>
    <dx:ASPxPopupControl ID="popupStockQuantity" runat="server" ShowFooter="false" ClientInstanceName="popupStockQuantity" PopupHorizontalAlign="WindowCenter" Modal="True" HeaderText="Stock Quantity" PopupVerticalAlign="WindowCenter" Width="500" Height="400" CloseAction="CloseButton" Theme="Office365" ShowCloseButton="true" AllowDragging="True">
       <ClientSideEvents Closing="popupStockQuantityClosing" />
        <ContentCollection>
            <dx:PopupControlContentControl>
                <dx:ASPxCallbackPanel ID="cbStockQuantity" ClientInstanceName="cbStockQuantity"  runat="server" OnCallback="cbStockQuantity_Callback" ClientSideEvents-EndCallback="cbStockQuantityEndCallback" >
                    <PanelCollection>
                        <dx:PanelContent runat="server">
                            <div class="ui stackable grid" style="padding-top:50px;padding-bottom:40px;">
                                <dx:ASPxGridView ID="gvStockQty" ClientInstanceName="gvStockQty" runat="server" OnBatchUpdate="gvStockQty_BatchUpdate" Width="100%" Theme="Office2010Blue" KeyFieldName="spareID" Settings-ShowPreview="false" Settings-ShowStatusBar="Hidden" ClientVisible="false"> 
                                    <SettingsBehavior AllowFocusedRow="true" AllowSelectByRowClick="true" AllowSort="false" AllowHeaderFilter="false"/>
                                    <SettingsEditing Mode="Batch" ></SettingsEditing>
                                    <ClientSideEvents BatchEditRowValidating="gvStockQtyBatchEditRowValidating"/>
                                    <Styles>
                                        <StatusBar CssClass="statusBar">
                                        </StatusBar>
                                        <FocusedRow BackColor="AliceBlue" ForeColor="Black" ></FocusedRow>
	                                    <SelectedRow BackColor="#e1e6e6" ForeColor="Black"></SelectedRow>
                                    </Styles>
                                   
                                    <Columns>
                                        <dx:GridViewCommandColumn ShowSelectCheckbox="true" SelectAllCheckboxMode="Page" />
                                        <dx:GridViewDataTextColumn FieldName="spareID" SortOrder="Descending" Caption="Spare Id" ReadOnly="true"></dx:GridViewDataTextColumn>
                                        <dx:GridViewDataTextColumn FieldName="navnLev" Caption="Name" ReadOnly="true"></dx:GridViewDataTextColumn>
                                        <dx:GridViewDataTextColumn FieldName="antallLev" Caption="Antall Lev" ReadOnly="true"></dx:GridViewDataTextColumn>
                                        <dx:GridViewDataTextColumn FieldName="antallSogb" Caption="Antall Sogb" ReadOnly="true"></dx:GridViewDataTextColumn>
                                        <dx:GridViewDataSpinEditColumn FieldName="bestilt" Caption="Bestilt" PropertiesSpinEdit-MinValue="0" ReadOnly="false" PropertiesSpinEdit-AllowUserInput="true" PropertiesSpinEdit-AllowMouseWheel="true"></dx:GridViewDataSpinEditColumn>
                                    </Columns>
                                </dx:ASPxGridView>
                            </div>
                            <div class="ui stackable grid">
                                <div class="one wide column">
                                    <input id="btnSendPurchase" runat="server" class="ui button" value="SendPurchase" type="button" onclick="SendPurchase()" style="display:none"/>
                                    <%--<div id="btnSendPurchase"  class="ui button">Send Purchase</div>--%>
                                </div>
                                <div class="seven wide column">
                                    
                                </div>

                                <div class="four wide column" style="float:right">
                                    <dx:ASPxMemo ID="txtAPIAnnotation" Font-Size="Medium" ClientInstanceName="txtAPIAnnotation" runat="server" NullText="Type Annotation here" ClientVisible="false" CssClass="customMlMemo" FocusedStyle-Border-BorderColor="#2185d0"></dx:ASPxMemo> 
                                </div>
                            </div>
                            <div class="ui stackable grid"></div>
                        </dx:PanelContent>
                    </PanelCollection>
                </dx:ASPxCallbackPanel>
            </dx:PopupControlContentControl>
        </ContentCollection>
    </dx:ASPxPopupControl>
    <dx:ASPxCallbackPanel ID="cbPanel" ClientInstanceName="cbPanel" runat="server" OnCallback="cbPanel_Callback"  ClientSideEvents-EndCallback="OnEndCallbackcbOpenReport">
        <PanelCollection>
            <dx:PanelContent>
                <div>
                    <div>
                        <dx:ASPxPopupControl ID="popupReport" runat="server" ClientInstanceName="popupReport" AllowDragging="false" Modal="True" Theme="iOS" CloseAction="CloseButton">

                            <Windows>
                                <dx:PopupWindow ContentUrl="ReportViewer_Transaction.aspx" HeaderText="Report" Name="report"
                                    Text="Report" Height="700px" Left="300" Width="1200px" Modal="True" Top="100">
                                </dx:PopupWindow>
                            </Windows>
                        </dx:ASPxPopupControl>
                    </div>
                </div>
            </dx:PanelContent>
        </PanelCollection>
    </dx:ASPxCallbackPanel>
    <dx:ASPxCallback ID="cbSendPurchase" ClientInstanceName="cbSendPurchase" runat="server" OnCallback="cbSendPurchase_Callback" ClientSideEvents-EndCallback="cbSendPurchaseEndCallback"></dx:ASPxCallback>
    <div id="modRepairPackage" class="ui modal" style="width: 1000px; height: 500px; overflow: scroll;">
        <i class="close icon"></i>
        <div class="header">
            Select Repair Package
        </div>
        <div class="content">
            <div class="ui grid">
                <div class="sixteen wide column">
                    <div class="ui form">
                        <div class="inline fields">
                            <div class="three wide field">
                                <label>
                                    <asp:Label ID="lblRPCodeSearch" Text="Search Repair Package" runat="server"></asp:Label>
                                </label>
                            </div>
                            <div class="one wide field"></div>
                        </div>
                        <div class="inline fields">
                            <div class="three wide field">
                                <input id="txtRPCodeSearch" type="text" style="width: 200px" />
                            </div>
                            <div class="one wide field"></div>
                            <div class="two wide field">
                            <input type="button" id="btnSearch" runat="server" value="Search" class="ui btn" onclick="SearchRepairPackage()"/>
                        </div>
                            <div>
                                 <asp:Label ID="lblSearchResult" Text="" runat="server" ForeColor="Red"></asp:Label>
                            </div>
                        </div>
                         <dx:ASPxCallbackPanel ID="cbRepPack" ClientInstanceName="cbRepPack"  runat="server" OnCallback="cbRepPack_Callback" ClientSideEvents-EndCallback="OncbRepPackEndCallback" >
                    <PanelCollection>
                        <dx:PanelContent runat="server">
                        <div id="divRepPack">
                            <dx:ASPxListBox ID="lbRepPakHead" ClientInstanceName="lbRepPakHead" runat="server" SelectionMode="Single" CssClass="cls" Width="100%" Height="200" ValueField="ID_RPKG_SEQ" Theme="Office2010Blue" ClientSideEvents-ItemDoubleClick="OnlbRepPakHeadItemDoubleClick">
                                <CaptionSettings Position="Top"/>
                                <Columns>
                                    <dx:ListBoxColumn FieldName="ID_RPKG_SEQ" ClientVisible="false"/>
                                    <dx:ListBoxColumn FieldName="MAKE" Caption="Merke." Width="20%"/>
                                    <dx:ListBoxColumn FieldName="JOB_ID" Caption="Jobbpakke." Width="20%"/>
                                    <dx:ListBoxColumn FieldName="JOB_TITLE" Caption="Tittel" Width="40%"/>
                                    <dx:ListBoxColumn FieldName="OPERATION_CODE" Caption="Gruppe" Width="20%"/>
                                </Columns>
                            </dx:ASPxListBox>
                        </div>
                            </dx:PanelContent>
                    </PanelCollection>
                </dx:ASPxCallbackPanel>
                        <div class="inline fields">
                            <div class="four wide field">
                                </div>
                            </div>
                        <div class="actions">
                            <div class="ui button ok positive">Ok</div>
                            <div class="ui button cancel negative">Avbryt</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</asp:Content>
