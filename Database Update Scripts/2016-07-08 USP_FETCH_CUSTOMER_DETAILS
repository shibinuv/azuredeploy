USE [CARSDEV]
GO
/****** Object:  StoredProcedure [dbo].[USP_FETCH_CUSTOMER_DETAILS]    Script Date: 08.07.2016 14:51:03 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Dag Jakobsen
-- Create date: 15.09.2015
-- Description:	To fetch customer details
-- Modified: 2015/12/2 TWN - Added new columns FLG_NO_GM and FLG_NO_ENV_FEE
-- =============================================
ALTER PROCEDURE [dbo].[USP_FETCH_CUSTOMER_DETAILS]
	-- Add the parameters for the stored procedure here
	@ID_CUST varchar(10) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
SELECT 
ID_CUSTOMER,			
CUST_NAME,			
CUST_GEN_TYPE,		
ID_CUST_GROUP,		
CUST_CONTACT_PERSON,	
ID_CUST_REG_CD,		
ID_CUST_PC_CODE,		
ID_CUST_DISC_CD,	
CUST_SSN_NO,			
CUST_DRIV_LICNO,		
CUST_PHONE_OFF,		
CUST_PHONE_HOME,		
CUST_PHONE_MOBILE,	
CUST_FAX,			
CUST_ID_EMAIL,		
CUST_REMARKS,		
CUST_PERM_ADD1,		
CUST_PERM_ADD2,		
ID_CUST_PERM_ZIPCODE,
isnull(TMZ2.ZIP_CITY, '') AS CUST_PERM_CITY,
CUST_BILL_ADD1,		
CUST_BILL_ADD2,		
ID_CUST_BILL_ZIPCODE,
isnull(TMZ1.ZIP_CITY, '') AS CUST_BILL_CITY,
CUST_ACCOUNT_NO,		
ID_CUST_PAY_TYPE,	
ID_CUST_CURRENCY,	
CUST_CREDIT_LIMIT,	
CUST_UNUTIL_CREDIT,	
ID_CUST_WARN,		
ID_CUST_PAY_TERM,	
FLG_CUST_INACTIVE,	
FLG_CUST_ADV,		
FLG_CUST_FACTORING,	
FLG_CUST_BATCHINV,	
FLG_CUST_NOCREDIT,	
TMC.CREATED_BY,			
TMC.DT_CREATED,			
TMC.MODIFIED_BY,			
TMC.DT_MODIFIED,			
CUST_BALANCE,		
IsSameAddress,		
IsExported,			
CUST_HOURLYPRICE,	
FLG_COSTPRICE,		
COSTPRICE,			
CUST_GARAGEMAT,		
CUST_SUB,			
CUST_DEP,			
FLG_CUST_IGNOREINV,	
FLG_INV_EMAIL,		
CUST_INV_EMAIL,
CUST_FIRST_NAME,
CUST_MIDDLE_NAME,
CUST_LAST_NAME,	
CUST_PHONE_ALT,
CUST_HOMEPAGE,
CUST_COUNTRY,
CUST_VISIT_ADDRESS,
CUST_MAIL_ADDRESS,
FLG_EINVOICE,		
FLG_ORDCONF_EMAIL,	
FLG_NO_SMS,
FLG_NO_EMAIL,		
FLG_NO_MARKETING,	
FLG_NO_HUMANEORG,	
FLG_NO_PHONESALE,	
FLG_PRIVATE_COMP,	
FLG_NO_ENV_FEE,
FLG_NO_GM,
FLG_PROSPECT,
CUST_NOTES,
CUST_PHONE_ALT,
CUST_DISC_GENERAL,
CUST_DISC_LABOUR,
CUST_DISC_SPARES,
CUST_ENIRO_ID,
DT_CUST_BORN,
CUST_COMPANY_NO,
CUST_COMPANY_DESCRIPTION,
ID_CP

 FROM TBL_MAS_CUSTOMER TMC
 left JOIN TBL_MAS_ZIPCODE TMZ1
 ON TMC.ID_CUST_BILL_ZIPCODE = TMZ1.ZIP_ZIPCODE
 left JOIN TBL_MAS_ZIPCODE TMZ2
 ON TMC.ID_CUST_PERM_ZIPCODE = TMZ2.ZIP_ZIPCODE
 WHERE ID_CUSTOMER = @ID_CUST 
END
